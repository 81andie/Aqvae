var uk=Object.create;var B1=Object.defineProperty,hk=Object.defineProperties,dk=Object.getOwnPropertyDescriptor,fk=Object.getOwnPropertyDescriptors,pk=Object.getOwnPropertyNames,ry=Object.getOwnPropertySymbols,mk=Object.getPrototypeOf,V1=Object.prototype.hasOwnProperty,_M=Object.prototype.propertyIsEnumerable;var gM=(n,s,o)=>s in n?B1(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o,St=(n,s)=>{for(var o in s||={})V1.call(s,o)&&gM(n,o,s[o]);if(ry)for(var o of ry(s))_M.call(s,o)&&gM(n,o,s[o]);return n},yi=(n,s)=>hk(n,fk(s));var oy=(n,s)=>{var o={};for(var u in n)V1.call(n,u)&&s.indexOf(u)<0&&(o[u]=n[u]);if(n!=null&&ry)for(var u of ry(n))s.indexOf(u)<0&&_M.call(n,u)&&(o[u]=n[u]);return o};var gk=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports);var _k=(n,s,o,u)=>{if(s&&typeof s=="object"||typeof s=="function")for(let _ of pk(s))!V1.call(n,_)&&_!==o&&B1(n,_,{get:()=>s[_],enumerable:!(u=dk(s,_))||u.enumerable});return n};var yk=(n,s,o)=>(o=n!=null?uk(mk(n)):{},_k(s||!n||!n.__esModule?B1(o,"default",{value:n,enumerable:!0}):o,n));var sy=(n,s,o)=>new Promise((u,_)=>{var i=$=>{try{V(o.next($))}catch(re){_(re)}},P=$=>{try{V(o.throw($))}catch(re){_(re)}},V=$=>$.done?u($.value):Promise.resolve($.value).then(i,P);V((o=o.apply(n,s)).next())});var AR=gk((BE,VE)=>{"use strict";(function(n,s){typeof BE=="object"&&typeof VE<"u"?VE.exports=s():typeof define=="function"&&define.amd?define(s):(n=typeof globalThis<"u"?globalThis:n||self,n.mapboxgl=s())})(BE,function(){"use strict";var n,s,o;function u(i,P){if(!n)n=P;else if(!s)s=P;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",$={};n($),o=P($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}u(["exports"],function(i){function P(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var V,$={},re={};function xe(){if(V)return re;V=1,Object.defineProperty(re,"__esModule",{value:!0}),re.setMatrixArrayType=function(p){re.ARRAY_TYPE=e=p},re.toRadian=function(p){return p*c},re.equals=function(p,h){return Math.abs(p-h)<=l*Math.max(1,Math.abs(p),Math.abs(h))},re.RANDOM=re.ARRAY_TYPE=re.EPSILON=void 0;var l=1e-6;re.EPSILON=l;var e=typeof Float32Array<"u"?Float32Array:Array;re.ARRAY_TYPE=e;var r=Math.random;re.RANDOM=r;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,h=arguments.length;h--;)p+=arguments[h]*arguments[h];return Math.sqrt(p)}),re}var Pe,Xe={};function Ze(){if(Pe)return Xe;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}Pe=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.create=function(){var h=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},Xe.clone=function(h){var m=new e.ARRAY_TYPE(4);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m},Xe.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h},Xe.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},Xe.fromValues=function(h,m,x,E){var D=new e.ARRAY_TYPE(4);return D[0]=h,D[1]=m,D[2]=x,D[3]=E,D},Xe.set=function(h,m,x,E,D){return h[0]=m,h[1]=x,h[2]=E,h[3]=D,h},Xe.transpose=function(h,m){if(h===m){var x=m[1];h[1]=m[2],h[2]=x}else h[0]=m[0],h[1]=m[2],h[2]=m[1],h[3]=m[3];return h},Xe.invert=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=x*y-D*E;return w?(h[0]=y*(w=1/w),h[1]=-E*w,h[2]=-D*w,h[3]=x*w,h):null},Xe.adjoint=function(h,m){var x=m[0];return h[0]=m[3],h[1]=-m[1],h[2]=-m[2],h[3]=x,h},Xe.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},Xe.multiply=c,Xe.rotate=function(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=Math.sin(x),T=Math.cos(x);return h[0]=E*T+y*C,h[1]=D*T+w*C,h[2]=E*-C+y*T,h[3]=D*-C+w*T,h},Xe.scale=function(h,m,x){var E=m[1],D=m[2],y=m[3],w=x[0],C=x[1];return h[0]=m[0]*w,h[1]=E*w,h[2]=D*C,h[3]=y*C,h},Xe.fromRotation=function(h,m){var x=Math.sin(m),E=Math.cos(m);return h[0]=E,h[1]=x,h[2]=-x,h[3]=E,h},Xe.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h},Xe.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},Xe.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},Xe.LDU=function(h,m,x,E){return h[2]=E[2]/E[0],x[0]=E[0],x[1]=E[1],x[3]=E[3]-h[2]*x[1],[h,m,x]},Xe.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h},Xe.subtract=p,Xe.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]},Xe.equals=function(h,m){var x=h[0],E=h[1],D=h[2],y=h[3],w=m[0],C=m[1],T=m[2],I=m[3];return Math.abs(x-w)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(w))&&Math.abs(E-C)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(C))&&Math.abs(D-T)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(T))&&Math.abs(y-I)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(I))},Xe.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h},Xe.multiplyScalarAndAdd=function(h,m,x,E){return h[0]=m[0]+x[0]*E,h[1]=m[1]+x[1]*E,h[2]=m[2]+x[2]*E,h[3]=m[3]+x[3]*E,h},Xe.sub=Xe.mul=void 0;var e=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=r(void 0);if(x&&x.has(h))return x.get(h);var E={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var w=D?Object.getOwnPropertyDescriptor(h,y):null;w&&(w.get||w.set)?Object.defineProperty(E,y,w):E[y]=h[y]}return E.default=h,x&&x.set(h,E),E}(xe());function r(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(r=function(E){return E?x:m})(h)}function c(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=x[0],T=x[1],I=x[2],S=x[3];return h[0]=E*C+y*T,h[1]=D*C+w*T,h[2]=E*I+y*S,h[3]=D*I+w*S,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h}return Xe.mul=c,Xe.sub=p,Xe}var yt,lt={};function Ut(){if(yt)return lt;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}yt=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=function(){var h=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},lt.clone=function(h){var m=new e.ARRAY_TYPE(6);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m},lt.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h},lt.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},lt.fromValues=function(h,m,x,E,D,y){var w=new e.ARRAY_TYPE(6);return w[0]=h,w[1]=m,w[2]=x,w[3]=E,w[4]=D,w[5]=y,w},lt.set=function(h,m,x,E,D,y,w){return h[0]=m,h[1]=x,h[2]=E,h[3]=D,h[4]=y,h[5]=w,h},lt.invert=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=m[4],C=m[5],T=x*y-E*D;return T?(h[0]=y*(T=1/T),h[1]=-E*T,h[2]=-D*T,h[3]=x*T,h[4]=(D*C-y*w)*T,h[5]=(E*w-x*C)*T,h):null},lt.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},lt.multiply=c,lt.rotate=function(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=Math.sin(x),S=Math.cos(x);return h[0]=E*S+y*I,h[1]=D*S+w*I,h[2]=E*-I+y*S,h[3]=D*-I+w*S,h[4]=C,h[5]=T,h},lt.scale=function(h,m,x){var E=m[1],D=m[2],y=m[3],w=m[4],C=m[5],T=x[0],I=x[1];return h[0]=m[0]*T,h[1]=E*T,h[2]=D*I,h[3]=y*I,h[4]=w,h[5]=C,h},lt.translate=function(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=x[0],S=x[1];return h[0]=E,h[1]=D,h[2]=y,h[3]=w,h[4]=E*I+y*S+C,h[5]=D*I+w*S+T,h},lt.fromRotation=function(h,m){var x=Math.sin(m),E=Math.cos(m);return h[0]=E,h[1]=x,h[2]=-x,h[3]=E,h[4]=0,h[5]=0,h},lt.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h[4]=0,h[5]=0,h},lt.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=m[0],h[5]=m[1],h},lt.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},lt.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},lt.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h},lt.subtract=p,lt.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h},lt.multiplyScalarAndAdd=function(h,m,x,E){return h[0]=m[0]+x[0]*E,h[1]=m[1]+x[1]*E,h[2]=m[2]+x[2]*E,h[3]=m[3]+x[3]*E,h[4]=m[4]+x[4]*E,h[5]=m[5]+x[5]*E,h},lt.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]},lt.equals=function(h,m){var x=h[0],E=h[1],D=h[2],y=h[3],w=h[4],C=h[5],T=m[0],I=m[1],S=m[2],R=m[3],F=m[4],B=m[5];return Math.abs(x-T)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(T))&&Math.abs(E-I)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(D-S)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(S))&&Math.abs(y-R)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(w-F)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(F))&&Math.abs(C-B)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))},lt.sub=lt.mul=void 0;var e=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=r(void 0);if(x&&x.has(h))return x.get(h);var E={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var w=D?Object.getOwnPropertyDescriptor(h,y):null;w&&(w.get||w.set)?Object.defineProperty(E,y,w):E[y]=h[y]}return E.default=h,x&&x.set(h,E),E}(xe());function r(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(r=function(E){return E?x:m})(h)}function c(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=x[0],S=x[1],R=x[2],F=x[3],B=x[4],U=x[5];return h[0]=E*I+y*S,h[1]=D*I+w*S,h[2]=E*R+y*F,h[3]=D*R+w*F,h[4]=E*B+y*U+C,h[5]=D*B+w*U+T,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h}return lt.mul=c,lt.sub=p,lt}var un,an={};function Zn(){if(un)return an;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}un=1,Object.defineProperty(an,"__esModule",{value:!0}),an.create=function(){var h=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},an.fromMat4=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[4],h[4]=m[5],h[5]=m[6],h[6]=m[8],h[7]=m[9],h[8]=m[10],h},an.clone=function(h){var m=new e.ARRAY_TYPE(9);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m[6]=h[6],m[7]=h[7],m[8]=h[8],m},an.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},an.fromValues=function(h,m,x,E,D,y,w,C,T){var I=new e.ARRAY_TYPE(9);return I[0]=h,I[1]=m,I[2]=x,I[3]=E,I[4]=D,I[5]=y,I[6]=w,I[7]=C,I[8]=T,I},an.set=function(h,m,x,E,D,y,w,C,T,I){return h[0]=m,h[1]=x,h[2]=E,h[3]=D,h[4]=y,h[5]=w,h[6]=C,h[7]=T,h[8]=I,h},an.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},an.transpose=function(h,m){if(h===m){var x=m[1],E=m[2],D=m[5];h[1]=m[3],h[2]=m[6],h[3]=x,h[5]=m[7],h[6]=E,h[7]=D}else h[0]=m[0],h[1]=m[3],h[2]=m[6],h[3]=m[1],h[4]=m[4],h[5]=m[7],h[6]=m[2],h[7]=m[5],h[8]=m[8];return h},an.invert=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=m[4],C=m[5],T=m[6],I=m[7],S=m[8],R=S*w-C*I,F=-S*y+C*T,B=I*y-w*T,U=x*R+E*F+D*B;return U?(h[0]=R*(U=1/U),h[1]=(-S*E+D*I)*U,h[2]=(C*E-D*w)*U,h[3]=F*U,h[4]=(S*x-D*T)*U,h[5]=(-C*x+D*y)*U,h[6]=B*U,h[7]=(-I*x+E*T)*U,h[8]=(w*x-E*y)*U,h):null},an.adjoint=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=m[4],C=m[5],T=m[6],I=m[7],S=m[8];return h[0]=w*S-C*I,h[1]=D*I-E*S,h[2]=E*C-D*w,h[3]=C*T-y*S,h[4]=x*S-D*T,h[5]=D*y-x*C,h[6]=y*I-w*T,h[7]=E*T-x*I,h[8]=x*w-E*y,h},an.determinant=function(h){var m=h[3],x=h[4],E=h[5],D=h[6],y=h[7],w=h[8];return h[0]*(w*x-E*y)+h[1]*(-w*m+E*D)+h[2]*(y*m-x*D)},an.multiply=c,an.translate=function(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=m[6],S=m[7],R=m[8],F=x[0],B=x[1];return h[0]=E,h[1]=D,h[2]=y,h[3]=w,h[4]=C,h[5]=T,h[6]=F*E+B*w+I,h[7]=F*D+B*C+S,h[8]=F*y+B*T+R,h},an.rotate=function(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=m[6],S=m[7],R=m[8],F=Math.sin(x),B=Math.cos(x);return h[0]=B*E+F*w,h[1]=B*D+F*C,h[2]=B*y+F*T,h[3]=B*w-F*E,h[4]=B*C-F*D,h[5]=B*T-F*y,h[6]=I,h[7]=S,h[8]=R,h},an.scale=function(h,m,x){var E=x[0],D=x[1];return h[0]=E*m[0],h[1]=E*m[1],h[2]=E*m[2],h[3]=D*m[3],h[4]=D*m[4],h[5]=D*m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},an.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=m[0],h[7]=m[1],h[8]=1,h},an.fromRotation=function(h,m){var x=Math.sin(m),E=Math.cos(m);return h[0]=E,h[1]=x,h[2]=0,h[3]=-x,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},an.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=0,h[4]=m[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},an.fromMat2d=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=0,h[3]=m[2],h[4]=m[3],h[5]=0,h[6]=m[4],h[7]=m[5],h[8]=1,h},an.fromQuat=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=x+x,C=E+E,T=D+D,I=x*w,S=E*w,R=E*C,F=D*w,B=D*C,U=D*T,k=y*w,G=y*C,H=y*T;return h[0]=1-R-U,h[3]=S-H,h[6]=F+G,h[1]=S+H,h[4]=1-I-U,h[7]=B-k,h[2]=F-G,h[5]=B+k,h[8]=1-I-R,h},an.normalFromMat4=function(h,m){var x=m[0],E=m[1],D=m[2],y=m[3],w=m[4],C=m[5],T=m[6],I=m[7],S=m[8],R=m[9],F=m[10],B=m[11],U=m[12],k=m[13],G=m[14],H=m[15],K=x*C-E*w,te=x*T-D*w,ie=x*I-y*w,Q=E*T-D*C,ue=E*I-y*C,se=D*I-y*T,de=S*k-R*U,ve=S*G-F*U,Te=S*H-B*U,Ee=R*G-F*k,Ie=R*H-B*k,Oe=F*H-B*G,De=K*Oe-te*Ie+ie*Ee+Q*Te-ue*ve+se*de;return De?(h[0]=(C*Oe-T*Ie+I*Ee)*(De=1/De),h[1]=(T*Te-w*Oe-I*ve)*De,h[2]=(w*Ie-C*Te+I*de)*De,h[3]=(D*Ie-E*Oe-y*Ee)*De,h[4]=(x*Oe-D*Te+y*ve)*De,h[5]=(E*Te-x*Ie-y*de)*De,h[6]=(k*se-G*ue+H*Q)*De,h[7]=(G*ie-U*se-H*te)*De,h[8]=(U*ue-k*ie+H*K)*De,h):null},an.projection=function(h,m,x){return h[0]=2/m,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/x,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},an.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},an.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},an.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h[6]=m[6]+x[6],h[7]=m[7]+x[7],h[8]=m[8]+x[8],h},an.subtract=p,an.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h[6]=m[6]*x,h[7]=m[7]*x,h[8]=m[8]*x,h},an.multiplyScalarAndAdd=function(h,m,x,E){return h[0]=m[0]+x[0]*E,h[1]=m[1]+x[1]*E,h[2]=m[2]+x[2]*E,h[3]=m[3]+x[3]*E,h[4]=m[4]+x[4]*E,h[5]=m[5]+x[5]*E,h[6]=m[6]+x[6]*E,h[7]=m[7]+x[7]*E,h[8]=m[8]+x[8]*E,h},an.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]&&h[6]===m[6]&&h[7]===m[7]&&h[8]===m[8]},an.equals=function(h,m){var x=h[0],E=h[1],D=h[2],y=h[3],w=h[4],C=h[5],T=h[6],I=h[7],S=h[8],R=m[0],F=m[1],B=m[2],U=m[3],k=m[4],G=m[5],H=m[6],K=m[7],te=m[8];return Math.abs(x-R)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(R))&&Math.abs(E-F)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(F))&&Math.abs(D-B)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(B))&&Math.abs(y-U)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(w-k)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(k))&&Math.abs(C-G)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(T-H)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(H))&&Math.abs(I-K)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(K))&&Math.abs(S-te)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(te))},an.sub=an.mul=void 0;var e=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=r(void 0);if(x&&x.has(h))return x.get(h);var E={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var w=D?Object.getOwnPropertyDescriptor(h,y):null;w&&(w.get||w.set)?Object.defineProperty(E,y,w):E[y]=h[y]}return E.default=h,x&&x.set(h,E),E}(xe());function r(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(r=function(E){return E?x:m})(h)}function c(h,m,x){var E=m[0],D=m[1],y=m[2],w=m[3],C=m[4],T=m[5],I=m[6],S=m[7],R=m[8],F=x[0],B=x[1],U=x[2],k=x[3],G=x[4],H=x[5],K=x[6],te=x[7],ie=x[8];return h[0]=F*E+B*w+U*I,h[1]=F*D+B*C+U*S,h[2]=F*y+B*T+U*R,h[3]=k*E+G*w+H*I,h[4]=k*D+G*C+H*S,h[5]=k*y+G*T+H*R,h[6]=K*E+te*w+ie*I,h[7]=K*D+te*C+ie*S,h[8]=K*y+te*T+ie*R,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h[6]=m[6]-x[6],h[7]=m[7]-x[7],h[8]=m[8]-x[8],h}return an.mul=c,an.sub=p,an}var Li,At={};function zi(){if(Li)return At;function l(y){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},l(y)}Li=1,Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var y=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0),y[0]=1,y[5]=1,y[10]=1,y[15]=1,y},At.clone=function(y){var w=new e.ARRAY_TYPE(16);return w[0]=y[0],w[1]=y[1],w[2]=y[2],w[3]=y[3],w[4]=y[4],w[5]=y[5],w[6]=y[6],w[7]=y[7],w[8]=y[8],w[9]=y[9],w[10]=y[10],w[11]=y[11],w[12]=y[12],w[13]=y[13],w[14]=y[14],w[15]=y[15],w},At.copy=function(y,w){return y[0]=w[0],y[1]=w[1],y[2]=w[2],y[3]=w[3],y[4]=w[4],y[5]=w[5],y[6]=w[6],y[7]=w[7],y[8]=w[8],y[9]=w[9],y[10]=w[10],y[11]=w[11],y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15],y},At.fromValues=function(y,w,C,T,I,S,R,F,B,U,k,G,H,K,te,ie){var Q=new e.ARRAY_TYPE(16);return Q[0]=y,Q[1]=w,Q[2]=C,Q[3]=T,Q[4]=I,Q[5]=S,Q[6]=R,Q[7]=F,Q[8]=B,Q[9]=U,Q[10]=k,Q[11]=G,Q[12]=H,Q[13]=K,Q[14]=te,Q[15]=ie,Q},At.set=function(y,w,C,T,I,S,R,F,B,U,k,G,H,K,te,ie,Q){return y[0]=w,y[1]=C,y[2]=T,y[3]=I,y[4]=S,y[5]=R,y[6]=F,y[7]=B,y[8]=U,y[9]=k,y[10]=G,y[11]=H,y[12]=K,y[13]=te,y[14]=ie,y[15]=Q,y},At.identity=c,At.transpose=function(y,w){if(y===w){var C=w[1],T=w[2],I=w[3],S=w[6],R=w[7],F=w[11];y[1]=w[4],y[2]=w[8],y[3]=w[12],y[4]=C,y[6]=w[9],y[7]=w[13],y[8]=T,y[9]=S,y[11]=w[14],y[12]=I,y[13]=R,y[14]=F}else y[0]=w[0],y[1]=w[4],y[2]=w[8],y[3]=w[12],y[4]=w[1],y[5]=w[5],y[6]=w[9],y[7]=w[13],y[8]=w[2],y[9]=w[6],y[10]=w[10],y[11]=w[14],y[12]=w[3],y[13]=w[7],y[14]=w[11],y[15]=w[15];return y},At.invert=function(y,w){var C=w[0],T=w[1],I=w[2],S=w[3],R=w[4],F=w[5],B=w[6],U=w[7],k=w[8],G=w[9],H=w[10],K=w[11],te=w[12],ie=w[13],Q=w[14],ue=w[15],se=C*F-T*R,de=C*B-I*R,ve=C*U-S*R,Te=T*B-I*F,Ee=T*U-S*F,Ie=I*U-S*B,Oe=k*ie-G*te,De=k*Q-H*te,je=k*ue-K*te,We=G*Q-H*ie,Ne=G*ue-K*ie,ut=H*ue-K*Q,ot=se*ut-de*Ne+ve*We+Te*je-Ee*De+Ie*Oe;return ot?(y[0]=(F*ut-B*Ne+U*We)*(ot=1/ot),y[1]=(I*Ne-T*ut-S*We)*ot,y[2]=(ie*Ie-Q*Ee+ue*Te)*ot,y[3]=(H*Ee-G*Ie-K*Te)*ot,y[4]=(B*je-R*ut-U*De)*ot,y[5]=(C*ut-I*je+S*De)*ot,y[6]=(Q*ve-te*Ie-ue*de)*ot,y[7]=(k*Ie-H*ve+K*de)*ot,y[8]=(R*Ne-F*je+U*Oe)*ot,y[9]=(T*je-C*Ne-S*Oe)*ot,y[10]=(te*Ee-ie*ve+ue*se)*ot,y[11]=(G*ve-k*Ee-K*se)*ot,y[12]=(F*De-R*We-B*Oe)*ot,y[13]=(C*We-T*De+I*Oe)*ot,y[14]=(ie*de-te*Te-Q*se)*ot,y[15]=(k*Te-G*de+H*se)*ot,y):null},At.adjoint=function(y,w){var C=w[0],T=w[1],I=w[2],S=w[3],R=w[4],F=w[5],B=w[6],U=w[7],k=w[8],G=w[9],H=w[10],K=w[11],te=w[12],ie=w[13],Q=w[14],ue=w[15];return y[0]=F*(H*ue-K*Q)-G*(B*ue-U*Q)+ie*(B*K-U*H),y[1]=-(T*(H*ue-K*Q)-G*(I*ue-S*Q)+ie*(I*K-S*H)),y[2]=T*(B*ue-U*Q)-F*(I*ue-S*Q)+ie*(I*U-S*B),y[3]=-(T*(B*K-U*H)-F*(I*K-S*H)+G*(I*U-S*B)),y[4]=-(R*(H*ue-K*Q)-k*(B*ue-U*Q)+te*(B*K-U*H)),y[5]=C*(H*ue-K*Q)-k*(I*ue-S*Q)+te*(I*K-S*H),y[6]=-(C*(B*ue-U*Q)-R*(I*ue-S*Q)+te*(I*U-S*B)),y[7]=C*(B*K-U*H)-R*(I*K-S*H)+k*(I*U-S*B),y[8]=R*(G*ue-K*ie)-k*(F*ue-U*ie)+te*(F*K-U*G),y[9]=-(C*(G*ue-K*ie)-k*(T*ue-S*ie)+te*(T*K-S*G)),y[10]=C*(F*ue-U*ie)-R*(T*ue-S*ie)+te*(T*U-S*F),y[11]=-(C*(F*K-U*G)-R*(T*K-S*G)+k*(T*U-S*F)),y[12]=-(R*(G*Q-H*ie)-k*(F*Q-B*ie)+te*(F*H-B*G)),y[13]=C*(G*Q-H*ie)-k*(T*Q-I*ie)+te*(T*H-I*G),y[14]=-(C*(F*Q-B*ie)-R*(T*Q-I*ie)+te*(T*B-I*F)),y[15]=C*(F*H-B*G)-R*(T*H-I*G)+k*(T*B-I*F),y},At.determinant=function(y){var w=y[0],C=y[1],T=y[2],I=y[3],S=y[4],R=y[5],F=y[6],B=y[7],U=y[8],k=y[9],G=y[10],H=y[11],K=y[12],te=y[13],ie=y[14],Q=y[15];return(w*R-C*S)*(G*Q-H*ie)-(w*F-T*S)*(k*Q-H*te)+(w*B-I*S)*(k*ie-G*te)+(C*F-T*R)*(U*Q-H*K)-(C*B-I*R)*(U*ie-G*K)+(T*B-I*F)*(U*te-k*K)},At.multiply=p,At.translate=function(y,w,C){var T,I,S,R,F,B,U,k,G,H,K,te,ie=C[0],Q=C[1],ue=C[2];return w===y?(y[12]=w[0]*ie+w[4]*Q+w[8]*ue+w[12],y[13]=w[1]*ie+w[5]*Q+w[9]*ue+w[13],y[14]=w[2]*ie+w[6]*Q+w[10]*ue+w[14],y[15]=w[3]*ie+w[7]*Q+w[11]*ue+w[15]):(I=w[1],S=w[2],R=w[3],F=w[4],B=w[5],U=w[6],k=w[7],G=w[8],H=w[9],K=w[10],te=w[11],y[0]=T=w[0],y[1]=I,y[2]=S,y[3]=R,y[4]=F,y[5]=B,y[6]=U,y[7]=k,y[8]=G,y[9]=H,y[10]=K,y[11]=te,y[12]=T*ie+F*Q+G*ue+w[12],y[13]=I*ie+B*Q+H*ue+w[13],y[14]=S*ie+U*Q+K*ue+w[14],y[15]=R*ie+k*Q+te*ue+w[15]),y},At.scale=function(y,w,C){var T=C[0],I=C[1],S=C[2];return y[0]=w[0]*T,y[1]=w[1]*T,y[2]=w[2]*T,y[3]=w[3]*T,y[4]=w[4]*I,y[5]=w[5]*I,y[6]=w[6]*I,y[7]=w[7]*I,y[8]=w[8]*S,y[9]=w[9]*S,y[10]=w[10]*S,y[11]=w[11]*S,y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15],y},At.rotate=function(y,w,C,T){var I,S,R,F,B,U,k,G,H,K,te,ie,Q,ue,se,de,ve,Te,Ee,Ie,Oe,De,je,We,Ne=T[0],ut=T[1],ot=T[2],tt=Math.hypot(Ne,ut,ot);return tt<e.EPSILON?null:(Ne*=tt=1/tt,ut*=tt,ot*=tt,I=Math.sin(C),S=Math.cos(C),B=w[1],U=w[2],k=w[3],H=w[5],K=w[6],te=w[7],Q=w[9],ue=w[10],se=w[11],de=Ne*Ne*(R=1-S)+S,Ee=Ne*ut*R-ot*I,Ie=ut*ut*R+S,Oe=ot*ut*R+Ne*I,De=Ne*ot*R+ut*I,je=ut*ot*R-Ne*I,We=ot*ot*R+S,y[0]=(F=w[0])*de+(G=w[4])*(ve=ut*Ne*R+ot*I)+(ie=w[8])*(Te=ot*Ne*R-ut*I),y[1]=B*de+H*ve+Q*Te,y[2]=U*de+K*ve+ue*Te,y[3]=k*de+te*ve+se*Te,y[4]=F*Ee+G*Ie+ie*Oe,y[5]=B*Ee+H*Ie+Q*Oe,y[6]=U*Ee+K*Ie+ue*Oe,y[7]=k*Ee+te*Ie+se*Oe,y[8]=F*De+G*je+ie*We,y[9]=B*De+H*je+Q*We,y[10]=U*De+K*je+ue*We,y[11]=k*De+te*je+se*We,w!==y&&(y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15]),y)},At.rotateX=function(y,w,C){var T=Math.sin(C),I=Math.cos(C),S=w[4],R=w[5],F=w[6],B=w[7],U=w[8],k=w[9],G=w[10],H=w[11];return w!==y&&(y[0]=w[0],y[1]=w[1],y[2]=w[2],y[3]=w[3],y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15]),y[4]=S*I+U*T,y[5]=R*I+k*T,y[6]=F*I+G*T,y[7]=B*I+H*T,y[8]=U*I-S*T,y[9]=k*I-R*T,y[10]=G*I-F*T,y[11]=H*I-B*T,y},At.rotateY=function(y,w,C){var T=Math.sin(C),I=Math.cos(C),S=w[0],R=w[1],F=w[2],B=w[3],U=w[8],k=w[9],G=w[10],H=w[11];return w!==y&&(y[4]=w[4],y[5]=w[5],y[6]=w[6],y[7]=w[7],y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15]),y[0]=S*I-U*T,y[1]=R*I-k*T,y[2]=F*I-G*T,y[3]=B*I-H*T,y[8]=S*T+U*I,y[9]=R*T+k*I,y[10]=F*T+G*I,y[11]=B*T+H*I,y},At.rotateZ=function(y,w,C){var T=Math.sin(C),I=Math.cos(C),S=w[0],R=w[1],F=w[2],B=w[3],U=w[4],k=w[5],G=w[6],H=w[7];return w!==y&&(y[8]=w[8],y[9]=w[9],y[10]=w[10],y[11]=w[11],y[12]=w[12],y[13]=w[13],y[14]=w[14],y[15]=w[15]),y[0]=S*I+U*T,y[1]=R*I+k*T,y[2]=F*I+G*T,y[3]=B*I+H*T,y[4]=U*I-S*T,y[5]=k*I-R*T,y[6]=G*I-F*T,y[7]=H*I-B*T,y},At.fromTranslation=function(y,w){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=w[0],y[13]=w[1],y[14]=w[2],y[15]=1,y},At.fromScaling=function(y,w){return y[0]=w[0],y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=w[1],y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=w[2],y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},At.fromRotation=function(y,w,C){var T,I,S,R=C[0],F=C[1],B=C[2],U=Math.hypot(R,F,B);return U<e.EPSILON?null:(R*=U=1/U,F*=U,B*=U,T=Math.sin(w),I=Math.cos(w),y[0]=R*R*(S=1-I)+I,y[1]=F*R*S+B*T,y[2]=B*R*S-F*T,y[3]=0,y[4]=R*F*S-B*T,y[5]=F*F*S+I,y[6]=B*F*S+R*T,y[7]=0,y[8]=R*B*S+F*T,y[9]=F*B*S-R*T,y[10]=B*B*S+I,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y)},At.fromXRotation=function(y,w){var C=Math.sin(w),T=Math.cos(w);return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=T,y[6]=C,y[7]=0,y[8]=0,y[9]=-C,y[10]=T,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},At.fromYRotation=function(y,w){var C=Math.sin(w),T=Math.cos(w);return y[0]=T,y[1]=0,y[2]=-C,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=C,y[9]=0,y[10]=T,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},At.fromZRotation=function(y,w){var C=Math.sin(w),T=Math.cos(w);return y[0]=T,y[1]=C,y[2]=0,y[3]=0,y[4]=-C,y[5]=T,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},At.fromRotationTranslation=h,At.fromQuat2=function(y,w){var C=new e.ARRAY_TYPE(3),T=-w[0],I=-w[1],S=-w[2],R=w[3],F=w[4],B=w[5],U=w[6],k=w[7],G=T*T+I*I+S*S+R*R;return G>0?(C[0]=2*(F*R+k*T+B*S-U*I)/G,C[1]=2*(B*R+k*I+U*T-F*S)/G,C[2]=2*(U*R+k*S+F*I-B*T)/G):(C[0]=2*(F*R+k*T+B*S-U*I),C[1]=2*(B*R+k*I+U*T-F*S),C[2]=2*(U*R+k*S+F*I-B*T)),h(y,w,C),y},At.getTranslation=function(y,w){return y[0]=w[12],y[1]=w[13],y[2]=w[14],y},At.getScaling=m,At.getRotation=function(y,w){var C=new e.ARRAY_TYPE(3);m(C,w);var T=1/C[0],I=1/C[1],S=1/C[2],R=w[0]*T,F=w[1]*I,B=w[2]*S,U=w[4]*T,k=w[5]*I,G=w[6]*S,H=w[8]*T,K=w[9]*I,te=w[10]*S,ie=R+k+te,Q=0;return ie>0?(Q=2*Math.sqrt(ie+1),y[3]=.25*Q,y[0]=(G-K)/Q,y[1]=(H-B)/Q,y[2]=(F-U)/Q):R>k&&R>te?(Q=2*Math.sqrt(1+R-k-te),y[3]=(G-K)/Q,y[0]=.25*Q,y[1]=(F+U)/Q,y[2]=(H+B)/Q):k>te?(Q=2*Math.sqrt(1+k-R-te),y[3]=(H-B)/Q,y[0]=(F+U)/Q,y[1]=.25*Q,y[2]=(G+K)/Q):(Q=2*Math.sqrt(1+te-R-k),y[3]=(F-U)/Q,y[0]=(H+B)/Q,y[1]=(G+K)/Q,y[2]=.25*Q),y},At.fromRotationTranslationScale=function(y,w,C,T){var I=w[0],S=w[1],R=w[2],F=w[3],B=I+I,U=S+S,k=R+R,G=I*B,H=I*U,K=I*k,te=S*U,ie=S*k,Q=R*k,ue=F*B,se=F*U,de=F*k,ve=T[0],Te=T[1],Ee=T[2];return y[0]=(1-(te+Q))*ve,y[1]=(H+de)*ve,y[2]=(K-se)*ve,y[3]=0,y[4]=(H-de)*Te,y[5]=(1-(G+Q))*Te,y[6]=(ie+ue)*Te,y[7]=0,y[8]=(K+se)*Ee,y[9]=(ie-ue)*Ee,y[10]=(1-(G+te))*Ee,y[11]=0,y[12]=C[0],y[13]=C[1],y[14]=C[2],y[15]=1,y},At.fromRotationTranslationScaleOrigin=function(y,w,C,T,I){var S=w[0],R=w[1],F=w[2],B=w[3],U=S+S,k=R+R,G=F+F,H=S*U,K=S*k,te=S*G,ie=R*k,Q=R*G,ue=F*G,se=B*U,de=B*k,ve=B*G,Te=T[0],Ee=T[1],Ie=T[2],Oe=I[0],De=I[1],je=I[2],We=(1-(ie+ue))*Te,Ne=(K+ve)*Te,ut=(te-de)*Te,ot=(K-ve)*Ee,tt=(1-(H+ue))*Ee,Ke=(Q+se)*Ee,It=(te+de)*Ie,ct=(Q-se)*Ie,pt=(1-(H+ie))*Ie;return y[0]=We,y[1]=Ne,y[2]=ut,y[3]=0,y[4]=ot,y[5]=tt,y[6]=Ke,y[7]=0,y[8]=It,y[9]=ct,y[10]=pt,y[11]=0,y[12]=C[0]+Oe-(We*Oe+ot*De+It*je),y[13]=C[1]+De-(Ne*Oe+tt*De+ct*je),y[14]=C[2]+je-(ut*Oe+Ke*De+pt*je),y[15]=1,y},At.fromQuat=function(y,w){var C=w[0],T=w[1],I=w[2],S=w[3],R=C+C,F=T+T,B=I+I,U=C*R,k=T*R,G=T*F,H=I*R,K=I*F,te=I*B,ie=S*R,Q=S*F,ue=S*B;return y[0]=1-G-te,y[1]=k+ue,y[2]=H-Q,y[3]=0,y[4]=k-ue,y[5]=1-U-te,y[6]=K+ie,y[7]=0,y[8]=H+Q,y[9]=K-ie,y[10]=1-U-G,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},At.frustum=function(y,w,C,T,I,S,R){var F=1/(C-w),B=1/(I-T),U=1/(S-R);return y[0]=2*S*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*S*B,y[6]=0,y[7]=0,y[8]=(C+w)*F,y[9]=(I+T)*B,y[10]=(R+S)*U,y[11]=-1,y[12]=0,y[13]=0,y[14]=R*S*2*U,y[15]=0,y},At.perspectiveNO=x,At.perspectiveZO=function(y,w,C,T,I){var S,R=1/Math.tan(w/2);return y[0]=R/C,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=R,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,I!=null&&I!==1/0?(y[10]=I*(S=1/(T-I)),y[14]=I*T*S):(y[10]=-1,y[14]=-T),y},At.perspectiveFromFieldOfView=function(y,w,C,T){var I=Math.tan(w.upDegrees*Math.PI/180),S=Math.tan(w.downDegrees*Math.PI/180),R=Math.tan(w.leftDegrees*Math.PI/180),F=Math.tan(w.rightDegrees*Math.PI/180),B=2/(R+F),U=2/(I+S);return y[0]=B,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=U,y[6]=0,y[7]=0,y[8]=-(R-F)*B*.5,y[9]=(I-S)*U*.5,y[10]=T/(C-T),y[11]=-1,y[12]=0,y[13]=0,y[14]=T*C/(C-T),y[15]=0,y},At.orthoNO=E,At.orthoZO=function(y,w,C,T,I,S,R){var F=1/(w-C),B=1/(T-I),U=1/(S-R);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*B,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=U,y[11]=0,y[12]=(w+C)*F,y[13]=(I+T)*B,y[14]=S*U,y[15]=1,y},At.lookAt=function(y,w,C,T){var I,S,R,F,B,U,k,G,H,K,te=w[0],ie=w[1],Q=w[2],ue=T[0],se=T[1],de=T[2],ve=C[0],Te=C[1],Ee=C[2];return Math.abs(te-ve)<e.EPSILON&&Math.abs(ie-Te)<e.EPSILON&&Math.abs(Q-Ee)<e.EPSILON?c(y):(k=te-ve,G=ie-Te,H=Q-Ee,I=se*(H*=K=1/Math.hypot(k,G,H))-de*(G*=K),S=de*(k*=K)-ue*H,R=ue*G-se*k,(K=Math.hypot(I,S,R))?(I*=K=1/K,S*=K,R*=K):(I=0,S=0,R=0),F=G*R-H*S,B=H*I-k*R,U=k*S-G*I,(K=Math.hypot(F,B,U))?(F*=K=1/K,B*=K,U*=K):(F=0,B=0,U=0),y[0]=I,y[1]=F,y[2]=k,y[3]=0,y[4]=S,y[5]=B,y[6]=G,y[7]=0,y[8]=R,y[9]=U,y[10]=H,y[11]=0,y[12]=-(I*te+S*ie+R*Q),y[13]=-(F*te+B*ie+U*Q),y[14]=-(k*te+G*ie+H*Q),y[15]=1,y)},At.targetTo=function(y,w,C,T){var I=w[0],S=w[1],R=w[2],F=T[0],B=T[1],U=T[2],k=I-C[0],G=S-C[1],H=R-C[2],K=k*k+G*G+H*H;K>0&&(k*=K=1/Math.sqrt(K),G*=K,H*=K);var te=B*H-U*G,ie=U*k-F*H,Q=F*G-B*k;return(K=te*te+ie*ie+Q*Q)>0&&(te*=K=1/Math.sqrt(K),ie*=K,Q*=K),y[0]=te,y[1]=ie,y[2]=Q,y[3]=0,y[4]=G*Q-H*ie,y[5]=H*te-k*Q,y[6]=k*ie-G*te,y[7]=0,y[8]=k,y[9]=G,y[10]=H,y[11]=0,y[12]=I,y[13]=S,y[14]=R,y[15]=1,y},At.str=function(y){return"mat4("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+", "+y[6]+", "+y[7]+", "+y[8]+", "+y[9]+", "+y[10]+", "+y[11]+", "+y[12]+", "+y[13]+", "+y[14]+", "+y[15]+")"},At.frob=function(y){return Math.hypot(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])},At.add=function(y,w,C){return y[0]=w[0]+C[0],y[1]=w[1]+C[1],y[2]=w[2]+C[2],y[3]=w[3]+C[3],y[4]=w[4]+C[4],y[5]=w[5]+C[5],y[6]=w[6]+C[6],y[7]=w[7]+C[7],y[8]=w[8]+C[8],y[9]=w[9]+C[9],y[10]=w[10]+C[10],y[11]=w[11]+C[11],y[12]=w[12]+C[12],y[13]=w[13]+C[13],y[14]=w[14]+C[14],y[15]=w[15]+C[15],y},At.subtract=D,At.multiplyScalar=function(y,w,C){return y[0]=w[0]*C,y[1]=w[1]*C,y[2]=w[2]*C,y[3]=w[3]*C,y[4]=w[4]*C,y[5]=w[5]*C,y[6]=w[6]*C,y[7]=w[7]*C,y[8]=w[8]*C,y[9]=w[9]*C,y[10]=w[10]*C,y[11]=w[11]*C,y[12]=w[12]*C,y[13]=w[13]*C,y[14]=w[14]*C,y[15]=w[15]*C,y},At.multiplyScalarAndAdd=function(y,w,C,T){return y[0]=w[0]+C[0]*T,y[1]=w[1]+C[1]*T,y[2]=w[2]+C[2]*T,y[3]=w[3]+C[3]*T,y[4]=w[4]+C[4]*T,y[5]=w[5]+C[5]*T,y[6]=w[6]+C[6]*T,y[7]=w[7]+C[7]*T,y[8]=w[8]+C[8]*T,y[9]=w[9]+C[9]*T,y[10]=w[10]+C[10]*T,y[11]=w[11]+C[11]*T,y[12]=w[12]+C[12]*T,y[13]=w[13]+C[13]*T,y[14]=w[14]+C[14]*T,y[15]=w[15]+C[15]*T,y},At.exactEquals=function(y,w){return y[0]===w[0]&&y[1]===w[1]&&y[2]===w[2]&&y[3]===w[3]&&y[4]===w[4]&&y[5]===w[5]&&y[6]===w[6]&&y[7]===w[7]&&y[8]===w[8]&&y[9]===w[9]&&y[10]===w[10]&&y[11]===w[11]&&y[12]===w[12]&&y[13]===w[13]&&y[14]===w[14]&&y[15]===w[15]},At.equals=function(y,w){var C=y[0],T=y[1],I=y[2],S=y[3],R=y[4],F=y[5],B=y[6],U=y[7],k=y[8],G=y[9],H=y[10],K=y[11],te=y[12],ie=y[13],Q=y[14],ue=y[15],se=w[0],de=w[1],ve=w[2],Te=w[3],Ee=w[4],Ie=w[5],Oe=w[6],De=w[7],je=w[8],We=w[9],Ne=w[10],ut=w[11],ot=w[12],tt=w[13],Ke=w[14],It=w[15];return Math.abs(C-se)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(se))&&Math.abs(T-de)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(de))&&Math.abs(I-ve)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(S-Te)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(Te))&&Math.abs(R-Ee)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ee))&&Math.abs(F-Ie)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ie))&&Math.abs(B-Oe)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Oe))&&Math.abs(U-De)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(De))&&Math.abs(k-je)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(je))&&Math.abs(G-We)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(We))&&Math.abs(H-Ne)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ne))&&Math.abs(K-ut)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(ut))&&Math.abs(te-ot)<=e.EPSILON*Math.max(1,Math.abs(te),Math.abs(ot))&&Math.abs(ie-tt)<=e.EPSILON*Math.max(1,Math.abs(ie),Math.abs(tt))&&Math.abs(Q-Ke)<=e.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Ke))&&Math.abs(ue-It)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(It))},At.sub=At.mul=At.ortho=At.perspective=void 0;var e=function(y,w){if(y&&y.__esModule)return y;if(y===null||l(y)!=="object"&&typeof y!="function")return{default:y};var C=r(void 0);if(C&&C.has(y))return C.get(y);var T={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in y)if(S!=="default"&&Object.prototype.hasOwnProperty.call(y,S)){var R=I?Object.getOwnPropertyDescriptor(y,S):null;R&&(R.get||R.set)?Object.defineProperty(T,S,R):T[S]=y[S]}return T.default=y,C&&C.set(y,T),T}(xe());function r(y){if(typeof WeakMap!="function")return null;var w=new WeakMap,C=new WeakMap;return(r=function(T){return T?C:w})(y)}function c(y){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y}function p(y,w,C){var T=w[0],I=w[1],S=w[2],R=w[3],F=w[4],B=w[5],U=w[6],k=w[7],G=w[8],H=w[9],K=w[10],te=w[11],ie=w[12],Q=w[13],ue=w[14],se=w[15],de=C[0],ve=C[1],Te=C[2],Ee=C[3];return y[0]=de*T+ve*F+Te*G+Ee*ie,y[1]=de*I+ve*B+Te*H+Ee*Q,y[2]=de*S+ve*U+Te*K+Ee*ue,y[3]=de*R+ve*k+Te*te+Ee*se,y[4]=(de=C[4])*T+(ve=C[5])*F+(Te=C[6])*G+(Ee=C[7])*ie,y[5]=de*I+ve*B+Te*H+Ee*Q,y[6]=de*S+ve*U+Te*K+Ee*ue,y[7]=de*R+ve*k+Te*te+Ee*se,y[8]=(de=C[8])*T+(ve=C[9])*F+(Te=C[10])*G+(Ee=C[11])*ie,y[9]=de*I+ve*B+Te*H+Ee*Q,y[10]=de*S+ve*U+Te*K+Ee*ue,y[11]=de*R+ve*k+Te*te+Ee*se,y[12]=(de=C[12])*T+(ve=C[13])*F+(Te=C[14])*G+(Ee=C[15])*ie,y[13]=de*I+ve*B+Te*H+Ee*Q,y[14]=de*S+ve*U+Te*K+Ee*ue,y[15]=de*R+ve*k+Te*te+Ee*se,y}function h(y,w,C){var T=w[0],I=w[1],S=w[2],R=w[3],F=T+T,B=I+I,U=S+S,k=T*F,G=T*B,H=T*U,K=I*B,te=I*U,ie=S*U,Q=R*F,ue=R*B,se=R*U;return y[0]=1-(K+ie),y[1]=G+se,y[2]=H-ue,y[3]=0,y[4]=G-se,y[5]=1-(k+ie),y[6]=te+Q,y[7]=0,y[8]=H+ue,y[9]=te-Q,y[10]=1-(k+K),y[11]=0,y[12]=C[0],y[13]=C[1],y[14]=C[2],y[15]=1,y}function m(y,w){var C=w[4],T=w[5],I=w[6],S=w[8],R=w[9],F=w[10];return y[0]=Math.hypot(w[0],w[1],w[2]),y[1]=Math.hypot(C,T,I),y[2]=Math.hypot(S,R,F),y}function x(y,w,C,T,I){var S,R=1/Math.tan(w/2);return y[0]=R/C,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=R,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,I!=null&&I!==1/0?(y[10]=(I+T)*(S=1/(T-I)),y[14]=2*I*T*S):(y[10]=-1,y[14]=-2*T),y}function E(y,w,C,T,I,S,R){var F=1/(w-C),B=1/(T-I),U=1/(S-R);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*B,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=2*U,y[11]=0,y[12]=(w+C)*F,y[13]=(I+T)*B,y[14]=(R+S)*U,y[15]=1,y}function D(y,w,C){return y[0]=w[0]-C[0],y[1]=w[1]-C[1],y[2]=w[2]-C[2],y[3]=w[3]-C[3],y[4]=w[4]-C[4],y[5]=w[5]-C[5],y[6]=w[6]-C[6],y[7]=w[7]-C[7],y[8]=w[8]-C[8],y[9]=w[9]-C[9],y[10]=w[10]-C[10],y[11]=w[11]-C[11],y[12]=w[12]-C[12],y[13]=w[13]-C[13],y[14]=w[14]-C[14],y[15]=w[15]-C[15],y}return At.perspective=x,At.ortho=E,At.mul=p,At.sub=D,At}var Er,Ft={},Bt={};function as(){if(Er)return Bt;function l(I){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},l(I)}Er=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=c,Bt.clone=function(I){var S=new e.ARRAY_TYPE(3);return S[0]=I[0],S[1]=I[1],S[2]=I[2],S},Bt.length=p,Bt.fromValues=function(I,S,R){var F=new e.ARRAY_TYPE(3);return F[0]=I,F[1]=S,F[2]=R,F},Bt.copy=function(I,S){return I[0]=S[0],I[1]=S[1],I[2]=S[2],I},Bt.set=function(I,S,R,F){return I[0]=S,I[1]=R,I[2]=F,I},Bt.add=function(I,S,R){return I[0]=S[0]+R[0],I[1]=S[1]+R[1],I[2]=S[2]+R[2],I},Bt.subtract=h,Bt.multiply=m,Bt.divide=x,Bt.ceil=function(I,S){return I[0]=Math.ceil(S[0]),I[1]=Math.ceil(S[1]),I[2]=Math.ceil(S[2]),I},Bt.floor=function(I,S){return I[0]=Math.floor(S[0]),I[1]=Math.floor(S[1]),I[2]=Math.floor(S[2]),I},Bt.min=function(I,S,R){return I[0]=Math.min(S[0],R[0]),I[1]=Math.min(S[1],R[1]),I[2]=Math.min(S[2],R[2]),I},Bt.max=function(I,S,R){return I[0]=Math.max(S[0],R[0]),I[1]=Math.max(S[1],R[1]),I[2]=Math.max(S[2],R[2]),I},Bt.round=function(I,S){return I[0]=Math.round(S[0]),I[1]=Math.round(S[1]),I[2]=Math.round(S[2]),I},Bt.scale=function(I,S,R){return I[0]=S[0]*R,I[1]=S[1]*R,I[2]=S[2]*R,I},Bt.scaleAndAdd=function(I,S,R,F){return I[0]=S[0]+R[0]*F,I[1]=S[1]+R[1]*F,I[2]=S[2]+R[2]*F,I},Bt.distance=E,Bt.squaredDistance=D,Bt.squaredLength=y,Bt.negate=function(I,S){return I[0]=-S[0],I[1]=-S[1],I[2]=-S[2],I},Bt.inverse=function(I,S){return I[0]=1/S[0],I[1]=1/S[1],I[2]=1/S[2],I},Bt.normalize=function(I,S){var R=S[0],F=S[1],B=S[2],U=R*R+F*F+B*B;return U>0&&(U=1/Math.sqrt(U)),I[0]=S[0]*U,I[1]=S[1]*U,I[2]=S[2]*U,I},Bt.dot=w,Bt.cross=function(I,S,R){var F=S[0],B=S[1],U=S[2],k=R[0],G=R[1],H=R[2];return I[0]=B*H-U*G,I[1]=U*k-F*H,I[2]=F*G-B*k,I},Bt.lerp=function(I,S,R,F){var B=S[0],U=S[1],k=S[2];return I[0]=B+F*(R[0]-B),I[1]=U+F*(R[1]-U),I[2]=k+F*(R[2]-k),I},Bt.hermite=function(I,S,R,F,B,U){var k=U*U,G=k*(2*U-3)+1,H=k*(U-2)+U,K=k*(U-1),te=k*(3-2*U);return I[0]=S[0]*G+R[0]*H+F[0]*K+B[0]*te,I[1]=S[1]*G+R[1]*H+F[1]*K+B[1]*te,I[2]=S[2]*G+R[2]*H+F[2]*K+B[2]*te,I},Bt.bezier=function(I,S,R,F,B,U){var k=1-U,G=k*k,H=U*U,K=G*k,te=3*U*G,ie=3*H*k,Q=H*U;return I[0]=S[0]*K+R[0]*te+F[0]*ie+B[0]*Q,I[1]=S[1]*K+R[1]*te+F[1]*ie+B[1]*Q,I[2]=S[2]*K+R[2]*te+F[2]*ie+B[2]*Q,I},Bt.random=function(I,S){S=S||1;var R=2*e.RANDOM()*Math.PI,F=2*e.RANDOM()-1,B=Math.sqrt(1-F*F)*S;return I[0]=Math.cos(R)*B,I[1]=Math.sin(R)*B,I[2]=F*S,I},Bt.transformMat4=function(I,S,R){var F=S[0],B=S[1],U=S[2],k=R[3]*F+R[7]*B+R[11]*U+R[15];return I[0]=(R[0]*F+R[4]*B+R[8]*U+R[12])/(k=k||1),I[1]=(R[1]*F+R[5]*B+R[9]*U+R[13])/k,I[2]=(R[2]*F+R[6]*B+R[10]*U+R[14])/k,I},Bt.transformMat3=function(I,S,R){var F=S[0],B=S[1],U=S[2];return I[0]=F*R[0]+B*R[3]+U*R[6],I[1]=F*R[1]+B*R[4]+U*R[7],I[2]=F*R[2]+B*R[5]+U*R[8],I},Bt.transformQuat=function(I,S,R){var F=R[0],B=R[1],U=R[2],k=S[0],G=S[1],H=S[2],K=B*H-U*G,te=U*k-F*H,ie=F*G-B*k,Q=B*ie-U*te,ue=U*K-F*ie,se=F*te-B*K,de=2*R[3];return te*=de,ie*=de,ue*=2,se*=2,I[0]=k+(K*=de)+(Q*=2),I[1]=G+te+ue,I[2]=H+ie+se,I},Bt.rotateX=function(I,S,R,F){var B=[],U=[];return B[0]=S[0]-R[0],B[1]=S[1]-R[1],B[2]=S[2]-R[2],U[0]=B[0],U[1]=B[1]*Math.cos(F)-B[2]*Math.sin(F),U[2]=B[1]*Math.sin(F)+B[2]*Math.cos(F),I[0]=U[0]+R[0],I[1]=U[1]+R[1],I[2]=U[2]+R[2],I},Bt.rotateY=function(I,S,R,F){var B=[],U=[];return B[0]=S[0]-R[0],B[1]=S[1]-R[1],B[2]=S[2]-R[2],U[0]=B[2]*Math.sin(F)+B[0]*Math.cos(F),U[1]=B[1],U[2]=B[2]*Math.cos(F)-B[0]*Math.sin(F),I[0]=U[0]+R[0],I[1]=U[1]+R[1],I[2]=U[2]+R[2],I},Bt.rotateZ=function(I,S,R,F){var B=[],U=[];return B[0]=S[0]-R[0],B[1]=S[1]-R[1],B[2]=S[2]-R[2],U[0]=B[0]*Math.cos(F)-B[1]*Math.sin(F),U[1]=B[0]*Math.sin(F)+B[1]*Math.cos(F),U[2]=B[2],I[0]=U[0]+R[0],I[1]=U[1]+R[1],I[2]=U[2]+R[2],I},Bt.angle=function(I,S){var R=I[0],F=I[1],B=I[2],U=S[0],k=S[1],G=S[2],H=Math.sqrt(R*R+F*F+B*B)*Math.sqrt(U*U+k*k+G*G),K=H&&w(I,S)/H;return Math.acos(Math.min(Math.max(K,-1),1))},Bt.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},Bt.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},Bt.exactEquals=function(I,S){return I[0]===S[0]&&I[1]===S[1]&&I[2]===S[2]},Bt.equals=function(I,S){var R=I[0],F=I[1],B=I[2],U=S[0],k=S[1],G=S[2];return Math.abs(R-U)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(U))&&Math.abs(F-k)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(k))&&Math.abs(B-G)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))},Bt.forEach=Bt.sqrLen=Bt.len=Bt.sqrDist=Bt.dist=Bt.div=Bt.mul=Bt.sub=void 0;var e=function(I,S){if(I&&I.__esModule)return I;if(I===null||l(I)!=="object"&&typeof I!="function")return{default:I};var R=r(void 0);if(R&&R.has(I))return R.get(I);var F={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in I)if(U!=="default"&&Object.prototype.hasOwnProperty.call(I,U)){var k=B?Object.getOwnPropertyDescriptor(I,U):null;k&&(k.get||k.set)?Object.defineProperty(F,U,k):F[U]=I[U]}return F.default=I,R&&R.set(I,F),F}(xe());function r(I){if(typeof WeakMap!="function")return null;var S=new WeakMap,R=new WeakMap;return(r=function(F){return F?R:S})(I)}function c(){var I=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function p(I){return Math.hypot(I[0],I[1],I[2])}function h(I,S,R){return I[0]=S[0]-R[0],I[1]=S[1]-R[1],I[2]=S[2]-R[2],I}function m(I,S,R){return I[0]=S[0]*R[0],I[1]=S[1]*R[1],I[2]=S[2]*R[2],I}function x(I,S,R){return I[0]=S[0]/R[0],I[1]=S[1]/R[1],I[2]=S[2]/R[2],I}function E(I,S){return Math.hypot(S[0]-I[0],S[1]-I[1],S[2]-I[2])}function D(I,S){var R=S[0]-I[0],F=S[1]-I[1],B=S[2]-I[2];return R*R+F*F+B*B}function y(I){var S=I[0],R=I[1],F=I[2];return S*S+R*R+F*F}function w(I,S){return I[0]*S[0]+I[1]*S[1]+I[2]*S[2]}Bt.sub=h,Bt.mul=m,Bt.div=x,Bt.dist=E,Bt.sqrDist=D,Bt.len=p,Bt.sqrLen=y;var C,T=(C=c(),function(I,S,R,F,B,U){var k,G;for(S||(S=3),R||(R=0),G=F?Math.min(F*S+R,I.length):I.length,k=R;k<G;k+=S)C[0]=I[k],C[1]=I[k+1],C[2]=I[k+2],B(C,C,U),I[k]=C[0],I[k+1]=C[1],I[k+2]=C[2];return I});return Bt.forEach=T,Bt}var Us,ih,hn={};function Ir(){if(Us)return hn;function l(T){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(T)}Us=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.create=c,hn.clone=function(T){var I=new e.ARRAY_TYPE(4);return I[0]=T[0],I[1]=T[1],I[2]=T[2],I[3]=T[3],I},hn.fromValues=function(T,I,S,R){var F=new e.ARRAY_TYPE(4);return F[0]=T,F[1]=I,F[2]=S,F[3]=R,F},hn.copy=function(T,I){return T[0]=I[0],T[1]=I[1],T[2]=I[2],T[3]=I[3],T},hn.set=function(T,I,S,R,F){return T[0]=I,T[1]=S,T[2]=R,T[3]=F,T},hn.add=function(T,I,S){return T[0]=I[0]+S[0],T[1]=I[1]+S[1],T[2]=I[2]+S[2],T[3]=I[3]+S[3],T},hn.subtract=p,hn.multiply=h,hn.divide=m,hn.ceil=function(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T[2]=Math.ceil(I[2]),T[3]=Math.ceil(I[3]),T},hn.floor=function(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T[2]=Math.floor(I[2]),T[3]=Math.floor(I[3]),T},hn.min=function(T,I,S){return T[0]=Math.min(I[0],S[0]),T[1]=Math.min(I[1],S[1]),T[2]=Math.min(I[2],S[2]),T[3]=Math.min(I[3],S[3]),T},hn.max=function(T,I,S){return T[0]=Math.max(I[0],S[0]),T[1]=Math.max(I[1],S[1]),T[2]=Math.max(I[2],S[2]),T[3]=Math.max(I[3],S[3]),T},hn.round=function(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T[2]=Math.round(I[2]),T[3]=Math.round(I[3]),T},hn.scale=function(T,I,S){return T[0]=I[0]*S,T[1]=I[1]*S,T[2]=I[2]*S,T[3]=I[3]*S,T},hn.scaleAndAdd=function(T,I,S,R){return T[0]=I[0]+S[0]*R,T[1]=I[1]+S[1]*R,T[2]=I[2]+S[2]*R,T[3]=I[3]+S[3]*R,T},hn.distance=x,hn.squaredDistance=E,hn.length=D,hn.squaredLength=y,hn.negate=function(T,I){return T[0]=-I[0],T[1]=-I[1],T[2]=-I[2],T[3]=-I[3],T},hn.inverse=function(T,I){return T[0]=1/I[0],T[1]=1/I[1],T[2]=1/I[2],T[3]=1/I[3],T},hn.normalize=function(T,I){var S=I[0],R=I[1],F=I[2],B=I[3],U=S*S+R*R+F*F+B*B;return U>0&&(U=1/Math.sqrt(U)),T[0]=S*U,T[1]=R*U,T[2]=F*U,T[3]=B*U,T},hn.dot=function(T,I){return T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]*I[3]},hn.cross=function(T,I,S,R){var F=S[0]*R[1]-S[1]*R[0],B=S[0]*R[2]-S[2]*R[0],U=S[0]*R[3]-S[3]*R[0],k=S[1]*R[2]-S[2]*R[1],G=S[1]*R[3]-S[3]*R[1],H=S[2]*R[3]-S[3]*R[2],K=I[0],te=I[1],ie=I[2],Q=I[3];return T[0]=te*H-ie*G+Q*k,T[1]=-K*H+ie*U-Q*B,T[2]=K*G-te*U+Q*F,T[3]=-K*k+te*B-ie*F,T},hn.lerp=function(T,I,S,R){var F=I[0],B=I[1],U=I[2],k=I[3];return T[0]=F+R*(S[0]-F),T[1]=B+R*(S[1]-B),T[2]=U+R*(S[2]-U),T[3]=k+R*(S[3]-k),T},hn.random=function(T,I){var S,R,F,B,U,k;I=I||1;do U=(S=2*e.RANDOM()-1)*S+(R=2*e.RANDOM()-1)*R;while(U>=1);do k=(F=2*e.RANDOM()-1)*F+(B=2*e.RANDOM()-1)*B;while(k>=1);var G=Math.sqrt((1-U)/k);return T[0]=I*S,T[1]=I*R,T[2]=I*F*G,T[3]=I*B*G,T},hn.transformMat4=function(T,I,S){var R=I[0],F=I[1],B=I[2],U=I[3];return T[0]=S[0]*R+S[4]*F+S[8]*B+S[12]*U,T[1]=S[1]*R+S[5]*F+S[9]*B+S[13]*U,T[2]=S[2]*R+S[6]*F+S[10]*B+S[14]*U,T[3]=S[3]*R+S[7]*F+S[11]*B+S[15]*U,T},hn.transformQuat=function(T,I,S){var R=I[0],F=I[1],B=I[2],U=S[0],k=S[1],G=S[2],H=S[3],K=H*R+k*B-G*F,te=H*F+G*R-U*B,ie=H*B+U*F-k*R,Q=-U*R-k*F-G*B;return T[0]=K*H+Q*-U+te*-G-ie*-k,T[1]=te*H+Q*-k+ie*-U-K*-G,T[2]=ie*H+Q*-G+K*-k-te*-U,T[3]=I[3],T},hn.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},hn.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},hn.exactEquals=function(T,I){return T[0]===I[0]&&T[1]===I[1]&&T[2]===I[2]&&T[3]===I[3]},hn.equals=function(T,I){var S=T[0],R=T[1],F=T[2],B=T[3],U=I[0],k=I[1],G=I[2],H=I[3];return Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(R-k)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(k))&&Math.abs(F-G)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))},hn.forEach=hn.sqrLen=hn.len=hn.sqrDist=hn.dist=hn.div=hn.mul=hn.sub=void 0;var e=function(T,I){if(T&&T.__esModule)return T;if(T===null||l(T)!=="object"&&typeof T!="function")return{default:T};var S=r(void 0);if(S&&S.has(T))return S.get(T);var R={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in T)if(B!=="default"&&Object.prototype.hasOwnProperty.call(T,B)){var U=F?Object.getOwnPropertyDescriptor(T,B):null;U&&(U.get||U.set)?Object.defineProperty(R,B,U):R[B]=T[B]}return R.default=T,S&&S.set(T,R),R}(xe());function r(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,S=new WeakMap;return(r=function(R){return R?S:I})(T)}function c(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function p(T,I,S){return T[0]=I[0]-S[0],T[1]=I[1]-S[1],T[2]=I[2]-S[2],T[3]=I[3]-S[3],T}function h(T,I,S){return T[0]=I[0]*S[0],T[1]=I[1]*S[1],T[2]=I[2]*S[2],T[3]=I[3]*S[3],T}function m(T,I,S){return T[0]=I[0]/S[0],T[1]=I[1]/S[1],T[2]=I[2]/S[2],T[3]=I[3]/S[3],T}function x(T,I){return Math.hypot(I[0]-T[0],I[1]-T[1],I[2]-T[2],I[3]-T[3])}function E(T,I){var S=I[0]-T[0],R=I[1]-T[1],F=I[2]-T[2],B=I[3]-T[3];return S*S+R*R+F*F+B*B}function D(T){return Math.hypot(T[0],T[1],T[2],T[3])}function y(T){var I=T[0],S=T[1],R=T[2],F=T[3];return I*I+S*S+R*R+F*F}hn.sub=p,hn.mul=h,hn.div=m,hn.dist=x,hn.sqrDist=E,hn.len=D,hn.sqrLen=y;var w,C=(w=c(),function(T,I,S,R,F,B){var U,k;for(I||(I=4),S||(S=0),k=R?Math.min(R*I+S,T.length):T.length,U=S;U<k;U+=I)w[0]=T[U],w[1]=T[U+1],w[2]=T[U+2],w[3]=T[U+3],F(w,w,B),T[U]=w[0],T[U+1]=w[1],T[U+2]=w[2],T[U+3]=w[3];return T});return hn.forEach=C,hn}function ls(){if(ih)return Ft;function l(se){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(de){return typeof de}:function(de){return de&&typeof Symbol=="function"&&de.constructor===Symbol&&de!==Symbol.prototype?"symbol":typeof de},l(se)}ih=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=x,Ft.identity=function(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=1,se},Ft.setAxisAngle=E,Ft.getAxisAngle=function(se,de){var ve=2*Math.acos(de[3]),Te=Math.sin(ve/2);return Te>e.EPSILON?(se[0]=de[0]/Te,se[1]=de[1]/Te,se[2]=de[2]/Te):(se[0]=1,se[1]=0,se[2]=0),ve},Ft.getAngle=function(se,de){var ve=S(se,de);return Math.acos(2*ve*ve-1)},Ft.multiply=D,Ft.rotateX=function(se,de,ve){ve*=.5;var Te=de[0],Ee=de[1],Ie=de[2],Oe=de[3],De=Math.sin(ve),je=Math.cos(ve);return se[0]=Te*je+Oe*De,se[1]=Ee*je+Ie*De,se[2]=Ie*je-Ee*De,se[3]=Oe*je-Te*De,se},Ft.rotateY=function(se,de,ve){ve*=.5;var Te=de[0],Ee=de[1],Ie=de[2],Oe=de[3],De=Math.sin(ve),je=Math.cos(ve);return se[0]=Te*je-Ie*De,se[1]=Ee*je+Oe*De,se[2]=Ie*je+Te*De,se[3]=Oe*je-Ee*De,se},Ft.rotateZ=function(se,de,ve){ve*=.5;var Te=de[0],Ee=de[1],Ie=de[2],Oe=de[3],De=Math.sin(ve),je=Math.cos(ve);return se[0]=Te*je+Ee*De,se[1]=Ee*je-Te*De,se[2]=Ie*je+Oe*De,se[3]=Oe*je-Ie*De,se},Ft.calculateW=function(se,de){var ve=de[0],Te=de[1],Ee=de[2];return se[0]=ve,se[1]=Te,se[2]=Ee,se[3]=Math.sqrt(Math.abs(1-ve*ve-Te*Te-Ee*Ee)),se},Ft.exp=y,Ft.ln=w,Ft.pow=function(se,de,ve){return w(se,de),I(se,se,ve),y(se,se),se},Ft.slerp=C,Ft.random=function(se){var de=e.RANDOM(),ve=e.RANDOM(),Te=e.RANDOM(),Ee=Math.sqrt(1-de),Ie=Math.sqrt(de);return se[0]=Ee*Math.sin(2*Math.PI*ve),se[1]=Ee*Math.cos(2*Math.PI*ve),se[2]=Ie*Math.sin(2*Math.PI*Te),se[3]=Ie*Math.cos(2*Math.PI*Te),se},Ft.invert=function(se,de){var ve=de[0],Te=de[1],Ee=de[2],Ie=de[3],Oe=ve*ve+Te*Te+Ee*Ee+Ie*Ie,De=Oe?1/Oe:0;return se[0]=-ve*De,se[1]=-Te*De,se[2]=-Ee*De,se[3]=Ie*De,se},Ft.conjugate=function(se,de){return se[0]=-de[0],se[1]=-de[1],se[2]=-de[2],se[3]=de[3],se},Ft.fromMat3=T,Ft.fromEuler=function(se,de,ve,Te){var Ee=.5*Math.PI/180;de*=Ee,ve*=Ee,Te*=Ee;var Ie=Math.sin(de),Oe=Math.cos(de),De=Math.sin(ve),je=Math.cos(ve),We=Math.sin(Te),Ne=Math.cos(Te);return se[0]=Ie*je*Ne-Oe*De*We,se[1]=Oe*De*Ne+Ie*je*We,se[2]=Oe*je*We-Ie*De*Ne,se[3]=Oe*je*Ne+Ie*De*We,se},Ft.str=function(se){return"quat("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"},Ft.setAxes=Ft.sqlerp=Ft.rotationTo=Ft.equals=Ft.exactEquals=Ft.normalize=Ft.sqrLen=Ft.squaredLength=Ft.len=Ft.length=Ft.lerp=Ft.dot=Ft.scale=Ft.mul=Ft.add=Ft.set=Ft.copy=Ft.fromValues=Ft.clone=void 0;var e=m(xe()),r=m(Zn()),c=m(as()),p=m(Ir());function h(se){if(typeof WeakMap!="function")return null;var de=new WeakMap,ve=new WeakMap;return(h=function(Te){return Te?ve:de})(se)}function m(se,de){if(se&&se.__esModule)return se;if(se===null||l(se)!=="object"&&typeof se!="function")return{default:se};var ve=h(de);if(ve&&ve.has(se))return ve.get(se);var Te={},Ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in se)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(se,Ie)){var Oe=Ee?Object.getOwnPropertyDescriptor(se,Ie):null;Oe&&(Oe.get||Oe.set)?Object.defineProperty(Te,Ie,Oe):Te[Ie]=se[Ie]}return Te.default=se,ve&&ve.set(se,Te),Te}function x(){var se=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0),se[3]=1,se}function E(se,de,ve){ve*=.5;var Te=Math.sin(ve);return se[0]=Te*de[0],se[1]=Te*de[1],se[2]=Te*de[2],se[3]=Math.cos(ve),se}function D(se,de,ve){var Te=de[0],Ee=de[1],Ie=de[2],Oe=de[3],De=ve[0],je=ve[1],We=ve[2],Ne=ve[3];return se[0]=Te*Ne+Oe*De+Ee*We-Ie*je,se[1]=Ee*Ne+Oe*je+Ie*De-Te*We,se[2]=Ie*Ne+Oe*We+Te*je-Ee*De,se[3]=Oe*Ne-Te*De-Ee*je-Ie*We,se}function y(se,de){var ve=de[0],Te=de[1],Ee=de[2],Ie=de[3],Oe=Math.sqrt(ve*ve+Te*Te+Ee*Ee),De=Math.exp(Ie),je=Oe>0?De*Math.sin(Oe)/Oe:0;return se[0]=ve*je,se[1]=Te*je,se[2]=Ee*je,se[3]=De*Math.cos(Oe),se}function w(se,de){var ve=de[0],Te=de[1],Ee=de[2],Ie=de[3],Oe=Math.sqrt(ve*ve+Te*Te+Ee*Ee),De=Oe>0?Math.atan2(Oe,Ie)/Oe:0;return se[0]=ve*De,se[1]=Te*De,se[2]=Ee*De,se[3]=.5*Math.log(ve*ve+Te*Te+Ee*Ee+Ie*Ie),se}function C(se,de,ve,Te){var Ee,Ie,Oe,De,je,We=de[0],Ne=de[1],ut=de[2],ot=de[3],tt=ve[0],Ke=ve[1],It=ve[2],ct=ve[3];return(Ie=We*tt+Ne*Ke+ut*It+ot*ct)<0&&(Ie=-Ie,tt=-tt,Ke=-Ke,It=-It,ct=-ct),1-Ie>e.EPSILON?(Ee=Math.acos(Ie),Oe=Math.sin(Ee),De=Math.sin((1-Te)*Ee)/Oe,je=Math.sin(Te*Ee)/Oe):(De=1-Te,je=Te),se[0]=De*We+je*tt,se[1]=De*Ne+je*Ke,se[2]=De*ut+je*It,se[3]=De*ot+je*ct,se}function T(se,de){var ve,Te=de[0]+de[4]+de[8];if(Te>0)ve=Math.sqrt(Te+1),se[3]=.5*ve,se[0]=(de[5]-de[7])*(ve=.5/ve),se[1]=(de[6]-de[2])*ve,se[2]=(de[1]-de[3])*ve;else{var Ee=0;de[4]>de[0]&&(Ee=1),de[8]>de[3*Ee+Ee]&&(Ee=2);var Ie=(Ee+1)%3,Oe=(Ee+2)%3;ve=Math.sqrt(de[3*Ee+Ee]-de[3*Ie+Ie]-de[3*Oe+Oe]+1),se[Ee]=.5*ve,se[3]=(de[3*Ie+Oe]-de[3*Oe+Ie])*(ve=.5/ve),se[Ie]=(de[3*Ie+Ee]+de[3*Ee+Ie])*ve,se[Oe]=(de[3*Oe+Ee]+de[3*Ee+Oe])*ve}return se}Ft.clone=p.clone,Ft.fromValues=p.fromValues,Ft.copy=p.copy,Ft.set=p.set,Ft.add=p.add,Ft.mul=D;var I=p.scale;Ft.scale=I;var S=p.dot;Ft.dot=S,Ft.lerp=p.lerp;var R=p.length;Ft.length=R,Ft.len=R;var F=p.squaredLength;Ft.squaredLength=F,Ft.sqrLen=F;var B=p.normalize;Ft.normalize=B,Ft.exactEquals=p.exactEquals,Ft.equals=p.equals;var U,k,G,H=(U=c.create(),k=c.fromValues(1,0,0),G=c.fromValues(0,1,0),function(se,de,ve){var Te=c.dot(de,ve);return Te<-.999999?(c.cross(U,k,de),c.len(U)<1e-6&&c.cross(U,G,de),c.normalize(U,U),E(se,U,Math.PI),se):Te>.999999?(se[0]=0,se[1]=0,se[2]=0,se[3]=1,se):(c.cross(U,de,ve),se[0]=U[0],se[1]=U[1],se[2]=U[2],se[3]=1+Te,B(se,se))});Ft.rotationTo=H;var K,te,ie=(K=x(),te=x(),function(se,de,ve,Te,Ee,Ie){return C(K,de,Ee,Ie),C(te,ve,Te,Ie),C(se,K,te,2*Ie*(1-Ie)),se});Ft.sqlerp=ie;var Q,ue=(Q=r.create(),function(se,de,ve,Te){return Q[0]=ve[0],Q[3]=ve[1],Q[6]=ve[2],Q[1]=Te[0],Q[4]=Te[1],Q[7]=Te[2],Q[2]=-de[0],Q[5]=-de[1],Q[8]=-de[2],B(se,T(se,Q))});return Ft.setAxes=ue,Ft}var ll,tn={};function wa(){if(ll)return tn;function l(C){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(C)}ll=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.create=function(){var C=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[4]=0,C[5]=0,C[6]=0,C[7]=0),C[3]=1,C},tn.clone=function(C){var T=new e.ARRAY_TYPE(8);return T[0]=C[0],T[1]=C[1],T[2]=C[2],T[3]=C[3],T[4]=C[4],T[5]=C[5],T[6]=C[6],T[7]=C[7],T},tn.fromValues=function(C,T,I,S,R,F,B,U){var k=new e.ARRAY_TYPE(8);return k[0]=C,k[1]=T,k[2]=I,k[3]=S,k[4]=R,k[5]=F,k[6]=B,k[7]=U,k},tn.fromRotationTranslationValues=function(C,T,I,S,R,F,B){var U=new e.ARRAY_TYPE(8);U[0]=C,U[1]=T,U[2]=I,U[3]=S;var k=.5*R,G=.5*F,H=.5*B;return U[4]=k*S+G*I-H*T,U[5]=G*S+H*C-k*I,U[6]=H*S+k*T-G*C,U[7]=-k*C-G*T-H*I,U},tn.fromRotationTranslation=m,tn.fromTranslation=function(C,T){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=.5*T[0],C[5]=.5*T[1],C[6]=.5*T[2],C[7]=0,C},tn.fromRotation=function(C,T){return C[0]=T[0],C[1]=T[1],C[2]=T[2],C[3]=T[3],C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},tn.fromMat4=function(C,T){var I=r.create();c.getRotation(I,T);var S=new e.ARRAY_TYPE(3);return c.getTranslation(S,T),m(C,I,S),C},tn.copy=x,tn.identity=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},tn.set=function(C,T,I,S,R,F,B,U,k){return C[0]=T,C[1]=I,C[2]=S,C[3]=R,C[4]=F,C[5]=B,C[6]=U,C[7]=k,C},tn.getDual=function(C,T){return C[0]=T[4],C[1]=T[5],C[2]=T[6],C[3]=T[7],C},tn.setDual=function(C,T){return C[4]=T[0],C[5]=T[1],C[6]=T[2],C[7]=T[3],C},tn.getTranslation=function(C,T){var I=T[4],S=T[5],R=T[6],F=T[7],B=-T[0],U=-T[1],k=-T[2],G=T[3];return C[0]=2*(I*G+F*B+S*k-R*U),C[1]=2*(S*G+F*U+R*B-I*k),C[2]=2*(R*G+F*k+I*U-S*B),C},tn.translate=function(C,T,I){var S=T[0],R=T[1],F=T[2],B=T[3],U=.5*I[0],k=.5*I[1],G=.5*I[2],H=T[4],K=T[5],te=T[6],ie=T[7];return C[0]=S,C[1]=R,C[2]=F,C[3]=B,C[4]=B*U+R*G-F*k+H,C[5]=B*k+F*U-S*G+K,C[6]=B*G+S*k-R*U+te,C[7]=-S*U-R*k-F*G+ie,C},tn.rotateX=function(C,T,I){var S=-T[0],R=-T[1],F=-T[2],B=T[3],U=T[4],k=T[5],G=T[6],H=T[7],K=U*B+H*S+k*F-G*R,te=k*B+H*R+G*S-U*F,ie=G*B+H*F+U*R-k*S,Q=H*B-U*S-k*R-G*F;return r.rotateX(C,T,I),C[4]=K*(B=C[3])+Q*(S=C[0])+te*(F=C[2])-ie*(R=C[1]),C[5]=te*B+Q*R+ie*S-K*F,C[6]=ie*B+Q*F+K*R-te*S,C[7]=Q*B-K*S-te*R-ie*F,C},tn.rotateY=function(C,T,I){var S=-T[0],R=-T[1],F=-T[2],B=T[3],U=T[4],k=T[5],G=T[6],H=T[7],K=U*B+H*S+k*F-G*R,te=k*B+H*R+G*S-U*F,ie=G*B+H*F+U*R-k*S,Q=H*B-U*S-k*R-G*F;return r.rotateY(C,T,I),C[4]=K*(B=C[3])+Q*(S=C[0])+te*(F=C[2])-ie*(R=C[1]),C[5]=te*B+Q*R+ie*S-K*F,C[6]=ie*B+Q*F+K*R-te*S,C[7]=Q*B-K*S-te*R-ie*F,C},tn.rotateZ=function(C,T,I){var S=-T[0],R=-T[1],F=-T[2],B=T[3],U=T[4],k=T[5],G=T[6],H=T[7],K=U*B+H*S+k*F-G*R,te=k*B+H*R+G*S-U*F,ie=G*B+H*F+U*R-k*S,Q=H*B-U*S-k*R-G*F;return r.rotateZ(C,T,I),C[4]=K*(B=C[3])+Q*(S=C[0])+te*(F=C[2])-ie*(R=C[1]),C[5]=te*B+Q*R+ie*S-K*F,C[6]=ie*B+Q*F+K*R-te*S,C[7]=Q*B-K*S-te*R-ie*F,C},tn.rotateByQuatAppend=function(C,T,I){var S=I[0],R=I[1],F=I[2],B=I[3],U=T[0],k=T[1],G=T[2],H=T[3];return C[0]=U*B+H*S+k*F-G*R,C[1]=k*B+H*R+G*S-U*F,C[2]=G*B+H*F+U*R-k*S,C[3]=H*B-U*S-k*R-G*F,C[4]=(U=T[4])*B+(H=T[7])*S+(k=T[5])*F-(G=T[6])*R,C[5]=k*B+H*R+G*S-U*F,C[6]=G*B+H*F+U*R-k*S,C[7]=H*B-U*S-k*R-G*F,C},tn.rotateByQuatPrepend=function(C,T,I){var S=T[0],R=T[1],F=T[2],B=T[3],U=I[0],k=I[1],G=I[2],H=I[3];return C[0]=S*H+B*U+R*G-F*k,C[1]=R*H+B*k+F*U-S*G,C[2]=F*H+B*G+S*k-R*U,C[3]=B*H-S*U-R*k-F*G,C[4]=S*(H=I[7])+B*(U=I[4])+R*(G=I[6])-F*(k=I[5]),C[5]=R*H+B*k+F*U-S*G,C[6]=F*H+B*G+S*k-R*U,C[7]=B*H-S*U-R*k-F*G,C},tn.rotateAroundAxis=function(C,T,I,S){if(Math.abs(S)<e.EPSILON)return x(C,T);var R=Math.hypot(I[0],I[1],I[2]);S*=.5;var F=Math.sin(S),B=F*I[0]/R,U=F*I[1]/R,k=F*I[2]/R,G=Math.cos(S),H=T[0],K=T[1],te=T[2],ie=T[3];C[0]=H*G+ie*B+K*k-te*U,C[1]=K*G+ie*U+te*B-H*k,C[2]=te*G+ie*k+H*U-K*B,C[3]=ie*G-H*B-K*U-te*k;var Q=T[4],ue=T[5],se=T[6],de=T[7];return C[4]=Q*G+de*B+ue*k-se*U,C[5]=ue*G+de*U+se*B-Q*k,C[6]=se*G+de*k+Q*U-ue*B,C[7]=de*G-Q*B-ue*U-se*k,C},tn.add=function(C,T,I){return C[0]=T[0]+I[0],C[1]=T[1]+I[1],C[2]=T[2]+I[2],C[3]=T[3]+I[3],C[4]=T[4]+I[4],C[5]=T[5]+I[5],C[6]=T[6]+I[6],C[7]=T[7]+I[7],C},tn.multiply=E,tn.scale=function(C,T,I){return C[0]=T[0]*I,C[1]=T[1]*I,C[2]=T[2]*I,C[3]=T[3]*I,C[4]=T[4]*I,C[5]=T[5]*I,C[6]=T[6]*I,C[7]=T[7]*I,C},tn.lerp=function(C,T,I,S){var R=1-S;return D(T,I)<0&&(S=-S),C[0]=T[0]*R+I[0]*S,C[1]=T[1]*R+I[1]*S,C[2]=T[2]*R+I[2]*S,C[3]=T[3]*R+I[3]*S,C[4]=T[4]*R+I[4]*S,C[5]=T[5]*R+I[5]*S,C[6]=T[6]*R+I[6]*S,C[7]=T[7]*R+I[7]*S,C},tn.invert=function(C,T){var I=w(T);return C[0]=-T[0]/I,C[1]=-T[1]/I,C[2]=-T[2]/I,C[3]=T[3]/I,C[4]=-T[4]/I,C[5]=-T[5]/I,C[6]=-T[6]/I,C[7]=T[7]/I,C},tn.conjugate=function(C,T){return C[0]=-T[0],C[1]=-T[1],C[2]=-T[2],C[3]=T[3],C[4]=-T[4],C[5]=-T[5],C[6]=-T[6],C[7]=T[7],C},tn.normalize=function(C,T){var I=w(T);if(I>0){I=Math.sqrt(I);var S=T[0]/I,R=T[1]/I,F=T[2]/I,B=T[3]/I,U=T[4],k=T[5],G=T[6],H=T[7],K=S*U+R*k+F*G+B*H;C[0]=S,C[1]=R,C[2]=F,C[3]=B,C[4]=(U-S*K)/I,C[5]=(k-R*K)/I,C[6]=(G-F*K)/I,C[7]=(H-B*K)/I}return C},tn.str=function(C){return"quat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+")"},tn.exactEquals=function(C,T){return C[0]===T[0]&&C[1]===T[1]&&C[2]===T[2]&&C[3]===T[3]&&C[4]===T[4]&&C[5]===T[5]&&C[6]===T[6]&&C[7]===T[7]},tn.equals=function(C,T){var I=C[0],S=C[1],R=C[2],F=C[3],B=C[4],U=C[5],k=C[6],G=C[7],H=T[0],K=T[1],te=T[2],ie=T[3],Q=T[4],ue=T[5],se=T[6],de=T[7];return Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(S-K)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(K))&&Math.abs(R-te)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(te))&&Math.abs(F-ie)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(ie))&&Math.abs(B-Q)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Q))&&Math.abs(U-ue)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(ue))&&Math.abs(k-se)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(se))&&Math.abs(G-de)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(de))},tn.sqrLen=tn.squaredLength=tn.len=tn.length=tn.dot=tn.mul=tn.setReal=tn.getReal=void 0;var e=h(xe()),r=h(ls()),c=h(zi());function p(C){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(p=function(S){return S?I:T})(C)}function h(C,T){if(C&&C.__esModule)return C;if(C===null||l(C)!=="object"&&typeof C!="function")return{default:C};var I=p(T);if(I&&I.has(C))return I.get(C);var S={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in C)if(F!=="default"&&Object.prototype.hasOwnProperty.call(C,F)){var B=R?Object.getOwnPropertyDescriptor(C,F):null;B&&(B.get||B.set)?Object.defineProperty(S,F,B):S[F]=C[F]}return S.default=C,I&&I.set(C,S),S}function m(C,T,I){var S=.5*I[0],R=.5*I[1],F=.5*I[2],B=T[0],U=T[1],k=T[2],G=T[3];return C[0]=B,C[1]=U,C[2]=k,C[3]=G,C[4]=S*G+R*k-F*U,C[5]=R*G+F*B-S*k,C[6]=F*G+S*U-R*B,C[7]=-S*B-R*U-F*k,C}function x(C,T){return C[0]=T[0],C[1]=T[1],C[2]=T[2],C[3]=T[3],C[4]=T[4],C[5]=T[5],C[6]=T[6],C[7]=T[7],C}function E(C,T,I){var S=T[0],R=T[1],F=T[2],B=T[3],U=I[4],k=I[5],G=I[6],H=I[7],K=T[4],te=T[5],ie=T[6],Q=T[7],ue=I[0],se=I[1],de=I[2],ve=I[3];return C[0]=S*ve+B*ue+R*de-F*se,C[1]=R*ve+B*se+F*ue-S*de,C[2]=F*ve+B*de+S*se-R*ue,C[3]=B*ve-S*ue-R*se-F*de,C[4]=S*H+B*U+R*G-F*k+K*ve+Q*ue+te*de-ie*se,C[5]=R*H+B*k+F*U-S*G+te*ve+Q*se+ie*ue-K*de,C[6]=F*H+B*G+S*k-R*U+ie*ve+Q*de+K*se-te*ue,C[7]=B*H-S*U-R*k-F*G+Q*ve-K*ue-te*se-ie*de,C}tn.getReal=r.copy,tn.setReal=r.copy,tn.mul=E;var D=r.dot;tn.dot=D;var y=r.length;tn.length=y,tn.len=y;var w=r.squaredLength;return tn.squaredLength=w,tn.sqrLen=w,tn}var kc,cl,Xt={};function Nc(){if(kc)return Xt;function l(T){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(T)}kc=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=c,Xt.clone=function(T){var I=new e.ARRAY_TYPE(2);return I[0]=T[0],I[1]=T[1],I},Xt.fromValues=function(T,I){var S=new e.ARRAY_TYPE(2);return S[0]=T,S[1]=I,S},Xt.copy=function(T,I){return T[0]=I[0],T[1]=I[1],T},Xt.set=function(T,I,S){return T[0]=I,T[1]=S,T},Xt.add=function(T,I,S){return T[0]=I[0]+S[0],T[1]=I[1]+S[1],T},Xt.subtract=p,Xt.multiply=h,Xt.divide=m,Xt.ceil=function(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T},Xt.floor=function(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T},Xt.min=function(T,I,S){return T[0]=Math.min(I[0],S[0]),T[1]=Math.min(I[1],S[1]),T},Xt.max=function(T,I,S){return T[0]=Math.max(I[0],S[0]),T[1]=Math.max(I[1],S[1]),T},Xt.round=function(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T},Xt.scale=function(T,I,S){return T[0]=I[0]*S,T[1]=I[1]*S,T},Xt.scaleAndAdd=function(T,I,S,R){return T[0]=I[0]+S[0]*R,T[1]=I[1]+S[1]*R,T},Xt.distance=x,Xt.squaredDistance=E,Xt.length=D,Xt.squaredLength=y,Xt.negate=function(T,I){return T[0]=-I[0],T[1]=-I[1],T},Xt.inverse=function(T,I){return T[0]=1/I[0],T[1]=1/I[1],T},Xt.normalize=function(T,I){var S=I[0],R=I[1],F=S*S+R*R;return F>0&&(F=1/Math.sqrt(F)),T[0]=I[0]*F,T[1]=I[1]*F,T},Xt.dot=function(T,I){return T[0]*I[0]+T[1]*I[1]},Xt.cross=function(T,I,S){var R=I[0]*S[1]-I[1]*S[0];return T[0]=T[1]=0,T[2]=R,T},Xt.lerp=function(T,I,S,R){var F=I[0],B=I[1];return T[0]=F+R*(S[0]-F),T[1]=B+R*(S[1]-B),T},Xt.random=function(T,I){I=I||1;var S=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(S)*I,T[1]=Math.sin(S)*I,T},Xt.transformMat2=function(T,I,S){var R=I[0],F=I[1];return T[0]=S[0]*R+S[2]*F,T[1]=S[1]*R+S[3]*F,T},Xt.transformMat2d=function(T,I,S){var R=I[0],F=I[1];return T[0]=S[0]*R+S[2]*F+S[4],T[1]=S[1]*R+S[3]*F+S[5],T},Xt.transformMat3=function(T,I,S){var R=I[0],F=I[1];return T[0]=S[0]*R+S[3]*F+S[6],T[1]=S[1]*R+S[4]*F+S[7],T},Xt.transformMat4=function(T,I,S){var R=I[0],F=I[1];return T[0]=S[0]*R+S[4]*F+S[12],T[1]=S[1]*R+S[5]*F+S[13],T},Xt.rotate=function(T,I,S,R){var F=I[0]-S[0],B=I[1]-S[1],U=Math.sin(R),k=Math.cos(R);return T[0]=F*k-B*U+S[0],T[1]=F*U+B*k+S[1],T},Xt.angle=function(T,I){var S=T[0],R=T[1],F=I[0],B=I[1],U=Math.sqrt(S*S+R*R)*Math.sqrt(F*F+B*B);return Math.acos(Math.min(Math.max(U&&(S*F+R*B)/U,-1),1))},Xt.zero=function(T){return T[0]=0,T[1]=0,T},Xt.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},Xt.exactEquals=function(T,I){return T[0]===I[0]&&T[1]===I[1]},Xt.equals=function(T,I){var S=T[0],R=T[1],F=I[0],B=I[1];return Math.abs(S-F)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(F))&&Math.abs(R-B)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(B))},Xt.forEach=Xt.sqrLen=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=Xt.len=void 0;var e=function(T,I){if(T&&T.__esModule)return T;if(T===null||l(T)!=="object"&&typeof T!="function")return{default:T};var S=r(void 0);if(S&&S.has(T))return S.get(T);var R={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in T)if(B!=="default"&&Object.prototype.hasOwnProperty.call(T,B)){var U=F?Object.getOwnPropertyDescriptor(T,B):null;U&&(U.get||U.set)?Object.defineProperty(R,B,U):R[B]=T[B]}return R.default=T,S&&S.set(T,R),R}(xe());function r(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,S=new WeakMap;return(r=function(R){return R?S:I})(T)}function c(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function p(T,I,S){return T[0]=I[0]-S[0],T[1]=I[1]-S[1],T}function h(T,I,S){return T[0]=I[0]*S[0],T[1]=I[1]*S[1],T}function m(T,I,S){return T[0]=I[0]/S[0],T[1]=I[1]/S[1],T}function x(T,I){return Math.hypot(I[0]-T[0],I[1]-T[1])}function E(T,I){var S=I[0]-T[0],R=I[1]-T[1];return S*S+R*R}function D(T){return Math.hypot(T[0],T[1])}function y(T){var I=T[0],S=T[1];return I*I+S*S}Xt.len=D,Xt.sub=p,Xt.mul=h,Xt.div=m,Xt.dist=x,Xt.sqrDist=E,Xt.sqrLen=y;var w,C=(w=c(),function(T,I,S,R,F,B){var U,k;for(I||(I=2),S||(S=0),k=R?Math.min(R*I+S,T.length):T.length,U=S;U<k;U+=I)w[0]=T[U],w[1]=T[U+1],F(w,w,B),T[U]=w[0],T[U+1]=w[1];return T});return Xt.forEach=C,Xt}function wo(){if(cl)return $;function l(T){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(T)}cl=1,Object.defineProperty($,"__esModule",{value:!0}),$.vec4=$.vec3=$.vec2=$.quat2=$.quat=$.mat4=$.mat3=$.mat2d=$.mat2=$.glMatrix=void 0;var e=C(xe());$.glMatrix=e;var r=C(Ze());$.mat2=r;var c=C(Ut());$.mat2d=c;var p=C(Zn());$.mat3=p;var h=C(zi());$.mat4=h;var m=C(ls());$.quat=m;var x=C(wa());$.quat2=x;var E=C(Nc());$.vec2=E;var D=C(as());$.vec3=D;var y=C(Ir());function w(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,S=new WeakMap;return(w=function(R){return R?S:I})(T)}function C(T,I){if(T&&T.__esModule)return T;if(T===null||l(T)!=="object"&&typeof T!="function")return{default:T};var S=w(I);if(S&&S.has(T))return S.get(T);var R={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in T)if(B!=="default"&&Object.prototype.hasOwnProperty.call(T,B)){var U=F?Object.getOwnPropertyDescriptor(T,B):null;U&&(U.get||U.set)?Object.defineProperty(R,B,U):R[B]=T[B]}return R.default=T,S&&S.set(T,R),R}return $.vec4=y,$}var lo,ul,zc,Ta,be=wo(),cs=function(){if(ul)return lo;function l(e,r,c,p){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=c,this.p2y=p}return ul=1,lo=l,l.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,p=0;p<8;p++){var h=this.sampleCurveX(c)-e;if(Math.abs(h)<r)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=h/m}var x=0,E=1;for(c=e,p=0;p<20&&(h=this.sampleCurveX(c),!(Math.abs(h-e)<r));p++)e>h?x=c:E=c,c=.5*(E-x)+x;return c},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},lo}(),$s=P(cs);function Bc(){if(Ta)return zc;function l(e,r){this.x=e,this.y=r}return Ta=1,zc=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,c=e.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),c=Math.sin(e),p=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=p,this},_rotateAround:function(e,r){var c=Math.cos(e),p=Math.sin(e),h=r.y+p*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-p*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(e){return e instanceof l?e:Array.isArray(e)?new l(e[0],e[1]):e},zc}var st=P(Bc());function Ea(l,e){if(Array.isArray(l)){if(!Array.isArray(e)||l.length!==e.length)return!1;for(let r=0;r<l.length;r++)if(!Ea(l[r],e[r]))return!1;return!0}if(typeof l=="object"&&l!==null&&e!==null){if(typeof e!="object"||Object.keys(l).length!==Object.keys(e).length)return!1;for(let r in l)if(!Ea(l[r],e[r]))return!1;return!0}return l===e}let nr=Math.PI/180,us=180/Math.PI;function _n(l){return l*nr}function Ki(l){return l*us}let To=[[0,0],[1,0],[1,1],[0,1]];function Ia(l){if(l<=0)return 0;if(l>=1)return 1;let e=l*l,r=e*l;return 4*(l<.5?r:3*(l-e)+r-.75)}function Gs(l,e,r,c){let p=new $s(l,e,r,c);return function(h){return p.solve(h)}}let hl=Gs(.25,.1,.25,1);function Qt(l,e,r){return Math.min(r,Math.max(e,l))}function dl(l,e,r){return(r=Qt((r-l)/(e-l),0,1))*r*(3-2*r)}function hs(l,e,r){let c=r-e,p=((l-e)%c+c)%c+e;return p===e?r:p}function Ca(l,e,r){if(!l.length)return r(null,[]);let c=l.length,p=new Array(l.length),h=null;l.forEach((m,x)=>{e(m,(E,D)=>{E&&(h=E),p[x]=D,--c==0&&r(h,p)})})}function mr(l,...e){for(let r of e)for(let c in r)l[c]=r[c];return l}let qr=1;function Vc(){return qr++}function jc(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function fl(l,e){l.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ds(l,e){return l.indexOf(e,l.length-e.length)!==-1}function Da(l,e,r){let c={};for(let p in l)c[p]=e.call(this,l[p],p,l);return c}function pl(l,e,r){let c={};for(let p in l)e.call(this,l[p],p,l)&&(c[p]=l[p]);return c}function co(l){return Array.isArray(l)?l.map(co):typeof l=="object"&&l?Da(l,co):l}let Uc={};function In(l){Uc[l]||(typeof console<"u"&&console.warn(l),Uc[l]=!0)}function jo(l,e,r){return(r.y-l.y)*(e.x-l.x)>(e.y-l.y)*(r.x-l.x)}function rh(l){let e=0;for(let r,c,p=0,h=l.length,m=h-1;p<h;m=p++)r=l[p],c=l[m],e+=(c.x-r.x)*(r.y+c.y);return e}function Wr([l,e,r]){let c=_n(e+90),p=_n(r);return{x:l*Math.cos(c)*Math.sin(p),y:l*Math.sin(c)*Math.sin(p),z:l*Math.cos(p),azimuthal:e,polar:r}}function Ma(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function $c(l){let e={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,p,h)=>{let m=p||h;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ml,Gc=null;function Sa(l,e){return[l[4*e],l[4*e+1],l[4*e+2],l[4*e+3]]}function ke(l,e,r,c){for(;e<r;){let p=e+r>>1;l[p]<c?e=p+1:r=p}return e}function Y(l,e,r,c){for(;e<r;){let p=e+r>>1;l[p]<=c?e=p+1:r=p}return e}function J(l){return l>0?1/(1.001-l):1+l}function ce(l){return l>0?1-1/(1.001-l):-l}let _e={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ml==null){let l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ml=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):l}catch{ml=l}}return ml},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!_e.API_URL)return null;try{let l=new URL(_e.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function me(l){return _e.API_URL_REGEX.test(l)}function Ce(l){return _e.API_SPRITE_REGEX.test(l)}let Le,Ae,Fe,$e,Ve,Qe;function ht(){return Le==null&&(Le=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Le}let dt={now:()=>$e!==void 0?$e:performance.now(),setNow(l){$e=l},restoreNow(){$e=void 0},frame(l){let e=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(l,e=0){let{width:r,height:c}=l;Ve||(Ve=document.createElement("canvas"));let p=Ve.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(r>Ve.width||c>Ve.height)&&(Ve.width=r,Ve.height=c),p.clearRect(-e,-e,r+2*e,c+2*e),p.drawImage(l,0,0,r,c),p.getImageData(-e,-e,r+2*e,c+2*e)},resolveURL:l=>(Ae||(Ae=document.createElement("a")),Ae.href=l,Ae.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Fe==null&&(Fe=window.matchMedia("(prefers-reduced-motion: reduce)")),Fe.matches)},hasCanvasFingerprintNoise(){if(Qe!==void 0)return Qe;if(!ht())return Qe=!1,!1;let l=new OffscreenCanvas(85,1),e=l.getContext("2d",{willReadFrequently:!0}),r=0;for(let p=0;p<l.width;++p)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(p,0,1,1);let c=e.getImageData(0,0,l.width,l.height);r=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&r++!==c.data[p])return Qe=!0,!0;return Qe=!1,!1}};function Vt(l,e){let r=l.indexOf("?");if(r<0)return`${l}?${new URLSearchParams(e).toString()}`;let c=new URLSearchParams(l.slice(r));for(let p in e)c.set(p,e[p]);return`${l.slice(0,r)}?${c.toString()}`}function $t(l,e={persistentParams:[]}){let r=l.indexOf("?");if(r<0)return l;let c=new URLSearchParams,p=new URLSearchParams(l.slice(r));for(let m of e.persistentParams){let x=p.get(m);x&&c.set(m,x)}let h=c.toString();return`${l.slice(0,r)}${h.length>0?`?${h}`:""}`}let Ht="mapbox-tiles",Gt=500,Ln=50,Un=["language","worldview","jobid"],nn,Vn;function pi(){try{return caches}catch{}}function Bi(){let l=pi();l&&nn==null&&(nn=l.open(Ht))}let Ui=1/0,ir={supported:!1,testSupport:function(l){!oh&&fs&&(Hc?sh(l):Eo=l)}},Eo,fs,oh=!1,Hc=!1,gl=typeof self<"u"?self:{};function sh(l){let e=l.createTexture();l.bindTexture(l.TEXTURE_2D,e);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,fs),l.isContextLost())return;ir.supported=!0}catch{}l.deleteTexture(e),oh=!0}gl.document&&(fs=gl.document.createElement("img"),fs.onload=function(){Eo&&sh(Eo),Eo=null,Hc=!0},fs.onerror=function(){oh=!0,Eo=null},fs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let _l={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(_l);class xf extends Error{constructor(e,r,c){r===401&&me(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let bf=Ma()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,qc=function(l,e){if(!(/^file:/.test(r=l.url)||/^file:/.test(bf())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){let h=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:bf(),referrerPolicy:c.referrerPolicy,signal:h.signal}),x=!1,E=!1,D=(y=m.url).indexOf("sku=")>0&&me(y);var y;c.type==="json"&&m.headers.set("Accept","application/json");let w=(T,I,S)=>{if(E)return;if(T&&T.message!=="SecurityError"&&In(T.toString()),I&&S)return C(I);let R=Date.now();fetch(m).then(F=>{if(F.ok){let B=D?F.clone():null;return C(F,B,R)}return p(new xf(F.statusText,F.status,c.url))}).catch(F=>{F.name!=="AbortError"&&p(new Error(`${F.message} ${c.url}`))})},C=(T,I,S)=>{(c.type==="arrayBuffer"?T.arrayBuffer():c.type==="json"?T.json():T.text()).then(R=>{E||(I&&S&&function(F,B,U){if(Bi(),nn==null)return;let k=$c(B.headers.get("Cache-Control")||"");if(k["no-store"])return;let G={status:B.status,statusText:B.statusText,headers:new Headers};B.headers.forEach((te,ie)=>G.headers.set(ie,te)),k["max-age"]&&G.headers.set("Expires",new Date(U+1e3*k["max-age"]).toUTCString());let H=G.headers.get("Expires");if(!H||new Date(H).getTime()-U<42e4)return;let K=$t(F.url,{persistentParams:Un});if(B.status===206){let te=F.headers.get("Range");if(!te)return;G.status=200,K=Vt(K,{range:te})}(function(te,ie){if(Vn===void 0)try{new Response(new ReadableStream),Vn=!0}catch{Vn=!1}Vn?ie(te.body):te.blob().then(ie)})(B,te=>{let ie=new Response((Q=B.status)!==200&&Q!==404&&[101,103,204,205,304].includes(Q)?null:te,G);var Q;Bi(),nn?.then(ue=>ue.put(K,ie)).catch(ue=>In(ue.message))})}(m,I,S),x=!0,p(null,R,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(R=>{E||p(new Error(R.message))})};return D?function(T,I){if(Bi(),nn==null)return I(null);nn.then(S=>{let R=$t(T.url,{persistentParams:Un}),F=T.headers.get("Range");F&&(R=Vt(R,{range:F})),S.match(R).then(B=>{let U=function(k){if(!k)return!1;let G=new Date(k.headers.get("Expires")||0),H=$c(k.headers.get("Cache-Control")||"");return G>Date.now()&&!H["no-cache"]}(B);S.delete(R),U&&S.put(R,B.clone()),I(null,B,U)}).catch(I)}).catch(I)}(m,w):w(null,null),{cancel:()=>{E=!0,x||h.abort()}}}(l,e);if(Ma()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,e,void 0,!0)}var r;return function(c,p){let h=new XMLHttpRequest;h.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(let m in c.headers)h.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=c.credentials==="include",h.onerror=()=>{p(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let m=h.response;if(c.type==="json")try{m=JSON.parse(h.response)}catch(x){return p(x)}p(null,m,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else p(new xf(h.statusText,h.status,c.url))},h.send(c.body),{cancel:()=>h.abort()}}(l,e)},yl=function(l,e){return qc(mr(l,{type:"arrayBuffer"}),e)};function uo(l){let e=document.createElement("a");return e.href=l,e.protocol===location.protocol&&e.host===location.host}let Io="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Co,kr;Co=[],kr=0;let Uo=function(l,e){if(ir.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),kr>=_e.MAX_PARALLEL_IMAGE_REQUESTS){let h={requestParameters:l,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Co.push(h),h}kr++;let r=!1,c=()=>{if(!r)for(r=!0,kr--;Co.length&&kr<_e.MAX_PARALLEL_IMAGE_REQUESTS;){let h=Co.shift(),{requestParameters:m,callback:x,cancelled:E}=h;E||(h.cancel=Uo(m,x).cancel)}},p=yl(l,(h,m,x,E)=>{c(),h?e(h):m&&(self.createImageBitmap?function(D,y){let w=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(w).then(C=>{y(null,C)}).catch(C=>{y(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(D,y)=>e(D,y,x,E)):function(D,y){let w=new Image;w.onload=()=>{y(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=Io})},w.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let C=new Blob([new Uint8Array(D)],{type:"image/png"});w.src=D.byteLength?URL.createObjectURL(C):Io}(m,(D,y)=>e(D,y,x,E)))});return{cancel:()=>{p.cancel(),c()}}};var Wc,wf,Tf,$o={exports:{}},ah={exports:{}},mg={exports:{}},Xv=function(){if(Tf)return $o.exports;Tf=1;var l=(Wc||(Wc=1,ah.exports=function(r,c){var p,h,m,x,E,D,y,w;for(h=r.length-(p=3&r.length),m=c,E=3432918353,D=461845907,w=0;w<h;)y=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24,++w,m=27492+(65535&(x=5*(65535&(m=(m^=y=(65535&(y=(y=(65535&y)*E+(((y>>>16)*E&65535)<<16)&4294967295)<<15|y>>>17))*D+(((y>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(y=0,p){case 3:y^=(255&r.charCodeAt(w+2))<<16;case 2:y^=(255&r.charCodeAt(w+1))<<8;case 1:m^=y=(65535&(y=(y=(65535&(y^=255&r.charCodeAt(w)))*E+(((y>>>16)*E&65535)<<16)&4294967295)<<15|y>>>17))*D+(((y>>>16)*D&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),ah.exports),e=(wf||(wf=1,mg.exports=function(r,c){for(var p,h=r.length,m=c^h,x=0;h>=4;)p=1540483477*(65535&(p=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:m^=(255&r.charCodeAt(x+2))<<16;case 2:m^=(255&r.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),mg.exports);return $o.exports=l,$o.exports.murmur3=l,$o.exports.murmur2=e,$o.exports}(),Nr=P(Xv);class Hs{constructor(e,...r){mr(this,r[0]||{}),this.type=e}}class Zc extends Hs{constructor(e,r={}){super("error",mr({error:e},r))}}function vl(l,e,r){r[l]&&r[l].indexOf(e)!==-1||(r[l]=r[l]||[],r[l].push(e))}function Ef(l,e,r){if(r&&r[l]){let c=r[l].indexOf(e);c!==-1&&r[l].splice(c,1)}}class xl{on(e,r){return this._listeners=this._listeners||{},vl(e,r,this._listeners),this}off(e,r){return Ef(e,r,this._listeners),Ef(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},vl(e,r,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,r){let c=typeof e=="string"?new Hs(e,r):e,p=c.type;if(this.listens(p)){c.target=this;let h=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(let E of h)E.call(this,c);let m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(let E of m)Ef(p,E,this._oneTimeListeners),E.call(this,c);let x=this._eventedParent;x&&(mr(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof Zc&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var If,Cn={},Cf=function(){if(If)return Cn;If=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(h){return(h=Math.round(h))<0?0:h>255?255:h}function r(h){return e(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function c(h){return(m=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:m>1?1:m;var m}function p(h,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?h+(m-h)*x*6:2*x<1?m:3*x<2?h+(m-h)*(2/3-x)*6:h}try{Cn.parseCSSColor=function(h){var m,x=h.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var E=x.indexOf("("),D=x.indexOf(")");if(E!==-1&&D+1===x.length){var y=x.substr(0,E),w=x.substr(E+1,D-(E+1)).split(","),C=1;switch(y){case"rgba":if(w.length!==4)return null;C=c(w.pop());case"rgb":return w.length!==3?null:[r(w[0]),r(w[1]),r(w[2]),C];case"hsla":if(w.length!==4)return null;C=c(w.pop());case"hsl":if(w.length!==3)return null;var T=(parseFloat(w[0])%360+360)%360/360,I=c(w[1]),S=c(w[2]),R=S<=.5?S*(I+1):S+I-S*I,F=2*S-R;return[e(255*p(F,R,T+1/3)),e(255*p(F,R,T)),e(255*p(F,R,T-1/3)),C];default:return null}}return null}}catch{}return Cn}();class Fn{constructor(e,r,c,p=1){this.r=e,this.g=r,this.b=c,this.a=p}static parse(e){if(!e)return;if(e instanceof Fn)return e;if(typeof e!="string")return;let r=Cf.parseCSSColor(e);return r?new Fn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(c)},${p})`}toRenderColor(e){let{r,g:c,b:p,a:h}=this;return new Yv(e,r,c,p,h)}}class Yv{constructor(e,r,c,p,h){if(e){let m=e.image.height,x=m*m;r=h===0?0:r/h*(m-1),c=h===0?0:c/h*(m-1),p=h===0?0:p/h*(m-1);let E=Math.floor(r),D=Math.floor(c),y=Math.floor(p),w=Math.ceil(r),C=Math.ceil(c),T=Math.ceil(p),I=r-E,S=c-D,R=p-y,F=e.image.data,B=4*(E+D*x+y*m),U=4*(E+D*x+T*m),k=4*(E+C*x+y*m),G=4*(E+C*x+T*m),H=4*(w+D*x+y*m),K=4*(w+D*x+T*m),te=4*(w+C*x+y*m),ie=4*(w+C*x+T*m);if(B<0||ie>=F.length)throw new Error("out of range");this.r=Pt(Pt(Pt(F[B],F[U],R),Pt(F[k],F[G],R),S),Pt(Pt(F[H],F[K],R),Pt(F[te],F[ie],R),S),I)/255*h,this.g=Pt(Pt(Pt(F[B+1],F[U+1],R),Pt(F[k+1],F[G+1],R),S),Pt(Pt(F[H+1],F[K+1],R),Pt(F[te+1],F[ie+1],R),S),I)/255*h,this.b=Pt(Pt(Pt(F[B+2],F[U+2],R),Pt(F[k+2],F[G+2],R),S),Pt(Pt(F[H+2],F[K+2],R),Pt(F[te+2],F[ie+2],R),S),I)/255*h,this.a=h}else this.r=r,this.g=c,this.b=p,this.a=h}toArray(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*c/p,p]}toArray01(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[e/p,r/p,c/p,p]}toArray01Scaled(e){let{r,g:c,b:p,a:h}=this;return h===0?[0,0,0]:[r/h*e,c/h*e,p/h*e]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:c,a:p}=this;return[e,r,c,p]}toArray01Linear(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(r/p,2.2),Math.pow(c/p,2.2),p]}}function Pt(l,e,r){return l*(1-r)+e*r}function Xc(l,e,r){return l.map((c,p)=>Pt(c,e[p],r))}Fn.black=new Fn(0,0,0,1),Fn.white=new Fn(1,1,1,1),Fn.transparent=new Fn(0,0,0,0),Fn.red=new Fn(1,0,0,1),Fn.blue=new Fn(0,0,1,1);var Aa=Object.freeze({__proto__:null,array:Xc,color:function(l,e,r){return new Fn(Pt(l.r,e.r,r),Pt(l.g,e.g,r),Pt(l.b,e.b,r),Pt(l.a,e.a,r))},number:Pt});function bl(l,...e){for(let r of e)for(let c in r)l[c]=r[c];return l}class Go extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class lh{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[c,p]of r)this.bindings[c]=p}concat(e){return new lh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Do={kind:"null"},gt={kind:"number"},vn={kind:"string"},xn={kind:"boolean"},zr={kind:"color"},gr={kind:"object"},Tn={kind:"value"},ch={kind:"collator"},wl={kind:"formatted"},Tl={kind:"resolvedImage"};function Cr(l,e){return{kind:"array",itemType:l,N:e}}function wi(l){if(l.kind==="array"){let e=wi(l.itemType);return typeof l.N=="number"?`array<${e}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${e}>`}return l.kind}let gg=[Do,gt,vn,xn,zr,wl,gr,Cr(Tn),Tl];function El(l,e){if(e.kind==="error")return null;if(l.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!El(l.itemType,e.itemType))&&(typeof l.N!="number"||l.N===e.N))return null}else{if(l.kind===e.kind)return null;if(l.kind==="value"){for(let r of gg)if(!El(r,e))return null}}return`Expected ${wi(l)} but found ${wi(e)} instead.`}function Il(l,e){return e.some(r=>r.kind===l.kind)}function Ho(l,e){return e.some(r=>r==="null"?l===null:r==="array"?Array.isArray(l):r==="object"?l&&!Array.isArray(l)&&typeof l=="object":r===typeof l)}class uh{constructor(e,r,c){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zr{constructor(e,r,c,p,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=c,this.fontStack=p,this.textColor=h}}class _r{constructor(e){this.sections=e}static fromString(e){return new _r([new Zr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof _r?e:_r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);let c={};r.fontStack&&(c["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(c["font-scale"]=r.scale),r.textColor&&(c["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(c)}return e}}class Dr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new Dr({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function _g(l,e,r,c){return typeof l=="number"&&l>=0&&l<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,e,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,e,r,c]:[l,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qs(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Fn||l instanceof uh||l instanceof _r||l instanceof Dr)return!0;if(Array.isArray(l)){for(let e of l)if(!qs(e))return!1;return!0}if(typeof l=="object"){for(let e in l)if(!qs(l[e]))return!1;return!0}return!1}function Fi(l){if(l===null)return Do;if(typeof l=="string")return vn;if(typeof l=="boolean")return xn;if(typeof l=="number")return gt;if(l instanceof Fn)return zr;if(l instanceof uh)return ch;if(l instanceof _r)return wl;if(l instanceof Dr)return Tl;if(Array.isArray(l)){let e=l.length,r;for(let c of l){let p=Fi(c);if(r){if(r===p)continue;r=Tn;break}r=p}return Cr(r||Tn,e)}return gr}function Mr(l){let e=typeof l;return l===null?"":e==="string"||e==="number"||e==="boolean"?String(l):l instanceof Fn||l instanceof _r||l instanceof Dr?l.toString():JSON.stringify(l)}class Mo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!qs(e[1]))return r.error("invalid value");let c=e[1],p=Fi(c),h=r.expectedType;return p.kind!=="array"||p.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(p=h),new Mo(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof _r?this.value.serialize():this.value}}class Wi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Df={string:vn,number:gt,boolean:xn,object:gr};class So{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c,p=1,h=e[0];if(h==="array"){let x,E;if(e.length>2){let D=e[1];if(typeof D!="string"||!(D in Df)||D==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=Df[D],p++}else x=Tn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],p++}c=Cr(x,E)}else c=Df[h];let m=[];for(;p<e.length;p++){let x=r.parse(e[p],p,Tn);if(!x)return null;m.push(x)}return new So(c,m)}evaluate(e){for(let r=0;r<this.args.length;r++){let c=this.args[r].evaluate(e);if(!El(this.type,Fi(c)))return c;if(r===this.args.length-1)throw new Wi(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${wi(Fi(c))} but was expected to be of type ${wi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){r.push(c.kind);let p=e.N;(typeof p=="number"||this.args.length>1)&&r.push(p)}}return r.concat(this.args.map(c=>c.serialize()))}}class Cl{constructor(e){this.type=wl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c=e[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");let p=[],h=!1;for(let m=1;m<=e.length-1;++m){let x=e[m];if(h&&typeof x=="object"&&!Array.isArray(x)){h=!1;let E=null;if(x["font-scale"]&&(E=r.parseObjectValue(x["font-scale"],m,"font-scale",gt),!E))return null;let D=null;if(x["text-font"]&&(D=r.parseObjectValue(x["text-font"],m,"text-font",Cr(vn)),!D))return null;let y=null;if(x["text-color"]&&(y=r.parseObjectValue(x["text-color"],m,"text-color",zr),!y))return null;let w=p[p.length-1];w.scale=E,w.font=D,w.textColor=y}else{let E=r.parse(e[m],m,Tn);if(!E)return null;let D=E.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Cl(p)}evaluate(e){return new _r(this.sections.map(r=>{let c=r.content.evaluate(e);return Fi(c)===Tl?new Zr("",c,null,null,null):new Zr(Mr(c),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let c={};r.scale&&(c["font-scale"]=r.scale.serialize()),r.font&&(c["text-font"]=r.font.serialize()),r.textColor&&(c["text-color"]=r.textColor.serialize()),e.push(c)}return e}}class Pa{constructor(e,r){this.type=Tl,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let c=r.parse(e[1],1,vn);if(!c)return r.error("No image name provided.");if(e.length===2)return new Pa(c);let p=r.parse(e[2],1,vn);return p?new Pa(c,p):r.error("Secondary image variant is not a string.")}evaluate(e){let r=Dr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ra(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}let hh={"to-boolean":xn,"to-color":zr,"to-number":gt,"to-string":vn};class ps{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c=e[0],p=[],h=Do;if(c==="to-array"){if(!Array.isArray(e[1]))return null;let m=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);h=Cr(r.expectedType.itemType,m)}else{if(!(m>0&&qs(e[1][0])))return null;h=Cr(Fi(e[1][0]),m)}for(let x=0;x<m;x++){let E=e[1][x],D;if(Ra(E)==="array")D=r.parse(E,void 0,h.itemType);else{let y=Ra(E);if(y!==h.itemType.kind)return r.error(`Expected ${h.itemType.kind} but found ${y}.`);D=r.registry.literal.parse(["literal",E===void 0?null:E],r)}if(!D)return null;p.push(D)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return r.error("Expected one argument.");h=hh[c];for(let m=1;m<e.length;m++){let x=r.parse(e[m],m,Tn);if(!x)return null;p.push(x)}}return new ps(h,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,c;for(let p of this.args){if(r=p.evaluate(e),c=null,r instanceof Fn)return r;if(typeof r=="string"){let h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:_g(r[0],r[1],r[2],r[3]),!c))return new Fn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Wi(c||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let c of this.args){if(r=c.evaluate(e),r===null)return 0;let p=Number(r);if(!isNaN(p))return p}throw new Wi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?_r.fromString(Mr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Dr.fromString(Mr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Mr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Cl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Pa(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}let Kv=["Unknown","Point","LineString","Polygon"];class yg{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*r-e[0])+this.featureDistanceData.bearing[1]*(p*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Fn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Br{constructor(e,r,c,p,h){this.name=e,this.type=r,this._evaluate=c,this.args=p,this._overloadIndex=h}evaluate(e){if(!this._evaluate){let r=Br.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let c=e[0],p=Br.definitions[c];if(!p)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let h=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=[],E=null,D=-1;for(let[y,w]of m){if(Array.isArray(y)&&y.length!==e.length-1)continue;x.push(y),D++,E=new Ag(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);let C=[],T=!1;for(let I=1;I<e.length;I++){let S=e[I],R=Array.isArray(y)?y[I-1]:y.type,F=E.parse(S,1+C.length,R);if(!F){T=!0;break}C.push(F)}if(!T)if(Array.isArray(y)&&y.length!==C.length)E.error(`Expected ${y.length} arguments, but found ${C.length} instead.`);else{for(let I=0;I<C.length;I++){let S=Array.isArray(y)?y[I]:y.type,R=C[I];E.concat(I+1).checkSubtype(S,R.type)}if(E.errors.length===0)return new Br(c,h,w,C,D)}}if(x.length===1)r.errors.push(...E.errors);else{let y=(x.length?x:m.map(([C])=>C)).map(Jv).join(" | "),w=[];for(let C=1;C<e.length;C++){let T=r.parse(e[C],1+w.length);if(!T)return null;w.push(wi(T.type))}r.error(`Expected arguments of type ${y}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){Br.definitions=r;for(let c in r)e[c]=Br}}function Jv(l){return Array.isArray(l)?`(${l.map(wi).join(", ")})`:`(${wi(l.type)}...)`}class dh{constructor(e,r,c){this.type=ch,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let c=e[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");let p=c["case-sensitive"]===void 0?r.parse(!1,1,xn):r.parseObjectValue(c["case-sensitive"],1,"case-sensitive",xn);if(!p)return null;let h=c["diacritic-sensitive"]===void 0?r.parse(!1,1,xn):r.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",xn);if(!h)return null;let m=null;return c.locale&&(m=r.parseObjectValue(c.locale,1,"locale",vn),!m)?null:new dh(p,h,m)}evaluate(e){return new uh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function vg(l,e,r=0,c=l.length-1,p=Ml){for(;c>r;){if(c-r>600){let E=c-r+1,D=e-r+1,y=Math.log(E),w=.5*Math.exp(2*y/3),C=.5*Math.sqrt(y*w*(E-w)/E)*(D-E/2<0?-1:1);vg(l,e,Math.max(r,Math.floor(e-D*w/E+C)),Math.min(c,Math.floor(e+(E-D)*w/E+C)),p)}let h=l[e],m=r,x=c;for(Dl(l,r,e),p(l[c],h)>0&&Dl(l,r,c);m<x;){for(Dl(l,m,x),m++,x--;p(l[m],h)<0;)m++;for(;p(l[x],h)>0;)x--}p(l[r],h)===0?Dl(l,r,x):(x++,Dl(l,x,c)),x<=e&&(r=x+1),e<=x&&(c=x-1)}}function Dl(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}function Ml(l,e){return l<e?-1:l>e?1:0}function Qv(l){let e=0;for(let r,c,p=0,h=l.length,m=h-1;p<h;m=p++)r=l[p],c=l[m],e+=(c.x-r.x)*(r.y+c.y);return e}function Yc(l,e){l[0]=Math.min(l[0],e[0]),l[1]=Math.min(l[1],e[1]),l[2]=Math.max(l[2],e[0]),l[3]=Math.max(l[3],e[1])}function Oa(l,e){return!(l[0]<=e[0]||l[2]>=e[2]||l[1]<=e[1]||l[3]>=e[3])}function ex(l,e,r){let c=l[0]-e[0],p=l[1]-e[1],h=l[0]-r[0],m=l[1]-r[1];return c*m-h*p==0&&c*h<=0&&p*m<=0}function Sl(l,e,r=!1){let c=!1;for(let x=0,E=e.length;x<E;x++){let D=e[x];for(let y=0,w=D.length,C=w-1;y<w;C=y++){let T=D[C],I=D[y];if(ex(l,T,I))return r;(h=T)[1]>(p=l)[1]!=(m=I)[1]>p[1]&&p[0]<(m[0]-h[0])*(p[1]-h[1])/(m[1]-h[1])+h[0]&&(c=!c)}}var p,h,m;return c}function xg(l,e,r,c){let p=c[0]-r[0],h=c[1]-r[1],m=(l[0]-r[0])*h-p*(l[1]-r[1]),x=(e[0]-r[0])*h-p*(e[1]-r[1]);return m>0&&x<0||m<0&&x>0}function fh(l,e,r,c){return(p=[c[0]-r[0],c[1]-r[1]])[0]*(h=[e[0]-l[0],e[1]-l[1]])[1]-p[1]*h[0]!=0&&!(!xg(l,e,r,c)||!xg(r,c,l,e));var p,h}let Xr=8192;function mn(l,e){let r=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*Xr),Math.round(c*p*Xr)]}function Dt(l,e){for(let r=0;r<e.length;r++)if(Sl(l,e[r]))return!0;return!1}function Mf(l,e,r){for(let c of r)for(let p=0,h=c.length,m=h-1;p<h;m=p++)if(fh(l,e,c[m],c[p]))return!0;return!1}function qt(l,e){for(let r=0;r<l.length;++r)if(!Sl(l[r],e))return!1;for(let r=0;r<l.length-1;++r)if(Mf(l[r],l[r+1],e))return!1;return!0}function Sf(l,e){for(let r=0;r<e.length;r++)if(qt(l,e[r]))return!0;return!1}function Kc(l,e,r){let c=[];for(let p=0;p<l.length;p++){let h=[];for(let m=0;m<l[p].length;m++){let x=mn(l[p][m],r);Yc(e,x),h.push(x)}c.push(h)}return c}function kt(l,e,r){let c=[];for(let p=0;p<l.length;p++){let h=Kc(l[p],e,r);c.push(h)}return c}function Af(l,e,r,c){if(l[0]<r[0]||l[0]>r[2]){let p=.5*c,h=l[0]-r[0]>p?-c:r[0]-l[0]>p?c:0;h===0&&(h=l[0]-r[2]>p?-c:r[2]-l[0]>p?c:0),l[0]+=h}Yc(e,l)}function ph(l,e,r,c){let p=Math.pow(2,c.z)*Xr,h=[c.x*Xr,c.y*Xr],m=[];if(!l)return m;for(let x of l)for(let E of x){let D=[E.x+h[0],E.y+h[1]];Af(D,e,r,p),m.push(D)}return m}function Pf(l,e,r,c){let p=Math.pow(2,c.z)*Xr,h=[c.x*Xr,c.y*Xr],m=[];if(!l)return m;for(let E of l){let D=[];for(let y of E){let w=[y.x+h[0],y.y+h[1]];Yc(e,w),D.push(w)}m.push(D)}if(e[2]-e[0]<=p/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(let E of m)for(let D of E)Af(D,e,r,p)}var x;return m}class Ws{constructor(e,r){this.type=xn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qs(e[1])){let c=e[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){let h=c.features[p].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ws(c,c.features[p].geometry)}else if(c.type==="Feature"){let p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ws(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ws(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,c){let p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let x=Kc(c.coordinates,h,m),E=ph(r.geometry(),p,h,m);if(!Oa(p,h))return!1;for(let D of E)if(!Sl(D,x))return!1}if(c.type==="MultiPolygon"){let x=kt(c.coordinates,h,m),E=ph(r.geometry(),p,h,m);if(!Oa(p,h))return!1;for(let D of E)if(!Dt(D,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,c){let p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let x=Kc(c.coordinates,h,m),E=Pf(r.geometry(),p,h,m);if(!Oa(p,h))return!1;for(let D of E)if(!qt(D,x))return!1}if(c.type==="MultiPolygon"){let x=kt(c.coordinates,h,m),E=Pf(r.geometry(),p,h,m);if(!Oa(p,h))return!1;for(let D of E)if(!Sf(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let La={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},cr=1/298.257223563,mh=cr*(2-cr),Al=Math.PI/180;class Pl{static fromTile(e,r,c){let p=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),h=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Al;return new Pl(h,c)}static get units(){return La}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!La[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(La).join(", ")}`);let c=6378.137*Al*(r?La[r]:1),p=Math.cos(e*Al),h=1/(1-mh*(1-p*p)),m=Math.sqrt(h);this.kx=c*m*p,this.ky=c*m*h*(1-mh)}distance(e,r){let c=gi(e[0]-r[0])*this.kx,p=(e[1]-r[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(e,r){let c=gi(r[0]-e[0])*this.kx;return Math.atan2(c,(r[1]-e[1])*this.ky)/Al}destination(e,r,c){let p=c*Al;return this.offset(e,Math.sin(p)*r,Math.cos(p)*r)}offset(e,r,c){return[e[0]+r/this.kx,e[1]+c/this.ky]}lineDistance(e){let r=0;for(let c=0;c<e.length-1;c++)r+=this.distance(e[c],e[c+1]);return r}area(e){let r=0;for(let c=0;c<e.length;c++){let p=e[c];for(let h=0,m=p.length,x=m-1;h<m;x=h++)r+=gi(p[h][0]-p[x][0])*(p[h][1]+p[x][1])*(c?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let c=0;if(r<=0)return e[0];for(let p=0;p<e.length-1;p++){let h=e[p],m=e[p+1],x=this.distance(h,m);if(c+=x,c>r)return ms(h,m,(r-(c-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,r,c){let[p,h]=r,m=gi(c[0]-p)*this.kx,x=(c[1]-h)*this.ky;if(m!==0||x!==0){let E=(gi(e[0]-p)*this.kx*m+(e[1]-h)*this.ky*x)/(m*m+x*x);E>1?(p=c[0],h=c[1]):E>0&&(p+=m/this.kx*E,h+=x/this.ky*E)}return m=gi(e[0]-p)*this.kx,x=(e[1]-h)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(e,r){let c=1/0,p=e[0][0],h=e[0][1],m=0,x=0;for(let E=0;E<e.length-1;E++){let D=e[E][0],y=e[E][1],w=gi(e[E+1][0]-D)*this.kx,C=(e[E+1][1]-y)*this.ky,T=0;w===0&&C===0||(T=(gi(r[0]-D)*this.kx*w+(r[1]-y)*this.ky*C)/(w*w+C*C),T>1?(D=e[E+1][0],y=e[E+1][1]):T>0&&(D+=w/this.kx*T,y+=C/this.ky*T)),w=gi(r[0]-D)*this.kx,C=(r[1]-y)*this.ky;let I=w*w+C*C;I<c&&(c=I,p=D,h=y,m=E,x=T)}return{point:[p,h],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(e,r,c){let p=this.pointOnLine(c,e),h=this.pointOnLine(c,r);if(p.index>h.index||p.index===h.index&&p.t>h.t){let D=p;p=h,h=D}let m=[p.point],x=p.index+1,E=h.index;!gh(c[x],m[0])&&x<=E&&m.push(c[x]);for(let D=x+1;D<=E;D++)m.push(c[D]);return gh(c[E],h.point)||m.push(h.point),m}lineSliceAlong(e,r,c){let p=0,h=[];for(let m=0;m<c.length-1;m++){let x=c[m],E=c[m+1],D=this.distance(x,E);if(p+=D,p>e&&h.length===0&&h.push(ms(x,E,(e-(p-D))/D)),p>=r)return h.push(ms(x,E,(r-(p-D))/D)),h;p>e&&h.push(E)}return h}bufferPoint(e,r){let c=r/this.ky,p=r/this.kx;return[e[0]-p,e[1]-c,e[0]+p,e[1]+c]}bufferBBox(e,r){let c=r/this.ky,p=r/this.kx;return[e[0]-p,e[1]-c,e[2]+p,e[3]+c]}insideBBox(e,r){return gi(e[0]-r[0])>=0&&gi(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function gh(l,e){return l[0]===e[0]&&l[1]===e[1]}function ms(l,e,r){let c=gi(e[0]-l[0]);return[l[0]+c*r,l[1]+(e[1]-l[1])*r]}function gi(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Rf{constructor(e=[],r=(c,p)=>c<p?-1:c>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:c}=this,p=r[e];for(;e>0;){let h=e-1>>1,m=r[h];if(c(p,m)>=0)break;r[e]=m,e=h}r[e]=p}_down(e){let{data:r,compare:c}=this,p=this.length>>1,h=r[e];for(;e<p;){let m=1+(e<<1),x=m+1;if(x<this.length&&c(r[x],r[m])<0&&(m=x),c(r[m],h)>=0)break;r[e]=r[m],e=m}r[e]=h}}var at=8192;function bg(l,e){return e.dist-l.dist}let Rl=100,_h=50;function yh(l){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==l.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==l[r])return!1;return!0}function vh(l){return l[1]-l[0]+1}function gs(l,e){let r=l[1]>=l[0]&&l[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Of(l,e){if(l[0]>l[1])return[null,null];let r=vh(l);if(e){if(r===2)return[l,null];let c=Math.floor(r/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(r===1)return[l,null];let c=Math.floor(r/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function Yr(l,e){let r=[1/0,1/0,-1/0,-1/0];if(!gs(e,l.length))return r;for(let c=e[0];c<=e[1];++c)Yc(r,l[c]);return r}function xh(l){let e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<l.length;++r)for(let c=0;c<l[r].length;++c)Yc(e,l[r][c]);return e}function Ol(l,e,r){if(yh(l)||yh(e))return NaN;let c=0,p=0;return l[2]<e[0]&&(c=e[0]-l[2]),l[0]>e[2]&&(c=l[0]-e[2]),l[1]>e[3]&&(p=l[1]-e[3]),l[3]<e[1]&&(p=e[1]-l[3]),r.distance([0,0],[c,p])}function wg(l){return 360*l-180}function Tg(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Kr(l,e){let r=Math.pow(2,e.z),c=(l.y/at+e.y)/r;return[wg((l.x/at+e.x)/r),Tg(c)]}function Eg(l,e){let r=[];for(let c=0;c<l.length;++c)r.push(Kr(l[c],e));return r}function Lf(l,e,r){let c=r.pointOnLine(e,l).point;return r.distance(l,c)}function Ff(l,e,r,c,p){let h=r.slice(c[0],c[1]+1),m=1/0;for(let x=e[0];x<=e[1];++x)if((m=Math.min(m,Lf(l[x],h,p)))===0)return 0;return m}function bh(l,e,r,c,p){let h=Math.min(p.pointToSegmentDistance(l,r,c),p.pointToSegmentDistance(e,r,c)),m=Math.min(p.pointToSegmentDistance(r,l,e),p.pointToSegmentDistance(c,l,e));return Math.min(h,m)}function Ig(l,e,r,c,p){if(!gs(e,l.length)||!gs(c,r.length))return NaN;let h=1/0;for(let m=e[0];m<e[1];++m)for(let x=c[0];x<c[1];++x){if(fh(l[m],l[m+1],r[x],r[x+1]))return 0;h=Math.min(h,bh(l[m],l[m+1],r[x],r[x+1],p))}return h}function Cg(l,e,r,c,p){if(!gs(e,l.length)||!gs(c,r.length))return NaN;let h=1/0;for(let m=e[0];m<=e[1];++m)for(let x=c[0];x<=c[1];++x)if((h=Math.min(h,p.distance(l[m],r[x])))===0)return h;return h}function Dg(l,e,r){if(Sl(l,e,!0))return 0;let c=1/0;for(let p of e){let h=p.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[h-1]&&(c=Math.min(c,r.pointToSegmentDistance(l,p[h-1],p[0])))===0||(c=Math.min(c,Lf(l,p,r)))===0)return c}return c}function Mg(l,e,r,c){if(!gs(e,l.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Sl(l[h],r,!0))return 0;let p=1/0;for(let h=e[0];h<e[1];++h)for(let m of r)for(let x=0,E=m.length,D=E-1;x<E;D=x++){if(fh(l[h],l[h+1],m[D],m[x]))return 0;p=Math.min(p,bh(l[h],l[h+1],m[D],m[x],c))}return p}function kf(l,e){for(let r of l)for(let c=0;c<=r.length-1;++c)if(Sl(r[c],e,!0))return!0;return!1}function Sg(l,e,r,c=1/0){let p=xh(l),h=xh(e);if(c!==1/0&&Ol(p,h,r)>=c)return c;if(Oa(p,h)){if(kf(l,e))return 0}else if(kf(e,l))return 0;let m=c;for(let x of l)for(let E=0,D=x.length,y=D-1;E<D;y=E++)for(let w of e)for(let C=0,T=w.length,I=T-1;C<T;I=C++){if(fh(x[y],x[E],w[I],w[C]))return 0;m=Math.min(m,bh(x[y],x[E],w[I],w[C],r))}return m}function Jc(l,e,r,c,p,h,m){if(h===null||m===null)return;let x=Ol(Yr(c,h),Yr(p,m),r);x<e&&l.push({dist:x,range1:h,range2:m})}function wh(l,e,r,c,p=1/0){let h=Math.min(c.distance(l[0],r[0][0]),p);if(h===0)return h;let m=new Rf([{dist:0,range1:[0,l.length-1],range2:[0,0]}],bg),x=e?_h:Rl,E=xh(r);for(;m.length;){let D=m.pop();if(D.dist>=h)continue;let y=D.range1;if(vh(y)<=x){if(!gs(y,l.length))return NaN;if(e){let w=Mg(l,y,r,c);if((h=Math.min(h,w))===0)return h}else for(let w=y[0];w<=y[1];++w){let C=Dg(l[w],r,c);if((h=Math.min(h,C))===0)return h}}else{let w=Of(y,e);if(w[0]!==null){let C=Ol(Yr(l,w[0]),E,c);C<h&&m.push({dist:C,range1:w[0],range2:[0,0]})}if(w[1]!==null){let C=Ol(Yr(l,w[1]),E,c);C<h&&m.push({dist:C,range1:w[1],range2:[0,0]})}}}return h}function Qc(l,e,r,c,p,h=1/0){let m=Math.min(h,p.distance(l[0],r[0]));if(m===0)return m;let x=new Rf([{dist:0,range1:[0,l.length-1],range2:[0,r.length-1]}],bg),E=e?_h:Rl,D=c?_h:Rl;for(;x.length;){let y=x.pop();if(y.dist>=m)continue;let w=y.range1,C=y.range2;if(vh(w)<=E&&vh(C)<=D){if(!gs(w,l.length)||!gs(C,r.length))return NaN;if(e&&c?m=Math.min(m,Ig(l,w,r,C,p)):e||c?e&&!c?m=Math.min(m,Ff(r,C,l,w,p)):!e&&c&&(m=Math.min(m,Ff(l,w,r,C,p))):m=Math.min(m,Cg(l,w,r,C,p)),m===0)return m}else{let T=Of(w,e),I=Of(C,c);Jc(x,m,p,l,r,T[0],I[0]),Jc(x,m,p,l,r,T[0],I[1]),Jc(x,m,p,l,r,T[1],I[0]),Jc(x,m,p,l,r,T[1],I[1])}}return m}function Ll(l,e,r,c,p=1/0){let h=p,m=Yr(l,[0,l.length-1]);for(let x of r)if(!(h!==1/0&&Ol(m,Yr(x,[0,x.length-1]),c)>=h)&&(h=Math.min(h,Qc(l,e,x,!0,c,h)),h===0))return h;return h}function eu(l,e,r,c,p=1/0){let h=p,m=Yr(l,[0,l.length-1]);for(let x of r){if(h!==1/0&&Ol(m,xh(x),c)>=h)continue;let E=wh(l,e,x,c,h);if(isNaN(E))return E;if((h=Math.min(h,E))===0)return h}return h}function Th(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Zs{constructor(e,r){this.type=gt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(qs(e[1])){let c=e[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(Th(c.features[p].geometry.type))return new Zs(c,c.features[p].geometry)}else if(c.type==="Feature"){if(Th(c.geometry.type))return new Zs(c,c.geometry)}else if(Th(c.type))return new Zs(c,c)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let r=e.geometry(),c=e.canonicalID();if(r!=null&&c!=null){if(e.geometryType()==="Point")return function(p,h,m){let x=[];for(let D of p)for(let y of D)x.push(Kr(y,h));let E=new Pl(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Qc(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",E):m.type==="MultiLineString"?Ll(x,!1,m.coordinates,E):m.type==="Polygon"||m.type==="MultiPolygon"?eu(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,E):null}(r,c,this.geometries);if(e.geometryType()==="LineString")return function(p,h,m){let x=[];for(let D of p){let y=[];for(let w of D)y.push(Kr(w,h));x.push(y)}let E=new Pl(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ll(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,E);if(m.type==="MultiLineString"){let D=1/0;for(let y=0;y<m.coordinates.length;y++){let w=Ll(m.coordinates[y],!0,x,E,D);if(isNaN(w))return w;if((D=Math.min(D,w))===0)return D}return D}if(m.type==="Polygon"||m.type==="MultiPolygon"){let D=1/0;for(let y=0;y<x.length;y++){let w=eu(x[y],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,E,D);if(isNaN(w))return w;if((D=Math.min(D,w))===0)return D}return D}return null}(r,c,this.geometries);if(e.geometryType()==="Polygon")return function(p,h,m){let x=[];for(let D of function(y,w){let C=y.length;if(C<=1)return[y];let T=[],I,S;for(let R=0;R<C;R++){let F=Qv(y[R]);F!==0&&(y[R].area=Math.abs(F),S===void 0&&(S=F<0),S===F<0?(I&&T.push(I),I=[y[R]]):I.push(y[R]))}return I&&T.push(I),T}(p)){let y=[];for(let w=0;w<D.length;++w)y.push(Eg(D[w],h));x.push(y)}let E=new Pl(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return eu(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,E);if(m.type==="MultiLineString"){let D=1/0;for(let y=0;y<m.coordinates.length;y++){let w=eu(m.coordinates[y],!0,x,E,D);if(isNaN(w))return w;if((D=Math.min(D,w))===0)return D}return D}return m.type==="Polygon"||m.type==="MultiPolygon"?function(D,y,w){let C=1/0;for(let T of D)for(let I of y){let S=Sg(T,I,w,C);if(isNaN(S))return S;if((C=Math.min(C,S))===0)return C}return C}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,E):null}(r,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xs(l,e){switch(l){case"string":return Mr(e);case"number":return+e;case"boolean":return!!e;case"color":return Fn.parse(e);case"formatted":return _r.fromString(Mr(e));case"resolvedImage":return Dr.fromString(Mr(e))}return e}function bn(l,e,r,c){return c!==void 0&&(l=c*Math.round(l/c)),e!==void 0&&l<e&&(l=e),r!==void 0&&l>r&&(l=r),l}class Fl{constructor(e,r,c){this.type=e,this.key=r,this.scope=c}static parse(e,r){let c=r.expectedType;if(c==null&&(c=Tn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");let p=r.parse(e[1],1);if(!(p instanceof Mo))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let h=r.parse(e[2],2);return h instanceof Mo?new Fl(c,Mr(p.value),Mr(h.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Fl(c,Mr(p.value))}evaluate(e){let r=[this.key,this.scope,e.scope].filter(Boolean).join(""),c=e.getConfig(r);if(!c)return null;let{type:p,value:h,values:m,minValue:x,maxValue:E,stepValue:D}=c,y=c.default.evaluate(e),w=y;if(h){let C=e.scope;e.scope=(C||"").split("").slice(1).join(""),w=h.evaluate(e),e.scope=C}return p&&(w=Xs(p,w)),w===void 0||x===void 0&&E===void 0&&D===void 0||(typeof w=="number"?w=bn(w,x,E,D):Array.isArray(w)&&(w=w.map(C=>typeof C=="number"?bn(C,x,E,D):C))),h!==void 0&&w!==void 0&&m&&!m.includes(w)&&(w=y,p&&(w=Xs(p,w))),(p&&p!==this.type||w!==void 0&&Fi(w)!==this.type)&&(w=Xs(this.type.kind,w)),w}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function tu(l){if(l instanceof Br&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ws||l instanceof Zs)return!1;let e=!0;return l.eachChild(r=>{e&&!tu(r)&&(e=!1)}),e}function Eh(l){if(l instanceof Br&&l.name==="feature-state")return!1;let e=!0;return l.eachChild(r=>{e&&!Eh(r)&&(e=!1)}),e}function Ih(l){if(l instanceof Fl)return new Set([l.key]);let e=new Set;return l.eachChild(r=>{e=new Set([...e,...Ih(r)])}),e}function nu(l,e){if(l instanceof Br&&e.indexOf(l.name)>=0)return!1;let r=!0;return l.eachChild(c=>{r&&!nu(c,e)&&(r=!1)}),r}class Xn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let c=e[1];return r.scope.has(c)?new Xn(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Nf{constructor(e,r=[],c,p=new lh,h=[],m,x){this.registry=e,this.path=r,this.key=r.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=p,this.errors=h,this.expectedType=c,this._scope=m,this.options=x}parse(e,r,c,p,h={}){return r||c?this.concat(r,null,c,p)._parse(e,h):this._parse(e,h)}parseObjectValue(e,r,c,p,h,m={}){return this.concat(r,c,p,h)._parse(e,m)}_parse(e,r){function c(p,h,m){return m==="assert"?new So(h,[p]):m==="coerce"?new ps(h,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let h=p.parse(e,this);if(!h)return null;if(this.expectedType){let m=this.expectedType,x=h.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else h=c(h,m,r.typeAnnotation||"coerce");else h=c(h,m,r.typeAnnotation||"assert")}if(!(h instanceof Mo)&&h.type.kind!=="resolvedImage"&&zf(h)){let m=new yg(this._scope,this.options);try{h=new Mo(h.type,h.evaluate(m))}catch(x){return this.error(x.message),null}}return h}return ps.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,c,p){let h=typeof e=="number"?this.path.concat(e):this.path;h=typeof r=="string"?h.concat(r):h;let m=p?this.scope.concat(p):this.scope;return new Nf(this.registry,h,c||null,m,this.errors,this._scope,this.options)}error(e,...r){let c=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new Go(c,e))}checkSubtype(e,r){let c=El(e,r);return c&&this.error(c),c}}var Ag=Nf;function zf(l){if(l instanceof Xn)return zf(l.boundExpression);if(l instanceof Br&&l.name==="error"||l instanceof dh||l instanceof Ws||l instanceof Zs||l instanceof Fl)return!1;let e=l instanceof ps||l instanceof So,r=!0;return l.eachChild(c=>{r=e?r&&zf(c):r&&c instanceof Mo}),!!r&&tu(l)&&nu(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ch(l,e){let r=l.length-1,c,p,h=0,m=r,x=0;for(;h<=m;)if(x=Math.floor((h+m)/2),c=l[x],p=l[x+1],c<=e){if(x===r||e<p)return x;h=x+1}else{if(!(c>e))throw new Wi("Input is not a number.");m=x-1}return 0}class iu{constructor(e,r,c){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[p,h]of c)this.labels.push(p),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let c=r.parse(e[1],1,gt);if(!c)return null;let p=[],h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let m=1;m<e.length;m+=2){let x=m===1?-1/0:e[m],E=e[m+1],D=m,y=m+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let w=r.parse(E,y,h);if(!w)return null;h=h||w.type,p.push([x,w])}return new iu(h,c,p)}evaluate(e){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return c[0].evaluate(e);let h=r.length;return p>=r[h-1]?c[h-1].evaluate(e):c[Ch(r,p)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}let Pg=.95047,Rg=1.08883,Og=4/29,kl=6/29,Lg=3*kl*kl,tx=kl*kl*kl,nx=Math.PI/180,ix=180/Math.PI;function Bf(l){return l>tx?Math.pow(l,1/3):l/Lg+Og}function Vf(l){return l>kl?l*l*l:Lg*(l-Og)}function jf(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Uf(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Fg(l){let e=Uf(l.r),r=Uf(l.g),c=Uf(l.b),p=Bf((.4124564*e+.3575761*r+.1804375*c)/Pg),h=Bf((.2126729*e+.7151522*r+.072175*c)/1);return{l:116*h-16,a:500*(p-h),b:200*(h-Bf((.0193339*e+.119192*r+.9503041*c)/Rg)),alpha:l.a}}function kg(l){let e=(l.l+16)/116,r=isNaN(l.a)?e:e+l.a/500,c=isNaN(l.b)?e:e-l.b/200;return e=1*Vf(e),r=Pg*Vf(r),c=Rg*Vf(c),new Fn(jf(3.2404542*r-1.5371385*e-.4985314*c),jf(-.969266*r+1.8760108*e+.041556*c),jf(.0556434*r-.2040259*e+1.0572252*c),l.alpha)}function rx(l,e,r){let c=e-l;return l+r*(c>180||c<-180?c-360*Math.round(c/360):c)}let ru={forward:Fg,reverse:kg,interpolate:function(l,e,r){return{l:Pt(l.l,e.l,r),a:Pt(l.a,e.a,r),b:Pt(l.b,e.b,r),alpha:Pt(l.alpha,e.alpha,r)}}},ou={forward:function(l){let{l:e,a:r,b:c}=Fg(l),p=Math.atan2(c,r)*ix;return{h:p<0?p+360:p,c:Math.sqrt(r*r+c*c),l:e,alpha:l.a}},reverse:function(l){let e=l.h*nx,r=l.c;return kg({l:l.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:l.alpha})},interpolate:function(l,e,r){return{h:rx(l.h,e.h,r),c:Pt(l.c,e.c,r),l:Pt(l.l,e.l,r),alpha:Pt(l.alpha,e.alpha,r)}}};var Ng=Object.freeze({__proto__:null,hcl:ou,lab:ru});class Jr{constructor(e,r,c,p,h){this.type=e,this.operator=r,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(let[m,x]of h)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,r,c,p){let h=0;if(e.name==="exponential")h=$f(r,e.base,c,p);else if(e.name==="linear")h=$f(r,1,c,p);else if(e.name==="cubic-bezier"){let m=e.controlPoints;h=new $s(m[0],m[1],m[2],m[3]).solve($f(r,1,c,p))}return h}static parse(e,r){let[c,p,h,...m]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let D=p[1];if(typeof D!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let D=p.slice(1);if(D.length!==4||D.some(y=>typeof y!="number"||y<0||y>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,gt),!h)return null;let x=[],E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=zr:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let D=0;D<m.length;D+=2){let y=m[D],w=m[D+1],C=D+3,T=D+4;if(typeof y!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(x.length&&x[x.length-1][0]>=y)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);let I=r.parse(w,T,E);if(!I)return null;E=E||I.type,x.push([y,I])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Jr(E,c,p,h,x):r.error(`Type ${wi(E)} is not interpolatable.`)}evaluate(e){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return c[0].evaluate(e);let h=r.length;if(p>=r[h-1])return c[h-1].evaluate(e);let m=Ch(r,p),x=Jr.interpolationFactor(this.interpolation,p,r[m],r[m+1]),E=c[m].evaluate(e),D=c[m+1].evaluate(e);return this.operator==="interpolate"?Aa[this.type.kind.toLowerCase()](E,D,x):this.operator==="interpolate-hcl"?ou.reverse(ou.interpolate(ou.forward(E),ou.forward(D),x)):ru.reverse(ru.interpolate(ru.forward(E),ru.forward(D),x))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)r.push(this.labels[c],this.outputs[c].serialize());return r}}function $f(l,e,r,c){let p=c-r,h=l-r;return p===0?0:e===1?h/p:(Math.pow(e,h)-1)/(Math.pow(e,p)-1)}class Dh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let c=null,p=r.expectedType;p&&p.kind!=="value"&&(c=p);let h=[];for(let x of e.slice(1)){let E=r.parse(x,1+h.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,h.push(E)}let m=p&&h.some(x=>El(p,x.type));return new Dh(m?Tn:c,h)}evaluate(e){let r,c=null,p=0;for(let h of this.args){if(p++,c=h.evaluate(e),c&&c instanceof Dr&&!c.available&&(r||(r=c),c=null,p===this.args.length))return r;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Mh{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let c=[];for(let h=1;h<e.length-1;h+=2){let m=e[h];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,h);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);let x=r.parse(e[h+1],h+1);if(!x)return null;c.push([m,x])}let p=r.parse(e[e.length-1],e.length-1,r.expectedType,c);return p?new Mh(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,c]of this.bindings)e.push(r,c.serialize());return e.push(this.result.serialize()),e}}class Gf{constructor(e,r,c){this.type=e,this.index=r,this.input=c}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,gt),p=r.parse(e[2],2,Cr(r.expectedType||Tn));return c&&p?new Gf(p.type.itemType,c,p):null}evaluate(e){let r=this.index.evaluate(e),c=this.input.evaluate(e);if(r<0)throw new Wi(`Array index out of bounds: ${r} < 0.`);if(r>=c.length)throw new Wi(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r!==Math.floor(r))throw new Wi(`Array index must be an integer, but found ${r} instead.`);return c[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hf{constructor(e,r){this.type=xn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,Tn),p=r.parse(e[2],2,Tn);return c&&p?Il(c.type,[xn,vn,gt,Do,Tn])?new Hf(c,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(c.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!Ho(r,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${wi(Fi(r))} instead.`);if(!Ho(c,["string","array"]))throw new Wi(`Expected second argument to be of type array or string, but found ${wi(Fi(c))} instead.`);return c.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sh{constructor(e,r,c){this.type=gt,this.needle=e,this.haystack=r,this.fromIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,Tn),p=r.parse(e[2],2,Tn);if(!c||!p)return null;if(!Il(c.type,[xn,vn,gt,Do,Tn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(c.type)} instead`);if(e.length===4){let h=r.parse(e[3],3,gt);return h?new Sh(c,p,h):null}return new Sh(c,p)}evaluate(e){let r=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Ho(r,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${wi(Fi(r))} instead.`);if(!Ho(c,["string","array"]))throw new Wi(`Expected second argument to be of type array or string, but found ${wi(Fi(c))} instead.`);if(this.fromIndex){let p=this.fromIndex.evaluate(e);return c.indexOf(r,p)}return c.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class qf{constructor(e,r,c,p,h,m){this.inputType=e,this.type=r,this.input=c,this.cases=p,this.outputs=h,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let c,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);let h={},m=[];for(let D=2;D<e.length-1;D+=2){let y=e[D],w=e[D+1];Array.isArray(y)||(y=[y]);let C=r.concat(D);if(y.length===0)return C.error("Expected at least one branch label.");for(let I of y){if(typeof I!="number"&&typeof I!="string")return C.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return C.error("Numeric branch labels must be integer values.");if(c){if(C.checkSubtype(c,Fi(I)))return null}else c=Fi(I);if(h[String(I)]!==void 0)return C.error("Branch labels must be unique.");h[String(I)]=m.length}let T=r.parse(w,D,p);if(!T)return null;p=p||T.type,m.push(T)}let x=r.parse(e[1],1,Tn);if(!x)return null;let E=r.parse(e[e.length-1],e.length-1,p);return E?x.type.kind!=="value"&&r.concat(1).checkSubtype(c,x.type)?null:new qf(c,p,x,h,m,E):null}evaluate(e){let r=this.input.evaluate(e);return(Fi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),c=[],p={};for(let m of r){let x=p[this.cases[m]];x===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}let h=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,x]of c)e.push(x.length===1?h(x[0]):x.map(h)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class su{constructor(e,r,c){this.type=e,this.branches=r,this.otherwise=c}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);let p=[];for(let m=1;m<e.length-1;m+=2){let x=r.parse(e[m],m,xn);if(!x)return null;let E=r.parse(e[m+1],m+1,c);if(!E)return null;p.push([x,E]),c=c||E.type}let h=r.parse(e[e.length-1],e.length-1,c);return h?new su(c,p,h):null}evaluate(e){for(let[r,c]of this.branches)if(r.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,c]of this.branches)e(r),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ah{constructor(e,r,c,p){this.type=e,this.input=r,this.beginIndex=c,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,Tn),p=r.parse(e[2],2,gt);if(!c||!p)return null;if(!Il(c.type,[Cr(Tn),vn,Tn]))return r.error(`Expected first argument to be of type array or string, but found ${wi(c.type)} instead`);if(e.length===4){let h=r.parse(e[3],3,gt);return h?new Ah(c.type,c,p,h):null}return new Ah(c.type,c,p)}evaluate(e){let r=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!Ho(r,["string","array"]))throw new Wi(`Expected first argument to be of type array or string, but found ${wi(Fi(r))} instead.`);if(this.endIndex){let p=this.endIndex.evaluate(e);return r.slice(c,p)}return r.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Wf(l,e){return l==="=="||l==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function zg(l,e,r,c){return c.compare(e,r)===0}function Nl(l,e,r){let c=l!=="=="&&l!=="!=";return class SR{constructor(h,m,x){this.type=xn,this.lhs=h,this.rhs=m,this.collator=x,this.hasUntypedArgument=h.type.kind==="value"||m.type.kind==="value"}static parse(h,m){if(h.length!==3&&h.length!==4)return m.error("Expected two or three arguments.");let x=h[0],E=m.parse(h[1],1,Tn);if(!E)return null;if(!Wf(x,E.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${wi(E.type)}'.`);let D=m.parse(h[2],2,Tn);if(!D)return null;if(!Wf(x,D.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${wi(D.type)}'.`);if(E.type.kind!==D.type.kind&&E.type.kind!=="value"&&D.type.kind!=="value")return m.error(`Cannot compare types '${wi(E.type)}' and '${wi(D.type)}'.`);c&&(E.type.kind==="value"&&D.type.kind!=="value"?E=new So(D.type,[E]):E.type.kind!=="value"&&D.type.kind==="value"&&(D=new So(E.type,[D])));let y=null;if(h.length===4){if(E.type.kind!=="string"&&D.type.kind!=="string"&&E.type.kind!=="value"&&D.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(y=m.parse(h[3],3,ch),!y)return null}return new SR(E,D,y)}evaluate(h){let m=this.lhs.evaluate(h),x=this.rhs.evaluate(h);if(c&&this.hasUntypedArgument){let E=Fi(m),D=Fi(x);if(E.kind!==D.kind||E.kind!=="string"&&E.kind!=="number")throw new Wi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let E=Fi(m),D=Fi(x);if(E.kind!=="string"||D.kind!=="string")return e(h,m,x)}return this.collator?r(h,m,x,this.collator.evaluate(h)):e(h,m,x)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){let h=[l];return this.eachChild(m=>{h.push(m.serialize())}),h}}}let ox=Nl("==",function(l,e,r){return e===r},zg),Bg=Nl("!=",function(l,e,r){return e!==r},function(l,e,r,c){return!zg(0,e,r,c)}),Vg=Nl("<",function(l,e,r){return e<r},function(l,e,r,c){return c.compare(e,r)<0}),zl=Nl(">",function(l,e,r){return e>r},function(l,e,r,c){return c.compare(e,r)>0}),jg=Nl("<=",function(l,e,r){return e<=r},function(l,e,r,c){return c.compare(e,r)<=0}),Ug=Nl(">=",function(l,e,r){return e>=r},function(l,e,r,c){return c.compare(e,r)>=0});class Zf{constructor(e,r,c,p,h,m){this.type=vn,this.number=e,this.locale=r,this.currency=c,this.unit=p,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let c=r.parse(e[1],1,gt);if(!c)return null;let p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let h=null;if(p.locale&&(h=r.parseObjectValue(p.locale,2,"locale",vn),!h))return null;let m=null;if(p.currency&&(m=r.parseObjectValue(p.currency,2,"currency",vn),!m))return null;let x=null;if(p.unit&&(x=r.parseObjectValue(p.unit,2,"unit",vn),!x))return null;let E=null;if(p["min-fraction-digits"]&&(E=r.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",gt),!E))return null;let D=null;return p["max-fraction-digits"]&&(D=r.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",gt),!D)?null:new Zf(c,h,m,x,E,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class au{constructor(e){this.type=gt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let c=r.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${wi(c.type)} instead.`):new au(c):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Wi(`Expected value to be of type string or array, but found ${wi(Fi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Ph(l){return function(){l=1831565813+(l|=0)|0;let e=Math.imul(l^l>>>15,1|l);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Bl={"==":ox,"!=":Bg,">":zl,"<":Vg,">=":Ug,"<=":jg,array:So,at:Gf,boolean:So,case:su,coalesce:Dh,collator:dh,format:Cl,image:Pa,in:Hf,"index-of":Sh,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:au,let:Mh,literal:Mo,match:qf,number:So,"number-format":Zf,object:So,slice:Ah,step:iu,string:So,"to-boolean":ps,"to-color":ps,"to-number":ps,"to-string":ps,var:Xn,within:Ws,distance:Zs,config:Fl};function $g(l,[e,r,c,p]){e=e.evaluate(l),r=r.evaluate(l),c=c.evaluate(l);let h=p?p.evaluate(l):1,m=_g(e,r,c,h);if(m)throw new Wi(m);return new Fn(e/255*h,r/255*h,c/255*h,h)}function Xf(l,[e,r,c,p]){e=e.evaluate(l),r=r.evaluate(l),c=c.evaluate(l);let h=p?p.evaluate(l):1,m=function(D,y,w,C){return typeof D=="number"&&D>=0&&D<=360?typeof y=="number"&&y>=0&&y<=100&&typeof w=="number"&&w>=0&&w<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[D,y,w,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[D,y,w,C]:[D,y,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[D,y,w,C]:[D,y,w]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,c,h);if(m)throw new Wi(m);let x=`hsla(${e}, ${r}%, ${c}%, ${h})`,E=Fn.parse(x);if(!E)throw new Wi(`Failed to parse HSLA color: ${x}`);return E}function Yf(l,e){return l in e}function Kf(l,e){let r=e[l];return r===void 0?null:r}function Fa(l){return{type:l}}function Gg(l){return{result:"success",value:l}}function Ys(l){return{result:"error",value:l}}function Jf(l,e){return!!l&&!!l.parameters&&l.parameters.indexOf(e)>-1}function Rh(l){return l["property-type"]==="data-driven"}function Qf(l){return Jf(l.expression,"measure-light")}function Hg(l){return Jf(l.expression,"zoom")}function ep(l){return!!l.expression&&l.expression.interpolated}function Oh(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function qg(l){return l}function Wg(l,e){let r=e.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",p=c||!(c||l.property!==void 0),h=l.type||(ep(e)?"exponential":"interval");if(r&&((l=bl({},l)).stops&&(l.stops=l.stops.map(D=>[D[0],Fn.parse(D[1])])),l.default=Fn.parse(l.default?l.default:e.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Ng[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,x,E;if(h==="exponential")m=Xg;else if(h==="interval")m=Zg;else if(h==="categorical"){m=sx,x=Object.create(null);for(let D of l.stops)x[D[0]]=D[1];E=typeof l.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=ax}if(c){let D={},y=[];for(let T=0;T<l.stops.length;T++){let I=l.stops[T],S=I[0].zoom;D[S]===void 0&&(D[S]={zoom:S,type:l.type,property:l.property,default:l.default,stops:[]},y.push(S)),D[S].stops.push([I[0].value,I[1]])}let w=[];for(let T of y)w.push([D[T].zoom,Wg(D[T],e)]);let C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Jr.interpolationFactor.bind(void 0,C),zoomStops:w.map(T=>T[0]),evaluate:({zoom:T},I)=>Xg({stops:w,base:l.base},e,T).evaluate(T,I)}}if(p){let D=h==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Jr.interpolationFactor.bind(void 0,D),zoomStops:l.stops.map(y=>y[0]),evaluate:({zoom:y})=>m(l,e,y,x,E)}}return{kind:"source",evaluate(D,y){let w=y&&y.properties?y.properties[l.property]:void 0;return w===void 0?lu(l.default,e.default):m(l,e,w,x,E)}}}function lu(l,e,r){return l!==void 0?l:e!==void 0?e:r!==void 0?r:void 0}function sx(l,e,r,c,p){return lu(typeof r===p?c[r]:void 0,l.default,e.default)}function Zg(l,e,r){if(Ra(r)!=="number")return lu(l.default,e.default);let c=l.stops.length;if(c===1||r<=l.stops[0][0])return l.stops[0][1];if(r>=l.stops[c-1][0])return l.stops[c-1][1];let p=Ch(l.stops.map(h=>h[0]),r);return l.stops[p][1]}function Xg(l,e,r){let c=l.base!==void 0?l.base:1;if(Ra(r)!=="number")return lu(l.default,e.default);let p=l.stops.length;if(p===1||r<=l.stops[0][0])return l.stops[0][1];if(r>=l.stops[p-1][0])return l.stops[p-1][1];let h=Ch(l.stops.map(y=>y[0]),r),m=function(y,w,C,T){let I=T-C,S=y-C;return I===0?0:w===1?S/I:(Math.pow(w,S)-1)/(Math.pow(w,I)-1)}(r,c,l.stops[h][0],l.stops[h+1][0]),x=l.stops[h][1],E=l.stops[h+1][1],D=Aa[e.type]||qg;if(l.colorSpace&&l.colorSpace!=="rgb"){let y=Ng[l.colorSpace];D=(w,C)=>y.reverse(y.interpolate(y.forward(w),y.forward(C),m))}return typeof x.evaluate=="function"?{evaluate(...y){let w=x.evaluate.apply(void 0,y),C=E.evaluate.apply(void 0,y);if(w!==void 0&&C!==void 0)return D(w,C,m)}}:D(x,E,m)}function ax(l,e,r){return e.type==="color"?r=Fn.parse(r):e.type==="formatted"?r=_r.fromString(r.toString()):e.type==="resolvedImage"?r=Dr.fromString(r.toString()):Ra(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),lu(r,l.default,e.default)}Br.register(Bl,{error:[{kind:"error"},[vn],(l,[e])=>{throw new Wi(e.evaluate(l))}],typeof:[vn,[Tn],(l,[e])=>wi(Fi(e.evaluate(l)))],"to-rgba":[Cr(gt,4),[zr],(l,[e])=>e.evaluate(l).toRenderColor(null).toArray()],rgb:[zr,[gt,gt,gt],$g],rgba:[zr,[gt,gt,gt,gt],$g],hsl:[zr,[gt,gt,gt],Xf],hsla:[zr,[gt,gt,gt,gt],Xf],has:{type:xn,overloads:[[[vn],(l,[e])=>Yf(e.evaluate(l),l.properties())],[[vn,gr],(l,[e,r])=>Yf(e.evaluate(l),r.evaluate(l))]]},get:{type:Tn,overloads:[[[vn],(l,[e])=>Kf(e.evaluate(l),l.properties())],[[vn,gr],(l,[e,r])=>Kf(e.evaluate(l),r.evaluate(l))]]},"feature-state":[Tn,[vn],(l,[e])=>Kf(e.evaluate(l),l.featureState||{})],properties:[gr,[],l=>l.properties()],"geometry-type":[vn,[],l=>l.geometryType()],id:[Tn,[],l=>l.id()],zoom:[gt,[],l=>l.globals.zoom],pitch:[gt,[],l=>l.globals.pitch||0],"distance-from-center":[gt,[],l=>l.distanceFromCenter()],"measure-light":[gt,[vn],(l,[e])=>l.measureLight(e.evaluate(l))],"heatmap-density":[gt,[],l=>l.globals.heatmapDensity||0],"line-progress":[gt,[],l=>l.globals.lineProgress||0],"raster-value":[gt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[gt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[gt,[],l=>l.globals.skyRadialProgress||0],accumulated:[Tn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[gt,Fa(gt),(l,e)=>{let r=0;for(let c of e)r+=c.evaluate(l);return r}],"*":[gt,Fa(gt),(l,e)=>{let r=1;for(let c of e)r*=c.evaluate(l);return r}],"-":{type:gt,overloads:[[[gt,gt],(l,[e,r])=>e.evaluate(l)-r.evaluate(l)],[[gt],(l,[e])=>-e.evaluate(l)]]},"/":[gt,[gt,gt],(l,[e,r])=>e.evaluate(l)/r.evaluate(l)],"%":[gt,[gt,gt],(l,[e,r])=>e.evaluate(l)%r.evaluate(l)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(l,[e,r])=>Math.pow(e.evaluate(l),r.evaluate(l))],sqrt:[gt,[gt],(l,[e])=>Math.sqrt(e.evaluate(l))],log10:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN10],ln:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))],log2:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN2],sin:[gt,[gt],(l,[e])=>Math.sin(e.evaluate(l))],cos:[gt,[gt],(l,[e])=>Math.cos(e.evaluate(l))],tan:[gt,[gt],(l,[e])=>Math.tan(e.evaluate(l))],asin:[gt,[gt],(l,[e])=>Math.asin(e.evaluate(l))],acos:[gt,[gt],(l,[e])=>Math.acos(e.evaluate(l))],atan:[gt,[gt],(l,[e])=>Math.atan(e.evaluate(l))],min:[gt,Fa(gt),(l,e)=>Math.min(...e.map(r=>r.evaluate(l)))],max:[gt,Fa(gt),(l,e)=>Math.max(...e.map(r=>r.evaluate(l)))],abs:[gt,[gt],(l,[e])=>Math.abs(e.evaluate(l))],round:[gt,[gt],(l,[e])=>{let r=e.evaluate(l);return r<0?-Math.round(-r):Math.round(r)}],floor:[gt,[gt],(l,[e])=>Math.floor(e.evaluate(l))],ceil:[gt,[gt],(l,[e])=>Math.ceil(e.evaluate(l))],"filter-==":[xn,[vn,Tn],(l,[e,r])=>l.properties()[e.value]===r.value],"filter-id-==":[xn,[Tn],(l,[e])=>l.id()===e.value],"filter-type-==":[xn,[vn],(l,[e])=>l.geometryType()===e.value],"filter-<":[xn,[vn,Tn],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c<p}],"filter-id-<":[xn,[Tn],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r<c}],"filter->":[xn,[vn,Tn],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c>p}],"filter-id->":[xn,[Tn],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r>c}],"filter-<=":[xn,[vn,Tn],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[xn,[Tn],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r<=c}],"filter->=":[xn,[vn,Tn],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[xn,[Tn],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r>=c}],"filter-has":[xn,[Tn],(l,[e])=>e.value in l.properties()],"filter-has-id":[xn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[xn,[Cr(vn)],(l,[e])=>e.value.indexOf(l.geometryType())>=0],"filter-id-in":[xn,[Cr(Tn)],(l,[e])=>e.value.indexOf(l.id())>=0],"filter-in-small":[xn,[vn,Cr(Tn)],(l,[e,r])=>r.value.indexOf(l.properties()[e.value])>=0],"filter-in-large":[xn,[vn,Cr(Tn)],(l,[e,r])=>function(c,p,h,m){for(;h<=m;){let x=h+m>>1;if(p[x]===c)return!0;p[x]>c?m=x-1:h=x+1}return!1}(l.properties()[e.value],r.value,0,r.value.length-1)],all:{type:xn,overloads:[[[xn,xn],(l,[e,r])=>e.evaluate(l)&&r.evaluate(l)],[Fa(xn),(l,e)=>{for(let r of e)if(!r.evaluate(l))return!1;return!0}]]},any:{type:xn,overloads:[[[xn,xn],(l,[e,r])=>e.evaluate(l)||r.evaluate(l)],[Fa(xn),(l,e)=>{for(let r of e)if(r.evaluate(l))return!0;return!1}]]},"!":[xn,[xn],(l,[e])=>!e.evaluate(l)],"is-supported-script":[xn,[vn],(l,[e])=>{let r=l.globals&&l.globals.isSupportedScript;return!r||r(e.evaluate(l))}],upcase:[vn,[vn],(l,[e])=>e.evaluate(l).toUpperCase()],downcase:[vn,[vn],(l,[e])=>e.evaluate(l).toLowerCase()],concat:[vn,Fa(Tn),(l,e)=>e.map(r=>Mr(r.evaluate(l))).join("")],"resolved-locale":[vn,[ch],(l,[e])=>e.evaluate(l).resolvedLocale()],random:[gt,[gt,gt,Tn],(l,e)=>{let[r,c,p]=e.map(m=>m.evaluate(l));if(r>c||r===c)return r;let h;if(typeof p=="string")h=function(m){let x=0;if(m.length===0)return x;for(let E=0;E<m.length;E++)x=(x<<5)-x+m.charCodeAt(E),x|=0;return x}(p);else{if(typeof p!="number")throw new Wi(`Invalid seed input: ${p}`);h=p}return r+Ph(h)()*(c-r)}]});class Lh{constructor(e,r,c,p){this.expression=e,this._warningHistory={},this._evaluator=new yg(c,p),this._defaultValue=r?function(h){return h.type==="color"&&(Oh(h.default)||Array.isArray(h.default))?new Fn(0,0,0,0):h.type==="color"?Fn.parse(h.default)||null:h.default===void 0?null:h.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,c,p,h,m,x,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,c,p,h,m,x,E){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Wi(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Fh(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Bl}function cu(l,e,r,c){let p=new Ag(Bl,[],e?function(m){let x={color:zr,string:vn,number:gt,enum:vn,boolean:xn,formatted:wl,resolvedImage:Tl};return m.type==="array"?Cr(x[m.value]||Tn,m.length):x[m.type]}(e):void 0,void 0,void 0,r,c),h=p.parse(l,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Gg(new Lh(h,e,r,c)):Ys(p.errors)}class tp{constructor(e,r,c){this.kind=e,this._styleExpression=r,this.isLightConstant=c,this.isStateDependent=e!=="constant"&&!Eh(r.expression),this.configDependencies=Ih(r.expression)}evaluateWithoutErrorHandling(e,r,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,c,p,h,m)}evaluate(e,r,c,p,h,m){return this._styleExpression.evaluate(e,r,c,p,h,m)}}class qo{constructor(e,r,c,p,h){this.kind=e,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Eh(r.expression),this.isLightConstant=h,this.configDependencies=Ih(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,c,p,h,m)}evaluate(e,r,c,p,h,m){return this._styleExpression.evaluate(e,r,c,p,h,m)}interpolationFactor(e,r,c){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,e,r,c):0}}function Yg(l,e,r,c){if((l=cu(l,e,r,c)).result==="error")return l;let p=l.value.expression,h=tu(p);if(!h&&!Rh(e))return Ys([new Go("","data expressions not supported")]);let m=nu(p,["zoom","pitch","distance-from-center"]);if(!m&&!Hg(e))return Ys([new Go("","zoom expressions not supported")]);let x=nu(p,["measure-light"]);if(!x&&!Qf(e))return Ys([new Go("","measure-light expression not supported")]);let E=e.expression&&e.expression.relaxZoomRestriction,D=Nh(p);return D||m||E?D instanceof Go?Ys([D]):D instanceof Jr&&!ep(e)?Ys([new Go("",'"interpolate" expressions cannot be used with this property')]):Gg(D?new qo(h?"camera":"composite",l.value,D.labels,D instanceof Jr?D.interpolation:void 0,x):new tp(h?"constant":"source",l.value,x)):Ys([new Go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class kh{constructor(e,r){this._parameters=e,this._specification=r,bl(this,Wg(this._parameters,this._specification))}static deserialize(e){return new kh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Nh(l){let e=null;if(l instanceof Mh)e=Nh(l.result);else if(l instanceof Dh){for(let r of l.args)if(e=Nh(r),e)break}else(l instanceof iu||l instanceof Jr)&&l.input instanceof Br&&l.input.name==="zoom"&&(e=l);return e instanceof Go||l.eachChild(r=>{let c=Nh(r);c instanceof Go?e=c:e&&c&&e!==c&&(e=new Go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var zh,np,Kg=function(){if(np)return zh;np=1,zh=e;var l=3;function e(r,c,p){var h=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var m=new Int32Array(this.arrayBuffer);r=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var x=0;x<this.d*this.d;x++){var E=m[l+x],D=m[l+x+1];h.push(E===D?null:m.subarray(E,D))}var y=m[l+h.length+1];this.keys=m.subarray(m[l+h.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var w=0;w<this.d*this.d;w++)h.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=p,this.scale=c/r,this.uid=0;var C=p/c*r;this.min=-C,this.max=r+C}return e.prototype.insert=function(r,c,p,h,m){this._forEachCell(c,p,h,m,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(h),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,c,p,h,m,x){this.cells[m].push(x)},e.prototype.query=function(r,c,p,h,m){var x=this.min,E=this.max;if(r<=x&&c<=x&&E<=p&&E<=h&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(r,c,p,h,this._queryCell,D,{},m),D},e.prototype._queryCell=function(r,c,p,h,m,x,E,D){var y=this.cells[m];if(y!==null)for(var w=this.keys,C=this.bboxes,T=0;T<y.length;T++){var I=y[T];if(E[I]===void 0){var S=4*I;(D?D(C[S+0],C[S+1],C[S+2],C[S+3]):r<=C[S+2]&&c<=C[S+3]&&p>=C[S+0]&&h>=C[S+1])?(E[I]=!0,x.push(w[I])):E[I]=!1}}},e.prototype._forEachCell=function(r,c,p,h,m,x,E,D){for(var y=this._convertToCellCoord(r),w=this._convertToCellCoord(c),C=this._convertToCellCoord(p),T=this._convertToCellCoord(h),I=y;I<=C;I++)for(var S=w;S<=T;S++){var R=this.d*S+I;if((!D||D(this._convertFromCellCoord(I),this._convertFromCellCoord(S),this._convertFromCellCoord(I+1),this._convertFromCellCoord(S+1)))&&m.call(this,r,c,p,h,R,x,E,D))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,c=l+this.cells.length+1+1,p=0,h=0;h<this.cells.length;h++)p+=this.cells[h].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,E=0;E<r.length;E++){var D=r[E];m[l+E]=x,m.set(D,x),x+=D.length}return m[l+r.length]=x,m.set(this.keys,x),m[l+r.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},zh}(),ka=P(Kg);let Vl={};function mt(l,e,r={}){Object.defineProperty(l,"_classRegistryKey",{value:e,writable:!1}),Vl[e]={klass:l,omit:r.omit||[]}}mt(Object,"Object"),ka.serialize=function(l,e){let r=l.toArrayBuffer();return e&&e.add(r),{buffer:r}},ka.deserialize=function(l){return new ka(l.buffer)},Object.defineProperty(ka,"name",{value:"Grid"}),mt(ka,"Grid"),mt(Fn,"Color"),mt(Error,"Error"),mt(_r,"Formatted"),mt(Zr,"FormattedSection"),mt(xf,"AJAXError"),mt(Dr,"ResolvedImage"),mt(kh,"StylePropertyFunction"),mt(Lh,"StyleExpression",{omit:["_evaluator"]}),mt(qo,"ZoomDependentExpression"),mt(tp,"ZoomConstantExpression"),mt(Br,"CompoundExpression",{omit:["_evaluate"]});for(let l in Bl)Vl[Bl[l]._classRegistryKey]||mt(Bl[l],`Expression${l}`);function ip(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Jg(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Ks(l,e){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(ip(l)||Jg(l))return e&&e.add(l),l;if(ArrayBuffer.isView(l)){let r=l;return e&&e.add(r.buffer),r}if(l instanceof ImageData)return e&&e.add(l.data.buffer),l;if(Array.isArray(l)){let r=[];for(let c of l)r.push(Ks(c,e));return r}if(l instanceof Map){let r={$name:"Map"};for(let[c,p]of l.entries())r[c]=Ks(p);return r}if(l instanceof Set){let r={$name:"Set"},c=0;for(let p of l.values())r[++c]=Ks(p);return r}if(typeof l=="object"){let r=l.constructor,c=r._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);let p=r.serialize?r.serialize(l,e):{};if(!r.serialize){for(let h in l)l.hasOwnProperty(h)&&(Vl[c].omit.indexOf(h)>=0||(p[h]=Ks(l[h],e)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof l)}function Na(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||ip(l)||Jg(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Na);if(typeof l=="object"){let e=l.$name||"Object";if(e==="Map"){let p=new Map;for(let h of Object.keys(l))h!=="$name"&&p.set(h,Na(l[h]));return p}if(e==="Set"){let p=new Set;for(let h of Object.keys(l))h!=="$name"&&p.add(Na(l[h]));return p}let{klass:r}=Vl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(l);let c=Object.create(r.prototype);for(let p of Object.keys(l))p!=="$name"&&(c[p]=Na(l[p]));return c}throw new Error("can't deserialize object of type "+typeof l)}let bt={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Bh(l){for(let e of l)if(jh(e.charCodeAt(0)))return!0;return!1}function lx(l){for(let e of l)if(!Vh(e.charCodeAt(0)))return!1;return!0}function Vh(l){return!(bt.Arabic(l)||bt["Arabic Supplement"](l)||bt["Arabic Extended-A"](l)||bt["Arabic Presentation Forms-A"](l)||bt["Arabic Presentation Forms-B"](l))}function jh(l){return!(l!==746&&l!==747&&(l<4352||!(bt["Bopomofo Extended"](l)||bt.Bopomofo(l)||bt["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||bt["CJK Compatibility Ideographs"](l)||bt["CJK Compatibility"](l)||bt["CJK Radicals Supplement"](l)||bt["CJK Strokes"](l)||!(!bt["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||bt["CJK Unified Ideographs Extension A"](l)||bt["CJK Unified Ideographs"](l)||bt["Enclosed CJK Letters and Months"](l)||bt["Hangul Compatibility Jamo"](l)||bt["Hangul Jamo Extended-A"](l)||bt["Hangul Jamo Extended-B"](l)||bt["Hangul Jamo"](l)||bt["Hangul Syllables"](l)||bt.Hiragana(l)||bt["Ideographic Description Characters"](l)||bt.Kanbun(l)||bt["Kangxi Radicals"](l)||bt["Katakana Phonetic Extensions"](l)||bt.Katakana(l)&&l!==12540||!(!bt["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!bt["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||bt["Unified Canadian Aboriginal Syllabics"](l)||bt["Unified Canadian Aboriginal Syllabics Extended"](l)||bt["Vertical Forms"](l)||bt["Yijing Hexagram Symbols"](l)||bt["Yi Syllables"](l)||bt["Yi Radicals"](l))))}function uu(l){return!(jh(l)||function(e){return!!(bt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||bt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||bt["Letterlike Symbols"](e)||bt["Number Forms"](e)||bt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||bt["Control Pictures"](e)&&e!==9251||bt["Optical Character Recognition"](e)||bt["Enclosed Alphanumerics"](e)||bt["Geometric Shapes"](e)||bt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||bt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||bt["CJK Symbols and Punctuation"](e)||bt.Katakana(e)||bt["Private Use Area"](e)||bt["CJK Compatibility Forms"](e)||bt["Small Form Variants"](e)||bt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(l))}function rp(l){return l>=1424&&l<=2303||bt["Arabic Presentation Forms-A"](l)||bt["Arabic Presentation Forms-B"](l)}function cx(l,e){return!(!e&&rp(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||bt.Khmer(l))}function ux(l){for(let e of l)if(rp(e.charCodeAt(0)))return!0;return!1}let hu="deferred",du="loading",Uh="loaded",jl=null,Ji="unavailable",Js=null,Qg=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Ji="error"),jl&&jl(l)};function op(){sp.fire(new Hs("pluginStateChange",{pluginStatus:Ji,pluginURL:Js}))}let sp=new xl,ap=function(){return Ji},lp=function(){if(Ji!==hu||!Js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ji=du,op(),Js&&yl({url:Js},l=>{l?Qg(l):(Ji=Uh,op())})},Vr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ji===Uh||Vr.applyArabicShaping!=null,isLoading:()=>Ji===du,setState(l){Ji=l.pluginStatus,Js=l.pluginURL},isParsed:()=>Vr.applyArabicShaping!=null&&Vr.processBidirectionalText!=null&&Vr.processStyledBidirectionalText!=null,getPluginURL:()=>Js};class vi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,c){for(let p of r)if(!cx(p.charCodeAt(0),c))return!1;return!0}(e,Vr.isLoaded())}}class $h{constructor(e,r,c,p){this.property=e,this.value=r,this.expression=function(h,m,x,E){if(Oh(h))return new kh(h,m);if(Fh(h)||Array.isArray(h)&&h.length>0){let D=Yg(h,m,x,E);if(D.result==="error")throw new Error(D.value.map(y=>`${y.key}: ${y.message}`).join(", "));return D.value}{let D=h;return typeof h=="string"&&m.type==="color"&&(D=Fn.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(r===void 0?e.specification.default:r,e.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,c){return this.property.possiblyEvaluate(this,e,r,c)}}class cp{constructor(e,r,c){this.property=e,this.value=new $h(e,void 0,r,c)}transitioned(e,r){return new t_(this.property,this.value,r,mr({},e.transition,this.transition),e.now)}untransitioned(){return new t_(this.property,this.value,null,{},0)}}class e_{constructor(e,r,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(e){return co(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new cp(this._values[e].property,this._scope,this._options)),this._values[e].value=new $h(this._values[e].property,r===null?void 0:co(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);let c=this._properties.properties;if(e)for(let p in e){let h=e[p];if(ds(p,"-transition")){let m=p.slice(0,-11);c[m]&&this.setTransition(m,h)}else c.hasOwnProperty(p)&&this.setValue(p,h)}}getTransition(e){return co(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new cp(this._values[e].property)),this._values[e].transition=co(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(e[r]=c);let p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){let c=new n_(this._properties);for(let p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(e,r._values[p]);return c}untransitioned(){let e=new n_(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class t_{constructor(e,r,c,p,h){let m=p.delay||0,x=p.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+m,this.end=this.begin+x,e.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(e,r,c){let p=e.now||0,h=this.value.possiblyEvaluate(e,r,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(p<this.begin)return m.possiblyEvaluate(e,r,c);{let x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,c),h,Ia(x))}}return h}}class n_{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,c){let p=new $l(this._properties);for(let h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(e,r,c);return p}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class hx{constructor(e,r,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(e){return co(this._values[e].value)}setValue(e,r){this._values[e]=new $h(this._values[e].property,r===null?void 0:co(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(e[r]=c)}return e}possiblyEvaluate(e,r,c){let p=new $l(this._properties);for(let h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(e,r,c);return p}}class Ul{constructor(e,r,c){this.property=e,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,c,p){return this.property.evaluate(this.value,this.parameters,e,r,c,p)}}class $l{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class it{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,c){let p=Aa[this.specification.type];return p?p(e,r,c):e}}class Tt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,c,p){return new Ul(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},c,p)}:e.expression,r)}interpolate(e,r,c){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ul(this,{kind:"constant",value:void 0},e.parameters);let p=Aa[this.specification.type];return p?new Ul(this,{kind:"constant",value:p(e.value.value,r.value.value,c)},e.parameters):e}evaluate(e,r,c,p,h,m){return e.kind==="constant"?e.value:e.evaluate(r,c,p,h,m)}}class Ao{constructor(e){this.specification=e}possiblyEvaluate(e,r,c,p){return!!e.expression.evaluate(r,null,{},c,p)}interpolate(){return!1}}class ui{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new vi(0,{});for(let c in e){let p=e[c];p.specification.overridable&&this.overridableProperties.push(c);let h=this.defaultPropertyValues[c]=new $h(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new cp(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=h.possiblyEvaluate(r)}}}mt(Tt,"DataDrivenProperty"),mt(it,"DataConstantProperty"),mt(Ao,"ColorRampProperty");var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function fu(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Gh(l){if(Array.isArray(l))return l.map(Gh);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let e={};for(let r in l)e[r]=Gh(l[r]);return e}return fu(l)}function up(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let e of l.slice(1))if(!up(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Po(l,e="",r=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};up(l)||(l=Hh(l));let p=l,h=!0;try{h=function(w){if(!Gl(w))return w;let C=Gh(w);return za(C),C=hp(C),C}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let m=Re[`filter_${c}`],x=cu(h,m,e,r),E=null;if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));E=(w,C,T)=>x.value.evaluate(w,C,{},T);let D=null,y=null;if(h!==p){let w=cu(p,m,e,r);if(w.result==="error")throw new Error(w.value.map(C=>`${C.key}: ${C.message}`).join(", "));D=(C,T,I,S,R)=>w.value.evaluate(C,T,{},I,void 0,void 0,S,R),y=!tu(w.value.expression)}return{filter:E,dynamicFilter:D||void 0,needGeometry:i_(h),needFeature:!!y}}function hp(l){if(!Array.isArray(l))return l;let e=function(r){if(dx.has(r[0])){for(let c=1;c<r.length;c++)if(Gl(r[c]))return!0}return r}(l);return e===!0?e:e.map(r=>hp(r))}function za(l){let e=!1,r=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)e=e||Gl(l[c]),r.push(l[c+1]);r.push(l[l.length-1])}else if(l[0]==="match"){e=e||Gl(l[1]);for(let c=2;c<l.length-1;c+=2)r.push(l[c+1]);r.push(l[l.length-1])}else if(l[0]==="step"){e=e||Gl(l[1]);for(let c=1;c<l.length-1;c+=2)r.push(l[c+1])}e&&(l.length=0,l.push("any",...r));for(let c=1;c<l.length;c++)za(l[c])}function Gl(l){if(!Array.isArray(l))return!1;if((e=l[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<l.length;r++)if(Gl(l[r]))return!0;return!1}let dx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fx(l,e){return l<e?-1:l>e?1:0}function i_(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let e=1;e<l.length;e++)if(i_(l[e]))return!0;return!1}function Hh(l){if(!l)return!0;let e=l[0];return l.length<=1?e!=="any":e==="=="?qh(l[1],l[2],"=="):e==="!="?mu(qh(l[1],l[2],"==")):e==="<"||e===">"||e==="<="||e===">="?qh(l[1],l[2],e):e==="any"?(r=l.slice(1),["any"].concat(r.map(Hh))):e==="all"?["all"].concat(l.slice(1).map(Hh)):e==="none"?["all"].concat(l.slice(1).map(Hh).map(mu)):e==="in"?Wh(l[1],l.slice(2)):e==="!in"?mu(Wh(l[1],l.slice(2))):e==="has"?pu(l[1]):e!=="!has"||mu(pu(l[1]));var r}function qh(l,e,r){switch(l){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,l,e]}}function Wh(l,e){if(e.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",l,["literal",e.sort(fx)]]:["filter-in-small",l,["literal",e]]}}function pu(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function mu(l){return["!",l]}let Hl="";function r_(l,e){return e?`${l}${Hl}${e}`:l}let Ro="-transition",px=new Set(["fill","line","background","hillshade","raster"]);class yr extends xl{constructor(e,r,c,p,h){if(super(),this.id=e.id,this.fqid=r_(this.id,c),this.type=e.type,this.scope=c,this.lut=p,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new hx(r.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint)){this._transitionablePaint=new e_(r.paint,this.scope,h);for(let m in e.paint)this.setPaintProperty(m,e.paint[m]);for(let m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $l(r.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&px.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);let c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ds(e,Ro)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){let c=this._transitionablePaint,p=c._properties.properties;if(ds(e,Ro)){let w=e.slice(0,-11);return p[w]&&c.setTransition(w,r||void 0),!1}if(!p[e])return!1;let h=c._values[e],m=h.value.isDataDriven(),x=h.value;c.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let E=c._values[e].value,D=E.isDataDriven(),y=ds(e,"pattern")||e==="line-dasharray";return D||m||y||this._handleOverridablePaintPropertyUpdate(e,x,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,c){return null}_handleOverridablePaintPropertyUpdate(e,r,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return pl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof Ul&&Rh(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Po(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,c,p,h,m,x,E,D){}queryIntersectsMatchingFeature(e,r,c,p){}}let mx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gu{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Dn(l,e=1){let r=0,c=0;return{members:l.map(p=>{let h=mx[p.type].BYTES_PER_ELEMENT,m=r=o_(r,Math.max(e,h)),x=p.components||1;return c=Math.max(c,h),r+=h*x,{name:p.name,type:p.type,components:x,offset:m}}),size:o_(r,Math.max(c,e)),alignment:e}}function o_(l,e){return Math.ceil(l/e)*e}class Qs extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.int16[p+0]=r,this.int16[p+1]=c,e}}Qs.prototype.bytesPerElement=4,mt(Qs,"StructArrayLayout2i4");class Zh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let h=3*e;return this.int16[h+0]=r,this.int16[h+1]=c,this.int16[h+2]=p,e}}Zh.prototype.bytesPerElement=6,mt(Zh,"StructArrayLayout3i6");class ea extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,c,p)}emplace(e,r,c,p,h){let m=4*e;return this.int16[m+0]=r,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=h,e}}ea.prototype.bytesPerElement=8,mt(ea,"StructArrayLayout4i8");class Xh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,h)}emplace(e,r,c,p,h,m){let x=5*e;return this.int16[x+0]=r,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=h,this.int16[x+4]=m,e}}Xh.prototype.bytesPerElement=10,mt(Xh,"StructArrayLayout5i10");class dp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,h,m,x)}emplace(e,r,c,p,h,m,x,E){let D=6*e,y=12*e,w=3*e;return this.int16[D+0]=r,this.int16[D+1]=c,this.uint8[y+4]=p,this.uint8[y+5]=h,this.uint8[y+6]=m,this.uint8[y+7]=x,this.float32[w+2]=E,e}}dp.prototype.bytesPerElement=12,mt(dp,"StructArrayLayout2i4ub1f12");class _s extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,c,p)}emplace(e,r,c,p,h){let m=4*e;return this.float32[m+0]=r,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=h,e}}_s.prototype.bytesPerElement=16,mt(_s,"StructArrayLayout4f16");class ta extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let h=3*e;return this.float32[h+0]=r,this.float32[h+1]=c,this.float32[h+2]=p,e}}ta.prototype.bytesPerElement=12,mt(ta,"StructArrayLayout3f12");class ys extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,h)}emplace(e,r,c,p,h,m){let x=6*e,E=3*e;return this.uint16[x+0]=r,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=h,this.float32[E+2]=m,e}}ys.prototype.bytesPerElement=12,mt(ys,"StructArrayLayout4ui1f12");class Ba extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,c,p)}emplace(e,r,c,p,h){let m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=h,e}}Ba.prototype.bytesPerElement=8,mt(Ba,"StructArrayLayout4ui8");class Yh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,r,c,p,h,m)}emplace(e,r,c,p,h,m,x){let E=6*e;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=h,this.int16[E+4]=m,this.int16[E+5]=x,e}}Yh.prototype.bytesPerElement=12,mt(Yh,"StructArrayLayout6i12");class fp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x,E,D,y,w,C){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,c,p,h,m,x,E,D,y,w,C)}emplace(e,r,c,p,h,m,x,E,D,y,w,C,T){let I=12*e;return this.int16[I+0]=r,this.int16[I+1]=c,this.int16[I+2]=p,this.int16[I+3]=h,this.uint16[I+4]=m,this.uint16[I+5]=x,this.uint16[I+6]=E,this.uint16[I+7]=D,this.int16[I+8]=y,this.int16[I+9]=w,this.int16[I+10]=C,this.int16[I+11]=T,e}}fp.prototype.bytesPerElement=24,mt(fp,"StructArrayLayout4i4ui4i24");class pp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,r,c,p,h,m)}emplace(e,r,c,p,h,m,x){let E=10*e,D=5*e;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=p,this.float32[D+2]=h,this.float32[D+3]=m,this.float32[D+4]=x,e}}pp.prototype.bytesPerElement=20,mt(pp,"StructArrayLayout3i3f20");class mp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}mp.prototype.bytesPerElement=4,mt(mp,"StructArrayLayout1ul4");class na extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=c,e}}na.prototype.bytesPerElement=4,mt(na,"StructArrayLayout2ui4");class ql extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x,E,D,y,w,C,T){let I=this.length;return this.resize(I+1),this.emplace(I,e,r,c,p,h,m,x,E,D,y,w,C,T)}emplace(e,r,c,p,h,m,x,E,D,y,w,C,T,I){let S=20*e,R=10*e;return this.int16[S+0]=r,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+3]=h,this.int16[S+4]=m,this.float32[R+3]=x,this.float32[R+4]=E,this.float32[R+5]=D,this.float32[R+6]=y,this.int16[S+14]=w,this.uint32[R+8]=C,this.uint16[S+18]=T,this.uint16[S+19]=I,e}}ql.prototype.bytesPerElement=40,mt(ql,"StructArrayLayout5i4f1i1ul2ui40");class Va extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,h,m,x)}emplace(e,r,c,p,h,m,x,E){let D=8*e;return this.int16[D+0]=r,this.int16[D+1]=c,this.int16[D+2]=p,this.int16[D+4]=h,this.int16[D+5]=m,this.int16[D+6]=x,this.int16[D+7]=E,e}}Va.prototype.bytesPerElement=16,mt(Va,"StructArrayLayout3i2i2i16");class Sr extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,h)}emplace(e,r,c,p,h,m){let x=4*e,E=8*e;return this.float32[x+0]=r,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[E+6]=h,this.int16[E+7]=m,e}}Sr.prototype.bytesPerElement=16,mt(Sr,"StructArrayLayout2f1f2i16");class Wl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,r,c,p,h,m)}emplace(e,r,c,p,h,m,x){let E=20*e,D=5*e;return this.uint8[E+0]=r,this.uint8[E+1]=c,this.float32[D+1]=p,this.float32[D+2]=h,this.float32[D+3]=m,this.float32[D+4]=x,e}}Wl.prototype.bytesPerElement=20,mt(Wl,"StructArrayLayout2ub4f20");class rr extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=c,this.uint16[h+2]=p,e}}rr.prototype.bytesPerElement=6,mt(rr,"StructArrayLayout3ui6");class gp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G){let H=this.length;return this.resize(H+1),this.emplace(H,e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G)}emplace(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G,H){let K=30*e,te=15*e,ie=60*e;return this.int16[K+0]=r,this.int16[K+1]=c,this.int16[K+2]=p,this.float32[te+2]=h,this.float32[te+3]=m,this.uint16[K+8]=x,this.uint16[K+9]=E,this.uint32[te+5]=D,this.uint32[te+6]=y,this.uint32[te+7]=w,this.uint16[K+16]=C,this.uint16[K+17]=T,this.uint16[K+18]=I,this.float32[te+10]=S,this.float32[te+11]=R,this.uint8[ie+48]=F,this.uint8[ie+49]=B,this.uint8[ie+50]=U,this.uint32[te+13]=k,this.int16[K+28]=G,this.uint8[ie+58]=H,e}}gp.prototype.bytesPerElement=60,mt(gp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _p extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G,H,K,te,ie,Q,ue,se,de,ve,Te,Ee){let Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G,H,K,te,ie,Q,ue,se,de,ve,Te,Ee)}emplace(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F,B,U,k,G,H,K,te,ie,Q,ue,se,de,ve,Te,Ee,Ie){let Oe=20*e,De=40*e,je=80*e;return this.float32[Oe+0]=r,this.float32[Oe+1]=c,this.int16[De+4]=p,this.int16[De+5]=h,this.int16[De+6]=m,this.int16[De+7]=x,this.int16[De+8]=E,this.int16[De+9]=D,this.int16[De+10]=y,this.int16[De+11]=w,this.int16[De+12]=C,this.uint16[De+13]=T,this.uint16[De+14]=I,this.uint16[De+15]=S,this.uint16[De+16]=R,this.uint16[De+17]=F,this.uint16[De+18]=B,this.uint16[De+19]=U,this.uint16[De+20]=k,this.uint16[De+21]=G,this.uint16[De+22]=H,this.uint16[De+23]=K,this.uint16[De+24]=te,this.uint16[De+25]=ie,this.uint16[De+26]=Q,this.uint16[De+27]=ue,this.uint32[Oe+14]=se,this.float32[Oe+15]=de,this.float32[Oe+16]=ve,this.float32[Oe+17]=Te,this.float32[Oe+18]=Ee,this.uint8[je+76]=Ie,e}}_p.prototype.bytesPerElement=80,mt(_p,"StructArrayLayout2f9i15ui1ul4f1ub80");class Zl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Zl.prototype.bytesPerElement=4,mt(Zl,"StructArrayLayout1f4");class vs extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,h)}emplace(e,r,c,p,h,m){let x=5*e;return this.float32[x+0]=r,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=h,this.float32[x+4]=m,e}}vs.prototype.bytesPerElement=20,mt(vs,"StructArrayLayout5f20");class yp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,h,m,x)}emplace(e,r,c,p,h,m,x,E){let D=7*e;return this.float32[D+0]=r,this.float32[D+1]=c,this.float32[D+2]=p,this.float32[D+3]=h,this.float32[D+4]=m,this.float32[D+5]=x,this.float32[D+6]=E,e}}yp.prototype.bytesPerElement=28,mt(yp,"StructArrayLayout7f28");class _u extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,c,p)}emplace(e,r,c,p,h){let m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=h,e}}_u.prototype.bytesPerElement=12,mt(_u,"StructArrayLayout1ul3ui12");class vp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}vp.prototype.bytesPerElement=2,mt(vp,"StructArrayLayout1ui2");class yu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.float32[p+0]=r,this.float32[p+1]=c,e}}yu.prototype.bytesPerElement=8,mt(yu,"StructArrayLayout2f8");class vu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R){let F=this.length;return this.resize(F+1),this.emplace(F,e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R)}emplace(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F){let B=16*e;return this.float32[B+0]=r,this.float32[B+1]=c,this.float32[B+2]=p,this.float32[B+3]=h,this.float32[B+4]=m,this.float32[B+5]=x,this.float32[B+6]=E,this.float32[B+7]=D,this.float32[B+8]=y,this.float32[B+9]=w,this.float32[B+10]=C,this.float32[B+11]=T,this.float32[B+12]=I,this.float32[B+13]=S,this.float32[B+14]=R,this.float32[B+15]=F,e}}vu.prototype.bytesPerElement=64,mt(vu,"StructArrayLayout16f64");class Kh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,h,m,x){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,h,m,x)}emplace(e,r,c,p,h,m,x,E){let D=10*e,y=5*e;return this.uint16[D+0]=r,this.uint16[D+1]=c,this.uint16[D+2]=p,this.uint16[D+3]=h,this.float32[y+2]=m,this.float32[y+3]=x,this.float32[y+4]=E,e}}Kh.prototype.bytesPerElement=20,mt(Kh,"StructArrayLayout4ui3f20");class Jh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Jh.prototype.bytesPerElement=2,mt(Jh,"StructArrayLayout1i2");class Qh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Qh.prototype.bytesPerElement=1,mt(Qh,"StructArrayLayout1ub1");class s_ extends gu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}s_.prototype.size=40;class ed extends ql{get(e){return new s_(this,e)}}mt(ed,"CollisionBoxArray");class xu extends gu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xu.prototype.size=60;class xp extends gp{get(e){return new xu(this,e)}}mt(xp,"PlacedSymbolArray");class a_ extends gu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}a_.prototype.size=80;class bp extends _p{get(e){return new a_(this,e)}}mt(bp,"SymbolInstanceArray");class l_ extends Zl{getoffsetX(e){return this.float32[1*e+0]}}mt(l_,"GlyphOffsetArray");class td extends Qs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}mt(td,"SymbolLineVertexArray");class c_ extends gu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}c_.prototype.size=12;class u_ extends _u{get(e){return new c_(this,e)}}mt(u_,"FeatureIndexArray");class h_ extends na{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}mt(h_,"FillExtrusionCentroidArray");class d_ extends gu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}d_.prototype.size=6;class wp extends Zh{get(e){return new d_(this,e)}}mt(wp,"FillExtrusionWallArray");let gx=Dn([{name:"a_pos",components:2,type:"Int16"}],4),_x=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xi{constructor(e=[]){this.segments=e}_prepareSegment(e,r,c,p){let h=this.segments[this.segments.length-1];return e>xi.MAX_VERTEX_ARRAY_LENGTH&&In(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>xi.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==p)&&(h={vertexOffset:r,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(h.sortKey=p),this.segments.push(h)),h}prepareSegment(e,r,c,p){return this._prepareSegment(e,r.length,c.length,p)}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,c,p){return new xi([{vertexOffset:e,primitiveOffset:r,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function f_(l,e){return 256*(l=Qt(Math.floor(l),0,255))+Qt(Math.floor(e),0,255)}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt(xi,"SegmentVector");let yx=Dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vx=Dn([{name:"a_dash",components:4,type:"Uint16"}]);class bu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,c,p){this.ids.push(p_(e)),this.positions.push(r,c,p)}eachPosition(e,r){let c=p_(e),p=0,h=this.ids.length-1;for(;p<h;){let m=p+h>>1;this.ids[m]>=c?h=m:p=m+1}for(;this.ids[p]===c;)r(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,r){let c=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Xl(c,p,0,c.length-1),r&&(r.add(c.buffer),r.add(p.buffer)),{ids:c,positions:p}}static deserialize(e){let r=new bu,c;r.ids=e.ids,r.positions=e.positions;for(let p of r.ids)p!==c&&r.uniqueIds.push(p),c=p;return r.indexed=!0,r}}function p_(l){let e=+l;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Nr(String(l))}function Xl(l,e,r,c){for(;r<c;){let p=l[r+c>>1],h=r-1,m=c+1;for(;;){do h++;while(l[h]<p);do m--;while(l[m]>p);if(h>=m)break;nd(l,h,m),nd(e,3*h,3*m),nd(e,3*h+1,3*m+1),nd(e,3*h+2,3*m+2)}m-r<c-m?(Xl(l,e,r,m),r=m+1):(Xl(l,e,m+1,c),c=m)}}function nd(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}mt(bu,"FeaturePositionMap");class xs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ja extends xs{constructor(e){super(e),this.current=0}set(e,r,c){this.fetchUniformLocation(e,r)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class vr extends xs{constructor(e){super(e),this.current=0}set(e,r,c){this.fetchUniformLocation(e,r)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Wo extends xs{constructor(e){super(e),this.current=[0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Tp extends xs{constructor(e){super(e),this.current=[0,0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class id extends xs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Ep extends xs{constructor(e){super(e),this.current=Fn.transparent.toRenderColor(null)}set(e,r,c){this.fetchUniformLocation(e,r)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}let m_=new Float32Array(16);class wu extends xs{constructor(e){super(e),this.current=m_}set(e,r,c){if(this.fetchUniformLocation(e,r)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}let xx=new Float32Array(9),bx=new Float32Array(4);class Ip extends xs{constructor(e){super(e),this.current=bx}set(e,r,c){if(this.fetchUniformLocation(e,r)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function Cp(l){return[f_(255*l.r,255*l.g),f_(255*l.b,255*l.a)]}class Tu{constructor(e,r,c,p){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=c,this.context=p}setUniform(e,r,c,p,h){let m=p.constantOr(this.value);r.set(e,h,m instanceof Fn?m.toRenderColor(this.context.lut):m)}getBinding(e,r){return this.type==="color"?new Ep(e):new vr(e)}}class Yl{constructor(e,r){this.uniformNames=r.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,c,p,h){let m=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,h,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new id(e):new vr(e)}}class Zo{constructor(e,r,c,p){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,c,p,h,m,x){let E=this.paintVertexArray.length,D=this.expression.evaluate(new vi(0,{brightness:m}),r,{},h,p,x);this.paintVertexArray.resize(e),this._setPaintValue(E,e,D,this.context)}updatePaintArray(e,r,c,p,h,m,x){let E=this.expression.evaluate({zoom:0,brightness:x},c,p,void 0,h);this._setPaintValue(e,r,E,this.context)}_setPaintValue(e,r,c,p){if(this.type==="color"){let h=Cp(c.toRenderColor(p.lut));for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qr{constructor(e,r,c,p,h,m){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.context=h,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,c,p,h,m,x){let E=this.expression.evaluate(new vi(this.context.zoom,{brightness:m}),r,{},h,p,x),D=this.expression.evaluate(new vi(this.context.zoom+1,{brightness:m}),r,{},h,p,x),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,E,D,this.context)}updatePaintArray(e,r,c,p,h,m,x){let E=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,h),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,p,void 0,h);this._setPaintValue(e,r,E,D,this.context)}_setPaintValue(e,r,c,p,h){if(this.type==="color"){let m=Cp(c.toRenderColor(h.lut)),x=Cp(c.toRenderColor(h.lut));for(let E=e;E<r;E++)this.paintVertexArray.emplace(E,m[0],m[1],x[0],x[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,c,p,h){let m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=Qt(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);r.set(e,h,x)}getBinding(e,r){return new vr(e)}}class Xo{constructor(e,r,c,p,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(c==="array"?vx:yx).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new p}populatePaintArray(e,r,c,p){let h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(e,r,c,p,h,m,x){this._setPaintValues(e,r,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,r,c,p){if(!p||!c)return;let h=p[c];if(!h)return;let{tl:m,br:x,pixelRatio:E}=h;for(let D=e;D<r;D++)this.paintVertexArray.emplace(D,m[0],m[1],x[0],x[1],E)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ua{constructor(e,r,c=()=>!0){this.binders={},this._buffers=[],this.context=r;let p=[];for(let h in e.paint._values){let m=e.paint.get(h);if(!c(h)||!(m instanceof Ul&&Rh(m.property.specification)))continue;let x=Tx(h,e.type),E=m.value,D=m.property.specification.type,y=!!m.property.useIntegerZoom,w=h==="line-dasharray"||h.endsWith("pattern"),C=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||C)if(E.kind==="source"||C||w){let T=d(h,D,"source");this.binders[h]=w?new Xo(E,x,D,T,e.id):new Zo(E,x,D,T),p.push(`/a_${h}`)}else{let T=d(h,D,"composite");this.binders[h]=new Qr(E,x,D,y,r,T),p.push(`/z_${h}`)}else this.binders[h]=w?new Yl(E.value,x):new Tu(E.value,x,D,r),p.push(`/u_${h}`)}this.cacheKey=p.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof Zo||r instanceof Qr?r.maxValue:0}populatePaintArrays(e,r,c,p,h,m,x){for(let E in this.binders){let D=this.binders[E];D.context=this.context,(D instanceof Zo||D instanceof Qr||D instanceof Xo)&&D.populatePaintArray(e,r,c,p,h,m,x)}}setConstantPatternPositions(e){for(let r in this.binders){let c=this.binders[r];c instanceof Yl&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,r,c,p,h,m,x,E){let D=!1,y=Object.keys(e),w=y.length!==0,C=w?y:r.uniqueIds;this.context.lut=h.lut;for(let T in this.binders){let I=this.binders[T];if(I.context=this.context,(I instanceof Zo||I instanceof Qr||I instanceof Xo)&&(I.expression.isStateDependent===!0||I.expression.isLightConstant===!1)){let S=h.paint.get(T);I.expression=S.value;for(let R of C){let F=e[R.toString()];r.eachPosition(R,(B,U,k)=>{let G=p.feature(B);I.updatePaintArray(U,k,G,F,m,x,E)})}if(!w)for(let R of c.uniqueIds){let F=e[R.toString()];c.eachPosition(R,(B,U,k)=>{let G=p.feature(B);I.updatePaintArray(U,k,G,F,m,x,E)})}D=!0}}return D}defines(){let e=[];for(let r in this.binders){let c=this.binders[r];(c instanceof Tu||c instanceof Yl)&&e.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof Zo||c instanceof Qr||c instanceof Xo)for(let p=0;p<c.paintVertexAttributes.length;p++)e.push(c.paintVertexAttributes[p].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof Tu||c instanceof Yl||c instanceof Qr)for(let p of c.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let c in this.binders){let p=this.binders[c];if(p instanceof Tu||p instanceof Yl||p instanceof Qr)for(let h of p.uniformNames)r.push({name:h,property:c,binding:p.getBinding(e,h)})}return r}setUniforms(e,r,c,p,h){for(let{name:m,property:x,binding:E}of c)this.binders[x].setUniform(e,E,h,p.get(x),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let r=this.binders[e];(r instanceof Zo||r instanceof Qr||r instanceof Xo)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let r in this.binders){let c=this.binders[r];(c instanceof Zo||c instanceof Qr||c instanceof Xo)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof Zo||r instanceof Qr||r instanceof Xo)&&r.destroy()}}}class ia{constructor(e,r,c=()=>!0){this.programConfigurations={};for(let p of e)this.programConfigurations[p.id]=new Ua(p,r,c);this.needsUpload=!1,this._featureMap=new bu,this._featureMapWithoutIds=new bu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,c,p,h,m,x,E){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,r,p,h,m,x,E);r.id!==void 0?this._featureMap.add(r.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,c,p,h,m){for(let x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,x,p,h,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let wx={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Tx(l,e){return wx[l]||[l.replace(`${e}-`,"").replace(/-/g,"_")]}let Ex={"line-pattern":{source:ys,composite:ys},"fill-pattern":{source:ys,composite:ys},"fill-extrusion-pattern":{source:ys,composite:ys},"line-dasharray":{source:Ba,composite:Ba}},g_={color:{source:yu,composite:_s},number:{source:Zl,composite:yu}};function d(l,e,r){let c=Ex[l];return c&&c[r]||g_[e][r]}mt(Tu,"ConstantBinder"),mt(Yl,"PatternConstantBinder"),mt(Zo,"SourceExpressionBinder"),mt(Xo,"PatternCompositeBinder"),mt(Qr,"CompositeExpressionBinder"),mt(Ua,"ProgramConfiguration",{omit:["_buffers"]}),mt(ia,"ProgramConfigurationSet");let t=at/Math.PI/2,a=5,f=6,g=16383,v=64,b=[v,32,16],M=-t,A=t;function O(l,e,r,c=t){return r=_n(r),[l*Math.sin(r)*c,-e*c,l*Math.cos(r)*c]}function L(l,e,r){return O(Math.cos(_n(l)),Math.sin(_n(l)),e,r)}let N=63710088e-1,z=2*Math.PI*N;class j{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new j(hs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,c=this.lat*r,p=e.lat*r,h=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return N*Math.acos(Math.min(h,1))}toBounds(e=0){let r=360*e/40075017,c=r/Math.cos(Math.PI/180*this.lat);return new q({lng:this.lng-c,lat:this.lat-r},{lng:this.lng+c,lat:this.lat+r})}toEcef(e){return L(this.lat,this.lng,t+e*t/N)}static convert(e){if(e instanceof j)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new j(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new j(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class q{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){let c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{let c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}setSouthWest(e){return this._sw=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}extend(e){let r=this._sw,c=this._ne,p,h;if(e instanceof j)p=e,h=e;else{if(!(e instanceof q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(q.convert(e)):this.extend(j.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(j.convert(e)):this;if(p=e._sw,h=e._ne,!p||!h)return this}return r||c?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),c.lng=Math.max(h.lng,c.lng),c.lat=Math.max(h.lat,c.lat)):(this._sw=new j(p.lng,p.lat),this._ne=new j(h.lng,h.lat)),this}getCenter(){return new j((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new j(this.getWest(),this.getNorth())}getSouthEast(){return new j(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:c}=j.convert(e),p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){if(e)return e instanceof q?e:new q(e)}}let W=0,Z=25.5;function X(l){return z*Math.cos(l*Math.PI/180)}function ne(l){return(180+l)/360}function oe(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ee(l,e){return l/X(e)}function le(l){return 360*l-180}function ae(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function fe(l,e){return l*X(ae(e))}let he=85.051129;function pe(l){return Math.cos(_n(Qt(l,-he,he)))}function we(l,e){let r=Qt(e,W,Z),c=Math.pow(2,r);return pe(l)*z/(512*c)}function ye(l){return 1/Math.cos(l*Math.PI/180)}function ge(l,e=0){let r=Math.exp(Math.PI*(1-(l.y+e/at)/(1<<l.z)*2));return 80150034*r/(r*r+1)/at/(1<<l.z)}class Me{constructor(e,r,c=0){this.x=+e,this.y=+r,this.z=+c}static fromLngLat(e,r=0){let c=j.convert(e);return new Me(ne(c.lng),oe(c.lat),ee(r,c.lat))}toLngLat(){return new j(le(this.x),ae(this.y))}toAltitude(){return fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/z*ye(ae(this.y))}}function Be(l,e,r,c,p,h,m,x,E){let D=(e+c)/2,y=(r+p)/2,w=new st(D,y);x(w),function(C,T,I,S,R,F){let B=I-R,U=S-F;return Math.abs((S-T)*B-(I-C)*U)/Math.hypot(B,U)}(w.x,w.y,h.x,h.y,m.x,m.y)>=E?(Be(l,e,r,D,y,h,w,x,E),Be(l,D,y,c,p,w,m,x,E)):l.push(m)}function qe(l,e,r){let c=l[0],p=c.x,h=c.y;e(c);let m=[c];for(let x=1;x<l.length;x++){let E=l[x],{x:D,y}=E;e(E),Be(m,p,h,D,y,c,E,e,r),p=D,h=y,c=E}return m}function ze(l,e,r,c){if(c(e,r)){let p=e.add(r)._mult(.5);ze(l,e,p,c),ze(l,p,r,c)}else l.push(r)}function Je(l,e){let r=l[0],c=[r];for(let p=1;p<l.length;p++){let h=l[p];ze(c,r,h,e),r=h}return c}let Se=Math.pow(2,14)-1,Ge=-Se-1;function Ue(l,e){let r=Math.round(l.x*e),c=Math.round(l.y*e);return l.x=Qt(r,Ge,Se),l.y=Qt(c,Ge,Se),(r<l.x||r>l.x+1||c<l.y||c>l.y+1)&&In("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function et(l,e,r){let c=l.loadGeometry(),p=l.extent,h=at/p;if(e&&r&&r.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:x,x:E,y:D,projection:y}=r,w=C=>{let T=le((e.x+C.x/p)/m),I=ae((e.y+C.y/p)/m),S=y.project(T,I);C.x=(S.x*x-E)*p,C.y=(S.y*x-D)*p};for(let C=0;C<c.length;C++)if(l.type!==1)c[C]=qe(c[C],w,1);else{let T=[];for(let I of c[C])I.x<0||I.x>=p||I.y<0||I.y>=p||(w(I),T.push(I));c[C]=T}}for(let m of c)for(let x of m)Ue(x,h);return c}function nt(l,e){return{type:l.type,id:l.id,properties:l.properties,geometry:e?et(l):[]}}function He(l,e,r,c,p){l.emplaceBack(2*e+(c+1)/2,2*r+(p+1)/2)}function Ye(l,e,r){l.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Et{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Qs,this.indexArray=new rr,this.segments=new xi,this.programConfigurations=new ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,c,p){let h=this.layers[0],m=[],x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(let{feature:D,id:y,index:w,sourceLayerIndex:C}of e){let T=this.layers[0]._featureFilter.needGeometry,I=nt(D,T);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),I,c))continue;let S=x?x.evaluate(I,{},c):void 0,R={id:y,properties:D.properties,type:D.type,sourceLayerIndex:C,index:w,geometry:T?I.geometry:et(D,c,p),patterns:{},sortKey:S};m.push(R)}x&&m.sort((D,y)=>D.sortKey-y.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Yh,E=p.projection);for(let D of m){let{geometry:y,index:w,sourceLayerIndex:C}=D,T=e[w].feature;this.addFeature(D,y,w,r.availableImages,c,E,r.brightness),r.featureIndex.insert(T,y,w,C,this.index)}}update(e,r,c,p,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_x.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,c,p,h,m,x){for(let E of r)for(let D of E){let y=D.x,w=D.y;if(y<0||y>=at||w<0||w>=at)continue;if(m){let I=m.projectTilePoint(y,w,h),S=m.upVector(h,y,w),R=this.globeExtVertexArray;Ye(R,I,S),Ye(R,I,S),Ye(R,I,S),Ye(R,I,S)}let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=C.vertexLength;He(this.layoutVertexArray,y,w,-1,-1),He(this.layoutVertexArray,y,w,1,-1),He(this.layoutVertexArray,y,w,1,1),He(this.layoutVertexArray,y,w,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},p,h,x)}}function rt(l,e){for(let r=0;r<l.length;r++)if(oi(e,l[r]))return!0;for(let r=0;r<e.length;r++)if(oi(l,e[r]))return!0;return!!Mt(l,e)}function ft(l,e,r){return!!oi(l,e)||!!rn(e,l,r)}function Ot(l,e){if(l.length===1)return Yn(e,l[0]);for(let r=0;r<e.length;r++){let c=e[r];for(let p=0;p<c.length;p++)if(oi(l,c[p]))return!0}for(let r=0;r<l.length;r++)if(Yn(e,l[r]))return!0;for(let r=0;r<e.length;r++)if(Mt(l,e[r]))return!0;return!1}function _t(l,e,r){if(l.length>1){if(Mt(l,e))return!0;for(let c=0;c<e.length;c++)if(rn(e[c],l,r))return!0}for(let c=0;c<l.length;c++)if(rn(l[c],e,r))return!0;return!1}function Mt(l,e){if(l.length===0||e.length===0)return!1;for(let r=0;r<l.length-1;r++){let c=l[r],p=l[r+1];for(let h=0;h<e.length-1;h++)if(ln(c,p,e[h],e[h+1]))return!0}return!1}function ln(l,e,r,c){return jo(l,r,c)!==jo(e,r,c)&&jo(l,e,r)!==jo(l,e,c)}function rn(l,e,r){let c=r*r;if(e.length===1)return l.distSqr(e[0])<c;for(let p=1;p<e.length;p++)if(jn(l,e[p-1],e[p])<c)return!0;return!1}function jn(l,e,r){let c=e.distSqr(r);if(c===0)return l.distSqr(e);let p=((l.x-e.x)*(r.x-e.x)+(l.y-e.y)*(r.y-e.y))/c;return l.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function Yn(l,e){let r,c,p,h=!1;for(let m=0;m<l.length;m++){r=l[m];for(let x=0,E=r.length-1;x<r.length;E=x++)c=r[x],p=r[E],c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(h=!h)}return h}function oi(l,e){let r=!1;for(let c=0,p=l.length-1;c<l.length;p=c++){let h=l[c],m=l[p];h.y>e.y!=m.y>e.y&&e.x<(m.x-h.x)*(e.y-h.y)/(m.y-h.y)+h.x&&(r=!r)}return r}function ho(l,e,r,c,p){for(let m of l)if(e<=m.x&&r<=m.y&&c>=m.x&&p>=m.y)return!0;let h=[new st(e,r),new st(e,p),new st(c,p),new st(c,r)];if(l.length>2){for(let m of h)if(oi(l,m))return!0}for(let m=0;m<l.length-1;m++)if(Mi(l[m],l[m+1],h))return!0;return!1}function Mi(l,e,r){let c=r[0],p=r[2];if(l.x<c.x&&e.x<c.x||l.x>p.x&&e.x>p.x||l.y<c.y&&e.y<c.y||l.y>p.y&&e.y>p.y)return!1;let h=jo(l,e,r[0]);return h!==jo(l,e,r[1])||h!==jo(l,e,r[2])||h!==jo(l,e,r[3])}function gn(l,e,r,c,p,h){let m=e.y-l.y,x=l.x-e.x;if(h=h||0){let E=m*m+x*x;if(E===0)return!0;let D=Math.sqrt(E);m/=D,x/=D}return!((r.x-l.x)*m+(r.y-l.y)*x-h<0||(c.x-l.x)*m+(c.y-l.y)*x-h<0||(p.x-l.x)*m+(p.y-l.y)*x-h<0)}function qn(l,e,r,c,p,h,m){return!(gn(l,e,c,p,h,m)||gn(e,r,c,p,h,m)||gn(r,l,c,p,h,m)||gn(c,p,l,e,r,m)||gn(p,h,l,e,r,m)||gn(h,c,l,e,r,m))}function hi(l,e,r){let c=e.paint.get(l).value;return c.kind==="constant"?c.value:r.programConfigurations.get(e.id).getMaxValue(l)}function $n(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function on(l,e,r,c,p){if(!e[0]&&!e[1])return l;let h=st.convert(e)._mult(p);r==="viewport"&&h._rotate(-c);let m=[];for(let x=0;x<l.length;x++)m.push(l[x].sub(h));return m}function Mn(l,e,r,c){let p=st.convert(l)._mult(c);return e==="viewport"&&p._rotate(-r),p}let kn,bi;mt(Et,"CircleBucket",{omit:["layers"]});var Si,wn={exports:{}},$i=(Si||(Si=1,function(l,e){(function(r){function c(h,m,x){var E=p(256*h,256*(m=Math.pow(2,x)-m-1),x),D=p(256*(h+1),256*(m+1),x);return E[0]+","+E[1]+","+D[0]+","+D[1]}function p(h,m,x){var E=2*Math.PI*6378137/256/Math.pow(2,x);return[h*E-2*Math.PI*6378137/2,m*E-2*Math.PI*6378137/2]}r.getURL=function(h,m,x,E,D,y){return y=y||{},h+"?"+["bbox="+c(x,E,D),"format="+(y.format||"image/png"),"service="+(y.service||"WMS"),"version="+(y.version||"1.1.1"),"request="+(y.request||"GetMap"),"srs="+(y.srs||"EPSG:3857"),"width="+(y.width||256),"height="+(y.height||256),"layers="+m].join("&")},r.getTileBBox=c,r.getMercCoords=p,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,wn.exports)),wn.exports);class Zi{constructor(e,r,c){this.z=e,this.x=r,this.y=c,this.key=Ar(0,e,e,r,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let c=$i.getTileBBox(this.x,this.y,this.z),p=function(h,m,x){let E,D="";for(let y=h;y>0;y--)E=1<<y-1,D+=(m&E?1:0)+(x&E?2:0);return D}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gi{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ar(e,r.z,r.z,r.x,r.y)}}class ti{constructor(e,r,c,p,h){this.overscaledZ=e,this.wrap=r,this.canonical=new Zi(c,+p,+h),this.key=r===0&&e===c?this.canonical.key:Ar(r,e,c,p,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new ti(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ti(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ar(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let c=this.canonical.z-e;return Ar(this.wrap*+r,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ti(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new ti(r,this.wrap,r,c,p),new ti(r,this.wrap,r,c+1,p),new ti(r,this.wrap,r,c,p+1),new ti(r,this.wrap,r,c+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ti(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ti(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ar(l,e,r,c,p){let h=1<<Math.min(r,22),m=h*(p%h)+c%h;return l&&r<22&&(m+=h*h*((l<0?-2*l-1:2*l)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}let Pr=[l=>{let e=l.canonical.x-1,r=l.wrap;return e<0&&(e=(1<<l.canonical.z)-1,r--),new ti(l.overscaledZ,r,l.canonical.z,e,l.canonical.y)},l=>{let e=l.canonical.x+1,r=l.wrap;return e===1<<l.canonical.z&&(e=0,r++),new ti(l.overscaledZ,r,l.canonical.z,e,l.canonical.y)},l=>new ti(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new ti(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];mt(Zi,"CanonicalTileID"),mt(ti,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let fo=Dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:eo}=fo,jr=Dn([{name:"a_pos_3",components:3,type:"Int16"}]);var po=Dn([{name:"a_pos",type:"Int16",components:2}]);class bs{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,c){let p=be.vec3.dot(r,this.dir);if(Math.abs(p)<1e-6)return!1;let h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/p;return c[0]=this.pos[0]+this.dir[0]*h,c[1]=this.pos[1]+this.dir[1]*h,c[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,c){if(be.vec3.equals(this.pos,e)||r===0)return c[0]=c[1]=c[2]=0,!1;let[p,h,m]=this.dir,x=this.pos[0]-e[0],E=this.pos[1]-e[1],D=this.pos[2]-e[2],y=p*p+h*h+m*m,w=2*(x*p+E*h+D*m),C=w*w-4*y*(x*x+E*E+D*D-r*r);if(C<0){let T=Math.max(-w/2,0),I=x+p*T,S=E+h*T,R=D+m*T,F=Math.hypot(I,S,R);return c[0]=I*r/F,c[1]=S*r/F,c[2]=R*r/F,!1}{let T=(-w-Math.sqrt(C))/(2*y);if(T<0){let I=Math.hypot(x,E,D);return c[0]=x*r/I,c[1]=E*r/I,c[2]=D*r/I,!1}return c[0]=x+p*T,c[1]=E+h*T,c[2]=D+m*T,!0}}}class ra{constructor(e,r,c,p,h){this.TL=e,this.TR=r,this.BR=c,this.BL=p,this.horizon=h}static fromInvProjectionMatrix(e,r,c){let p=[-1,1,1],h=[1,1,1],m=[1,-1,1],x=[-1,-1,1],E=be.vec3.transformMat4(p,p,e),D=be.vec3.transformMat4(h,h,e),y=be.vec3.transformMat4(m,m,e),w=be.vec3.transformMat4(x,x,e);return new ra(E,D,y,w,r/c)}}function Yo(l,e,r){let c=1/0,p=-1/0,h=[];for(let m of l){be.vec3.sub(h,m,e);let x=be.vec3.dot(h,r);c=Math.min(c,x),p=Math.max(p,x)}return[c,p]}function Kl(l,e){let r=!0;for(let c=0;c<l.planes.length;c++){let p=l.planes[c],h=0;for(let m=0;m<e.length;m++)h+=be.vec3.dot(p,e[m])+p[3]>=0;if(h===0)return 0;h!==e.length&&(r=!1)}return r?2:1}function Jl(l,e){for(let r of l.projections){let c=Yo(e,l.points[0],r.axis);if(r.projection[1]<c[0]||r.projection[0]>c[1])return 0}return 1}function rd(l,e){let r=0,c=[0,0,0,0];for(let p=0;p<l.length;p++)c[0]=l[p][0],c[1]=l[p][1],c[2]=l[p][2],c[3]=1,be.vec4.dot(c,e)>=0&&r++;return r}class Ql{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ni.fromPoints(this.points),this.projections=[],this.frustumEdges=[be.vec3.sub([],this.points[2],this.points[3]),be.vec3.sub([],this.points[0],this.points[3]),be.vec3.sub([],this.points[4],this.points[0]),be.vec3.sub([],this.points[5],this.points[1]),be.vec3.sub([],this.points[6],this.points[2]),be.vec3.sub([],this.points[7],this.points[3])];for(let c of this.frustumEdges){let p=[0,-c[2],c[1]],h=[c[2],0,-c[0]];this.projections.push({axis:p,projection:Yo(this.points,this.points[0],p)}),this.projections.push({axis:h,projection:Yo(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,r,c,p){let h=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{let y=be.vec4.transformMat4([],D,e),w=1/y[3]/r*h;return be.vec4.mul(y,y,[w,w,p?1/y[3]:w,w])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{let y=be.vec3.sub([],m[D[0]],m[D[1]]),w=be.vec3.sub([],m[D[2]],m[D[1]]),C=be.vec3.normalize([],be.vec3.cross([],y,w)),T=-be.vec3.dot(C,m[D[1]]);return C.concat(T)}),E=[];for(let D=0;D<m.length;D++)E.push([m[D][0],m[D][1],m[D][2]]);return new Ql(E,x)}intersectsPrecise(e,r,c){for(let p=0;p<r.length;p++)if(!rd(e,r[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!rd(e,this.planes[p]))return 0;for(let p of c)for(let h of this.frustumEdges){let m=be.vec3.cross([],p,h),x=be.vec3.length(m);if(x===0)continue;be.vec3.scale(m,m,1/x);let E=Yo(this.points,this.points[0],m),D=Yo(e,this.points[0],m);if(E[0]>D[1]||D[0]>E[1])return 0}return 1}containsPoint(e){for(let r of this.planes){let c=r[3];if(be.vec3.dot([r[0],r[1],r[2]],e)+c<0)return!1}return!0}}class ni{static fromPoints(e){let r=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let p of e)be.vec3.min(r,r,p),be.vec3.max(c,c,p);return new ni(r,c)}static fromTileIdAndHeight(e,r,c){let p=1<<e.canonical.z,h=e.canonical.x,m=e.canonical.y;return new ni([h/p,m/p,r],[(h+1)/p,(m+1)/p,c])}static applyTransform(e,r){let c=e.getCorners();for(let p=0;p<c.length;++p)be.vec3.transformMat4(c[p],c[p],r);return ni.fromPoints(c)}static applyTransformFast(e,r){let c=[r[12],r[13],r[14]],p=[...c];for(let h=0;h<3;h++)for(let m=0;m<3;m++){let x=r[4*m+h],E=x*e.min[m],D=x*e.max[m];c[h]+=Math.min(E,D),p[h]+=Math.max(E,D)}return new ni(c,p)}static projectAabbCorners(e,r){let c=e.getCorners();for(let p=0;p<c.length;++p)be.vec3.transformMat4(c[p],c[p],r);return c}constructor(e,r){this.min=e,this.max=r,this.center=be.vec3.scale([],be.vec3.add([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],c=be.vec3.clone(this.min),p=be.vec3.clone(this.max);for(let h=0;h<r.length;h++)c[h]=r[h]?this.min[h]:this.center[h],p[h]=r[h]?this.center[h]:this.max[h];return p[2]=this.max[2],new ni(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Kl(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Kl(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Jl(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Jl(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function $a(l){return l*t/N}mt(ni,"Aabb");let Ix=[new ni([M,M,M],[A,A,A]),new ni([M,M,M],[0,0,A]),new ni([0,M,M],[A,0,A]),new ni([M,0,M],[0,A,A]),new ni([0,0,M],[A,A,A])];function __(l,e,r,c=!0){let p=be.vec3.scale([],l._camera.position,l.worldSize),h=[e,r,1,1];be.vec4.transformMat4(h,h,l.pixelMatrixInverse),be.vec4.scale(h,h,1/h[3]);let m=be.vec3.sub([],h,p),x=be.vec3.normalize([],m),E=l.globeMatrix,D=[E[12],E[13],E[14]],y=be.vec3.sub([],D,p),w=be.vec3.length(y),C=be.vec3.normalize([],y),T=l.worldSize/(2*Math.PI),I=be.vec3.dot(C,x),S=Math.asin(T/w);if(S<Math.acos(I)){if(!c)return null;let ue=[],se=[];be.vec3.scale(ue,x,w/I),be.vec3.normalize(se,be.vec3.sub(se,ue,y)),be.vec3.normalize(x,be.vec3.add(x,y,be.vec3.scale(x,se,Math.tan(S)*w)))}let R=[];new bs(p,x).closestPointOnSphere(D,T,R);let F=be.vec3.normalize([],Sa(E,0)),B=be.vec3.normalize([],Sa(E,1)),U=be.vec3.normalize([],Sa(E,2)),k=be.vec3.dot(F,R),G=be.vec3.dot(B,R),H=be.vec3.dot(U,R),K=Ki(Math.asin(-G/T)),te=Ki(Math.atan2(k,H));te=l.center.lng+function(ue,se){let de=(se-ue+180)%360-180;return de<-180?de+360:de}(l.center.lng,te);let ie=ne(te),Q=Qt(oe(K),0,1);return new Me(ie,Q)}class PO{constructor(e,r,c){this.a=be.vec3.sub([],e,c),this.b=be.vec3.sub([],r,c),this.center=c;let p=be.vec3.normalize([],this.a),h=be.vec3.normalize([],this.b);this.angle=Math.acos(be.vec3.dot(p,h))}}function Cx(l,e){if(l.angle===0)return null;let r;return r=l.a[e]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[e]/l.a[e]/Math.sin(l.angle)-1/Math.tan(l.angle)),r<0||r>1?null:function(c,p,h,m){let x=Math.sin(h);return c*(Math.sin((1-m)*h)/x)+p*(Math.sin(m*h)/x)}(l.a[e],l.b[e],l.angle,Qt(r,0,1))+l.center[e]}function oa(l){if(l.z<=1)return Ix[l.z+2*l.y+l.x];let e=Dx(y_(l));return ni.fromPoints(e)}function Ga(l,e,r){return be.vec3.scale(l,l,1-r),be.vec3.scaleAndAdd(l,l,e,r)}function KE(l,e,r){for(let c of l)be.vec3.transformMat4(c,c,e),be.vec3.scale(c,c,r)}function JE(l,e,r,c){let p=e/l.worldSize,h=l.globeMatrix;if(r.z<=1){let ie=oa(r).getCorners();return KE(ie,h,p),ni.fromPoints(ie)}let m=y_(r,c),x=Dx(m,t+$a(l._tileCoverLift));KE(x,h,p);let E=Number.MAX_VALUE,D=[-E,-E,-E],y=[E,E,E];if(m.contains(l.center)){for(let ue of x)be.vec3.min(y,y,ue),be.vec3.max(D,D,ue);D[2]=0;let ie=l.point,Q=[ie.x*p,ie.y*p,0];return be.vec3.min(y,y,Q),be.vec3.max(D,D,Q),new ni(y,D)}if(l._tileCoverLift>0){for(let ie of x)be.vec3.min(y,y,ie),be.vec3.max(D,D,ie);return new ni(y,D)}let w=[h[12]*p,h[13]*p,h[14]*p],C=m.getCenter(),T=Qt(l.center.lat,-he,he),I=Qt(C.lat,-he,he),S=ne(l.center.lng),R=oe(T),F=S-ne(C.lng),B=R-oe(I);F>.5?F-=1:F<-.5&&(F+=1);let U=0;if(Math.abs(F)>Math.abs(B))U=F>=0?1:3;else{U=B>=0?0:2;let ie=[h[4]*p,h[5]*p,h[6]*p],Q=-Math.sin(_n(B>=0?m.getSouth():m.getNorth()))*t;be.vec3.scaleAndAdd(w,w,ie,Q)}let k=x[U],G=x[(U+1)%4],H=new PO(k,G,w),K=[Cx(H,0)||k[0],Cx(H,1)||k[1],Cx(H,2)||k[2]],te=ec(l.zoom);if(te>0){let ie=function({x:ue,y:se,z:de},ve,Te,Ee,Ie){let Oe=1/(1<<de),De=ue*Oe,je=De+Oe,We=se*Oe,Ne=We+Oe,ut=0,ot=(De+je)/2-Ee;return ot>.5?ut=-1:ot<-.5&&(ut=1),De=((De+ut)*ve-(Ee*=ve))*Te+Ee,je=((je+ut)*ve-Ee)*Te+Ee,We=(We*ve-(Ie*=ve))*Te+Ie,Ne=(Ne*ve-Ie)*Te+Ie,[[De,Ne,0],[je,Ne,0],[je,We,0],[De,We,0]]}(r,e,l._pixelsPerMercatorPixel,S,R);for(let ue=0;ue<x.length;ue++)Ga(x[ue],ie[ue],te);let Q=be.vec3.add([],ie[U],ie[(U+1)%4]);be.vec3.scale(Q,Q,.5),Ga(K,Q,te)}for(let ie of x)be.vec3.min(y,y,ie),be.vec3.max(D,D,ie);return y[2]=Math.min(k[2],G[2]),be.vec3.min(y,y,K),be.vec3.max(D,D,K),new ni(y,D)}function y_({x:l,y:e,z:r},c=!1){let p=1/(1<<r),h=new j(le(l*p),e===(1<<r)-1&&c?-90:ae((e+1)*p)),m=new j(le((l+1)*p),e===0&&c?90:ae(e*p));return new q(h,m)}function Dx(l,e=t){let r=_n(l.getNorth()),c=_n(l.getSouth()),p=Math.cos(r),h=Math.cos(c),m=Math.sin(r),x=Math.sin(c),E=l.getWest(),D=l.getEast();return[O(h,x,E,e),O(h,x,D,e),O(p,m,D,e),O(p,m,E,e)]}function Dp(l,e,r,c){let p=1<<r.z,h=(l/at+r.x)/p;return L(ae((e/at+r.y)/p),le(h),c)}function v_({min:l,max:e}){return g/Math.max(e[0]-l[0],e[1]-l[1],e[2]-l[2])}let QE=new Float64Array(16);function x_(l){let e=v_(l),r=be.mat4.fromScaling(QE,[e,e,e]);return be.mat4.translate(r,r,be.vec3.negate([],l.min))}function Mx(l){let e=be.mat4.fromTranslation(QE,l.min),r=1/v_(l);return be.mat4.scale(e,e,[r,r,r])}function Sx(l){let e=at/(2*Math.PI);return l/(2*Math.PI)/e}function eI(l,e){return at/(512*Math.pow(2,l))*v_(oa(e))}function tI(l,e,r,c,p){let h=Sx(r),m=[l,e,-r/(2*Math.PI)],x=be.mat4.identity(new Float64Array(16));return be.mat4.translate(x,x,m),be.mat4.scale(x,x,[h,h,h]),be.mat4.rotateX(x,x,_n(-p)),be.mat4.rotateY(x,x,_n(-c)),x}function ec(l){return dl(a,f,l)}function nI(l,e){let r=L(e.lat,e.lng),c=function(h){let m=L(h._center.lat,h._center.lng),x=be.vec3.fromValues(0,1,0),E=be.vec3.cross([],x,m),D=be.mat4.fromRotation([],-h.angle,m);E=be.vec3.transformMat4(E,E,D),be.mat4.fromRotation(D,-h._pitch,E);let y=be.vec3.normalize([],m);return be.vec3.scale(y,y,$a(h.cameraToCenterDistance/h.pixelsPerMeter)),be.vec3.transformMat4(y,y,D),be.vec3.add([],m,y)}(l),p=be.vec3.subtract([],c,r);return be.vec3.angle(p,r)}function Ax(l,e){return nI(l,e)>Math.PI/2*1.01}let iI=_n(85),RO=Math.cos(iI),OO=Math.sin(iI),LO=be.mat4.create(),rI=l=>{let e=[];return l.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function oI(l,e,r,c,p,h,m,x,E){if(h&&l.queryGeometry.isAboveHorizon)return!1;h&&(E*=l.pixelToTileUnitsFactor);let D=l.tileID.canonical,y=r.projection.upVectorScale(D,r.center.lat,r.worldSize).metersToTile;for(let w of e)for(let C of w){let T=C.add(x),I=p&&r.elevation?r.elevation.exaggeration()*p.getElevationAt(T.x,T.y,!0):0,S=r.projection.projectTilePoint(T.x,T.y,D);if(I>0){let U=r.projection.upVector(D,T.x,T.y);S.x+=U[0]*y*I,S.y+=U[1]*y*I,S.z+=U[2]*y*I}let R=h?T:FO(S.x,S.y,S.z,c),F=h?l.tilespaceRays.map(U=>NO(U,I)):l.queryGeometry.screenGeometry,B=be.vec4.transformMat4([],[S.x,S.y,S.z,1],c);if(!m&&h?E*=B[3]/r.cameraToCenterDistance:m&&!h&&(E*=r.cameraToCenterDistance/B[3]),h){let U=ae((C.y/at+D.y)/(1<<D.z));E/=r.projection.pixelsPerMeter(U,1)/ee(1,U)}if(ft(F,R,E))return!0}return!1}function FO(l,e,r,c){let p=be.vec4.transformMat4([],[l,e,r,1],c);return new st(p[0]/p[3],p[1]/p[3])}let sI=be.vec3.fromValues(0,0,0),kO=be.vec3.fromValues(0,0,1);function NO(l,e){let r=be.vec3.create();return sI[2]=e,l.intersectsPlane(sI,kO,r),new st(r[0],r[1])}class aI extends Et{}let lI,cI,uI,hI;function dI(l,{width:e,height:r},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*r*c);return l.width=e,l.height=r,l.data=p,l}function fI(l,e,r){let{width:c,height:p}=e;c===l.width&&p===l.height||(Px(l,e,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,p)},r,null),l.width=c,l.height=p,l.data=e.data)}function Px(l,e,r,c,p,h,m,x){if(p.width===0||p.height===0)return e;if(p.width>l.width||p.height>l.height||r.x>l.width-p.width||r.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||c.x>e.width-p.width||c.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let E=l.data,D=e.data,y=h===4&&x;for(let w=0;w<p.height;w++){let C=((r.y+w)*l.width+r.x)*h,T=((c.y+w)*e.width+c.x)*h;if(y)for(let I=0;I<p.width;I++){let S=C+I*h+3,R=T+I*h;D[R+0]=255,D[R+1]=255,D[R+2]=255,D[R+3]=E[S]}else if(m)for(let I=0;I<p.width;I++){let S=C+I*h,R=T+I*h,F=E[S+3],B=new Fn(E[S+0]/255*F,E[S+1]/255*F,E[S+2]/255*F,F).toRenderColor(m).toArray();D[R+0]=B[0],D[R+1]=B[1],D[R+2]=B[2],D[R+3]=B[3]}else for(let I=0;I<p.width*h;I++)D[T+I]=E[C+I]}return e}mt(aI,"HeatmapBucket",{omit:["layers"]});class tc{constructor(e,r){dI(this,e,1,r)}resize(e){fI(this,new tc(e),1)}clone(){return new tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,c,p,h){Px(e,r,c,p,h,1,null)}}class Rr{constructor(e,r){dI(this,e,4,r)}resize(e){fI(this,new Rr(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Rr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,c,p,h,m,x){Px(e,r,c,p,h,4,m,x)}}class pI{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Mp(l){let e={},r=l.resolution||256,c=l.clips?l.clips.length:1,p=l.image||new Rr({width:r,height:c}),h=(m,x,E)=>{e[l.evaluationKey]=E;let D=l.expression.evaluate(e);D&&(p.data[m+x+0]=Math.floor(255*D.r/D.a),p.data[m+x+1]=Math.floor(255*D.g/D.a),p.data[m+x+2]=Math.floor(255*D.b/D.a),p.data[m+x+3]=Math.floor(255*D.a))};if(l.clips)for(let m=0,x=0;m<c;++m,x+=4*r)for(let E=0,D=0;E<r;E++,D+=4){let y=E/(r-1),{start:w,end:C}=l.clips[m];h(x,D,w*(1-y)+C*y)}else for(let m=0,x=0;m<r;m++,x+=4)h(0,x,m/(r-1));return p}mt(tc,"AlphaImage"),mt(Rr,"RGBAImage");let zO=Dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:BO}=zO;function Sp(l,e,r=2){let c=e&&e.length,p=c?e[0]*r:l.length,h=mI(l,0,p,r,!0),m=[];if(!h||h.next===h.prev)return m;let x,E,D;if(c&&(h=function(y,w,C,T){let I=[];for(let S=0,R=w.length;S<R;S++){let F=mI(y,w[S]*T,S<R-1?w[S+1]*T:y.length,T,!1);F===F.next&&(F.steiner=!0),I.push(WO(F))}I.sort(GO);for(let S=0;S<I.length;S++)C=HO(I[S],C);return C}(l,e,h,r)),l.length>80*r){x=1/0,E=1/0;let y=-1/0,w=-1/0;for(let C=r;C<p;C+=r){let T=l[C],I=l[C+1];T<x&&(x=T),I<E&&(E=I),T>y&&(y=T),I>w&&(w=I)}D=Math.max(y-x,w-E),D=D!==0?32767/D:0}return Ap(h,m,r,x,E,D,0),m}function mI(l,e,r,c,p){let h;if(p===function(m,x,E,D){let y=0;for(let w=x,C=E-D;w<E;w+=D)y+=(m[C]-m[w])*(m[w+1]+m[C+1]),C=w;return y}(l,e,r,c)>0)for(let m=e;m<r;m+=c)h=yI(m/c|0,l[m],l[m+1],h);else for(let m=r-c;m>=e;m-=c)h=yI(m/c|0,l[m],l[m+1],h);return h&&b_(h,h.next)&&(Rp(h),h=h.next),h}function Eu(l,e){if(!l)return l;e||(e=l);let r,c=l;do if(r=!1,c.steiner||!b_(c,c.next)&&Hi(c.prev,c,c.next)!==0)c=c.next;else{if(Rp(c),c=e=c.prev,c===c.next)break;r=!0}while(r||c!==e);return e}function Ap(l,e,r,c,p,h,m){if(!l)return;!m&&h&&function(E,D,y,w){let C=E;do C.z===0&&(C.z=Rx(C.x,C.y,D,y,w)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==E);C.prevZ.nextZ=null,C.prevZ=null,function(T){let I,S=1;do{let R,F=T;T=null;let B=null;for(I=0;F;){I++;let U=F,k=0;for(let H=0;H<S&&(k++,U=U.nextZ,U);H++);let G=S;for(;k>0||G>0&&U;)k!==0&&(G===0||!U||F.z<=U.z)?(R=F,F=F.nextZ,k--):(R=U,U=U.nextZ,G--),B?B.nextZ=R:T=R,R.prevZ=B,B=R;F=U}B.nextZ=null,S*=2}while(I>1)}(C)}(l,c,p,h);let x=l;for(;l.prev!==l.next;){let E=l.prev,D=l.next;if(h?jO(l,c,p,h):VO(l))e.push(E.i,l.i,D.i),Rp(l),l=D.next,x=D.next;else if((l=D)===x){m?m===1?Ap(l=UO(Eu(l),e),e,r,c,p,h,2):m===2&&$O(l,e,r,c,p,h):Ap(Eu(l),e,r,c,p,h,1);break}}}function VO(l){let e=l.prev,r=l,c=l.next;if(Hi(e,r,c)>=0)return!1;let p=e.x,h=r.x,m=c.x,x=e.y,E=r.y,D=c.y,y=p<h?p<m?p:m:h<m?h:m,w=x<E?x<D?x:D:E<D?E:D,C=p>h?p>m?p:m:h>m?h:m,T=x>E?x>D?x:D:E>D?E:D,I=c.next;for(;I!==e;){if(I.x>=y&&I.x<=C&&I.y>=w&&I.y<=T&&od(p,x,h,E,m,D,I.x,I.y)&&Hi(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function jO(l,e,r,c){let p=l.prev,h=l,m=l.next;if(Hi(p,h,m)>=0)return!1;let x=p.x,E=h.x,D=m.x,y=p.y,w=h.y,C=m.y,T=x<E?x<D?x:D:E<D?E:D,I=y<w?y<C?y:C:w<C?w:C,S=x>E?x>D?x:D:E>D?E:D,R=y>w?y>C?y:C:w>C?w:C,F=Rx(T,I,e,r,c),B=Rx(S,R,e,r,c),U=l.prevZ,k=l.nextZ;for(;U&&U.z>=F&&k&&k.z<=B;){if(U.x>=T&&U.x<=S&&U.y>=I&&U.y<=R&&U!==p&&U!==m&&od(x,y,E,w,D,C,U.x,U.y)&&Hi(U.prev,U,U.next)>=0||(U=U.prevZ,k.x>=T&&k.x<=S&&k.y>=I&&k.y<=R&&k!==p&&k!==m&&od(x,y,E,w,D,C,k.x,k.y)&&Hi(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;U&&U.z>=F;){if(U.x>=T&&U.x<=S&&U.y>=I&&U.y<=R&&U!==p&&U!==m&&od(x,y,E,w,D,C,U.x,U.y)&&Hi(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;k&&k.z<=B;){if(k.x>=T&&k.x<=S&&k.y>=I&&k.y<=R&&k!==p&&k!==m&&od(x,y,E,w,D,C,k.x,k.y)&&Hi(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function UO(l,e){let r=l;do{let c=r.prev,p=r.next.next;!b_(c,p)&&gI(c,r,r.next,p)&&Pp(c,p)&&Pp(p,c)&&(e.push(c.i,r.i,p.i),Rp(r),Rp(r.next),r=l=p),r=r.next}while(r!==l);return Eu(r)}function $O(l,e,r,c,p,h){let m=l;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&ZO(m,x)){let E=_I(m,x);return m=Eu(m,m.next),E=Eu(E,E.next),Ap(m,e,r,c,p,h,0),void Ap(E,e,r,c,p,h,0)}x=x.next}m=m.next}while(m!==l)}function GO(l,e){return l.x-e.x}function HO(l,e){let r=function(p,h){let m=h,x=p.x,E=p.y,D,y=-1/0;do{if(E<=m.y&&E>=m.next.y&&m.next.y!==m.y){let S=m.x+(E-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(S<=x&&S>y&&(y=S,D=m.x<m.next.x?m:m.next,S===x))return D}m=m.next}while(m!==h);if(!D)return null;let w=D,C=D.x,T=D.y,I=1/0;m=D;do{if(x>=m.x&&m.x>=C&&x!==m.x&&od(E<T?x:y,E,C,T,E<T?y:x,E,m.x,m.y)){let S=Math.abs(E-m.y)/(x-m.x);Pp(m,p)&&(S<I||S===I&&(m.x>D.x||m.x===D.x&&qO(D,m)))&&(D=m,I=S)}m=m.next}while(m!==w);return D}(l,e);if(!r)return e;let c=_I(r,l);return Eu(c,c.next),Eu(r,r.next)}function qO(l,e){return Hi(l.prev,l,e.prev)<0&&Hi(e.next,l,l.next)<0}function Rx(l,e,r,c,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-r)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function WO(l){let e=l,r=l;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==l);return r}function od(l,e,r,c,p,h,m,x){return(p-m)*(e-x)>=(l-m)*(h-x)&&(l-m)*(c-x)>=(r-m)*(e-x)&&(r-m)*(h-x)>=(p-m)*(c-x)}function ZO(l,e){return l.next.i!==e.i&&l.prev.i!==e.i&&!function(r,c){let p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==c.i&&p.next.i!==c.i&&gI(p,p.next,r,c))return!0;p=p.next}while(p!==r);return!1}(l,e)&&(Pp(l,e)&&Pp(e,l)&&function(r,c){let p=r,h=!1,m=(r.x+c.x)/2,x=(r.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&m<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(h=!h),p=p.next;while(p!==r);return h}(l,e)&&(Hi(l.prev,l,e.prev)||Hi(l,e.prev,e))||b_(l,e)&&Hi(l.prev,l,l.next)>0&&Hi(e.prev,e,e.next)>0)}function Hi(l,e,r){return(e.y-l.y)*(r.x-e.x)-(e.x-l.x)*(r.y-e.y)}function b_(l,e){return l.x===e.x&&l.y===e.y}function gI(l,e,r,c){let p=T_(Hi(l,e,r)),h=T_(Hi(l,e,c)),m=T_(Hi(r,c,l)),x=T_(Hi(r,c,e));return p!==h&&m!==x||!(p!==0||!w_(l,r,e))||!(h!==0||!w_(l,c,e))||!(m!==0||!w_(r,l,c))||!(x!==0||!w_(r,e,c))}function w_(l,e,r){return e.x<=Math.max(l.x,r.x)&&e.x>=Math.min(l.x,r.x)&&e.y<=Math.max(l.y,r.y)&&e.y>=Math.min(l.y,r.y)}function T_(l){return l>0?1:l<0?-1:0}function Pp(l,e){return Hi(l.prev,l,l.next)<0?Hi(l,e,l.next)>=0&&Hi(l,l.prev,e)>=0:Hi(l,e,l.prev)<0||Hi(l,l.next,e)<0}function _I(l,e){let r=Ox(l.i,l.x,l.y),c=Ox(e.i,e.x,e.y),p=l.next,h=e.prev;return l.next=e,e.prev=l,r.next=p,p.prev=r,c.next=r,r.prev=c,h.next=c,c.prev=h,c}function yI(l,e,r,c){let p=Ox(l,e,r);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Rp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Ox(l,e,r){return{i:l,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E_(l,e){let r=l.length;if(r<=1)return[l];let c=[],p,h;for(let m=0;m<r;m++){let x=rh(l[m]);x!==0&&(l[m].area=Math.abs(x),h===void 0&&(h=x<0),h===x<0?(p&&c.push(p),p=[l[m]]):p.push(l[m]))}if(p&&c.push(p),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(vg(c[m],e,1,c[m].length-1,XO),c[m]=c[m].slice(0,e));return c}function XO(l,e){return e.area-l.area}function Lx(l,e,r){let c=r.patternDependencies,p=!1;for(let h of e){let m=h.paint.get(`${l}-pattern`);m.isConstant()||(p=!0);let x=m.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function Fx(l,e,r,c,p){let h=p.patternDependencies;for(let m of e){let x=m.paint.get(`${l}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:c},r,{},p.availableImages);E=E&&E.name?E.name:E,h[E]=!0,r.patterns[m.id]=E}}return r}class kx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qs,this.indexArray=new rr,this.indexArray2=new na,this.programConfigurations=new ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new xi,this.segments2=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,c,p){this.hasPattern=Lx("fill",this.layers,r);let h=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:x,id:E,index:D,sourceLayerIndex:y}of e){let w=this.layers[0]._featureFilter.needGeometry,C=nt(x,w);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),C,c))continue;let T=h?h.evaluate(C,{},c,r.availableImages):void 0,I={id:E,properties:x.properties,type:x.type,sourceLayerIndex:y,index:D,geometry:w?C.geometry:et(x,c,p),patterns:{},sortKey:T};m.push(I)}h&&m.sort((x,E)=>x.sortKey-E.sortKey);for(let x of m){let{geometry:E,index:D,sourceLayerIndex:y}=x;if(this.hasPattern){let w=Fx("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(w)}else this.addFeature(x,E,D,c,{},r.availableImages,r.brightness);r.featureIndex.insert(e[D].feature,E,D,y,this.index)}}update(e,r,c,p,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(e,r,c,p,h,m){for(let x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,c,p,h,m=[],x){for(let E of E_(r,500)){let D=0;for(let S of E)D+=S.length;let y=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),w=y.vertexLength,C=[],T=[];for(let S of E){if(S.length===0)continue;S!==E[0]&&T.push(C.length/2);let R=this.segments2.prepareSegment(S.length,this.layoutVertexArray,this.indexArray2),F=R.vertexLength;this.layoutVertexArray.emplaceBack(S[0].x,S[0].y),this.indexArray2.emplaceBack(F+S.length-1,F),C.push(S[0].x),C.push(S[0].y);for(let B=1;B<S.length;B++)this.layoutVertexArray.emplaceBack(S[B].x,S[B].y),this.indexArray2.emplaceBack(F+B-1,F+B),C.push(S[B].x),C.push(S[B].y);R.vertexLength+=S.length,R.primitiveLength+=S.length}let I=Sp(C,T);for(let S=0;S<I.length;S+=3)this.indexArray.emplaceBack(w+I[S],w+I[S+1],w+I[S+2]);y.vertexLength+=D,y.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,h,m,p,x)}}let vI,xI,bI,wI;mt(kx,"FillBucket",{omit:["layers","patternFeatures"]});class Nx{constructor(e,r,c,p){if(this.triangleCount=r.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[h,m]=[e[0].clone(),e[0].clone()];for(let w=1;w<e.length;++w){let C=e[w];h.x=Math.min(h.x,C.x),h.y=Math.min(h.y,C.y),m.x=Math.max(m.x,C.x),m.y=Math.max(m.y,C.y)}if(p){let w=Math.ceil(Math.max(m.x-h.x,m.y-h.y)/p);c=Math.max(c,w)}if(c===0)return;this.min=h,this.max=m;let x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);let E=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/E)),this.cellsY=Math.max(1,Math.ceil(x.y/E)),this.xScale=1/E,this.yScale=1/E;let D=[];for(let w=0;w<this.triangleCount;w++){let C=e[r[3*w+0]].sub(this.min),T=e[r[3*w+1]].sub(this.min),I=e[r[3*w+2]].sub(this.min),S=sa(Math.floor(Math.min(C.x,T.x,I.x)),this.xScale,this.cellsX),R=sa(Math.floor(Math.max(C.x,T.x,I.x)),this.xScale,this.cellsX),F=sa(Math.floor(Math.min(C.y,T.y,I.y)),this.yScale,this.cellsY),B=sa(Math.floor(Math.max(C.y,T.y,I.y)),this.yScale,this.cellsY),U=new st(0,0),k=new st(0,0),G=new st(0,0),H=new st(0,0);for(let K=F;K<=B;++K){U.y=k.y=K*E,G.y=H.y=(K+1)*E;for(let te=S;te<=R;++te)U.x=G.x=te*E,k.x=H.x=(te+1)*E,(qn(C,T,I,U,k,H)||qn(C,T,I,U,H,G))&&D.push({cellIdx:K*this.cellsX+te,triIdx:w})}}if(D.length===0)return;D.sort((w,C)=>w.cellIdx-C.cellIdx||w.triIdx-C.triIdx);let y=0;for(;y<D.length;){let w=D[y].cellIdx,C={start:this.payload.length,len:0};for(;y<D.length&&D[y].cellIdx===w;)++C.len,this.payload.push(D[y++].triIdx);this.cells[w]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let c=sa(e.x-this.min.x,this.xScale,this.cellsX),p=sa(e.y-this.min.y,this.yScale,this.cellsY),h=this.cells[p*this.cellsX+c];if(h){this._lazyInitLookup();for(let m=0;m<h.len;m++){let x=this.payload[h.start+m],E=Math.floor(x/8),D=1<<x%8;if(!(this.lookup[E]&D)&&(this.lookup[E]|=D,r.push(x),r.length===this.triangleCount))return}}}query(e,r,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();let p=sa(e.x-this.min.x,this.xScale,this.cellsX),h=sa(r.x-this.min.x,this.xScale,this.cellsX),m=sa(e.y-this.min.y,this.yScale,this.cellsY),x=sa(r.y-this.min.y,this.yScale,this.cellsY);for(let E=m;E<=x;E++)for(let D=p;D<=h;D++){let y=this.cells[E*this.cellsX+D];if(y)for(let w=0;w<y.len;w++){let C=this.payload[y.start+w],T=Math.floor(C/8),I=1<<C%8;if(!(this.lookup[T]&I)&&(this.lookup[T]|=I,c.push(C),c.length===this.triangleCount))return}}}}function sa(l,e,r){return Math.max(0,Math.min(r-1,Math.floor(l*e)))}mt(Nx,"TriangleGridIndex");class TI{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(let c of this.footprints)r.push({footprint:c,id:e})}populate(e,r,c,p){let h=[];for(let{feature:m,id:x,index:E,sourceLayerIndex:D}of e){let y=this.layers[0]._featureFilter.needGeometry,w=nt(m,y);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),w,c))continue;let C={id:x,properties:m.properties,type:m.type,sourceLayerIndex:D,index:E,geometry:y?w.geometry:et(m,c,p),patterns:{}};h.push(C)}for(let m of h){let{geometry:x,index:E,sourceLayerIndex:D}=m;this.addFeature(m,x,E,c,{},r.availableImages,r.brightness),r.featureIndex.insert(e[E].feature,x,E,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,c,p,h){}destroy(){}addFeature(e,r,c,p,h,m=[],x){for(let E of E_(r,2)){let D=[],y=[],w=[],C=new st(1/0,1/0),T=new st(-1/0,-1/0);for(let R of E)if(R.length!==0){R!==E[0]&&w.push(y.length/2);for(let F=0;F<R.length;F++)y.push(R[F].x),y.push(R[F].y),D.push(R[F]),C.x=Math.min(C.x,R[F].x),C.y=Math.min(C.y,R[F].y),T.x=Math.max(T.x,R[F].x),T.y=Math.max(T.y,R[F].y)}let I=Sp(y,w),S=new Nx(D,I,8,256);this.footprints.push({vertices:D,indices:I,grid:S,min:C,max:T})}}}mt(TI,"ClipBucket",{omit:["layers"]});let YO=Dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),KO=Dn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),JO=Dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),QO=Dn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),eL=Dn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tL=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nL}=YO;var zx,EI,Bx,II,Vx,CI,DI,I_={};function MI(){if(EI)return zx;EI=1;var l=Bc();function e(p,h,m,x,E){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=x,this._values=E,p.readFields(r,this,h)}function r(p,h,m){p==1?h.id=m.readVarint():p==2?function(x,E){for(var D=x.readVarint()+x.pos;x.pos<D;){var y=E._keys[x.readVarint()],w=E._values[x.readVarint()];E.properties[y]=w}}(m,h):p==3?h.type=m.readVarint():p==4&&(h._geometry=m.pos)}function c(p){for(var h,m,x=0,E=0,D=p.length,y=D-1;E<D;y=E++)x+=((m=p[y]).x-(h=p[E]).x)*(h.y+m.y);return x}return zx=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var h,m=p.readVarint()+p.pos,x=1,E=0,D=0,y=0,w=[];p.pos<m;){if(E<=0){var C=p.readVarint();x=7&C,E=C>>3}if(E--,x===1||x===2)D+=p.readSVarint(),y+=p.readSVarint(),x===1&&(h&&w.push(h),h=[]),h.push(new l(D,y));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&w.push(h),w},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var h=p.readVarint()+p.pos,m=1,x=0,E=0,D=0,y=1/0,w=-1/0,C=1/0,T=-1/0;p.pos<h;){if(x<=0){var I=p.readVarint();m=7&I,x=I>>3}if(x--,m===1||m===2)(E+=p.readSVarint())<y&&(y=E),E>w&&(w=E),(D+=p.readSVarint())<C&&(C=D),D>T&&(T=D);else if(m!==7)throw new Error("unknown command "+m)}return[y,C,w,T]},e.prototype.toGeoJSON=function(p,h,m){var x,E,D=this.extent*Math.pow(2,m),y=this.extent*p,w=this.extent*h,C=this.loadGeometry(),T=e.types[this.type];function I(F){for(var B=0;B<F.length;B++){var U=F[B];F[B]=[360*(U.x+y)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+w)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(x=0;x<C.length;x++)S[x]=C[x][0];I(C=S);break;case 2:for(x=0;x<C.length;x++)I(C[x]);break;case 3:for(C=function(F){var B=F.length;if(B<=1)return[F];for(var U,k,G=[],H=0;H<B;H++){var K=c(F[H]);K!==0&&(k===void 0&&(k=K<0),k===K<0?(U&&G.push(U),U=[F[H]]):U.push(F[H]))}return U&&G.push(U),G}(C),x=0;x<C.length;x++)for(E=0;E<C[x].length;E++)I(C[x][E])}C.length===1?C=C[0]:T="Multi"+T;var R={type:"Feature",geometry:{type:T,coordinates:C},properties:this.properties};return"id"in this&&(R.id=this.id),R},zx}function SI(){if(II)return Bx;II=1;var l=MI();function e(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(r,this,p),this.length=this._features.length}function r(c,p,h){c===15?p.version=h.readVarint():c===1?p.name=h.readString():c===5?p.extent=h.readVarint():c===2?p._features.push(h.pos):c===3?p._keys.push(h.readString()):c===4&&p._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var D=m.readVarint()>>3;x=D===1?m.readString():D===2?m.readFloat():D===3?m.readDouble():D===4?m.readVarint64():D===5?m.readVarint():D===6?m.readSVarint():D===7?m.readBoolean():null}return x}(h))}return Bx=e,e.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},Bx}function AI(){return DI||(DI=1,I_.VectorTile=function(){if(CI)return Vx;CI=1;var l=SI();function e(r,c,p){if(r===3){var h=new l(p,p.readVarint()+p.pos);h.length&&(c[h.name]=h)}}return Vx=function(r,c){this.layers=r.readFields(e,{},c)},Vx}(),I_.VectorTileFeature=MI(),I_.VectorTileLayer=SI()),I_}var sd=AI();class Iu extends st{constructor(e,r,c){super(e,r),this.z=c}}class PI extends Iu{constructor(e,r,c,p){super(e,r,c),this.w=p}}function C_(l,e,r,c){let p=[],h=c===0?(m,x,E,D,y,w)=>{m.push(new st(w,E+(w-x)/(D-x)*(y-E)))}:(m,x,E,D,y,w)=>{m.push(new st(x+(w-E)/(y-E)*(D-x),w))};for(let m of l){let x=[];for(let E of m){if(E.length<=2)continue;let D=[];for(let C=0;C<E.length-1;C++){let T=E[C].x,I=E[C].y,S=E[C+1].x,R=E[C+1].y,F=c===0?T:I,B=c===0?S:R;F<e?B>e&&h(D,T,I,S,R,e):F>r?B<r&&h(D,T,I,S,R,r):D.push(E[C]),B<e&&F>=e&&h(D,T,I,S,R,e),B>r&&F<=r&&h(D,T,I,S,R,r)}let y=E[E.length-1],w=c===0?y.x:y.y;w>=e&&w<=r&&D.push(y),D.length&&(y=D[D.length-1],D[0].x===y.x&&D[0].y===y.y||D.push(D[0]),x.push(D))}x.length&&p.push(x)}return p}function RI(l,e,r,c){let p=r==="x"?"y":"x",h=(c-l[r])/(e[r]-l[r]);l[p]=l[p]+(e[p]-l[p])*h,l[r]=c,l.hasOwnProperty("z")&&(l.z=Pt(l.z,e.z,h)),l.hasOwnProperty("w")&&(l.w=Pt(l.w,e.w,h))}function OI(l,e,r,c){let p=r,h=c;for(let m of["x","y"]){let x=l,E=e;x[m]>=E[m]&&(x=e,E=l),x[m]<p&&E[m]>p&&RI(x,E,m,p),x[m]<h&&E[m]>h&&RI(E,x,m,h)}}let D_=Number.MAX_SAFE_INTEGER;function LI(l,e,r,c){return l.order<e||l.order===D_||!(l.clipMask&r)||function(p,h){return h.length!==0&&h.find(m=>m===p)===void 0}(c,l.clipScope)}function M_(l,e){return l.x-e.x||l.y-e.y}function FI(l,e){return M_(l.min,e.min)===0&&M_(l.max,e.max)===0}function jx(l,e){return!(l.min.x>e.max.x||l.max.x<e.min.x||l.min.y>e.max.y||l.max.y<e.min.y)}function Ux(l,e){if(l.length!==e.length)return!1;for(let r=0;r<l.length;r++)if(l[r].sourceId!==e[r].sourceId||!FI(l[r],e[r])||l[r].order!==e[r].order||l[r].clipMask!==e[r].clipMask||!Ea(l[r].clipScope,e[r].clipScope))return!1;return!0}function kI(l,e,r){let c=1/at,p=1/(1<<r.canonical.z),h=(e.x*c+r.canonical.x)*p+r.wrap,m=(e.y*c+r.canonical.y)*p;return{min:new st((l.x*c+r.canonical.x)*p+r.wrap,(l.y*c+r.canonical.y)*p),max:new st(h,m)}}function iL(l,e,r){let c=1<<r.canonical.z,p=((e.x-r.wrap)*c-r.canonical.x)*at,h=(e.y*c-r.canonical.y)*at;return{min:new st(((l.x-r.wrap)*c-r.canonical.x)*at,(l.y*c-r.canonical.y)*at),max:new st(p,h)}}function NI(l,e,r,c,p,h,m){let x=l.indices,E=l.vertices,D=[];for(let y=c;y<c+p;y+=3){let w=e[r[y+0]+h],C=e[r[y+1]+h],T=e[r[y+2]+h],I=Math.min(w.x,C.x,T.x),S=Math.max(w.x,C.x,T.x),R=Math.min(w.y,C.y,T.y),F=Math.max(w.y,C.y,T.y);D.length=0,l.grid.query(new st(I,R),new st(S,F),D);for(let B=0;B<D.length;B++){let U=D[B];if(qn(E[x[3*U+0]],E[x[3*U+1]],E[x[3*U+2]],w,C,T,m))return!0}}return!1}function zI(l,e,r,c){if(!l||!r)return!1;let p=l.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(r.vertices.length<l.vertices.length)return zI(r,c,l,e);let h=e.canonical,m=c.canonical,x=Math.pow(2,m.z-h.z);p=l.vertices.map(E=>new st((E.x+h.x*at)*x-m.x*at,(E.y+h.y*at)*x-m.y*at))}return NI(r,p,l.indices,0,l.indices.length,0,0)}function BI(l,e,r,c){let p=Math.pow(2,c.z-r.z);return new st((l+r.x*at)*p-c.x*at,(e+r.y*at)*p-c.y*at)}function VI(l,e){let r=[];e.grid.queryPoint(l,r);let c=e.indices,p=e.vertices;for(let h=0;h<r.length;h++){let m=r[h];if(oi([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],l))return!0}return!1}let $x=[new st(0,0),new st(at,0),new st(at,at),new st(0,at)];function jI(l,e){let r=[],c=[];if(!e||l.length<2)return[l];if(l.length===2)return Mi(l[0],l[1],$x)?[l]:[];for(let p=0;p<l.length+2;p++){let h=l[p%l.length],m=l[(p+1)%l.length],x=Mi(p===0?l[l.length-1]:l[(p-1)%l.length],h,$x),E=Mi(h,m,$x),D=x||E;D&&c.push(h),D&&E||c.length>0&&(c.length>1&&r.push(c),c=[])}return c.length>1&&r.push(c),r}let Gx=sd.VectorTileFeature.types,rL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],oL=["fill-extrusion-flood-light-ground-radius"],sL=Math.pow(2,13),aL=Math.pow(2,15)-1,UI=new st(0,1),nc=2147483648;function Op(l,e,r,c,p,h,m,x){l.emplaceBack((e<<1)+m,(r<<1)+h,(Math.floor(c*sL)<<1)+p,Math.round(x))}function Lp(l,e,r){l.emplaceBack(e.x*at,e.y*at,r?1:0)}function S_(l,e,r,c,p,h){l.emplaceBack(e.x,e.y,(r.x<<1)+c,(r.y<<1)+p,h)}function Fp(l,e,r){l.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class $I{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class GI{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class HI{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,c){this.accCount++,this.acc._add(r);let p=!!this.borders;r.x<e.min.x?(e.min.x=r.x,p=!0):r.x>e.max.x&&(e.max.x=r.x,p=!0),r.y<e.min.y?(e.min.y=r.y,p=!0):r.y>e.max.y&&(e.max.y=r.y,p=!0),((r.x===0||r.x===at)&&r.x===c.x)!=((r.y===0||r.y===at)&&r.y===c.y)&&this.processBorderOverlap(r,c),p&&this.checkBorderIntersection(r,c)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Pt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>at!=e.x>at&&this.addBorderIntersection(1,Pt(r.y,e.y,(at-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Pt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>at!=e.y>at&&this.addBorderIntersection(3,Pt(r.x,e.x,(at-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let c=this.borders[e];r<c[0]&&(c[0]=r),r>c[1]&&(c[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let c=e.x===0?0:1;this.addBorderIntersection(c,r.y),this.addBorderIntersection(c,e.y)}else{let c=e.y===0?2:3;this.addBorderIntersection(c,r.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function qI(l,e){let r=l.add(e)._unit(),c=Qt(l.x*r.x+l.y*r.y,-1,1);var p,h,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*aL*((p=l).x*(h=e).y-p.y*h.x<0?-1:1)}let lL=[l=>l.x<0,l=>l.x>at,l=>l.y<0,l=>l.y>at];function cL(l,e,r,c){let p=[4];if(c===0)return p;r._mult(c);let h=l.sub(r),m=e.sub(r),x=[l,e,h,m];for(let E=0;E<4;E++)for(let D of x)if(lL[E](D)){p.push(E);break}return p}class WI{constructor(e){this.vertexArray=new Xh,this.indexArray=new rr,this.programConfigurations=new ia(e.layers,{zoom:e.zoom,lut:e.lut},r=>oL.includes(r)),this._segments=new xi,this.hiddenByLandmarkVertexArray=new Qh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,c,p=!1){let h=e.length;if(h>2){let m=Math.max(0,this._segments.get().length-1),x=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[m].length),E;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{let D=e[0],y=e[1];E=qI(D.sub(e[h-1])._perp()._unit(),y.sub(D)._perp()._unit())}for(let D=0;D<h;D++){let y=D===h-1?0:D+1,w=e[D],C=e[y],T=e[y===h-1?0:y+1],I=C.sub(w)._perp()._unit(),S=qI(I,T.sub(C)._perp()._unit()),R=E,F=S;if(Hx(w,C,r)||p&&YI(w,r)&&YI(C,r)){E=S;continue}let B=x.vertexLength;S_(this.vertexArray,w,C,1,1,R),S_(this.vertexArray,w,C,1,0,R),S_(this.vertexArray,w,C,0,1,F),S_(this.vertexArray,w,C,0,0,F),x.vertexLength+=4;let U=cL(w,C,I,c);for(let k of U)this._segmentToGroundQuads[m].push({id:B,region:k}),this._segmentToRegionTriCounts[m][k]+=2,x.primitiveLength+=2;E=S}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),r=e.length;for(let c=0;c<r;c++)this._segmentToGroundQuads[c].sort((p,h)=>p.region-h.region);for(let c=0;c<r;c++){let p=this._segmentToGroundQuads[c],h=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((E,D)=>E+D,0);let x=0;for(let E=0;E<=4;E++){let D=m[E];if(D!==0){let y=this.regionSegments[E];y||(y=this.regionSegments[E]=new xi);let w={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+x,vertexLength:h.vertexLength,primitiveLength:D};y.get().push(w)}x+=D}for(let E=0;E<p.length;E++){let D=p[E].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,c,p,h,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,c,p,h,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,KO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,c,p,h,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,c,p,h,m)}updateHiddenByLandmark(e){if(!this.hasData())return;let r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let c=e.flags&nc?1:0;for(let p=e.groundVertexArrayOffset;p<r;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,eL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let r=this.regionSegments[e];r&&r.destroy()}}}}class A_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new rr,this.footprintVertices=new Qs,this.footprintSegments=[],this.layoutVertexArray=new ea,this.centroidVertexArray=new h_,this.wallVertexArray=new wp,this.indexArray=new rr,this.programConfigurations=new ia(e.layers,{zoom:e.zoom,lut:e.lut},r=>rL.includes(r)),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new WI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,c,p){this.features=[],this.hasPattern=Lx("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ge(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:h,id:m,index:x,sourceLayerIndex:E}of e){let D=this.layers[0]._featureFilter.needGeometry,y=nt(h,D);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),y,c))continue;let w={id:m,sourceLayerIndex:E,index:x,geometry:D?y.geometry:et(h,c,p),properties:h.properties,type:h.type,patterns:{}},C=this.layoutVertexArray.length,T=Gx[w.type]==="Polygon";if(this.hasPattern)this.features.push(Fx("fill-extrusion",this.layers,w,this.zoom,r));else if(this.wallMode)for(let I of w.geometry)for(let S of jI(I,T))this.addFeature(w,[S],x,c,{},r.availableImages,p,r.brightness);else this.addFeature(w,w.geometry,x,c,{},r.availableImages,p,r.brightness);r.featureIndex.insert(h,w.geometry,x,E,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,c,p,h,m){for(let x of this.features){let E=Gx[x.type]==="Polygon",{geometry:D}=x;if(this.wallMode)for(let y of D)for(let w of jI(y,E))this.addFeature(x,[w],x.index,r,c,p,h,m);else this.addFeature(x,D,x.index,r,c,p,h,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,c,p,h){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let x=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,x,c,p,h),this.groundEffect.update(e,r,x,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,QO.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,JO.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,c,p,h,m,x,E){let D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,y=[new st(0,0),new st(at,at)],w=x.projection,C=w.name==="globe",T=this.wallMode||Gx[e.type]==="Polygon",I=new HI;I.centroidDataIndex=this.centroidData.length;let S=new GI,R=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p),B;if(S.height=F,S.vertexArrayOffset=this.layoutVertexArray.length,S.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yh),this.wallMode){if(C)return void In("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;B=function(Q){let ue=Q[0].x===Q[Q.length-1].x&&Q[0].y===Q[Q.length-1].y;(function(tt){let Ke=0,It=tt.length;for(let ct=0;ct<It;ct++)Ke+=(tt[(ct+1)%It].x-tt[ct].x)*(tt[(ct+1)%It].y+tt[ct].y);return Ke>=0})(Q)||(Q=Q.reverse());let de={geometry:[],joinNormals:[],indices:[]},ve=[],Te=[],Ee=[],Ie=Q.length;if(Ie<(ue?3:2))return de;for(;Ie>=2&&Q[Ie-1].equals(Q[Ie-2]);)Ie--;let Oe,De,je,We,Ne,ut=0;for(;ut<Ie-1&&Q[ut].equals(Q[ut+1]);)ut++;ue&&(Oe=Q[Ie-2],Ne=Q[ut].sub(Oe)._unit()._perp());for(let tt=ut;tt<Ie;tt++){if(je=tt===Ie-1?ue?Q[ut+1]:void 0:Q[tt+1],je&&Q[tt].equals(je))continue;Ne&&(We=Ne),Oe&&(De=Oe),Oe=Q[tt],Ne=je?je.sub(Oe)._unit()._perp():We,We=We||Ne;let Ke=We.add(Ne);Ke.x===0&&Ke.y===0||Ke._unit();let It=Ke.x*Ne.x+Ke.y*Ne.y,ct=It!==0?1/It:1/0,pt=We.x*Ne.y-We.y*Ne.x>0,Nt="miter",sn=2;Nt==="miter"&&ct>sn&&(Nt="bevel"),Nt==="bevel"&&(ct>100&&(Nt="flipbevel"),ct<sn&&(Nt="miter"));let Kt=(Jt,dn,pn,Kn)=>{let Nn=new st(Jt.x,Jt.y),jt=new st(Jt.x,Jt.y);Nn.x+=dn.x*Kn,Nn.y+=dn.y*Kn,jt.x-=dn.x*Math.max(pn,1),jt.y-=dn.y*Math.max(pn,1),Ee.push(dn),ve.push(Nn),Te.push(jt)};if(Nt==="miter")Ke._mult(ct),Kt(Oe,Ke,0,0);else if(Nt==="flipbevel")Ke=Ne.mult(-1),Kt(Oe,Ke,0,0),Kt(Oe,Ke.mult(-1),0,0);else{let Jt=-Math.sqrt(ct*ct-1),dn=pt?Jt:0,pn=pt?0:Jt;De&&Kt(Oe,We,dn,pn),je&&Kt(Oe,Ne,dn,pn)}}de.geometry=[...ve,...Te.reverse(),ve[0]],de.joinNormals=[...Ee,...Ee.reverse(),Ee[Ee.length-1]];let ot=de.geometry.length-1;for(let tt=0;tt<ot/2;tt++)if(tt+1<ot/2){let Ke=tt,It=tt+1,ct=ot-1-tt,pt=ot-2-tt;Ke=Ke===0?ot-1:Ke-1,It=It===0?ot-1:It-1,ct=ct===0?ot-1:ct-1,pt=pt===0?ot-1:pt-1,de.indices.push(ct),de.indices.push(It),de.indices.push(Ke),de.indices.push(ct),de.indices.push(pt),de.indices.push(It)}return de}(r[0]),r=[B.geometry]}let U=(Q,ue)=>Q<(ue.length-1)/2||Q===ue.length-1,k=this.wallMode?[r]:E_(r,500);for(let Q=k.length-1;Q>=0;Q--){let ue=k[Q];(ue.length===0||(G=ue[0]).every(se=>se.x<=0)||G.every(se=>se.x>=at)||G.every(se=>se.y<=0)||G.every(se=>se.y>=at))&&k.splice(Q,1)}var G;let H;if(C)H=eC(k,y,p);else{H=[];for(let Q of k)H.push({polygon:Q,bounds:y})}let K=T?this.edgeRadius:0,te=K>0&&this.zoom<17,ie=(Q,ue)=>{if(Q.length===0)return!1;let se=Q[Q.length-1];return ue.x===se.x&&ue.y===se.y};for(let{polygon:Q,bounds:ue}of H){let se=0,de=0;for(let Ie of Q)T&&!Ie[0].equals(Ie[Ie.length-1])&&Ie.push(Ie[0]),de+=T?Ie.length-1:Ie.length;let ve=this.segments.prepareSegment((T?5:4)*de,this.layoutVertexArray,this.indexArray);S.footprintSegIdx<0&&(S.footprintSegIdx=this.footprintSegments.length),S.polygonSegIdx<0&&(S.polygonSegIdx=this.polygonSegments.length);let Te={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ee=new $I;if(Ee.vertexOffset=this.footprintVertices.length,Ee.indexOffset=3*this.footprintIndices.length,Ee.ringIndices=[],T){let Ie=[],Oe=[];se=ve.vertexLength;for(let je=0;je<Q.length;je++){let We=Q[je];We.length&&je!==0&&Oe.push(Ie.length/2);let Ne=[],ut,ot;ut=We[1].sub(We[0])._perp()._unit(),Ee.ringIndices.push(We.length-1);for(let tt=1;tt<We.length;tt++){let Ke=We[tt],It=We[tt===We.length-1?1:tt+1],ct=Ke.clone();if(K){ot=It.sub(Ke)._perp()._unit();let pt=ut.add(ot)._unit(),Nt=K*Math.min(4,1/(ut.x*pt.x+ut.y*pt.y));ct.x+=Nt*pt.x,ct.y+=Nt*pt.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ut=ot}if(!R||K!==0&&!te||ie(Ne,ct)||Ne.push(ct),Op(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),this.wallMode){let pt=U(tt,We);Lp(this.wallVertexArray,B.joinNormals[tt],!pt)}ve.vertexLength++,this.footprintVertices.emplaceBack(Ke.x,Ke.y),Ie.push(Ke.x,Ke.y),C&&Fp(this.layoutVertexExtArray,w.projectTilePoint(ct.x,ct.y,p),w.upVector(p,ct.x,ct.y))}R&&(K===0||te)&&(Ne.length!==0&&ie(Ne,Ne[0])&&Ne.pop(),this.groundEffect.addData(Ne,ue,D))}let De=this.wallMode?B.indices:Sp(Ie,Oe);for(let je=0;je<De.length;je+=3)this.footprintIndices.emplaceBack(Ee.vertexOffset+De[je+0],Ee.vertexOffset+De[je+1],Ee.vertexOffset+De[je+2]),this.indexArray.emplaceBack(se+De[je],se+De[je+2],se+De[je+1]),ve.primitiveLength++;Ee.indexCount+=De.length,Ee.vertexCount+=this.footprintVertices.length-Ee.vertexOffset}for(let Ie=0;Ie<Q.length;Ie++){let Oe=Q[Ie];I.startRing(S,Oe[0]);let De=Oe.length>4&&KI(Oe[Oe.length-2],Oe[0],Oe[1]),je=K?uL(Oe[Oe.length-2],Oe[0],Oe[1],K):0,We=[],Ne,ut,ot;ut=Oe[1].sub(Oe[0])._perp()._unit();let tt=!0;for(let Ke=1,It=0;Ke<Oe.length;Ke++){let ct=Oe[Ke-1],pt=Oe[Ke],Nt=Oe[Ke===Oe.length-1?1:Ke+1];if(I.appendEdge(S,pt,ct),Hx(pt,ct,ue)){K&&(ut=Nt.sub(pt)._perp()._unit(),tt=!tt);continue}let sn=pt.sub(ct)._perp(),Kt=sn.x/(Math.abs(sn.x)+Math.abs(sn.y)),Jt=sn.y>0?1:0,dn=ct.dist(pt);if(It+dn>32768&&(It=0),K){ot=Nt.sub(pt)._perp()._unit();let jt=XI(ct,pt,Nt,ZI(ut,ot),K);isNaN(jt)&&(jt=0);let An=pt.sub(ct)._unit();ct=ct.add(An.mult(je))._round(),pt=pt.add(An.mult(-jt))._round(),je=jt,ut=ot,R&&this.zoom>=17&&(ie(We,ct)||We.push(ct),ie(We,pt)||We.push(pt))}let pn=ve.vertexLength,Kn=Oe.length>4&&KI(ct,pt,Nt),Nn=JI(It,De,tt);if(Op(this.layoutVertexArray,ct.x,ct.y,Kt,Jt,0,0,Nn),Op(this.layoutVertexArray,ct.x,ct.y,Kt,Jt,0,1,Nn),this.wallMode){let jt=U(Ke-1,Oe),An=B.joinNormals[Ke-1];Lp(this.wallVertexArray,An,jt),Lp(this.wallVertexArray,An,jt)}if(It+=dn,Nn=JI(It,Kn,!tt),De=Kn,Op(this.layoutVertexArray,pt.x,pt.y,Kt,Jt,0,0,Nn),Op(this.layoutVertexArray,pt.x,pt.y,Kt,Jt,0,1,Nn),this.wallMode){let jt=U(Ke,Oe),An=B.joinNormals[Ke];Lp(this.wallVertexArray,An,jt),Lp(this.wallVertexArray,An,jt)}if(ve.vertexLength+=4,this.indexArray.emplaceBack(pn+0,pn+1,pn+2),this.indexArray.emplaceBack(pn+1,pn+3,pn+2),ve.primitiveLength+=2,K){let jt=se+(Ke===1?Oe.length-2:Ke-2),An=Ke===1?se:jt+1;if(this.indexArray.emplaceBack(pn+1,jt,pn+3),this.indexArray.emplaceBack(jt,An,pn+3),ve.primitiveLength+=2,Ne===void 0&&(Ne=pn),!Hx(Nt,Oe[Ke],ue)){let On=Ke===Oe.length-1?Ne:ve.vertexLength;this.indexArray.emplaceBack(pn+2,pn+3,On),this.indexArray.emplaceBack(pn+3,On+1,On),this.indexArray.emplaceBack(pn+3,An,On+1),ve.primitiveLength+=3}tt=!tt}if(C){let jt=this.layoutVertexExtArray,An=w.projectTilePoint(ct.x,ct.y,p),On=w.projectTilePoint(pt.x,pt.y,p),si=w.upVector(p,ct.x,ct.y),Ti=w.upVector(p,pt.x,pt.y);Fp(jt,An,si),Fp(jt,An,si),Fp(jt,On,Ti),Fp(jt,On,Ti)}}T&&(se+=Oe.length-1),R&&K&&this.zoom>=17&&(We.length!==0&&ie(We,We[0])&&We.pop(),this.groundEffect.addData(We,ue,D,K>0))}this.footprintSegments.push(Ee),Te.triangleCount=this.indexArray.length-Te.triangleArrayOffset,this.polygonSegments.push(Te),++S.footprintSegLen,++S.polygonSegLen}if(S.vertexCount=this.layoutVertexArray.length-S.vertexArrayOffset,S.groundVertexCount=this.groundEffect.vertexArray.length-S.groundVertexArrayOffset,S.vertexCount!==0){if(S.centroidXY=I.borders?UI:this.encodeCentroid(I,S),this.centroidData.push(S),I.borders){this.featuresOnBorder.push(I);let Q=this.featuresOnBorder.length-1;for(let ue=0;ue<I.borders.length;ue++)I.borders[ue][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ue].push(Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,h,m,p,E),this.groundEffect.addPaintPropertiesData(e,c,h,m,p,E),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,c)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){let e=[];for(let x=0;x<this.centroidData.length;x++){let E=this.centroidData[x],D=+(E.min.y+E.max.y>at),y=2*D+(+(E.min.x+E.max.x>at)^D);for(let w=0;w<E.polygonSegLen;w++){let C=E.polygonSegIdx+w;e.push({centroidIdx:x,subtile:y,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}let r=new rr;e.sort((x,E)=>x.triangleSegmentIdx===E.triangleSegmentIdx?x.subtile-E.subtile:x.triangleSegmentIdx-E.triangleSegmentIdx);let c=0,p=0,h=0;for(let x of e){if(x.triangleSegmentIdx!==c)break;h++}let m=e.length;for(;p!==e.length;){c=e[p].triangleSegmentIdx;let x=0,E=p,D=p;for(let y=E;y<h&&e[y].subtile===x;y++)D++;for(;E!==h;){let y=e[E];x=y.subtile;let w=this.centroidData[y.centroidIdx].min.clone(),C=this.centroidData[y.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=E;I<D;I++){let S=e[I],R=this.polygonSegments[S.polygonSegmentIdx],F=this.centroidData[S.centroidIdx].min,B=this.centroidData[S.centroidIdx].max,U=this.indexArray.uint16;for(let k=R.triangleArrayOffset;k<R.triangleArrayOffset+R.triangleCount;k++)r.emplaceBack(U[3*k],U[3*k+1],U[3*k+2]);T.primitiveLength+=R.triangleCount,w.x=Math.min(w.x,F.x),w.y=Math.min(w.y,F.y),C.x=Math.max(C.x,B.x),C.y=Math.max(C.y,B.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:w,max:C}),E=D;for(let I=E;I<h&&e[I].subtile===e[E].subtile;I++)D++}p=h;for(let y=p;y<m&&e[y].triangleSegmentIdx===e[p].triangleSegmentIdx;y++)h++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,c){let p=new xi;if(this.wallMode){for(let S of this.triangleSubSegments)p.segments.push(S.segment);return p}let h=0,m=0,x=1<<e.canonical.z;if(r){let S=r.getMinMaxForTile(e);S&&(h=S.min,m=S.max)}m+=this.maxHeight;let E=e.toUnwrapped(),D,y=[E.canonical.x/x+E.wrap,E.canonical.y/x],w=[(E.canonical.x+1)/x+E.wrap,(E.canonical.y+1)/x],C=(S,R,F)=>[S[0]*(1-F[0])+R[0]*F[0],S[1]*(1-F[1])+R[1]*F[1]],T=[],I=[];for(let S of this.triangleSubSegments){T[0]=S.min.x/at,T[1]=S.min.y/at,I[0]=S.max.x/at,I[1]=S.max.y/at;let R=C(y,w,T),F=C(y,w,I);if(new ni([R[0],R[1],h],[F[0],F[1],m]).intersectsPrecise(c)===0){D&&(p.segments.push(D),D=void 0);continue}let B=S.segment;D&&D.vertexOffset!==B.vertexOffset&&(p.segments.push(D),D=void 0),D?(D.vertexLength+=B.vertexLength,D.primitiveLength+=B.primitiveLength):D={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&p.segments.push(D),p}encodeCentroid(e,r){let c=e.centroid(),p=r.span(),h=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new st(Qt(c.x,1,at-1)<<3|h,Qt(c.y,1,at-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new st(0,0);let r=e.borders,c=Number.MAX_VALUE;if(r[0][0]!==c||r[1][0]!==c){let p=r[0][0]!==c?0:1;return new st(6|(r[0][0]!==c?0:65528),(r[p][0]+r[p][1])/2<<3|6)}{let p=r[2][0]!==c?2:3;return new st((r[p][0]+r[p][1])/2<<3|6,6|(r[2][0]!==c?0:65528))}}showCentroid(e){let r=this.centroidData[e.centroidDataIndex];r.flags&=nc,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let r=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,p=e.flags&nc?UI:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==p.y||h!==p.x){for(let m=r;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let p=r.getReplacementRegionsForTile(e.toUnwrapped());if(Ux(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let m of this.centroidData)m.flags&=2147483647;let h=[];for(let m of this.activeReplacements){if(m.order<c)continue;let x=Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z);for(let E of this.centroidData)if(!(E.flags&nc||m.min.x>E.max.x||E.min.x>m.max.x||m.min.y>E.max.y||E.min.y>m.max.y))for(let D=0;D<E.footprintSegLen;D++){let y=this.footprintSegments[E.footprintSegIdx+D];if(h.length=0,hL(this.footprintVertices,y.vertexOffset,y.vertexCount,m.footprintTileId.canonical,e.canonical,h),NI(m.footprint,h,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-x)){E.flags|=nc;break}}}for(let m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,c){let p=!1;for(let h=0;h<c.footprintSegLen;h++){let m=this.footprintSegments[c.footprintSegIdx+h],x=0;for(let E of m.ringIndices){for(let D=x,y=E+x-1;D<E+x;y=D++){let w=this.footprintVertices.int16[2*(D+m.vertexOffset)+0],C=this.footprintVertices.int16[2*(D+m.vertexOffset)+1],T=this.footprintVertices.int16[2*(y+m.vertexOffset)+1];C>r!=T>r&&e<(this.footprintVertices.int16[2*(y+m.vertexOffset)+0]-w)*(r-C)/(T-C)+w&&(p=!p)}x=E}}return p}getHeightAtTileCoord(e,r){let c=Number.NEGATIVE_INFINITY,p=!0,h=4*(e+at)*at+(r+at);if(this.partLookup.hasOwnProperty(h)){let m=this.partLookup[h];return m?{height:m.height,hidden:!!(m.flags&nc)}:void 0}for(let m of this.centroidData)e>m.max.x||m.min.x>e||r>m.max.y||m.min.y>r||this.footprintContainsPoint(e,r,m)&&m&&m.height>c&&(c=m.height,this.partLookup[h]=m,p=!!(m.flags&nc));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[h]=void 0}}function ZI(l,e){let r=l.add(e)._unit();return l.x*r.x+l.y*r.y}function uL(l,e,r,c){let p=e.sub(l)._perp()._unit(),h=r.sub(e)._perp()._unit();return XI(l,e,r,ZI(p,h),c)}function XI(l,e,r,c,p){let h=Math.sqrt(1-c*c);return Math.min(l.dist(e)/3,e.dist(r)/3,p*h/c)}function Hx(l,e,r){return l.x<r[0].x&&e.x<r[0].x||l.x>r[1].x&&e.x>r[1].x||l.y<r[0].y&&e.y<r[0].y||l.y>r[1].y&&e.y>r[1].y}function YI(l,e){return l.x<e[0].x||l.x>e[1].x||l.y<e[0].y||l.y>e[1].y}function KI(l,e,r){if(l.x<0||l.x>=at||e.x<0||e.x>=at||r.x<0||r.x>=at)return!1;let c=r.sub(e),p=c.perp(),h=l.sub(e);return(c.x*h.x+c.y*h.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(h.x*h.x+h.y*h.y))>-.866&&p.x*h.x+p.y*h.y<0}function JI(l,e,r){let c=e?2|l:-3&l;return r?1|c:-2&c}function QI(){let l=Math.PI/32,e=Math.tan(l),r=N;return r*Math.sqrt(1+2*e*e)-r}function eC(l,e,r){let c=1<<r.z,p=le(r.x/c),h=le((r.x+1)/c),m=ae(r.y/c),x=ae((r.y+1)/c);return function(E,D,y,w,C=0,T){let I=[];if(!E.length||!y||!w)return I;let S=(H,K)=>{for(let te of H)I.push({polygon:te,bounds:K})},R=Math.ceil(Math.log2(y)),F=Math.ceil(Math.log2(w)),B=R-F,U=[];for(let H=0;H<Math.abs(B);H++)U.push(B>0?0:1);for(let H=0;H<Math.min(R,F);H++)U.push(0),U.push(1);let k=E;if(k=C_(k,D[0].y-C,D[1].y+C,1),k=C_(k,D[0].x-C,D[1].x+C,0),!k.length)return I;let G=[];for(U.length?G.push({polygons:k,bounds:D,depth:0}):S(k,D);G.length;){let H=G.pop(),K=H.depth,te=U[K],ie=H.bounds[0],Q=H.bounds[1],ue=te===0?ie.x:ie.y,se=te===0?Q.x:Q.y,de=T?T(te,ue,se):.5*(ue+se),ve=C_(H.polygons,ue-C,de+C,te),Te=C_(H.polygons,de-C,se+C,te);if(ve.length){let Ee=[ie,new st(te===0?de:Q.x,te===1?de:Q.y)];U.length>K+1?G.push({polygons:ve,bounds:Ee,depth:K+1}):S(ve,Ee)}if(Te.length){let Ee=[new st(te===0?de:ie.x,te===1?de:ie.y),Q];U.length>K+1?G.push({polygons:Te,bounds:Ee,depth:K+1}):S(Te,Ee)}}return I}(l,e,Math.ceil((h-p)/11.25),Math.ceil((m-x)/11.25),1,(E,D,y)=>{if(E===0)return .5*(D+y);{let w=ae((r.y+D/at)/c);return(oe(.5*(ae((r.y+y/at)/c)+w))*c-r.y)*at}})}function hL(l,e,r,c,p,h){let m=Math.pow(2,c.z-p.z);for(let x=0;x<r;x++){let E=l.int16[2*(x+e)+0],D=l.int16[2*(x+e)+1];E=(E+p.x*at)*m-c.x*at,D=(D+p.y*at)*m-c.y*at,h.push(new st(E,D))}}let tC,nC;function kp(l,e){return l.x*e.x+l.y*e.y}function iC(l,e){if(l.length===1){let r=0,c=e[r++],p;for(;!p||c.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){let h=e[r],m=l[0],x=p.sub(c),E=h.sub(c),D=m.sub(c),y=kp(x,x),w=kp(x,E),C=kp(E,E),T=kp(D,x),I=kp(D,E),S=y*C-w*w,R=(C*T-w*I)/S,F=(y*I-w*T)/S,B=c.z*(1-R-F)+p.z*R+h.z*F;if(isFinite(B))return B}return 1/0}{let r=1/0;for(let c of e)r=Math.min(r,c.z);return r}}function rC(l,e,r,c,p,h,m,x){let E=m*p.getElevationAt(l,e,!0,!0),D=h[0]!==0,y=D?h[1]===0?m*(h[0]/7-450):m*function(w,C,T){let I=Math.floor(C[0]/8),S=Math.floor(C[1]/8),R=10*(C[0]-8*I),F=10*(C[1]-8*S),B=w.getElevationAt(I,S,!0,!0),U=w.getMeterToDEM(T),k=Math.floor(.5*(R*U-1)),G=Math.floor(.5*(F*U-1)),H=w.tileCoordToPixel(I,S),K=2*k+1,te=2*G+1,ie=function(Te,Ee,Ie,Oe,De){return[Te.getElevationAtPixel(Ee,Ie,!0),Te.getElevationAtPixel(Ee+De,Ie,!0),Te.getElevationAtPixel(Ee,Ie+De,!0),Te.getElevationAtPixel(Ee+Oe,Ie+De,!0)]}(w,H.x-k,H.y-G,K,te),Q=Math.abs(ie[0]-ie[1]),ue=Math.abs(ie[2]-ie[3]),se=Math.abs(ie[0]-ie[2])+Math.abs(ie[1]-ie[3]),de=Math.min(.25,.5*U*(Q+ue)/K),ve=Math.min(.25,.5*U*se/te);return B+Math.max(de*R,ve*F)}(p,h,x):E;return{base:E+(r===0)?-1:r,top:D?Math.max(y+c,E+r+2):E+c}}mt(A_,"FillExtrusionBucket",{omit:["layers","features"]}),mt(GI,"PartData"),mt($I,"FootprintSegment"),mt(HI,"BorderCentroidData"),mt(WI,"GroundEffect");let dL=Dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),fL=Dn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:pL}=dL,mL=Dn([{name:"a_packed",components:4,type:"Float32"}]),{members:gL}=mL,_L=Dn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:yL}=_L;class oC{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new tc({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let c=this.getKey(e,r);return this.positions[c]}trim(){let e=this.width,r=this.height=jc(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,c){let p=[],h=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,x=!0;p.push({left:h,right:m,isDash:x,zeroLength:e[0]===0});let E=e[0];for(let D=1;D<e.length;D++){x=!x;let y=e[D];h=E*c,E+=y,m=E*c,p.push({left:h,right:m,isDash:x,zeroLength:y===0})}return p}addRoundDash(e,r,c){let p=r/2;for(let h=-c;h<=c;h++){let m=this.width*(this.nextRow+c+h),x=0,E=e[x];for(let D=0;D<this.width;D++){D/E.right>1&&(E=e[++x]);let y=Math.abs(D-E.left),w=Math.abs(D-E.right),C=Math.min(y,w),T,I=h/c*(p+1);if(E.isDash){let S=p-Math.abs(I);T=Math.sqrt(C*C+S*S)}else T=p-Math.sqrt(C*C+I*I);this.image.data[m+D]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,r){for(let E=e.length-1;E>=0;--E){let D=e[E],y=e[E+1];D.zeroLength?e.splice(E,1):y&&y.isDash===D.isDash&&(y.left=D.left,e.splice(E,1))}let c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);let h=this.width*this.nextRow,m=0,x=e[m];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++m]);let D=Math.abs(E-x.left),y=Math.abs(E-x.right),w=Math.min(D,y);this.image.data[h+E]=Math.max(0,Math.min(255,(x.isDash?w:-w)+r+128))}}addDash(e,r){let c=this.getKey(e,r);if(this.positions[c])return this.positions[c];let p=r==="round",h=p?7:0,m=2*h+1;if(this.nextRow+m>this.height)return In("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let y=0;y<e.length;y++)e[y]<0&&(In("Negative value is found in line dasharray, replacing values with 0"),e[y]=0),x+=e[y];if(x!==0){let y=this.width/x,w=this.getDashRanges(e,this.width,y);p?this.addRoundDash(w,y,h):this.addRegularDash(w,r==="square"?.5*y:0)}let E=this.nextRow+h;this.nextRow+=m;let D={tl:[E,h],br:[x,0]};return this.positions[c]=D,D}}mt(oC,"LineAtlas");let vL=sd.VectorTileFeature.types,xL=Math.cos(Math.PI/180*37.5),bL=Math.cos(Math.PI/180*5);class qx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new dp,this.layoutVertexArray2=new _s,this.patternVertexArray=new ta,this.indexArray=new rr,this.programConfigurations=new ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new xi,this.maxLineLength=0,this.zOffsetVertexArray=new Zl,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:at/64}updateFootprints(e,r){}populate(e,r,c,p){this.hasPattern=Lx("line",this.layers,r);let h=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);let x=[];for(let{feature:w,id:C,index:T,sourceLayerIndex:I}of e){let S=this.layers[0]._featureFilter.needGeometry,R=nt(w,S);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),R,c))continue;let F=h?h.evaluate(R,{},c):void 0,B={id:C,properties:w.properties,type:w.type,sourceLayerIndex:I,index:T,geometry:S?R.geometry:et(w,c,p),patterns:{},sortKey:F};x.push(B)}h&&x.sort((w,C)=>w.sortKey-C.sortKey);let{lineAtlas:E,featureIndex:D}=r,y=this.addConstantDashes(E);for(let w of x){let{geometry:C,index:T,sourceLayerIndex:I}=w;if(y&&this.addFeatureDashes(w,E),this.hasPattern){let S=Fx("line",this.layers,w,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(w,C,T,c,E.positions,r.availableImages,r.brightness);D.insert(e[T].feature,C,T,I,this.index)}}addConstantDashes(e){let r=!1;for(let c of this.layers){let p=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(p.kind!=="constant"||h.kind!=="constant")r=!0;else{let m=h.value,x=p.value;if(!x)continue;e.addDash(x,m)}}return r}addFeatureDashes(e,r){let c=this.zoom;for(let p of this.layers){let h=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(h.kind==="constant"&&m.kind==="constant")continue;let x,E;if(h.kind==="constant"){if(x=h.value,!x)continue}else x=h.evaluate({zoom:c},e);E=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),r.addDash(x,E),e.patterns[p.id]=r.getKey(x,E)}}update(e,r,c,p,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(e,r,c,p,h,m){for(let x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gL)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,yL)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,fL.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,c,p,h,m,x){let E=this.layers[0].layout,D=E.get("line-join").evaluate(e,{}),y=E.get("line-cap").evaluate(e,{}),w=E.get("line-miter-limit"),C=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let T of r)this.addLine(T,e,p,D,y,w,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,h,m,p,x)}addLine(e,r,c,p,h,m,x){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let E={zoom:this.zoom,lineProgress:void 0},D=this.layers[0].layout,y=p==="none";if(this.patternJoinNone=this.hasPattern&&y,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let w=vL[r.type]==="Polygon",C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let T=0;for(;T<C-1&&e[T].equals(e[T+1]);)T++;if(C<(w?3:2))return;p==="bevel"&&(m=1.05);let I=this.overscaling<=16?15*at/(512*this.overscaling):0,S=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray),R,F,B,U,k,G;this.e1=this.e2=-1,w&&(R=e[C-2],k=e[T].sub(R)._unit()._perp());for(let H=T;H<C;H++){if(B=H===C-1?w?e[T+1]:void 0:e[H+1],B&&e[H].equals(B))continue;if(k&&(U=k),R&&(F=R),R=e[H],this.hasZOffset){let Ee=D.get("line-z-offset").value;if(Ee.kind==="constant")G=Ee.value;else{if(this.lineClips){let Ie=this.totalDistance/(this.lineClips.end-this.lineClips.start);E.lineProgress=(Ie*this.lineClips.start+this.distance+(F?F.dist(R):0))/Ie}else In(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),E.lineProgress=0;G=Ee.evaluate(E,r)}G=G||0}k=B?B.sub(R)._unit()._perp():U,U=U||k;let K=F&&B,te=K?p:w||y?"butt":h,ie=U.x*k.x+U.y*k.y;if(y){let Ee=function(Ie){if(Ie.patternJoinNone){let Oe=Ie.segmentPoints.length/2,De=Ie.lineSoFar-Ie.segmentStart;for(let je=0;je<Oe;++je){let We=Ie.segmentPoints[2*je+1],Ne=Math.round(Ie.segmentPoints[2*je])+.5+.25*We;Ie.patternVertexArray.emplaceBack(Ne,De,Ie.segmentStart),Ie.patternVertexArray.emplaceBack(Ne,De,Ie.segmentStart)}Ie.segmentPoints.length=0}Ie.e1=Ie.e2=-1};if(K&&ie<bL){this.updateDistance(F,R),this.addCurrentVertex(R,U,1,1,S,G),Ee(this),this.addCurrentVertex(R,k,-1,-1,S,G);continue}if(F){if(!B){this.updateDistance(F,R),this.addCurrentVertex(R,U,1,1,S,G),Ee(this);continue}te="miter"}}let Q=U.add(k);Q.x===0&&Q.y===0||Q._unit();let ue=Q.x*k.x+Q.y*k.y,se=ue!==0?1/ue:1/0,de=2*Math.sqrt(2-2*ue),ve=ue<xL&&F&&B,Te=U.x*k.y-U.y*k.x>0;if(ve&&H>T){let Ee=R.dist(F);if(Ee>2*I){let Ie=R.sub(R.sub(F)._mult(I/Ee)._round());this.updateDistance(F,Ie),this.addCurrentVertex(Ie,U,0,0,S,G),F=Ie}}if(K&&te==="round"&&(se<x?te="miter":se<=2&&(te="fakeround")),te==="miter"&&se>m&&(te="bevel"),te==="bevel"&&(se>2&&(te="flipbevel"),se<m&&(te="miter")),F&&this.updateDistance(F,R),te==="miter")Q._mult(se),this.addCurrentVertex(R,Q,0,0,S,G);else if(te==="flipbevel"){if(se>100)Q=k.mult(-1);else{let Ee=se*U.add(k).mag()/U.sub(k).mag();Q._perp()._mult(Ee*(Te?-1:1))}this.addCurrentVertex(R,Q,0,0,S,G),this.addCurrentVertex(R,Q.mult(-1),0,0,S,G)}else if(te==="bevel"||te==="fakeround"){let Ee=-Math.sqrt(se*se-1),Ie=Te?Ee:0,Oe=Te?0:Ee;if(F&&this.addCurrentVertex(R,U,Ie,Oe,S,G),te==="fakeround"){let De=Math.round(180*de/Math.PI/20);for(let je=1;je<De;je++){let We=je/De;if(We!==.5){let ut=We-.5;We+=We*ut*(We-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*ut*ut+(.848013+ie*(.215638*ie-1.06021)))}let Ne=k.sub(U)._mult(We)._add(U)._unit()._mult(Te?-1:1);this.addHalfVertex(R,Ne.x,Ne.y,!1,Te,0,S,G)}}B&&this.addCurrentVertex(R,k,-Ie,-Oe,S,G)}else te==="butt"?this.addCurrentVertex(R,Q,0,0,S,G):te==="square"?(F||this.addCurrentVertex(R,Q,-1,-1,S,G),this.addCurrentVertex(R,Q,0,0,S,G),F&&this.addCurrentVertex(R,Q,1,1,S,G)):te==="round"&&(F&&(this.addCurrentVertex(R,U,0,0,S,G),this.addCurrentVertex(R,U,1,1,S,G,!0)),B&&(this.addCurrentVertex(R,k,-1,-1,S,G,!0),this.addCurrentVertex(R,k,0,0,S,G)));if(ve&&H<C-1){let Ee=R.dist(B);if(Ee>2*I){let Ie=R.add(B.sub(R)._mult(I/Ee)._round());this.updateDistance(R,Ie),this.addCurrentVertex(Ie,k,0,0,S,G),R=Ie}}}}addVerticesTo(e,r,c,p,h,m,x,E,D,y){let w=(r.w-e.w)/this.tessellationStep|0;if(w>1){this.lineSoFar=e.w;let C=(r.x-e.x)/w,T=(r.y-e.y)/w,I=(r.z-e.z)/w,S=(r.w-e.w)/w;for(let R=1;R<w;++R)e.x+=C,e.y+=T,e.z+=I,this.lineSoFar+=S,this.addHalfVertex(e,c,p,y,!1,x,D,e.z),this.addHalfVertex(e,h,m,y,!0,-E,D,e.z)}this.lineSoFar=r.w,this.addHalfVertex(r,c,p,y,!1,x,D,r.z),this.addHalfVertex(r,h,m,y,!0,-E,D,r.z)}addCurrentVertex(e,r,c,p,h,m,x=!1){let E=r.x+r.y*c,D=r.y-r.x*c,y=r.y*p-r.x,w=-r.y-r.x*p;if(m!=null){let T=at+10,I=m,S=new PI(e.x,e.y,I,this.lineSoFar),R=sC(e,-10,T),F=this.lineSoFar;if(this.currentVertex)if(R){let B=this.currentVertexIsOutside,U=this.currentVertex,k=new PI(e.x,e.y,I,this.lineSoFar);OI(U,k,-10,T),sC(k,-10,T)||(B&&(this.e1=this.e2=-1,this.lineSoFar=U.w,this.addHalfVertex(U,E,D,x,!1,c,h,U.z),this.addHalfVertex(U,y,w,x,!0,-p,h,U.z)),this.addVerticesTo(U,k,E,D,y,w,c,p,h,x))}else{let B=this.currentVertex;this.currentVertexIsOutside&&(OI(B,S,-10,T),this.e1=this.e2=-1,this.lineSoFar=B.w,this.addHalfVertex(B,E,D,x,!1,c,h,B.z),this.addHalfVertex(B,y,w,x,!0,-p,h,B.z)),this.addVerticesTo(B,S,E,D,y,w,c,p,h,x)}else R||(this.addHalfVertex(e,E,D,x,!1,c,h,m),this.addHalfVertex(e,y,w,x,!0,-p,h,m));this.currentVertex=S,this.currentVertexIsOutside=R,this.lineSoFar=F}else this.addHalfVertex(e,E,D,x,!1,c,h,m),this.addHalfVertex(e,y,w,x,!0,-p,h,m)}addHalfVertex({x:e,y:r},c,p,h,m,x,E,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let y=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),E.primitiveLength++),m?this.e2=y:this.e1=y,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}function sC(l,e,r){return l.x<e||l.x>r||l.y<e||l.y>r}let aC,lC;function cC(l,e,r){return e*(at/(l.tileSize*Math.pow(2,r-l.tileID.overscaledZ)))}function uC(l,e){return 1/cC(l,1,e.tileZoom)}function hC(l,e,r,c){return l.translatePosMatrix(c||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}mt(qx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let dC=l=>{let e=[];fC(l)&&e.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let r=l.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let c=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return c&&p&&e.push("LINE_JOIN_NONE"),e};function fC(l){let e=l.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Wx,pC=()=>Wx||(Wx={layout:aC||(aC=new ui({"line-cap":new Tt(Re.layout_line["line-cap"]),"line-join":new Tt(Re.layout_line["line-join"]),"line-miter-limit":new it(Re.layout_line["line-miter-limit"]),"line-round-limit":new it(Re.layout_line["line-round-limit"]),"line-sort-key":new Tt(Re.layout_line["line-sort-key"]),"line-z-offset":new Tt(Re.layout_line["line-z-offset"]),visibility:new it(Re.layout_line.visibility)})),paint:lC||(lC=new ui({"line-opacity":new Tt(Re.paint_line["line-opacity"]),"line-color":new Tt(Re.paint_line["line-color"]),"line-translate":new it(Re.paint_line["line-translate"]),"line-translate-anchor":new it(Re.paint_line["line-translate-anchor"]),"line-width":new Tt(Re.paint_line["line-width"]),"line-gap-width":new Tt(Re.paint_line["line-gap-width"]),"line-offset":new Tt(Re.paint_line["line-offset"]),"line-blur":new Tt(Re.paint_line["line-blur"]),"line-dasharray":new Tt(Re.paint_line["line-dasharray"]),"line-pattern":new Tt(Re.paint_line["line-pattern"]),"line-gradient":new Ao(Re.paint_line["line-gradient"]),"line-trim-offset":new it(Re.paint_line["line-trim-offset"]),"line-trim-fade-range":new it(Re.paint_line["line-trim-fade-range"]),"line-trim-color":new it(Re.paint_line["line-trim-color"]),"line-emissive-strength":new it(Re.paint_line["line-emissive-strength"]),"line-border-width":new Tt(Re.paint_line["line-border-width"]),"line-border-color":new Tt(Re.paint_line["line-border-color"]),"line-occlusion-opacity":new it(Re.paint_line["line-occlusion-opacity"])}))},Wx);class wL extends Tt{possiblyEvaluate(e,r){return r=new vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,c,p){return r=mr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,c,p)}}let Np;function mC(l,e){return e>0?e+2*l:l}let TL=Dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),EL=Dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),IL=Dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let CL=Dn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),DL=Dn([{name:"a_texb",components:2,type:"Uint16"}]),ML=Dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),SL=Dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let gC=Dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),AL=Dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Dn([{name:"triangle",components:3,type:"Uint16"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Dn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Dn([{type:"Float32",name:"offsetX"}]),Dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ur=24;let ws=128;function Zx(l,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new vi(l+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:p}=r,h=0;for(;h<c.length&&c[h]<=l;)h++;h=Math.max(0,h-1);let m=h;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);let x=c[h],E=c[m];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:E,minSize:r.evaluate(new vi(x)),maxSize:r.evaluate(new vi(E)),interpolationType:p}}}function P_(l,{uSize:e,uSizeT:r},{lowerSize:c,upperSize:p}){return l.kind==="source"?c/ws:l.kind==="composite"?Pt(c/ws,p/ws,r):e}function ad(l,e){let r=0,c=0;if(l.kind==="constant")c=l.layoutSize;else if(l.kind!=="source"){let{interpolationType:p,minZoom:h,maxZoom:m}=l,x=p?Qt(Jr.interpolationFactor(p,e,h,m),0,1):0;l.kind==="camera"?c=Pt(l.minSize,l.maxSize,x):r=x}return{uSizeT:r,uSize:c}}var PL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ws,evaluateSizeForFeature:P_,evaluateSizeForZoom:ad,getSizeData:Zx});function RL(l,e,r){return l.sections.forEach(c=>{c.text=function(p,h,m){let x=h.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),Vr.applyArabicShaping&&(p=Vr.applyArabicShaping(p)),p}(c.text,e,r)}),l}let zp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function OL(l){return l==="\uFE36"||l==="\uFE48"||l==="\uFE38"||l==="\uFE44"||l==="\uFE42"||l==="\uFE3E"||l==="\uFE3C"||l==="\uFE3A"||l==="\uFE18"||l==="\uFE40"||l==="\uFE10"||l==="\uFE13"||l==="\uFE14"||l==="\uFF40"||l==="\uFFE3"||l==="\uFE11"||l==="\uFE12"}function LL(l){return l==="\uFE35"||l==="\uFE47"||l==="\uFE37"||l==="\uFE43"||l==="\uFE41"||l==="\uFE3D"||l==="\uFE3B"||l==="\uFE39"||l==="\uFE17"||l==="\uFE3F"}var _C,Xx,yC,Yx={};function FL(){return _C||(_C=1,Yx.read=function(l,e,r,c,p){var h,m,x=8*p-c-1,E=(1<<x)-1,D=E>>1,y=-7,w=r?p-1:0,C=r?-1:1,T=l[e+w];for(w+=C,h=T&(1<<-y)-1,T>>=-y,y+=x;y>0;h=256*h+l[e+w],w+=C,y-=8);for(m=h&(1<<-y)-1,h>>=-y,y+=c;y>0;m=256*m+l[e+w],w+=C,y-=8);if(h===0)h=1-D;else{if(h===E)return m?NaN:1/0*(T?-1:1);m+=Math.pow(2,c),h-=D}return(T?-1:1)*m*Math.pow(2,h-c)},Yx.write=function(l,e,r,c,p,h){var m,x,E,D=8*h-p-1,y=(1<<D)-1,w=y>>1,C=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=c?0:h-1,I=c?1:-1,S=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=y):(m=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-m))<1&&(m--,E*=2),(e+=m+w>=1?C/E:C*Math.pow(2,1-w))*E>=2&&(m++,E/=2),m+w>=y?(x=0,m=y):m+w>=1?(x=(e*E-1)*Math.pow(2,p),m+=w):(x=e*Math.pow(2,w-1)*Math.pow(2,p),m=0));p>=8;l[r+T]=255&x,T+=I,x/=256,p-=8);for(m=m<<p|x,D+=p;D>0;l[r+T]=255&m,T+=I,m/=256,D-=8);l[r+T-I]|=128*S}),Yx}function vC(){if(yC)return Xx;yC=1,Xx=e;var l=FL();function e(k){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(k)?k:new Uint8Array(k||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,c=1/r,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(k){return k.type===e.Bytes?k.readVarint()+k.pos:k.pos+1}function m(k,G,H){return H?4294967296*G+(k>>>0):4294967296*(G>>>0)+(k>>>0)}function x(k,G,H){var K=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));H.realloc(K);for(var te=H.pos-1;te>=k;te--)H.buf[te+K]=H.buf[te]}function E(k,G){for(var H=0;H<k.length;H++)G.writeVarint(k[H])}function D(k,G){for(var H=0;H<k.length;H++)G.writeSVarint(k[H])}function y(k,G){for(var H=0;H<k.length;H++)G.writeFloat(k[H])}function w(k,G){for(var H=0;H<k.length;H++)G.writeDouble(k[H])}function C(k,G){for(var H=0;H<k.length;H++)G.writeBoolean(k[H])}function T(k,G){for(var H=0;H<k.length;H++)G.writeFixed32(k[H])}function I(k,G){for(var H=0;H<k.length;H++)G.writeSFixed32(k[H])}function S(k,G){for(var H=0;H<k.length;H++)G.writeFixed64(k[H])}function R(k,G){for(var H=0;H<k.length;H++)G.writeSFixed64(k[H])}function F(k,G){return(k[G]|k[G+1]<<8|k[G+2]<<16)+16777216*k[G+3]}function B(k,G,H){k[H]=G,k[H+1]=G>>>8,k[H+2]=G>>>16,k[H+3]=G>>>24}function U(k,G){return(k[G]|k[G+1]<<8|k[G+2]<<16)+(k[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(k,G,H){for(H=H||this.length;this.pos<H;){var K=this.readVarint(),te=K>>3,ie=this.pos;this.type=7&K,k(te,G,this),this.pos===ie&&this.skip(K)}return G},readMessage:function(k,G){return this.readFields(k,G,this.readVarint()+this.pos)},readFixed32:function(){var k=F(this.buf,this.pos);return this.pos+=4,k},readSFixed32:function(){var k=U(this.buf,this.pos);return this.pos+=4,k},readFixed64:function(){var k=F(this.buf,this.pos)+F(this.buf,this.pos+4)*r;return this.pos+=8,k},readSFixed64:function(){var k=F(this.buf,this.pos)+U(this.buf,this.pos+4)*r;return this.pos+=8,k},readFloat:function(){var k=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,k},readDouble:function(){var k=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,k},readVarint:function(k){var G,H,K=this.buf;return G=127&(H=K[this.pos++]),H<128?G:(G|=(127&(H=K[this.pos++]))<<7,H<128?G:(G|=(127&(H=K[this.pos++]))<<14,H<128?G:(G|=(127&(H=K[this.pos++]))<<21,H<128?G:function(te,ie,Q){var ue,se,de=Q.buf;if(ue=(112&(se=de[Q.pos++]))>>4,se<128||(ue|=(127&(se=de[Q.pos++]))<<3,se<128)||(ue|=(127&(se=de[Q.pos++]))<<10,se<128)||(ue|=(127&(se=de[Q.pos++]))<<17,se<128)||(ue|=(127&(se=de[Q.pos++]))<<24,se<128)||(ue|=(1&(se=de[Q.pos++]))<<31,se<128))return m(te,ue,ie);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&(H=K[this.pos]))<<28,k,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var k=this.readVarint();return k%2==1?(k+1)/-2:k/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var k=this.readVarint()+this.pos,G=this.pos;return this.pos=k,k-G>=12&&p?function(H,K,te){return p.decode(H.subarray(K,te))}(this.buf,G,k):function(H,K,te){for(var ie="",Q=K;Q<te;){var ue,se,de,ve=H[Q],Te=null,Ee=ve>239?4:ve>223?3:ve>191?2:1;if(Q+Ee>te)break;Ee===1?ve<128&&(Te=ve):Ee===2?(192&(ue=H[Q+1]))==128&&(Te=(31&ve)<<6|63&ue)<=127&&(Te=null):Ee===3?(se=H[Q+2],(192&(ue=H[Q+1]))==128&&(192&se)==128&&((Te=(15&ve)<<12|(63&ue)<<6|63&se)<=2047||Te>=55296&&Te<=57343)&&(Te=null)):Ee===4&&(se=H[Q+2],de=H[Q+3],(192&(ue=H[Q+1]))==128&&(192&se)==128&&(192&de)==128&&((Te=(15&ve)<<18|(63&ue)<<12|(63&se)<<6|63&de)<=65535||Te>=1114112)&&(Te=null)),Te===null?(Te=65533,Ee=1):Te>65535&&(Te-=65536,ie+=String.fromCharCode(Te>>>10&1023|55296),Te=56320|1023&Te),ie+=String.fromCharCode(Te),Q+=Ee}return ie}(this.buf,G,k)},readBytes:function(){var k=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,k);return this.pos=k,G},readPackedVarint:function(k,G){if(this.type!==e.Bytes)return k.push(this.readVarint(G));var H=h(this);for(k=k||[];this.pos<H;)k.push(this.readVarint(G));return k},readPackedSVarint:function(k){if(this.type!==e.Bytes)return k.push(this.readSVarint());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readSVarint());return k},readPackedBoolean:function(k){if(this.type!==e.Bytes)return k.push(this.readBoolean());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readBoolean());return k},readPackedFloat:function(k){if(this.type!==e.Bytes)return k.push(this.readFloat());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readFloat());return k},readPackedDouble:function(k){if(this.type!==e.Bytes)return k.push(this.readDouble());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readDouble());return k},readPackedFixed32:function(k){if(this.type!==e.Bytes)return k.push(this.readFixed32());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readFixed32());return k},readPackedSFixed32:function(k){if(this.type!==e.Bytes)return k.push(this.readSFixed32());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readSFixed32());return k},readPackedFixed64:function(k){if(this.type!==e.Bytes)return k.push(this.readFixed64());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readFixed64());return k},readPackedSFixed64:function(k){if(this.type!==e.Bytes)return k.push(this.readSFixed64());var G=h(this);for(k=k||[];this.pos<G;)k.push(this.readSFixed64());return k},skip:function(k){var G=7&k;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(k,G){this.writeVarint(k<<3|G)},realloc:function(k){for(var G=this.length||16;G<this.pos+k;)G*=2;if(G!==this.length){var H=new Uint8Array(G);H.set(this.buf),this.buf=H,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(k){this.realloc(4),B(this.buf,k,this.pos),this.pos+=4},writeSFixed32:function(k){this.realloc(4),B(this.buf,k,this.pos),this.pos+=4},writeFixed64:function(k){this.realloc(8),B(this.buf,-1&k,this.pos),B(this.buf,Math.floor(k*c),this.pos+4),this.pos+=8},writeSFixed64:function(k){this.realloc(8),B(this.buf,-1&k,this.pos),B(this.buf,Math.floor(k*c),this.pos+4),this.pos+=8},writeVarint:function(k){(k=+k||0)>268435455||k<0?function(G,H){var K,te;if(G>=0?(K=G%4294967296|0,te=G/4294967296|0):(te=~(-G/4294967296),4294967295^(K=~(-G%4294967296))?K=K+1|0:(K=0,te=te+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),function(ie,Q,ue){ue.buf[ue.pos++]=127&ie|128,ie>>>=7,ue.buf[ue.pos++]=127&ie|128,ie>>>=7,ue.buf[ue.pos++]=127&ie|128,ie>>>=7,ue.buf[ue.pos++]=127&ie|128,ue.buf[ue.pos]=127&(ie>>>=7)}(K,0,H),function(ie,Q){var ue=(7&ie)<<4;Q.buf[Q.pos++]|=ue|((ie>>>=3)?128:0),ie&&(Q.buf[Q.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(Q.buf[Q.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(Q.buf[Q.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(Q.buf[Q.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(Q.buf[Q.pos++]=127&ie)))))}(te,H)}(k,this):(this.realloc(4),this.buf[this.pos++]=127&k|(k>127?128:0),k<=127||(this.buf[this.pos++]=127&(k>>>=7)|(k>127?128:0),k<=127||(this.buf[this.pos++]=127&(k>>>=7)|(k>127?128:0),k<=127||(this.buf[this.pos++]=k>>>7&127))))},writeSVarint:function(k){this.writeVarint(k<0?2*-k-1:2*k)},writeBoolean:function(k){this.writeVarint(!!k)},writeString:function(k){k=String(k),this.realloc(4*k.length),this.pos++;var G=this.pos;this.pos=function(K,te,ie){for(var Q,ue,se=0;se<te.length;se++){if((Q=te.charCodeAt(se))>55295&&Q<57344){if(!ue){Q>56319||se+1===te.length?(K[ie++]=239,K[ie++]=191,K[ie++]=189):ue=Q;continue}if(Q<56320){K[ie++]=239,K[ie++]=191,K[ie++]=189,ue=Q;continue}Q=ue-55296<<10|Q-56320|65536,ue=null}else ue&&(K[ie++]=239,K[ie++]=191,K[ie++]=189,ue=null);Q<128?K[ie++]=Q:(Q<2048?K[ie++]=Q>>6|192:(Q<65536?K[ie++]=Q>>12|224:(K[ie++]=Q>>18|240,K[ie++]=Q>>12&63|128),K[ie++]=Q>>6&63|128),K[ie++]=63&Q|128)}return ie}(this.buf,k,this.pos);var H=this.pos-G;H>=128&&x(G,H,this),this.pos=G-1,this.writeVarint(H),this.pos+=H},writeFloat:function(k){this.realloc(4),l.write(this.buf,k,this.pos,!0,23,4),this.pos+=4},writeDouble:function(k){this.realloc(8),l.write(this.buf,k,this.pos,!0,52,8),this.pos+=8},writeBytes:function(k){var G=k.length;this.writeVarint(G),this.realloc(G);for(var H=0;H<G;H++)this.buf[this.pos++]=k[H]},writeRawMessage:function(k,G){this.pos++;var H=this.pos;k(G,this);var K=this.pos-H;K>=128&&x(H,K,this),this.pos=H-1,this.writeVarint(K),this.pos+=K},writeMessage:function(k,G,H){this.writeTag(k,e.Bytes),this.writeRawMessage(G,H)},writePackedVarint:function(k,G){G.length&&this.writeMessage(k,E,G)},writePackedSVarint:function(k,G){G.length&&this.writeMessage(k,D,G)},writePackedBoolean:function(k,G){G.length&&this.writeMessage(k,C,G)},writePackedFloat:function(k,G){G.length&&this.writeMessage(k,y,G)},writePackedDouble:function(k,G){G.length&&this.writeMessage(k,w,G)},writePackedFixed32:function(k,G){G.length&&this.writeMessage(k,T,G)},writePackedSFixed32:function(k,G){G.length&&this.writeMessage(k,I,G)},writePackedFixed64:function(k,G){G.length&&this.writeMessage(k,S,G)},writePackedSFixed64:function(k,G){G.length&&this.writeMessage(k,R,G)},writeBytesField:function(k,G){this.writeTag(k,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(k,G){this.writeTag(k,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(k,G){this.writeTag(k,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(k,G){this.writeTag(k,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(k,G){this.writeTag(k,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(k,G){this.writeTag(k,e.Varint),this.writeVarint(G)},writeSVarintField:function(k,G){this.writeTag(k,e.Varint),this.writeSVarint(G)},writeStringField:function(k,G){this.writeTag(k,e.Bytes),this.writeString(G)},writeFloatField:function(k,G){this.writeTag(k,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(k,G){this.writeTag(k,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(k,G){this.writeVarintField(k,!!G)}},Xx}var R_=P(vC());let Kx=3;function kL(l,e,r){e.glyphs=[],l===1&&r.readMessage(NL,e)}function NL(l,e,r){if(l===3){let{id:c,bitmap:p,width:h,height:m,left:x,top:E,advance:D}=r.readMessage(zL,{});e.glyphs.push({id:c,bitmap:new tc({width:h+2*Kx,height:m+2*Kx},p),metrics:{width:h,height:m,left:x,top:E,advance:D}})}else l===4?e.ascender=r.readSVarint():l===5&&(e.descender=r.readSVarint())}function zL(l,e,r){l===1?e.id=r.readVarint():l===2?e.bitmap=r.readBytes():l===3?e.width=r.readVarint():l===4?e.height=r.readVarint():l===5?e.left=r.readSVarint():l===6?e.top=r.readSVarint():l===7&&(e.advance=r.readVarint())}let xC=Kx,Oo={horizontal:1,vertical:2,horizontalOnly:3};class Bp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let c=new Bp;return c.scale=e||1,c.fontStack=r,c}static forImage(e){let r=new Bp;return r.imageName=e,r}}class ld{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let c=new ld;for(let p=0;p<e.sections.length;p++){let h=e.sections[p];h.image?c.addImageSection(h):c.addTextSection(h,r)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,c){let p="";for(let h=0;h<r.length;h++){let m=r.charCodeAt(h+1)||null,x=r.charCodeAt(h-1)||null;p+=!c&&(m&&uu(m)&&!zp[r[h+1]]||x&&uu(x)&&!zp[r[h-1]])||!zp[r[h]]?r[h]:zp[r[h]]}return p}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&O_[this.text.charCodeAt(c)];c++)e++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&O_[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let c=new ld;return c.text=this.text.substring(e,r),c.sectionIndex=this.sectionIndex.slice(e,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Bp.forText(e.scale,e.fontStack||r));let c=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(c)}addImageSection(e){let r=e.image?e.image.namePrimary:"";if(r.length===0)return void In("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Bp.forImage(r)),this.sectionIndex.push(this.sections.length-1)):In("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jx(l,e,r,c,p,h,m,x,E,D,y,w,C,T,I){let S=ld.fromFeature(l,p);w===Oo.vertical&&S.verticalizePunctuation(C);let R=[],F=function(H,K,te,ie,Q,ue){if(!H)return[];let se=[],de=function(Ie,Oe,De,je,We,Ne){let ut=0;for(let ot=0;ot<Ie.length();ot++){let tt=Ie.getSection(ot);ut+=bC(Ie.getCodePoint(ot),tt,je,We,Oe,Ne)}return ut/Math.max(1,Math.ceil(ut/De))}(H,K,te,ie,Q,ue),ve=H.text.indexOf("\u200B")>=0,Te=0;for(let Ie=0;Ie<H.length();Ie++){let Oe=H.getSection(Ie),De=H.getCodePoint(Ie);if(O_[De]||(Te+=bC(De,Oe,ie,Q,K,ue)),Ie<H.length()-1){let je=!((Ee=De)<11904||!(bt["Bopomofo Extended"](Ee)||bt.Bopomofo(Ee)||bt["CJK Compatibility Forms"](Ee)||bt["CJK Compatibility Ideographs"](Ee)||bt["CJK Compatibility"](Ee)||bt["CJK Radicals Supplement"](Ee)||bt["CJK Strokes"](Ee)||bt["CJK Symbols and Punctuation"](Ee)||bt["CJK Unified Ideographs Extension A"](Ee)||bt["CJK Unified Ideographs"](Ee)||bt["Enclosed CJK Letters and Months"](Ee)||bt["Halfwidth and Fullwidth Forms"](Ee)||bt.Hiragana(Ee)||bt["Ideographic Description Characters"](Ee)||bt["Kangxi Radicals"](Ee)||bt["Katakana Phonetic Extensions"](Ee)||bt.Katakana(Ee)||bt["Vertical Forms"](Ee)||bt["Yi Radicals"](Ee)||bt["Yi Syllables"](Ee)));(BL[De]||je||Oe.imageName)&&se.push(TC(Ie+1,Te,de,se,VL(De,H.getCodePoint(Ie+1),je&&ve),!1))}}var Ee;return EC(TC(H.length(),Te,de,se,0,!0))}(S,D,h,e,c,T),{processBidirectionalText:B,processStyledBidirectionalText:U}=Vr;if(B&&S.sections.length===1){let H=B(S.toString(),F);for(let K of H){let te=new ld;te.text=K,te.sections=S.sections;for(let ie=0;ie<K.length;ie++)te.sectionIndex.push(0);R.push(te)}}else if(U){let H=U(S.text,S.sectionIndex,F);for(let K of H){let te=new ld;te.text=K[0],te.sectionIndex=K[1],te.sections=S.sections,R.push(te)}}else R=function(H,K){let te=[],ie=H.text,Q=0;for(let ue of K)te.push(H.substring(Q,ue)),Q=ue;return Q<ie.length&&te.push(H.substring(Q,ie.length)),te}(S,F);let k=[],G={positionedLines:k,text:S.toString(),top:y[1],bottom:y[1],left:y[0],right:y[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(H,K,te,ie,Q,ue,se,de,ve,Te,Ee,Ie){let Oe=0,De=0,je=0,We=de==="right"?1:de==="left"?0:.5,Ne=!1;for(let ct of Q){let pt=ct.getSections();for(let Nt of pt){if(Nt.imageName)continue;let sn=K[Nt.fontStack];if(sn&&(Ne=sn.ascender!==void 0&&sn.descender!==void 0,!Ne))break}if(!Ne)break}let ut=0;for(let ct of Q){ct.trim();let pt=ct.getMaxScale(),Nt=(pt-1)*ur,sn={positionedGlyphs:[],lineOffset:0};H.positionedLines[ut]=sn;let Kt=sn.positionedGlyphs,Jt=0;if(!ct.length()){De+=ue,++ut;continue}let dn=0,pn=0;for(let Nn=0;Nn<ct.length();Nn++){let jt=ct.getSection(Nn),An=ct.getSectionIndex(Nn),On=ct.getCodePoint(Nn),si=jt.scale,Ti=null,Ni=null,Ei=null,_i=ur,Qi=0,Vi=!(ve===Oo.horizontal||!Ee&&!jh(On)||Ee&&(O_[On]||(ot=On,bt.Arabic(ot)||bt["Arabic Supplement"](ot)||bt["Arabic Extended-A"](ot)||bt["Arabic Presentation Forms-A"](ot)||bt["Arabic Presentation Forms-B"](ot))));if(jt.imageName){let hr=ie[jt.imageName];if(!hr)continue;Ei=jt.imageName,H.iconsInText=H.iconsInText||!0,Ni=hr.paddedRect;let ii=hr.displaySize;si=si*ur/Ie,Ti={width:ii[0],height:ii[1],left:0,top:-xC,advance:Vi?ii[1]:ii[0],localGlyph:!1},Qi=Ne?-Ti.height*si:pt*ur-17-ii[1]*si,_i=Ti.advance;let to=(Vi?ii[0]:ii[1])*si-ur*pt;to>0&&to>Jt&&(Jt=to)}else{let hr=te[jt.fontStack];if(!hr)continue;hr[On]&&(Ni=hr[On]);let ii=K[jt.fontStack];if(!ii)continue;let to=ii.glyphs[On];if(!to)continue;if(Ti=to.metrics,_i=On!==8203?ur:0,Ne){let Ds=ii.ascender!==void 0?Math.abs(ii.ascender):0,Jo=ii.descender!==void 0?Math.abs(ii.descender):0,Qo=(Ds+Jo)*si;dn<Qo&&(dn=Qo,pn=(Ds-Jo)/2*si),Qi=-Ds*si}else Qi=(pt-si)*ur-17}Vi?(H.verticalizable=!0,Kt.push({glyph:On,imageName:Ei,x:Oe,y:De+Qi,vertical:Vi,scale:si,localGlyph:Ti.localGlyph,fontStack:jt.fontStack,sectionIndex:An,metrics:Ti,rect:Ni}),Oe+=_i*si+Te):(Kt.push({glyph:On,imageName:Ei,x:Oe,y:De+Qi,vertical:Vi,scale:si,localGlyph:Ti.localGlyph,fontStack:jt.fontStack,sectionIndex:An,metrics:Ti,rect:Ni}),Oe+=Ti.advance*si+Te)}Kt.length!==0&&(je=Math.max(Oe-Te,je),Ne?IC(Kt,We,Jt,pn,ue*pt/2):IC(Kt,We,Jt,0,ue/2)),Oe=0;let Kn=ue*pt+Jt;sn.lineOffset=Math.max(Jt,Nt),De+=Kn,++ut}var ot;let tt=De,{horizontalAlign:Ke,verticalAlign:It}=Qx(se);(function(ct,pt,Nt,sn,Kt,Jt){let dn=(pt-Nt)*Kt,pn=-Jt*sn;for(let Kn of ct)for(let Nn of Kn.positionedGlyphs)Nn.x+=dn,Nn.y+=pn})(H.positionedLines,We,Ke,It,je,tt),H.top+=-It*tt,H.bottom=H.top+tt,H.left+=-Ke*je,H.right=H.left+je,H.hasBaseline=Ne}(G,e,r,c,R,m,x,E,w,D,C,I),!function(H){for(let K of H)if(K.positionedGlyphs.length!==0)return!1;return!0}(k)&&G}let O_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},BL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bC(l,e,r,c,p,h){if(e.imageName){let m=c[e.imageName];return m?m.displaySize[0]*e.scale*ur/h+p:0}{let m=r[e.fontStack],x=m&&m.glyphs[l];return x?x.metrics.advance*e.scale+p:0}}function wC(l,e,r,c){let p=Math.pow(l-e,2);return c?l<e?p/2:2*p:p+Math.abs(r)*r}function VL(l,e,r){let c=0;return l===10&&(c-=1e4),r&&(c+=150),l!==40&&l!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function TC(l,e,r,c,p,h){let m=null,x=wC(e,r,p,h);for(let E of c){let D=wC(e-E.x,r,p,h)+E.badness;D<=x&&(m=E,x=D)}return{index:l,x:e,priorBreak:m,badness:x}}function EC(l){return l?EC(l.priorBreak).concat(l.index):[]}function Qx(l){let e=.5,r=.5;switch(l){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function IC(l,e,r,c,p){if(!(e||r||c||p))return;let h=l.length-1,m=l[h],x=(m.x+m.metrics.advance*m.scale)*e;for(let E=0;E<=h;E++)l[E].x-=x,l[E].y+=r+c+p}function jL(l,e,r,c){let{horizontalAlign:p,verticalAlign:h}=Qx(c),m=r[0]-l.displaySize[0]*p,x=r[1]-l.displaySize[1]*h;return{imagePrimary:l,imageSecondary:e,top:x,bottom:x+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function CC(l,e,r,c,p,h){let m=l.imagePrimary,x;if(m.content){let R=m.content,F=m.pixelRatio||1;x=[R[0]/F,R[1]/F,m.displaySize[0]-R[2]/F,m.displaySize[1]-R[3]/F]}let E=e.left*h,D=e.right*h,y,w,C,T;r==="width"||r==="both"?(T=p[0]+E-c[3],w=p[0]+D+c[1]):(T=p[0]+(E+D-m.displaySize[0])/2,w=T+m.displaySize[0]);let I=e.top*h,S=e.bottom*h;return r==="height"||r==="both"?(y=p[1]+I-c[0],C=p[1]+S+c[2]):(y=p[1]+(I+S-m.displaySize[1])/2,C=y+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:y,right:w,bottom:C,left:T,collisionPadding:x}}class Ha extends st{constructor(e,r,c,p,h){super(e,r),this.angle=p,this.z=c,h!==void 0&&(this.segment=h)}clone(){return new Ha(this.x,this.y,this.z,this.angle,this.segment)}}function DC(l,e,r,c,p){if(e.segment===void 0)return!0;let h=e,m=e.segment+1,x=0;for(;x>-r/2;){if(m--,m<0)return!1;x-=l[m].dist(h),h=l[m]}x+=l[m].dist(l[m+1]),m++;let E=[],D=0;for(;x<r/2;){let y=l[m],w=l[m+1];if(!w)return!1;let C=l[m-1].angleTo(y)-y.angleTo(w);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:C}),D+=C;x-E[0].distance>c;)D-=E.shift().angleDelta;if(D>p)return!1;m++,x+=y.dist(w)}return!0}function MC(l){let e=0;for(let r=0;r<l.length-1;r++)e+=l[r].dist(l[r+1]);return e}function SC(l,e,r){return l?.6*e*r:0}function AC(l,e){return Math.max(l?l.right-l.left:0,e?e.right-e.left:0)}function UL(l,e,r,c,p,h){let m=SC(r,p,h),x=AC(r,c)*h,E=0,D=MC(l)/2;for(let y=0;y<l.length-1;y++){let w=l[y],C=l[y+1],T=w.dist(C);if(E+T>D){let I=(D-E)/T,S=Pt(w.x,C.x,I),R=Pt(w.y,C.y,I),F=new Ha(S,R,0,C.angleTo(w),y);return!m||DC(l,F,x,m,e)?F:void 0}E+=T}}function $L(l,e,r,c,p,h,m,x,E){let D=SC(c,h,m),y=AC(c,p),w=y*m,C=l[0].x===0||l[0].x===E||l[0].y===0||l[0].y===E;return e-w<e/4&&(e=w+e/4),PC(l,C?e/2*x%e:(y/2+2*h)*m*x%e,e,D,r,w,C,!1,E)}function PC(l,e,r,c,p,h,m,x,E){let D=h/2,y=MC(l),w=0,C=e-r,T=[];for(let I=0;I<l.length-1;I++){let S=l[I],R=l[I+1],F=S.dist(R),B=R.angleTo(S);for(;C+r<w+F;){C+=r;let U=(C-w)/F,k=Pt(S.x,R.x,U),G=Pt(S.y,R.y,U);if(k>=0&&k<E&&G>=0&&G<E&&C-D>=0&&C+D<=y){let H=new Ha(k,G,0,B,I);c&&!DC(l,H,h,c,p)||T.push(H)}}w+=F}return x||T.length||m||(T=PC(l,w/2,r,c,p,h,m,!0,E)),T}function RC(l,e,r,c,p){let h=[];for(let m=0;m<l.length;m++){let x=l[m],E;for(let D=0;D<x.length-1;D++){let y=x[D],w=x[D+1];y.x<e&&w.x<e||(y.x<e?y=new st(e,y.y+(e-y.x)/(w.x-y.x)*(w.y-y.y))._round():w.x<e&&(w=new st(e,y.y+(e-y.x)/(w.x-y.x)*(w.y-y.y))._round()),y.y<r&&w.y<r||(y.y<r?y=new st(y.x+(r-y.y)/(w.y-y.y)*(w.x-y.x),r)._round():w.y<r&&(w=new st(y.x+(r-y.y)/(w.y-y.y)*(w.x-y.x),r)._round()),y.x>=c&&w.x>=c||(y.x>=c?y=new st(c,y.y+(c-y.x)/(w.x-y.x)*(w.y-y.y))._round():w.x>=c&&(w=new st(c,y.y+(c-y.x)/(w.x-y.x)*(w.y-y.y))._round()),y.y>=p&&w.y>=p||(y.y>=p?y=new st(y.x+(p-y.y)/(w.y-y.y)*(w.x-y.x),p)._round():w.y>=p&&(w=new st(y.x+(p-y.y)/(w.y-y.y)*(w.x-y.x),p)._round()),E&&y.equals(E[E.length-1])||(E=[y],h.push(E)),E.push(w)))))}}return h}function OC(l){let e=0,r=0;for(let m of l)e+=m.w*m.h,r=Math.max(r,m.w);l.sort((m,x)=>x.h-m.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],p=0,h=0;for(let m of l)for(let x=c.length-1;x>=0;x--){let E=c[x];if(!(m.w>E.w||m.h>E.h)){if(m.x=E.x,m.y=E.y,h=Math.max(h,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===E.w&&m.h===E.h){let D=c.pop();x<c.length&&(c[x]=D)}else m.h===E.h?(E.x+=m.w,E.w-=m.w):m.w===E.w?(E.y+=m.h,E.h-=m.h):(c.push({x:E.x+m.w,y:E.y,w:E.w-m.w,h:m.h}),E.y+=m.h,E.h-=m.h);break}}return{w:p,h,fill:e/(p*h)||0}}mt(Ha,"Anchor");let Vp=1;class e1{constructor(e,{pixelRatio:r,version:c,stretchX:p,stretchY:h,content:m},x){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=h,this.content=m,this.version=c,this.padding=x}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class LC{constructor(e,r,c){let p={},h={};this.haveRenderCallbacks=[];let m=[];this.addImages(e,p,Vp,m),this.addImages(r,h,2,m);let{w:x,h:E}=OC(m),D=new Rr({width:x||1,height:E||1});for(let y in e){let w=e[y],C=p[y].paddedRect;Rr.copy(w.data,D,{x:0,y:0},{x:C.x+Vp,y:C.y+Vp},w.data,c,w.sdf)}for(let y in r){let w=r[y],C=h[y].paddedRect,T=h[y].padding,I=C.x+T,S=C.y+T,R=w.data.width,F=w.data.height;T=T>1?T-1:T,Rr.copy(w.data,D,{x:0,y:0},{x:I,y:S},w.data,c),Rr.copy(w.data,D,{x:0,y:F-T},{x:I,y:S-T},{width:R,height:T},c),Rr.copy(w.data,D,{x:0,y:0},{x:I,y:S+F},{width:R,height:T},c),Rr.copy(w.data,D,{x:R-T,y:0},{x:I-T,y:S},{width:T,height:F},c),Rr.copy(w.data,D,{x:0,y:0},{x:I+R,y:S},{width:T,height:F},c),Rr.copy(w.data,D,{x:R-T,y:F-T},{x:I-T,y:S-T},{width:T,height:T},c),Rr.copy(w.data,D,{x:0,y:F-T},{x:I+R,y:S-T},{width:T,height:T},c),Rr.copy(w.data,D,{x:0,y:0},{x:I+R,y:S+F},{width:T,height:T},c),Rr.copy(w.data,D,{x:R-T,y:0},{x:I-T,y:S+F},{width:T,height:T},c)}this.image=D,this.iconPositions=p,this.patternPositions=h}addImages(e,r,c,p){for(let h in e){let m=e[h],x={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(x),r[h]=new e1(x,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(let p in e.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[p],e.getImage(p,c),r),this.patchUpdatedImage(this.patternPositions[p],e.getImage(p,c),r)}patchUpdatedImage(e,r,c){if(!e||!r||e.version===r.version)return;e.version=r.version;let[p,h]=e.tl;c.update(r.data,{position:{x:p,y:h}})}}mt(e1,"ImagePosition"),mt(LC,"ImageAtlas");let jp=1e20;function FC(l,e,r,c,p,h,m,x,E){for(let D=e;D<e+c;D++)kC(l,r*h+D,h,p,m,x,E);for(let D=r;D<r+p;D++)kC(l,D*h+e,1,c,m,x,E)}function kC(l,e,r,c,p,h,m){h[0]=0,m[0]=-jp,m[1]=jp,p[0]=l[e];for(let x=1,E=0,D=0;x<c;x++){p[x]=l[e+x*r];let y=x*x;do{let w=h[E];D=(p[x]-p[w]+y-w*w)/(x-w)/2}while(D<=m[E]&&--E>-1);E++,h[E]=x,m[E]=D,m[E+1]=jp}for(let x=0,E=0;x<c;x++){for(;m[E+1]<x;)E++;let D=h[E],y=x-D;l[e+x*r]=p[D]+y*y}}let Ts=2,t1={none:0,ideographs:1,all:2};class cd{constructor(e,r,c){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,c){let p=[],h=this.urls[r]||_e.GLYPHS_URL;for(let m in e)for(let x of e[m])p.push({stack:m,id:x});Ca(p,({stack:m,id:x},E)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=D.glyphs[x];if(y!==void 0)return void E(null,{stack:m,id:x,glyph:y});if(y=this._tinySDF(D,m,x),y)return D.glyphs[x]=y,void E(null,{stack:m,id:x,glyph:y});let w=Math.floor(x/256);if(256*w>65535)return void E(new Error("glyphs > 65535 not supported"));if(D.ranges[w])return void E(null,{stack:m,id:x,glyph:y});let C=D.requests[w];C||(C=D.requests[w]=[],cd.loadGlyphRange(m,w,h,this.requestManager,(T,I)=>{if(I){D.ascender=I.ascender,D.descender=I.descender;for(let S in I.glyphs)this._doesCharSupportLocalGlyph(+S)||(D.glyphs[+S]=I.glyphs[+S]);D.ranges[w]=!0}for(let S of C)S(T,I);delete D.requests[w]})),C.push((T,I)=>{T?E(T):I&&E(null,{stack:m,id:x,glyph:I.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){let E={};for(let{stack:D,id:y,glyph:w}of x)E[D]===void 0&&(E[D]={}),E[D].glyphs===void 0&&(E[D].glyphs={}),E[D].glyphs[y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},E[D].ascender=this.entries[D].ascender,E[D].descender=this.entries[D].descender;c(null,E)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==t1.none&&(this.localGlyphMode===t1.all?!!this.localFontFamily:!!this.localFontFamily&&(bt["CJK Unified Ideographs"](e)||bt["Hangul Syllables"](e)||bt.Hiragana(e)||bt.Katakana(e)||bt["CJK Symbols and Punctuation"](e)||bt["CJK Unified Ideographs Extension A"](e)||bt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,c){let p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let h=e.tinySDF;if(!h){let S="400";/bold/i.test(r)?S="900":/medium/i.test(r)?S="500":/light/i.test(r)&&(S="200"),h=e.tinySDF=new cd.TinySDF({fontFamily:p,fontWeight:S,fontSize:24*Ts,buffer:3*Ts,radius:8*Ts}),h.fontWeight=S}if(this.localGlyphs[h.fontWeight][c])return this.localGlyphs[h.fontWeight][c];let m=String.fromCodePoint(c),{data:x,width:E,height:D,glyphWidth:y,glyphHeight:w,glyphLeft:C,glyphTop:T,glyphAdvance:I}=h.draw(m);return this.localGlyphs[h.fontWeight][c]={id:c,bitmap:new tc({width:E,height:D},x),metrics:{width:y/Ts,height:w/Ts,left:C/Ts,top:T/Ts-27,advance:I/Ts,localGlyph:!0}}}}cd.loadGlyphRange=function(l,e,r,c,p){let h=256*e,m=h+255,x=c.transformRequest(c.normalizeGlyphsURL(r).replace("{fontstack}",l).replace("{range}",`${h}-${m}`),_l.Glyphs);yl(x,(E,D)=>{if(E)p(E);else if(D){let y={},w=function(C){return new R_(C).readFields(kL,{})}(D);for(let C of w.glyphs)y[C.id]=C;p(null,{glyphs:y,ascender:w.ascender,descender:w.descender})}})},cd.TinySDF=class{constructor({fontSize:l=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=r;let x=this.size=l+4*e,E=this._createCanvas(x),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${m} ${h} ${l}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(l){let e=document.createElement("canvas");return e.width=e.height=l,e}draw(l){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:h}=this.ctx.measureText(l),m=Math.ceil(r),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-p))),E=Math.min(this.size-this.buffer,m+Math.ceil(c)),D=x+2*this.buffer,y=E+2*this.buffer,w=Math.max(D*y,0),C=new Uint8ClampedArray(w),T={data:C,width:D,height:y,glyphWidth:x,glyphHeight:E,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||E===0)return T;let{ctx:I,buffer:S,gridInner:R,gridOuter:F}=this;I.clearRect(S,S,x,E),I.fillText(l,S,S+m);let B=I.getImageData(S,S,x,E);F.fill(jp,0,w),R.fill(0,0,w);for(let U=0;U<E;U++)for(let k=0;k<x;k++){let G=B.data[4*(U*x+k)+3]/255;if(G===0)continue;let H=(U+S)*D+k+S;if(G===1)F[H]=0,R[H]=jp;else{let K=.5-G;F[H]=K>0?K*K:0,R[H]=K<0?K*K:0}}FC(F,0,0,D,y,D,this.f,this.v,this.z),FC(R,S,S,x,E,D,this.f,this.v,this.z);for(let U=0;U<w;U++){let k=Math.sqrt(F[U])-Math.sqrt(R[U]);C[U]=Math.round(255-255*(k/this.radius+this.cutoff))}return T}};let ic=Vp;function NC(l,e,r,c){let p=[],h=l.imagePrimary,m=h.pixelRatio,x=h.paddedRect.w-2*ic,E=h.paddedRect.h-2*ic,D=l.right-l.left,y=l.bottom-l.top,w=h.stretchX||[[0,x]],C=h.stretchY||[[0,E]],T=(ue,se)=>ue+se[1]-se[0],I=w.reduce(T,0),S=C.reduce(T,0),R=x-I,F=E-S,B=0,U=I,k=0,G=S,H=0,K=R,te=0,ie=F;if(h.content&&c){let ue=h.content;B=L_(w,0,ue[0]),k=L_(C,0,ue[1]),U=L_(w,ue[0],ue[2]),G=L_(C,ue[1],ue[3]),H=ue[0]-B,te=ue[1]-k,K=ue[2]-ue[0]-U,ie=ue[3]-ue[1]-G}let Q=(ue,se,de,ve)=>{let Te=F_(ue.stretch-B,U,D,l.left),Ee=k_(ue.fixed-H,K,ue.stretch,I),Ie=F_(se.stretch-k,G,y,l.top),Oe=k_(se.fixed-te,ie,se.stretch,S),De=F_(de.stretch-B,U,D,l.left),je=k_(de.fixed-H,K,de.stretch,I),We=F_(ve.stretch-k,G,y,l.top),Ne=k_(ve.fixed-te,ie,ve.stretch,S),ut=new st(Te,Ie),ot=new st(De,Ie),tt=new st(De,We),Ke=new st(Te,We),It=new st(Ee/m,Oe/m),ct=new st(je/m,Ne/m),pt=e*Math.PI/180;if(pt){let pn=Math.sin(pt),Kn=Math.cos(pt),Nn=[Kn,-pn,pn,Kn];ut._matMult(Nn),ot._matMult(Nn),Ke._matMult(Nn),tt._matMult(Nn)}let Nt=ue.stretch+ue.fixed,sn=de.stretch+de.fixed,Kt=se.stretch+se.fixed,Jt=ve.stretch+ve.fixed,dn=l.imageSecondary;return{tl:ut,tr:ot,bl:Ke,br:tt,texPrimary:{x:h.paddedRect.x+ic+Nt,y:h.paddedRect.y+ic+Kt,w:sn-Nt,h:Jt-Kt},texSecondary:dn?{x:dn.paddedRect.x+ic+Nt,y:dn.paddedRect.y+ic+Kt,w:sn-Nt,h:Jt-Kt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:It,pixelOffsetBR:ct,minFontScaleX:K/m/D,minFontScaleY:ie/m/y,isSDF:r}};if(c&&(h.stretchX||h.stretchY)){let ue=zC(w,R,I),se=zC(C,F,S);for(let de=0;de<ue.length-1;de++){let ve=ue[de],Te=ue[de+1];for(let Ee=0;Ee<se.length-1;Ee++)p.push(Q(ve,se[Ee],Te,se[Ee+1]))}}else p.push(Q({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return p}function L_(l,e,r){let c=0;for(let p of l)c+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return c}function zC(l,e,r){let c=[{fixed:-ic,stretch:0}];for(let[p,h]of l){let m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(h-p)})}return c.push({fixed:e+ic,stretch:r}),c}function F_(l,e,r,c){return l/e*r+c}function k_(l,e,r,c){return l-e*r/c}function GL(l,e,r,c){let p=e+l.positionedLines[c].lineOffset;return c===0?r+p/2:r+(p+(e+l.positionedLines[c-1].lineOffset))/2}function HL(l,e=1,r=!1){let c=1/0,p=1/0,h=-1/0,m=-1/0,x=l[0];for(let T=0;T<x.length;T++){let I=x[T];(!T||I.x<c)&&(c=I.x),(!T||I.y<p)&&(p=I.y),(!T||I.x>h)&&(h=I.x),(!T||I.y>m)&&(m=I.y)}let E=Math.min(h-c,m-p),D=E/2,y=new Rf([],qL);if(E===0)return new st(c,p);for(let T=c;T<h;T+=E)for(let I=p;I<m;I+=E)y.push(new ud(T+D,I+D,D,l));let w=function(T){let I=0,S=0,R=0,F=T[0];for(let B=0,U=F.length,k=U-1;B<U;k=B++){let G=F[B],H=F[k],K=G.x*H.y-H.x*G.y;S+=(G.x+H.x)*K,R+=(G.y+H.y)*K,I+=3*K}return new ud(S/I,R/I,0,T)}(l),C=y.length;for(;y.length;){let T=y.pop();(T.d>w.d||!w.d)&&(w=T,r&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,C)),T.max-w.d<=e||(D=T.h/2,y.push(new ud(T.p.x-D,T.p.y-D,D,l)),y.push(new ud(T.p.x+D,T.p.y-D,D,l)),y.push(new ud(T.p.x-D,T.p.y+D,D,l)),y.push(new ud(T.p.x+D,T.p.y+D,D,l)),C+=4)}return r&&(console.log(`num probes: ${C}`),console.log(`best distance: ${w.d}`)),w.p}function qL(l,e){return e.max-l.max}class ud{constructor(e,r,c,p){this.p=new st(e,r),this.h=c,this.d=function(h,m){let x=!1,E=1/0;for(let D=0;D<m.length;D++){let y=m[D];for(let w=0,C=y.length,T=C-1;w<C;T=w++){let I=y[w],S=y[T];I.y>h.y!=S.y>h.y&&h.x<(S.x-I.x)*(h.y-I.y)/(S.y-I.y)+I.x&&(x=!x),E=Math.min(E,jn(h,I,S))}}return(x?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}let n1=Number.POSITIVE_INFINITY,WL=Math.sqrt(2);function BC(l,[e,r]){let c=0,p=0;if(r===n1){e<0&&(e=0);let h=e/WL;switch(l){case"top-right":case"top-left":p=h-7;break;case"bottom-right":case"bottom-left":p=7-h;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(l){case"top-right":case"bottom-right":c=-h;break;case"top-left":case"bottom-left":c=h;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),l){case"top-right":case"top-left":case"top":p=r-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-r}switch(l){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,p]}function i1(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ZL(l,e,r,c,p,h,m,x,E,D,y,w,C,T,I){let S=h.textMaxSize.evaluate(e,{},w);S===void 0&&(S=m);let R=l.layers[0].layout,F=R.get("icon-offset").evaluate(e,{},w),B=jC(r.horizontal)||r.vertical,U=C.name==="globe",k=ur,G=m/k,H=l.tilePixelRatio*S/k,K=(Te=l.overscaling,l.zoom>18&&Te>2&&(Te>>=1),Math.max(at/(512*Te),1)*R.get("symbol-spacing")),te=R.get("text-padding")*l.tilePixelRatio,ie=R.get("icon-padding")*l.tilePixelRatio,Q=_n(R.get("text-max-angle")),ue=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",se=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",de=R.get("symbol-placement"),ve=K/2;var Te;let Ee=R.get("icon-text-fit").evaluate(e,{},w),Ie=R.get("icon-text-fit-padding").evaluate(e,{},w),Oe=Ee!=="none",De;l.hasAnyIconTextFit===!1&&Oe&&(l.hasAnyIconTextFit=!0),c&&Oe&&(l.allowVerticalPlacement&&r.vertical&&(De=CC(c,r.vertical,Ee,Ie,F,G)),B&&(c=CC(c,B,Ee,Ie,F,G)));let je=(We,Ne,ut)=>{if(Ne.x<0||Ne.x>=at||Ne.y<0||Ne.y>=at)return;let ot=null;if(U){let{x:tt,y:Ke,z:It}=C.projectTilePoint(Ne.x,Ne.y,ut);ot={anchor:new Ha(tt,Ke,It,0,void 0),up:C.upVector(ut,Ne.x,Ne.y)}}(function(tt,Ke,It,ct,pt,Nt,sn,Kt,Jt,dn,pn,Kn,Nn,jt,An,On,si,Ti,Ni,Ei,_i,Qi,Vi,hr,ii,to,Ds){let Jo=tt.addToLineVertexArray(Ke,ct),Qo,Su,lc,Au,om,lM,cM,uM=0,hM=0,dM=0,fM=0,O1=-1,L1=-1,aa={},pM=Nr(""),Pu=It?It.anchor:Ke,F1=Jt.layout.get("icon-text-fit").evaluate(_i,{},ii)!=="none",k1=0,N1=0;if(Jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[k1,N1]=Jt.layout.get("text-offset").evaluate(_i,{},ii).map(mo=>mo*ur):(k1=Jt.layout.get("text-radial-offset").evaluate(_i,{},ii)*ur,N1=n1),tt.allowVerticalPlacement&&pt.vertical){let mo=pt.vertical;if(An)lM=r1(mo),Kt&&(cM=r1(Kt));else{let go=Jt.layout.get("text-rotate").evaluate(_i,{},ii)+90;lc=N_(dn,Pu,Ke,pn,Kn,Nn,mo,jt,go,On),Kt&&(Au=N_(dn,Pu,Ke,pn,Kn,Nn,Kt,Ti,go))}}if(Nt){let mo=Jt.layout.get("icon-rotate").evaluate(_i,{},ii),go=NC(Nt,mo,Vi,F1),_d=Kt?NC(Kt,mo,Vi,F1):void 0;Su=N_(dn,Pu,Ke,pn,Kn,Nn,Nt,Ti,mo),uM=4*go.length;let mM=tt.iconSizeData,Ru=null;mM.kind==="source"?(Ru=[ws*Jt.layout.get("icon-size").evaluate(_i,{},ii)],Ru[0]>rc&&In(`${tt.layerIds[0]}: Value for "icon-size" is >= ${Up}. Reduce your "icon-size".`)):mM.kind==="composite"&&(Ru=[ws*Qi.compositeIconSizes[0].evaluate(_i,{},ii),ws*Qi.compositeIconSizes[1].evaluate(_i,{},ii)],(Ru[0]>rc||Ru[1]>rc)&&In(`${tt.layerIds[0]}: Value for "icon-size" is >= ${Up}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,go,Ru,Ei,Ni,_i,!1,It,Ke,Jo.lineStartIndex,Jo.lineLength,-1,hr,ii,to,Ds),O1=tt.icon.placedSymbolArray.length-1,_d&&(hM=4*_d.length,tt.addSymbols(tt.icon,_d,Ru,Ei,Ni,_i,Oo.vertical,It,Ke,Jo.lineStartIndex,Jo.lineLength,-1,hr,ii,to,Ds),L1=tt.icon.placedSymbolArray.length-1)}for(let mo in pt.horizontal){let go=pt.horizontal[mo];Qo||(pM=Nr(go.text),An?om=r1(go):Qo=N_(dn,Pu,Ke,pn,Kn,Nn,go,jt,Jt.layout.get("text-rotate").evaluate(_i,{},ii),On));let _d=go.positionedLines.length===1;if(dM+=VC(tt,It,Ke,go,sn,Jt,An,_i,On,Jo,pt.vertical?Oo.horizontal:Oo.horizontalOnly,_d?Object.keys(pt.horizontal):[mo],aa,O1,Qi,hr,ii,to),_d)break}pt.vertical&&(fM+=VC(tt,It,Ke,pt.vertical,sn,Jt,An,_i,On,Jo,Oo.vertical,["vertical"],aa,L1,Qi,hr,ii,to));let cc=-1,z1=(mo,go)=>mo?Math.max(mo,go):go;cc=z1(om,cc),cc=z1(lM,cc),cc=z1(cM,cc);let ck=cc>-1?1:0;tt.glyphOffsetArray.length>=65535&&In("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_i.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,_i.sortKey),tt.symbolInstances.emplaceBack(Ke.x,Ke.y,Pu.x,Pu.y,Pu.z,aa.right>=0?aa.right:-1,aa.center>=0?aa.center:-1,aa.left>=0?aa.left:-1,aa.vertical>=0?aa.vertical:-1,O1,L1,pM,Qo!==void 0?Qo:tt.collisionBoxArray.length,Qo!==void 0?Qo+1:tt.collisionBoxArray.length,lc!==void 0?lc:tt.collisionBoxArray.length,lc!==void 0?lc+1:tt.collisionBoxArray.length,Su!==void 0?Su:tt.collisionBoxArray.length,Su!==void 0?Su+1:tt.collisionBoxArray.length,Au||tt.collisionBoxArray.length,Au?Au+1:tt.collisionBoxArray.length,pn,dM,fM,uM,hM,ck,0,k1,N1,cc,0,F1?1:0)})(l,Ne,ot,We,r,c,p,De,l.layers[0],l.collisionBoxArray,e.index,e.sourceLayerIndex,l.index,te,ue,E,0,ie,se,F,e,h,D,y,w,T,I)};if(de==="line")for(let We of RC(e.geometry,0,0,at,at)){let Ne=$L(We,K,Q,r.vertical||B,c,k,H,l.overscaling,at);for(let ut of Ne)B&&XL(l,B.text,ve,ut)||je(We,ut,w)}else if(de==="line-center"){for(let We of e.geometry)if(We.length>1){let Ne=UL(We,Q,r.vertical||B,c,k,H);Ne&&je(We,Ne,w)}}else if(e.type==="Polygon")for(let We of E_(e.geometry,0)){let Ne=HL(We,16);je(We[0],new Ha(Ne.x,Ne.y,0,0,void 0),w)}else if(e.type==="LineString")for(let We of e.geometry)je(We,new Ha(We[0].x,We[0].y,0,0,void 0),w);else if(e.type==="Point")for(let We of e.geometry)for(let Ne of We)je([Ne],new Ha(Ne.x,Ne.y,0,0,void 0),w)}let Up=255,rc=Up*ws;function VC(l,e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R,F){let B=function(G,H,K,te,ie,Q,ue,se){let de=[];if(H.positionedLines.length===0)return de;let ve=te.layout.get("text-rotate").evaluate(Q,{})*Math.PI/180,Te=function(je){let We=je[0],Ne=je[1],ut=We*Ne;return ut>0?[We,-Ne]:ut<0?[-We,Ne]:We===0?[Ne,We]:[Ne,-We]}(K),Ee=Math.abs(H.top-H.bottom);for(let je of H.positionedLines)Ee-=je.lineOffset;let Ie=H.positionedLines.length,Oe=Ee/Ie,De=H.top-K[1];for(let je=0;je<Ie;++je){let We=H.positionedLines[je];De=GL(H,Oe,De,je);for(let Ne of We.positionedGlyphs){if(!Ne.rect)continue;let ut=Ne.rect||{},ot=xC+1,tt=!0,Ke=1,It=0;if(Ne.imageName){let Ei=ue[Ne.imageName];if(!Ei)continue;if(Ei.sdf){In("SDF images are not supported in formatted text and will be ignored.");continue}tt=!1,Ke=Ei.pixelRatio,ot=Vp/Ke}let ct=(ie||se)&&Ne.vertical,pt=Ne.metrics.advance*Ne.scale/2,Nt=Ne.metrics,sn=Ne.rect;if(sn===null)continue;se&&H.verticalizable&&(It=Ne.imageName?pt-Ne.metrics.width*Ne.scale/2:0);let Kt=ie?[Ne.x+pt,Ne.y]:[0,0],Jt=[0,0],dn=[0,0],pn=!1;ie||(ct?(dn=[Ne.x+pt+Te[0],Ne.y+Te[1]-It],pn=!0):Jt=[Ne.x+pt+K[0],Ne.y+K[1]-It]);let Kn=sn.w*Ne.scale/(Ke*(Ne.localGlyph?Ts:1)),Nn=sn.h*Ne.scale/(Ke*(Ne.localGlyph?Ts:1)),jt,An,On,si;if(ct){let Ei=Ne.y-De,_i=new st(-pt,pt-Ei),Qi=-Math.PI/2,Vi=new st(...dn);jt=new st(-pt+Jt[0],Jt[1]),jt._rotateAround(Qi,_i)._add(Vi),jt.x+=-Ei+pt,jt.y-=(Nt.left-ot)*Ne.scale;let hr=Ne.imageName?Nt.advance*Ne.scale:ur*Ne.scale,ii=String.fromCodePoint(Ne.glyph);OL(ii)?jt.x+=(1-ot)*Ne.scale:LL(ii)?jt.x+=hr-Nt.height*Ne.scale+(-ot-1)*Ne.scale:jt.x+=Ne.imageName||Nt.width+2*ot===sn.w&&Nt.height+2*ot===sn.h?(hr-Nn)/2:(hr-(Nt.height+2*ot)*Ne.scale)/2,An=new st(jt.x,jt.y-Kn),On=new st(jt.x+Nn,jt.y),si=new st(jt.x+Nn,jt.y-Kn)}else{let Ei=(Nt.left-ot)*Ne.scale-pt+Jt[0],_i=(-Nt.top-ot)*Ne.scale+Jt[1],Qi=Ei+Kn,Vi=_i+Nn;jt=new st(Ei,_i),An=new st(Qi,_i),On=new st(Ei,Vi),si=new st(Qi,Vi)}if(ve){let Ei;Ei=ie?new st(0,0):pn?new st(Te[0],Te[1]):new st(K[0],K[1]),jt._rotateAround(ve,Ei),An._rotateAround(ve,Ei),On._rotateAround(ve,Ei),si._rotateAround(ve,Ei)}let Ti=new st(0,0),Ni=new st(0,0);de.push({tl:jt,tr:An,bl:On,br:si,texPrimary:ut,texSecondary:void 0,writingMode:H.writingMode,glyphOffset:Kt,sectionIndex:Ne.sectionIndex,isSDF:tt,pixelOffsetTL:Ti,pixelOffsetBR:Ni,minFontScaleX:0,minFontScaleY:0})}}return de}(0,c,E,h,m,x,p,l.allowVerticalPlacement),U=l.textSizeData,k=null;U.kind==="source"?(k=[ws*h.layout.get("text-size").evaluate(x,{},R)],k[0]>rc&&In(`${l.layerIds[0]}: Value for "text-size" is >= ${Up}. Reduce your "text-size".`)):U.kind==="composite"&&(k=[ws*I.compositeTextSizes[0].evaluate(x,{},R),ws*I.compositeTextSizes[1].evaluate(x,{},R)],(k[0]>rc||k[1]>rc)&&In(`${l.layerIds[0]}: Value for "text-size" is >= ${Up}. Reduce your "text-size".`)),l.addSymbols(l.text,B,k,E,m,x,y,e,r,D.lineStartIndex,D.lineLength,T,S,R,F,!1);for(let G of w)C[G]=l.text.placedSymbolArray.length-1;return 4*B.length}function jC(l){for(let e in l)return l[e];return null}function N_(l,e,r,c,p,h,m,x,E,D){let y=m.top,w=m.bottom,C=m.left,T=m.right,I=m.collisionPadding;if(I&&(C-=I[0],y-=I[1],T+=I[2],w+=I[3]),E){let S=new st(C,y),R=new st(T,y),F=new st(C,w),B=new st(T,w),U=_n(E),k=new st(0,0);D&&(k=new st(D[0],D[1])),S._rotateAround(U,k),R._rotateAround(U,k),F._rotateAround(U,k),B._rotateAround(U,k),C=Math.min(S.x,R.x,F.x,B.x),T=Math.max(S.x,R.x,F.x,B.x),y=Math.min(S.y,R.y,F.y,B.y),w=Math.max(S.y,R.y,F.y,B.y)}return l.emplaceBack(e.x,e.y,e.z,r.x,r.y,C,y,T,w,x,c,p,h),l.length-1}function r1(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);let e=l.bottom-l.top;return e>0?Math.max(10,e):null}function XL(l,e,r,c){let p=l.compareText;if(e in p){let h=p[e];for(let m=h.length-1;m>=0;m--)if(c.dist(h[m])<r)return!0}else p[e]=[];return p[e].push(c),!1}function UC(l,e){let r=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*e:0,p=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),h=Math.sin(r)*p/Math.sin(Math.max(Math.PI/2-l._pitch-r,.01)),m=Math.sin(l._pitch)*h+p,x=p*(1/l._horizonShift);return l.elevation&&l.elevation.exaggeration()!==0||(m*=1+Math.max(l.zoom-17,0)),Math.min(1.01*m,x)}function $p(l,e){if(!e.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:e};let r=Math.pow(2,-l.z),c=l.x*r,p=(l.x+1)*r,h=l.y*r,m=(l.y+1)*r,x=le(c),E=le(p),D=ae(h),y=ae(m),w=e.project(x,D),C=e.project(E,D),T=e.project(E,y),I=e.project(x,y),S=Math.min(w.x,C.x,T.x,I.x),R=Math.min(w.y,C.y,T.y,I.y),F=Math.max(w.x,C.x,T.x,I.x),B=Math.max(w.y,C.y,T.y,I.y),U=r/16;function k(H,K,te,ie,Q,ue){let se=(te+Q)/2,de=(ie+ue)/2,ve=e.project(le(se),ae(de)),Te=Math.max(0,S-ve.x,R-ve.y,ve.x-F,ve.y-B);S=Math.min(S,ve.x),F=Math.max(F,ve.x),R=Math.min(R,ve.y),B=Math.max(B,ve.y),Te>U&&(k(H,ve,te,ie,se,de),k(ve,K,se,de,Q,ue))}k(w,C,c,h,p,h),k(C,T,p,h,p,m),k(T,I,p,m,c,m),k(I,w,c,m,c,h),S-=U,R-=U,F+=U,B+=U;let G=1/Math.max(F-S,B-R);return{scale:G,x:S*G,y:R*G,x2:F*G,y2:B*G,projection:e}}function $C(l,{x:e,y:r},c=0){return new st(((e-c)*l.scale-l.x)*at,(r*l.scale-l.y)*at)}let YL=be.mat4.identity(new Float32Array(16));class oc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new j(0,0)}projectTilePoint(e,r,c){return{x:e,y:r,z:0}}locationPoint(e,r,c=!0){return e._coordinatePoint(e.locationCoordinate(r),c)}pixelsPerMeter(e,r){return ee(1,e)*r}pixelSpaceConversion(e,r,c){return 1}farthestPixelDistance(e){return UC(e,e.pixelsPerMeter)}pointCoordinate(e,r,c,p){let h=e.horizonLineFromTop(!1),m=new st(r,Math.max(h,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,p))}pointCoordinate3D(e,r,c){let p=new st(r,c);if(e.elevation)return e.elevation.pointCoordinate(p);{let h=this.pointCoordinate(e,p.x,p.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);let c=e.horizonLineFromTop();return r.y<c}createInversionMatrix(e,r){return YL}createTileMatrix(e,r,c){let p,h,m,x=c.canonical,E=be.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let D=$p(x,this);p=1,h=D.x+c.wrap*D.scale,m=D.y,be.mat4.scale(E,E,[p/D.scale,p/D.scale,e.pixelsPerMeter/r])}else p=r/e.zoomScale(x.z),h=(x.x+Math.pow(2,x.z)*c.wrap)*p,m=x.y*p;return be.mat4.translate(E,E,[h,m,0]),be.mat4.scale(E,E,[p/at,p/at,1]),E}upVector(e,r,c){return[0,0,1]}upVectorScale(e,r,c){return{metersToTile:1}}}class KL extends oc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,c]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(_n(r));this.n=(p+Math.sin(_n(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:c,c:p,r0:h}=this,m=_n(e-this.center[0]),x=_n(r),E=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:E*Math.sin(m*c),y:E*Math.cos(m*c)-h,z:0}}unproject(e,r){let{n:c,c:p,r0:h}=this,m=h+r,x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));let E=_n(this.center[0])*c;x=hs(x,-Math.PI-E,Math.PI-E);let D=Qt(Ki(x/c)+this.center[0],-180,180),y=Math.asin(Qt((p-(e*e+m*m)*c*c)/(2*c),-1,1)),w=Qt(Ki(y),-he,he);return new j(D,w)}}let Gp=1.340264,Hp=-.081106,qp=893e-6,Wp=.003796,z_=Math.sqrt(3)/2;class JL extends oc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let c=Math.asin(z_*Math.sin(r)),p=c*c,h=p*p*p;return{x:.5*(e*Math.cos(c)/(z_*(Gp+3*Hp*p+h*(7*qp+9*Wp*p)))/Math.PI+.5),y:1-.5*(c*(Gp+Hp*p+h*(qp+Wp*p))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,p=c*c,h=p*p*p;for(let y,w,C,T=0;T<12&&(w=c*(Gp+Hp*p+h*(qp+Wp*p))-r,C=Gp+3*Hp*p+h*(7*qp+9*Wp*p),y=w/C,c=Qt(c-y,-Math.PI/3,Math.PI/3),p=c*c,h=p*p*p,!(Math.abs(y)<1e-12));++T);let m=z_*e*(Gp+3*Hp*p+h*(7*qp+9*Wp*p))/Math.cos(c),x=Math.asin(Math.sin(c)/z_),E=Qt(180*m/Math.PI,-180,180),D=Qt(180*x/Math.PI,-he,he);return new j(E,D)}}class QL extends oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let c=360*(e-.5),p=Qt(360*(.5-r),-he,he);return new j(c,p)}}let hd=Math.PI/2;function B_(l){return Math.tan((hd+l)/2)}class eF extends oc{constructor(e){super(e),this.center=e.center||[0,30];let[r,c]=this.parallels=e.parallels||[30,30],p=_n(r),h=_n(c);this.southernCenter=p+h<0,this.southernCenter&&(p=-p,h=-h);let m=Math.cos(p),x=B_(p);this.n=p===h?Math.sin(p):Math.log(m/Math.cos(h))/Math.log(B_(h)/x),this.f=m*Math.pow(B_(p),this.n)/this.n}project(e,r){r=_n(r),this.southernCenter&&(r=-r),e=_n(e-this.center[0]);let c=1e-6,{n:p,f:h}=this;h>0?r<-hd+c&&(r=-hd+c):r>hd-c&&(r=hd-c);let m=h/Math.pow(B_(r),p),x=m*Math.sin(p*e),E=h-m*Math.cos(p*e);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;let{n:c,f:p}=this,h=p-r,m=Math.sign(h),x=Math.sign(c)*Math.sqrt(e*e+h*h),E=Math.atan2(e,Math.abs(h))*m;h*c<0&&(E-=Math.PI*Math.sign(e)*m);let D=Qt(Ki(E/c)+this.center[0],-180,180),y=Qt(Ki(2*Math.atan(Math.pow(p/x,1/c))-hd),-he,he);return new j(D,this.southernCenter?-y:y)}}class GC extends oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ne(e),y:oe(r),z:0}}unproject(e,r){let c=le(e),p=ae(r);return new j(c,p)}}let HC=_n(he);class tF extends oc{project(e,r){let c=(r=_n(r))*r,p=c*c;return{x:.5*((e=_n(e))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,p=25,h=0,m=c*c;do{m=c*c;let D=m*m;h=(c*(1.007226+m*(.015085+D*(.028874*m-.044475-.005916*D)))-r)/(1.007226+m*(.045255+D*(.259866*m-.311325-.005916*11*D))),c=Qt(c-h,-HC,HC)}while(Math.abs(h)>1e-6&&--p>0);m=c*c;let x=Qt(Ki(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),E=Ki(c);return new j(x,E)}}let qC=_n(he);class nF extends oc{project(e,r){r=_n(r),e=_n(e);let c=Math.cos(r),p=2/Math.PI,h=Math.acos(c*Math.cos(e/2)),m=Math.sin(h)/h,x=.5*(e*p+2*c*Math.sin(e/2)/m)||0,E=.5*(r+Math.sin(r)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,r){let c=e=(2*e-.5)*Math.PI,p=r=(2*(1-r)-1)*Math.PI,h=25,m=1e-6,x=0,E=0;do{let D=Math.cos(p),y=Math.sin(p),w=2*y*D,C=y*y,T=D*D,I=Math.cos(c/2),S=Math.sin(c/2),R=2*I*S,F=S*S,B=1-T*I*I,U=B?1/B:0,k=B?Math.acos(D*I)*Math.sqrt(1/B):0,G=.5*(2*k*D*S+2*c/Math.PI)-e,H=.5*(k*y+p)-r,K=.5*U*(T*F+k*D*I*C)+1/Math.PI,te=U*(R*w/4-k*y*S),ie=.125*U*(w*S-k*y*T*R),Q=.5*U*(C*I+k*F*D)+.5,ue=te*ie-Q*K;x=(H*te-G*Q)/ue,E=(G*ie-H*K)/ue,c=Qt(c-x,-Math.PI,Math.PI),p=Qt(p-E,-qC,qC)}while((Math.abs(x)>m||Math.abs(E)>m)&&--h>0);return new j(Ki(c),Ki(p))}}class WC extends oc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:c,cosPhi:p}=this;return{x:_n(e)*p*c+.5,y:-Math.sin(_n(r))/p*c+.5,z:0}}unproject(e,r){let{scale:c,cosPhi:p}=this,h=-(r-.5)/c,m=Qt(Ki((e-.5)/c)/p,-180,180),x=Math.asin(Qt(h*p,-1,1)),E=Qt(Ki(x),-he,he);return new j(m,E)}}class iF extends GC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,c){let p=Dp(e,r,c),h=x_(oa(c));return be.vec3.transformMat4(p,p,h),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,r){let c=L(r.lat,r.lng),p=be.vec3.normalize([],c),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,m=ee(1,0)*at*h;be.vec3.scaleAndAdd(c,c,p,m);let x=be.mat4.identity(new Float64Array(16));return be.mat4.multiply(x,e.pixelMatrix,e.globeMatrix),be.vec3.transformMat4(c,c,x),new st(c[0],c[1])}pixelsPerMeter(e,r){return ee(1,0)*r}pixelSpaceConversion(e,r,c){let p=ee(1,e)*r,h=Pt(ee(1,45)*r,p,c);return this.pixelsPerMeter(e,r)/h}createTileMatrix(e,r,c){let p=Mx(oa(c.canonical));return be.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,r){let{center:c}=e,p=x_(oa(r));return be.mat4.rotateY(p,p,_n(c.lng)),be.mat4.rotateX(p,p,_n(c.lat)),be.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,r,c,p){return __(e,r,c,!0)||new Me(0,0)}pointCoordinate3D(e,r,c){let p=this.pointCoordinate(e,r,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,r){return!__(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(p,h){let m=p.cameraToCenterDistance,x=p._centerAltitude*h,E=p._camera,D=p._camera.forward(),y=be.vec3.add([],be.vec3.scale([],D,-m),[0,0,x]),w=p.worldSize/(2*Math.PI),C=[0,0,-w],T=p.width/p.height,I=Math.tan(p.fovAboveCenter),S=be.vec3.scale([],E.up(),I),R=be.vec3.scale([],E.right(),I*T),F=be.vec3.normalize([],be.vec3.add([],be.vec3.add([],D,S),R)),B=[],U;if(new bs(y,F).closestPointOnSphere(C,w,B)){let k=be.vec3.add([],B,C),G=be.vec3.sub([],k,y);U=Math.cos(p.fovAboveCenter)*be.vec3.length(G)}else{let k=be.vec3.sub([],y,C),G=be.vec3.sub([],C,y);be.vec3.normalize(G,G);let H=be.vec3.length(k)-w;U=Math.sqrt(H*(H+2*w));let K=Math.acos(U/(w+H))-Math.acos(be.vec3.dot(D,G));U*=Math.cos(K)}return 1.01*U}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=ec(e.zoom);if(c>0){let p=UC(e,ee(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Pt(r,p+h*(1-Math.cos(m)),Math.pow(c,10))}return r}upVector(e,r,c){return Dp(r,c,e,1)}upVectorScale(e){return{metersToTile:$a(v_(oa(e)))}}}function ZC(l){let e=l.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(l.name){case"mercator":return new GC(l);case"equirectangular":return new QL(l);case"naturalEarth":return new tF(l);case"equalEarth":return new JL(l);case"winkelTripel":return new nF(l);case"albers":return r?new WC(l):new KL(l);case"lambertConformalConic":return r?new WC(l):new eF(l);case"globe":return new iF(l)}throw new Error(`Invalid projection name: ${l.name}`)}let rF=sd.VectorTileFeature.types,oF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function V_(l,e,r,c,p,h,m,x,E,D,y,w,C){let T=x?Math.min(rc,Math.round(x[0])):0,I=x?Math.min(rc,Math.round(x[1])):0;l.emplaceBack(e,r,Math.round(32*c),Math.round(32*p),h,m,(T<<1)+(E?1:0),I,16*D,16*y,256*w,256*C)}function j_(l,e,r){l.emplaceBack(e,r)}function U_(l,e,r,c,p,h,m){l.emplaceBack(e,r,c,p,h,m)}function $_(l,e,r,c,p){l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p)}function sF(l){for(let e of l.sections)if(ux(e.text))return!0;return!1}class o1{constructor(e){this.layoutVertexArray=new fp,this.indexArray=new rr,this.programConfigurations=e,this.segments=new xi,this.dynamicLayoutVertexArray=new _s,this.opacityVertexArray=new mp,this.placedSymbolArray=new xp,this.iconTransitioningVertexArray=new na,this.globeExtVertexArray=new pp,this.zOffsetVertexArray=new Zl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,c,p,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,TL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,IL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,oF,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,DL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,EL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,CL.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}mt(o1,"SymbolBuffers");class s1{constructor(e,r,c){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new c,this.segments=new xi,this.collisionVertexArray=new Wl,this.collisionVertexArrayExt=new _s}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ML.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,SL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mt(s1,"CollisionBuffers");class G_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=be.mat4.identity([]),this.placementViewportMatrix=be.mat4.identity([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zx(this.zoom,r["text-size"]),this.iconSizeData=Zx(this.zoom,r["icon-size"]);let c=this.layers[0].layout,p=c.get("symbol-sort-key"),h=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Oo[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new o1(new ia(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new o1(new ia(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new l_,this.lineVertexArray=new td,this.symbolInstances=new bp}calculateGlyphDependencies(e,r,c,p,h){for(let m=0;m<e.length;m++){let x=e.codePointAt(m);if(x===void 0)break;if(r[x]=!0,p&&h&&x<=65535){let E=zp[e.charAt(m)];E&&(r[E.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ux(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,r,c,p){let h=this.layers[0],m=h.layout,x=this.projection.name==="globe",E=m.get("text-font"),D=m.get("text-field"),y=m.get("icon-image"),w=(D.value.kind!=="constant"||D.value.value instanceof _r&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),C=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,T=m.get("symbol-sort-key");if(this.features=[],!w&&!C)return;let I=r.iconDependencies,S=r.glyphDependencies,R=r.availableImages,F=new vi(this.zoom);for(let{feature:B,id:U,index:k,sourceLayerIndex:G}of e){let H=h._featureFilter.needGeometry,K=nt(B,H);if(!h._featureFilter.filter(F,K,c))continue;if(H||(K.geometry=et(B,c,p)),x&&B.type!==1&&c.z<=5){let ue=K.geometry,se=.98078528056,de=(ve,Te)=>{let Ee=Dp(ve.x,ve.y,c,1),Ie=Dp(Te.x,Te.y,c,1);return be.vec3.dot(Ee,Ie)<se};for(let ve=0;ve<ue.length;ve++)ue[ve]=Je(ue[ve],de)}let te,ie;if(w){let ue=h.getValueAndResolveTokens("text-field",K,c,R),se=_r.factory(ue);sF(se)&&(this.hasRTLText=!0),(!this.hasRTLText||ap()==="unavailable"||this.hasRTLText&&Vr.isParsed())&&(te=RL(se,h,K))}if(C){let ue=h.getValueAndResolveTokens("icon-image",K,c,R);ie=ue instanceof Dr?ue:Dr.fromString(ue)}if(!te&&!ie)continue;let Q=this.sortFeaturesByKey?T.evaluate(K,{},c):void 0;if(this.features.push({id:U,text:te,icon:ie,index:k,sourceLayerIndex:G,geometry:K.geometry,properties:B.properties,type:rF[B.type],sortKey:Q}),ie&&(I[ie.namePrimary]=!0,ie.nameSecondary&&(I[ie.nameSecondary]=!0)),te){let ue=E.evaluate(K,{},c).join(","),se=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Oo.vertical)>=0;for(let de of te.sections)if(de.image)I[de.image.namePrimary]=!0;else{let ve=Bh(te.toString()),Te=de.fontStack||ue,Ee=S[Te]=S[Te]||{};this.calculateGlyphDependencies(de.text,Ee,se,this.allowVerticalPlacement,ve)}}}m.get("symbol-placement")==="line"&&(this.features=function(B){let U={},k={},G=[],H=0;function K(ue){G.push(B[ue]),H++}function te(ue,se,de){let ve=k[ue];return delete k[ue],k[se]=ve,G[ve].geometry[0].pop(),G[ve].geometry[0]=G[ve].geometry[0].concat(de[0]),ve}function ie(ue,se,de){let ve=U[se];return delete U[se],U[ue]=ve,G[ve].geometry[0].shift(),G[ve].geometry[0]=de[0].concat(G[ve].geometry[0]),ve}function Q(ue,se,de){let ve=de?se[0][se[0].length-1]:se[0][0];return`${ue}:${ve.x}:${ve.y}`}for(let ue=0;ue<B.length;ue++){let se=B[ue],de=se.geometry,ve=se.text?se.text.toString():null;if(!ve){K(ue);continue}let Te=Q(ve,de),Ee=Q(ve,de,!0);if(Te in k&&Ee in U&&k[Te]!==U[Ee]){let Ie=ie(Te,Ee,de),Oe=te(Te,Ee,G[Ie].geometry);delete U[Te],delete k[Ee],k[Q(ve,G[Oe].geometry,!0)]=Oe,G[Ie].geometry=null}else Te in k?te(Te,Ee,de):Ee in U?ie(Te,Ee,de):(K(ue),U[Te]=H-1,k[Ee]=H-1)}return G.filter(ue=>ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((B,U)=>B.sortKey-U.sortKey)}update(e,r,c,p,h){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let x=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,x,c,p,h),this.icon.programConfigurations.updatePaintArrays(e,r,x,c,p,h)}updateZOffset(){let e=(h,m,x)=>{c+=m,c>h.length&&h.resize(c);for(let E=-m;E<0;E++)h.emplace(E+c,x)},r=(h,m,x)=>{p+=m,p>h.length&&h.resize(p);for(let E=-m;E<0;E++)h.emplace(E+p,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:E,numIconVertices:D}=m,y=m.zOffset,w=D>0;if((x>0||E>0)&&(e(this.text.zOffsetVertexArray,x,y),e(this.text.zOffsetVertexArray,E,y)),w){let{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:T}=m;C>=0&&r(this.icon.zOffsetVertexArray,D,y),T>=0&&r(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,y)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ZC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let c=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:p,y:h}of r)this.lineVertexArray.emplaceBack(p,h);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,r,c,p,h,m,x,E,D,y,w,C,T,I,S,R){let F=e.indexArray,B=e.layoutVertexArray,U=e.globeExtVertexArray,k=e.segments.prepareSegment(4*r.length,B,F,this.canOverlap?m.sortKey:void 0),G=this.glyphOffsetArray.length,H=k.vertexLength,K=this.allowVerticalPlacement&&x===Oo.vertical?Math.PI/2:0,te=m.text&&m.text.sections;for(let Q=0;Q<r.length;Q++){let{tl:ue,tr:se,bl:de,br:ve,texPrimary:Te,texSecondary:Ee,pixelOffsetTL:Ie,pixelOffsetBR:Oe,minFontScaleX:De,minFontScaleY:je,glyphOffset:We,isSDF:Ne,sectionIndex:ut}=r[Q],ot=k.vertexLength,tt=We[1];if(V_(B,D.x,D.y,ue.x,tt+ue.y,Te.x,Te.y,c,Ne,Ie.x,Ie.y,De,je),V_(B,D.x,D.y,se.x,tt+se.y,Te.x+Te.w,Te.y,c,Ne,Oe.x,Ie.y,De,je),V_(B,D.x,D.y,de.x,tt+de.y,Te.x,Te.y+Te.h,c,Ne,Ie.x,Oe.y,De,je),V_(B,D.x,D.y,ve.x,tt+ve.y,Te.x+Te.w,Te.y+Te.h,c,Ne,Oe.x,Oe.y,De,je),E){let{x:Ke,y:It,z:ct}=E.anchor,[pt,Nt,sn]=E.up;U_(U,Ke,It,ct,pt,Nt,sn),U_(U,Ke,It,ct,pt,Nt,sn),U_(U,Ke,It,ct,pt,Nt,sn),U_(U,Ke,It,ct,pt,Nt,sn),$_(e.dynamicLayoutVertexArray,Ke,It,ct,K)}else $_(e.dynamicLayoutVertexArray,D.x,D.y,D.z,K);if(R){let Ke=Ee||Te;j_(e.iconTransitioningVertexArray,Ke.x,Ke.y),j_(e.iconTransitioningVertexArray,Ke.x+Ke.w,Ke.y),j_(e.iconTransitioningVertexArray,Ke.x,Ke.y+Ke.h),j_(e.iconTransitioningVertexArray,Ke.x+Ke.w,Ke.y+Ke.h)}F.emplaceBack(ot,ot+1,ot+2),F.emplaceBack(ot+1,ot+2,ot+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),Q!==r.length-1&&ut===r[Q+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,m,m.index,{},T,I,S,te&&te[ut])}let ie=E?E.anchor:D;e.placedSymbolArray.emplaceBack(ie.x,ie.y,ie.z,D.x,D.y,G,this.glyphOffsetArray.length-G,H,y,w,D.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,C,0)}_commitLayoutVertex(e,r,c,p,h,m,x){e.emplaceBack(r,c,p,h,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,c,p,h,m,x){let E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=E.vertexLength,y=x.tileAnchorX,w=x.tileAnchorY;for(let T=0;T<4;T++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,r,e.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,w,new st(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,w,new st(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,w,new st(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,w,new st(e.x1,e.y2)),E.vertexLength+=4;let C=c.indexArray;C.emplaceBack(D,D+1),C.emplaceBack(D+1,D+2),C.emplaceBack(D+2,D+3),C.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,c,p,h,m){for(let x=p;x<h;x++){let E=c.get(x),D=this.getSymbolInstanceTextSize(e,m,r,x);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,c,p,h,m){for(let x=p;x<h;x++){let E=c.get(x),D=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new s1(Va,gC.members,na),this.iconCollisionBox=new s1(Va,gC.members,na);let c=ad(this.iconSizeData,e),p=ad(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(p,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(p,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,c,p){let h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:p),m=P_(this.textSizeData,e,h)/ur;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,c){let p=this.icon.placedSymbolArray.get(c),h=P_(this.iconSizeData,e,p);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,c,p){e.emplaceBack(r,-c,-c,p),e.emplaceBack(r,c,-c,p),e.emplaceBack(r,c,c,p),e.emplaceBack(r,-c,c,p)}_updateTextDebugCollisionBoxes(e,r,c,p,h,m){for(let x=p;x<h;x++){let E=c.get(x),D=this.getSymbolInstanceTextSize(e,m,r,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,r,c,p,h,m){for(let x=p;x<h;x++){let E=c.get(x),D=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,E.padding,m.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let c=ad(this.iconSizeData,e),p=ad(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(p,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(p,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,c,p,h,m,x,E,D){let y={};if(r<c){let{x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k,featureIndex:G}=e.get(r);y.textBox={x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k},y.textFeatureIndex=G}if(p<h){let{x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k,featureIndex:G}=e.get(p);y.verticalTextBox={x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k},y.verticalTextFeatureIndex=G}if(m<x){let{x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k,featureIndex:G}=e.get(m);y.iconBox={x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k},y.iconFeatureIndex=G}if(E<D){let{x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k,featureIndex:G}=e.get(E);y.verticalIconBox={x1:w,y1:C,x2:T,y2:I,padding:S,projectedAnchorX:R,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:U,tileAnchorY:k},y.verticalIconFeatureIndex=G}return y}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){let c=e.placedSymbolArray.get(r),p=c.vertexStartIndex+4*c.numGlyphs;for(let h=c.vertexStartIndex;h<p;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),c=Math.cos(e),p=[],h=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);let E=this.symbolInstances.get(x);p.push(0|Math.round(r*E.tileAnchorX+c*E.tileAnchorY)),h.push(E.featureIndex)}return m.sort((x,E)=>p[x]-p[E]||h[E]-h[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex);let{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:D}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),h>=0&&h!==p&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let XC,YC,a1;mt(G_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),G_.addDynamicAttributes=$_;class KC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Do,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt(KC,"FormatSectionOverride",{omit:["defaultValue"]});let l1=()=>a1||(a1={layout:XC||(XC=new ui({"symbol-placement":new it(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new it(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(Re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new it(Re.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new it(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new it(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Re.layout_symbol["icon-size"]),"icon-text-fit":new Tt(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Re.layout_symbol["icon-image"]),"icon-rotate":new Tt(Re.layout_symbol["icon-rotate"]),"icon-padding":new it(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new it(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Re.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(Re.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Re.layout_symbol["text-field"]),"text-font":new Tt(Re.layout_symbol["text-font"]),"text-size":new Tt(Re.layout_symbol["text-size"]),"text-max-width":new Tt(Re.layout_symbol["text-max-width"]),"text-line-height":new Tt(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Re.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Re.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(Re.layout_symbol["text-anchor"]),"text-max-angle":new it(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new it(Re.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Re.layout_symbol["text-rotate"]),"text-padding":new it(Re.layout_symbol["text-padding"]),"text-keep-upright":new it(Re.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Re.layout_symbol["text-transform"]),"text-offset":new Tt(Re.layout_symbol["text-offset"]),"text-allow-overlap":new it(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new it(Re.layout_symbol["text-ignore-placement"]),"text-optional":new it(Re.layout_symbol["text-optional"]),visibility:new it(Re.layout_symbol.visibility)})),paint:YC||(YC=new ui({"icon-opacity":new Tt(Re.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Tt(Re.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Tt(Re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Tt(Re.paint_symbol["text-emissive-strength"]),"icon-color":new Tt(Re.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new it(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(Re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Tt(Re.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Tt(Re.paint_symbol["text-occlusion-opacity"]),"text-color":new Tt(Re.paint_symbol["text-color"],{runtimeType:zr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Tt(Re.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Re.paint_symbol["text-halo-blur"]),"text-translate":new it(Re.paint_symbol["text-translate"]),"text-translate-anchor":new it(Re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new it(Re.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new it(Re.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new it(Re.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new it(Re.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Tt(Re.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new it(Re.paint_symbol["symbol-elevation-reference"])}))},a1);class H_ extends yr{constructor(e,r,c,p){super(e,l1(),r,c,p),this._colorAdjustmentMatrix=be.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let c=this.layout.get("text-writing-mode");if(c){let p=[];for(let h of c)p.indexOf(h)<0&&p.push(h);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,c,p){return this._saturation===e&&this._contrast===r&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(h,m,x,E){h=ce(h),m=J(m);let D=be.mat4.create(),y=h/3,w=1-2*y,C=[w,y,y,0,y,w,y,0,y,y,w,0,0,0,0,1],T=.5-.5*m,I=E-x;return be.mat4.multiply(D,[I,0,0,0,0,I,0,0,0,0,I,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,T,T,T,1]),be.mat4.multiply(D,D,C),D}(e,r,c,p),this._saturation=e,this._contrast=r,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,c,p){let h=this.layout.get(e).evaluate(r,{},c,p),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Fh(m.value)||!h?h:function(x,E){return E.replace(/{([^{}]+)}/g,(D,y)=>y in x?String(x[y]):"")}(r.properties,h)}createBucket(e){return new G_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of l1().paint.overridableProperties){if(!H_.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),c=new KC(r),p=new Lh(c,r.property.specification,this.scope,this.options),h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new tp("source",p):new qo("composite",p,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Ul(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&H_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let c=e.get("text-field"),p=l1().paint.properties[r],h=!1,m=x=>{for(let E of x)if(p.overrides&&p.overrides.hasOverride(E))return void(h=!0)};if(c.value.kind==="constant"&&c.value.value instanceof _r)m(c.value.value.sections);else if(c.value.kind==="source"){let x=D=>{h||(D instanceof Mo&&Fi(D.value)===wl?m(D.value.sections):D instanceof Cl?m(D.sections):D.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,c){return{config:new Ua(this,{zoom:r,lut:c}),overrideFog:!1}}}let JC,QC,eD,tD;var c1=Dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function u1(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function h1(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class d1{constructor(e,r,c,p){this.context=e,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:p&&p.premultiply})}update(e,r){let c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:h}=this,{gl:m}=h,{x,y:E}=r&&r.position?r.position:{x:0,y:0},D=Math.max(x+c,this.size?this.size[0]:0),y=Math.max(E+p,this.size?this.size[1]:0);!this.size||this.size[0]===D&&this.size[1]===y||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!r||r.premultiply!==!1));let w=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&D>0&&y>0){let C=this.useMipmap?Math.floor(Math.log2(Math.max(D,y)))+1:1;m.texStorage2D(m.TEXTURE_2D,C,this.format,D,y),this.size=[D,y]}if(this.size)if(w)m.texSubImage2D(m.TEXTURE_2D,0,x,E,u1(this.format),h1(this.format),e);else{let C=e.data;C&&m.texSubImage2D(m.TEXTURE_2D,0,x,E,c,p,u1(this.format),h1(this.format),C)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r,c=!1){let{context:p}=this,{gl:h}=p;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,c,p){let{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class q_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){let{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrapS=r)}}function W_(l,e,r,c,p,h,m,x){let E=[l,e,1,r,c,1,p,h,1],D=[m,x,1],y=be.mat3.adjoint([],E),[w,C,T]=be.vec3.transformMat3(D,D,y);return be.mat3.multiply(E,E,[w,0,0,0,C,0,0,0,T])}function nD(l,e,r,c,p,h,m,x){let E=function(D,y,w,C,T,I,S,R){let F=W_(0,0,1,0,1,1,0,1),B=W_(D,y,w,C,T,I,S,R),U=be.mat3.adjoint([],F);return be.mat3.multiply(B,B,U)}(l,e,r,c,p,h,m,x);return[E[2]/E[8]/at,E[5]/E[8]/at]}function Z_(l){return[l[0],Math.min(Math.max(l[1],-he),he)]}class iD extends xl{constructor(e,r,c,p){super(),this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Hs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Uo(this.map._requestManager.transformRequest(this.url,_l.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Zc(c)):p&&(this.image=p instanceof HTMLImageElement?dt.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new q_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Hs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof q_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],c=e[0][1];for(let h of e)h[1]>c&&(c=h[1]),h[1]<r&&(r=h[1]);let p=(c+r)/2;if(p>he?this.onNorthPole=!0:p<-he&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let h=e.map(Me.fromLngLat);this.tileID=function(m){let x=1/0,E=1/0,D=-1/0,y=-1/0;for(let S of m)x=Math.min(x,S.x),E=Math.min(E,S.y),D=Math.max(D,S.x),y=Math.max(y,S.y);let w=Math.max(D-x,y-E),C=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),T=Math.pow(2,C),I=Math.floor((x+D)/2*T);return I>1&&(I-=1),new Zi(C,I,Math.floor((E+y)/2*T))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Hs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let F in this.tiles){let B=this.tiles[F];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=$p(new Zi(0,0,0),this.map.transform.projection),c=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){let B=F[1].x-F[0].x,U=F[1].y-F[0].y,k=F[2].x-F[1].x,G=F[2].y-F[1].y,H=F[3].x-F[2].x,K=F[3].y-F[2].y,te=F[0].x-F[3].x,ie=F[0].y-F[3].y,Q=B*G-k*U,ue=k*K-H*G,se=H*ie-te*K,de=te*U-B*ie;return Q>0&&ue>0&&se>0&&de>0||Q<0&&ue<0&&se<0&&de<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let p=$p(this.tileID,this.map.transform.projection),[h,m,x,E]=this.coordinates.map(F=>{let B=p.projection.project(F[0],F[1]);return $C(p,B)._round()});this.perspectiveTransform=nD(h.x,h.y,m.x,m.y,x.x,x.y,E.x,E.y);let D=this._boundsArray=new ea;D.emplaceBack(h.x,h.y,0,0),D.emplaceBack(m.x,m.y,at,0),D.emplaceBack(E.x,E.y,0,at),D.emplaceBack(x.x,x.y,at,at),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(D,c1.members),this.boundsSegments=xi.simpleSegment(0,0,4,2);let y=[],w=[Z_((C=this.coordinates)[0]),Z_(C[1]),Z_(C[2]),Z_(C[3])];var C;let[T,I,S,R]=function(F){let B=F[0][0],U=B,k=F[0][1],G=k;for(let H=1;H<F.length;H++)F[H][0]<B?B=F[H][0]:F[H][0]>U&&(U=F[H][0]),F[H][1]<k?k=F[H][1]:F[H][1]>G&&(G=F[H][1]);return[B,k,U-B,G-k]}(w);{let F=new ea,[B,U,k,G]=function(Ie){let Oe=Ie[0].x,De=Oe,je=Ie[0].y,We=je;for(let Ne=1;Ne<Ie.length;Ne++)Ie[Ne].x<Oe?Oe=Ie[Ne].x:Ie[Ne].x>De&&(De=Ie[Ne].x),Ie[Ne].y<je?je=Ie[Ne].y:Ie[Ne].y>We&&(We=Ie[Ne].y);return[Oe,je,De-Oe,We-je]}(c),H=Ie=>[(Ie.x-B)/k,(Ie.y-U)/G],[K,te,ie,Q]=c.map(H),ue=function(Ie,Oe,De,je,We,Ne,ut,ot){let tt=W_(0,0,1,0,1,1,0,1),Ke=W_(Ie,Oe,De,je,We,Ne,ut,ot),It=be.mat3.adjoint([],Ke);return be.mat3.multiply(tt,tt,It)}(K[0],K[1],te[0],te[1],ie[0],ie[1],Q[0],Q[1]);this.elevatedGlobePerspectiveTransform=nD(K[0],K[1],te[0],te[1],ie[0],ie[1],Q[0],Q[1]);let se=(Ie,Oe)=>{y.push(Ie.lng);let De=Math.round((Ie.lng-T)/S*at),je=Math.round((Ie.lat-I)/R*at),We=H(Oe),Ne=be.vec3.transformMat3([],[We[0],We[1],1],ue),ut=Math.round(Ne[0]/Ne[2]*at),ot=Math.round(Ne[1]/Ne[2]*at);F.emplaceBack(De,je,ut,ot)},de=c[3].x-c[0].x,ve=c[3].y-c[0].y,Te=c[2].x-c[1].x,Ee=c[2].y-c[1].y;for(let Ie=0;Ie<65;Ie++){let Oe=Ie/64,De=[c[0].x+Oe*de,c[0].y+Oe*ve],je=[c[1].x+Oe*Te,c[1].y+Oe*Ee],We=je[0]-De[0],Ne=je[1]-De[1];for(let ut=0;ut<65;ut++){let ot=ut/64,tt={x:De[0]+We*ot,y:De[1]+Ne*ot,z:0};se(r.projection.unproject(tt.x,tt.y),tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(F,c1.members)}{this.maxLongitudeTriangleSize=0;let F=[],B=new rr,U=(k,G,H)=>{B.emplaceBack(k,G,H);let K=y[k],te=y[G],ie=y[H],Q=Math.min(Math.min(K,te),ie),ue=Math.max(Math.max(K,te),ie)-Q;ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ue),F.push(Q+ue/2)};for(let k=0;k<64;k++)for(let G=0;G<64;G++){let H=65*k+G,K=H+1,te=H+65,ie=te+1;U(H,te,K),U(K,te,ie)}[F,B]=function(k,G){let H=Array.from({length:k.length},(ie,Q)=>Q);H.sort((ie,Q)=>k[ie]-k[Q]);let K=[],te=new rr;for(let ie=0;ie<H.length;ie++){let Q=H[ie];K.push(k[Q]);let ue=3*Q,se=ue+1;te.emplaceBack(G.uint16[ue],G.uint16[se],G.uint16[se+1])}return[K,te]}(F,B),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=xi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,S/at,0,R/at,0,0,I,T,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let r=this.map.painter.context,c=r.gl;!this._dirty||this.texture instanceof q_||(this.texture?this.texture.update(this.image):(this.texture=new d1(r,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let c=this.elevatedGlobeTrianglesCenterLongitudes,p=(h=e+180)+360*Math.round((c[0]-h)/360);var h;let m=new xi,x=(w,C)=>{m.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:r.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=E){let w=Y(c,0,c.length,p+E);return w===c.length||x(w,ke(c,w+1,c.length,p+360-E)-w),m}p<c[0]&&(p+=360);let D=ke(c,0,c.length,p-E);if(D===c.length)return x(0,c.length),m;x(0,D-0);let y=Y(c,D+1,c.length,p+E);return y!==c.length&&x(y,c.length-y),m}}let aF=(Math.pow(256,2)-1)/16907520;class rD extends yr{constructor(e,r,c,p){super(e,{layout:eD||(eD=new ui({visibility:new it(Re.layout_raster.visibility)})),paint:tD||(tD=new ui({"raster-opacity":new it(Re.paint_raster["raster-opacity"]),"raster-color":new Ao(Re.paint_raster["raster-color"]),"raster-color-mix":new it(Re.paint_raster["raster-color-mix"]),"raster-color-range":new it(Re.paint_raster["raster-color-range"]),"raster-hue-rotate":new it(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new it(Re.paint_raster["raster-saturation"]),"raster-contrast":new it(Re.paint_raster["raster-contrast"]),"raster-resampling":new it(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new it(Re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new it(Re.paint_raster["raster-emissive-strength"]),"raster-array-band":new it(Re.paint_raster["raster-array-band"]),"raster-elevation":new it(Re.paint_raster["raster-elevation"])}))},r,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof iD&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let r=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Mp({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let oD,sD,aD,lD,cD;class uD extends yr{constructor(e,r,c,p){super(e,{layout:oD||(oD=new ui({visibility:new it(Re["layout_raster-particle"].visibility)})),paint:sD||(sD=new ui({"raster-particle-array-band":new it(Re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new it(Re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ao(Re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new it(Re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new it(Re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new it(Re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new it(Re["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new it(Re["paint_raster-particle"]["raster-particle-elevation"])}))},r,c,p),this._updateColorRamp(),this.lastInvalidatedAt=dt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Mp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=dt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class lF extends yr{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function f1(l,e,r){let c=[0,0,1],p=be.quat.identity([]);return be.quat.rotateY(p,p,r?-_n(l)+Math.PI:_n(l)),be.quat.rotateX(p,p,-_n(e)),be.vec3.transformQuat(c,c,p),be.vec3.normalize(c,c)}function hD(l,e){let r=X_(l.projection,l.zoom,l.width,l.height),c=function(h,m,x,E,D){let y=new j(x.lng-180*sc,x.lat),w=new j(x.lng+180*sc,x.lat),C=h.project(y.lng,y.lat),T=h.project(w.lng,w.lat),I=-Math.atan2(T.y-C.y,T.x-C.x),S=Me.fromLngLat(x);S.y=Qt(S.y,-1+sc,1-sc);let R=S.toLngLat(),F=h.project(R.lng,R.lat),B=Me.fromLngLat(R);B.x+=sc;let U=B.toLngLat(),k=h.project(U.lng,U.lat),G=fD(k.x-F.x,k.y-F.y,I),H=Me.fromLngLat(R);H.y+=sc;let K=H.toLngLat(),te=h.project(K.lng,K.lat),ie=fD(te.x-F.x,te.y-F.y,I),Q=Math.abs(G.x)/Math.abs(ie.y),ue=be.mat4.identity([]);be.mat4.rotateZ(ue,ue,-I*(1-(D?0:E)));let se=be.mat4.identity([]);return be.mat4.scale(se,se,[1,1-(1-Q)*E,1]),se[4]=-ie.x/ie.y*E,be.mat4.rotateZ(se,se,I),be.mat4.multiply(se,ue,se),se}(l.projection,0,l.center,r,e),p=dD(l);return be.mat4.scale(c,c,[p,p,1]),c}function dD(l){let e=l.projection,r=X_(l.projection,l.zoom,l.width,l.height),c=p1(e,l.center),p=p1(e,j.convert(e.center));return Math.pow(2,c*r+(1-r)*p)}function X_(l,e,r,c,p=1/0){let h=l.range;if(!h)return 0;let m=Math.min(p,Math.max(r,c)),x=Math.log(m/1024)/Math.LN2;return dl(h[0]+x,h[1]+x,e)}let sc=1/4e4;function p1(l,e){let r=Qt(e.lat,-he,he),c=new j(e.lng-180*sc,r),p=new j(e.lng+180*sc,r),h=l.project(c.lng,r),m=l.project(p.lng,r),x=Me.fromLngLat(c),E=Me.fromLngLat(p),D=m.x-h.x,y=m.y-h.y,w=E.x-x.x,C=E.y-x.y,T=Math.sqrt((w*w+C*C)/(D*D+y*y));return Math.log(T)/Math.LN2}function fD(l,e,r){let c=Math.cos(r),p=Math.sin(r);return{x:l*c-e*p,y:l*p+e*c}}function pD(l,e,r){be.mat4.identity(l),be.mat4.rotateZ(l,l,_n(e[2])),be.mat4.rotateX(l,l,_n(e[0])),be.mat4.rotateY(l,l,_n(e[1])),be.mat4.scale(l,l,r),be.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Y_(l,e,r,c,p,h,m,x){let E=[r[0]-e[0],r[1]-e[1],0],D=[c[0]-e[0],c[1]-e[1],0];if(be.vec3.length(E)<1e-12||be.vec3.length(D)<1e-12)return be.quat.identity(l);let y=be.vec3.cross([],E,D);be.vec3.normalize(y,y),be.vec3.subtract(D,c,e),E[2]=(h-p)*x,D[2]=(m-p)*x;let w=E;return be.vec3.cross(w,E,D),be.vec3.normalize(w,w),be.quat.rotationTo(l,y,w)}function m1(l,e,r=!1){let c=ec(e.zoom),p=function(h,m,x){let E=m.worldSize,D=[h[12],h[13],h[14]],y=ae(D[1]/E),w=le(D[0]/E),C=be.mat4.identity([]),T=ee(1,y)*E,I=ee(1,0)*E*we(y,m.zoom),S=1/Sx(E),R=I*S;if(x){let k=X_(m.projection,m.zoom,m.width,m.height,1024);R=S*m.projection.pixelSpaceConversion(m.center.lat,E,k)}let F=L(y,w);be.vec3.add(F,F,be.vec3.scale([],be.vec3.normalize([],F),T*R*D[2]));let B=function(k){let G=[k[0],k[1],k[2]],H=[0,1,0],K=be.vec3.cross([],H,G);return be.vec3.cross(H,G,K),be.vec3.squaredLength(H)===0&&(H=[0,1,0],be.vec3.cross(K,G,H)),be.vec3.normalize(K,K),be.vec3.normalize(H,H),be.vec3.normalize(G,G),[K[0],K[1],K[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,k[0],k[1],k[2],1]}(F);be.mat4.scale(C,C,[R,R,R*T]),be.mat4.translate(C,C,[-D[0],-D[1],-D[2]]);let U=be.mat4.multiply([],m.globeMatrix,B);return be.mat4.multiply(U,U,C),be.mat4.multiply(U,U,h),U}(l,e,r);if(c>0){let h=function(m,x){let E=x.worldSize,D=ee(1,0)*E*we(x.center.lat,x.zoom)/Sx(E),y=ee(1,x.center.lat)*E,w=be.mat4.identity([]);return be.mat4.rotateY(w,w,_n(x.center.lng)),be.mat4.rotateX(w,w,_n(x.center.lat)),be.mat4.translate(w,w,[0,0,t]),be.mat4.scale(w,w,[D,D,D*y]),be.mat4.translate(w,w,[x.point.x-.5*E,x.point.y-.5*E,0]),be.mat4.multiply(w,w,m),be.mat4.multiply(w,x.globeMatrix,w)}(l,e);return function(m,x,E){let D=(I,S,R)=>{let F=be.vec3.length(I),B=be.vec3.length(S),U=Ga(I,S,R);return be.vec3.scale(U,U,1/be.vec3.length(U)*Pt(F,B,R))},y=D([m[0],m[1],m[2]],[x[0],x[1],x[2]],E),w=D([m[4],m[5],m[6]],[x[4],x[5],x[6]],E),C=D([m[8],m[9],m[10]],[x[8],x[9],x[10]],E),T=Ga([m[12],m[13],m[14]],[x[12],x[13],x[14]],E);return[y[0],y[1],y[2],0,w[0],w[1],w[2],0,C[0],C[1],C[2],0,T[0],T[1],T[2],1]}(p,h,c)}return p}function mD(l,e,r,c){let p=ni.projectAabbCorners(c,r),h=Number.MAX_VALUE,m=-1;for(let D=0;D<p.length;++D){let y=p[D];y[0]=(.5*y[0]+.5)*e.width,y[1]=(.5-.5*y[1])*e.height,y[2]<h&&(m=D,h=y[2])}let x=D=>new st(p[D][0],p[D][1]),E;switch(m){case 0:case 6:E=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:E=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:E=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:E=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(rt(l,E))return h}let cF=Dn([{name:"a_pos_3f",components:3,type:"Float32"}]),uF=Dn([{name:"a_color_3f",components:3,type:"Float32"}]),hF=Dn([{name:"a_color_4f",components:4,type:"Float32"}]),dF=Dn([{name:"a_uv_2f",components:2,type:"Float32"}]),fF=Dn([{name:"a_normal_3f",components:3,type:"Float32"}]),pF=Dn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),mF=Dn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),gD={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class K_{constructor(e,r,c,p){this.message=(e?`${e}: `:"")+c,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function _D(l,e){let r=l.indexOf("://")===-1;try{return new URL(l,r&&e?"http://example.com":void 0),!0}catch{return!1}}class yD{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class vD{constructor(){this.instancedDataArray=new vu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class g1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,c,p){this.tileToMeter=ge(c);let h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:m,id:x,index:E,sourceLayerIndex:D}of e){let y=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),w=nt(m,h);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom),w,c))continue;let C={id:y,sourceLayerIndex:D,index:E,geometry:h?w.geometry:et(m,c,p),properties:m.properties,type:m.type,patterns:{}},T=this.addFeature(C,C.geometry,w);T&&r.featureIndex.insert(m,C.geometry,E,D,this.index,this.instancesPerModel[T].instancedDataArray.length,at/32)}this.lookup=null}update(e,r,c,p){for(let h in this.instancesPerModel){let m=this.instancesPerModel[h];for(let x in e)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],e[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];for(let p of c.features){let h=this.layers[0],m=p.feature,x=this.canonical,E=h.paint.get("model-rotation").evaluate(m,{},x),D=h.paint.get("model-scale").evaluate(m,{},x),y=h.paint.get("model-translation").evaluate(m,{},x);be.vec3.exactEquals(p.rotation,E)&&be.vec3.exactEquals(p.scale,D)&&be.vec3.exactEquals(p.translation,y)||(this.evaluate(p,p.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,r,c,p){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let h=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ux(this.activeReplacements,h))return!1;this.activeReplacements=h;let m=!1;for(let x in this.instancesPerModel){let E=this.instancesPerModel[x],D=E.instancedDataArray;for(let y of E.features){let w=y.instancedDataOffset,C=y.instancedDataCount;for(let T=0;T<C;T++){let I=16*(T+w),S=D.float32[I+0],R=S>at;S=R?S-at:S;let F=Math.floor(S),B=D.float32[I+1],U=!1;for(let k of this.activeReplacements)if(!LI(k,c,gD.Model,p)&&!(k.min.x>F||F>k.max.x||k.min.y>B||B>k.max.y)&&(U=VI(BI(F,B,e.canonical,k.footprintTileId.canonical),k.footprint),U))break;D.float32[I]=U?S+at:S,m=m||U!==R}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,pF.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,c){let p=this.layers[0],h=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!h)return In(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),h;_D(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new vD);let m=this.instancesPerModel[h],x=m.instancedDataArray,E=new yD(c,x.length);for(let D of r)for(let y of D){if(y.x<0||y.x>=at||y.y<0||y.y>=at)continue;let w=(this.lookupDim-1)/at,C=this.lookupDim*(y.y*w|0)+y.x*w|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;let T=x.length;x.resize(T+1),m.instancesEvaluatedElevation.push(0),x.float32[16*T]=y.x,x.float32[16*T+1]=y.y}return E.instancedDataCount=m.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(E),this.evaluate(E,{},m,!1)),h}getModelUris(){return this.modelUris}evaluate(e,r,c,p){let h=this.layers[0],m=e.feature,x=this.canonical,E=e.rotation=h.paint.get("model-rotation").evaluate(m,r,x),D=e.scale=h.paint.get("model-scale").evaluate(m,r,x),y=e.translation=h.paint.get("model-translation").evaluate(m,r,x),w=h.paint.get("model-color").evaluate(m,r,x);w.a=h.paint.get("model-color-mix-intensity").evaluate(m,r,x);let C=[];this.maxVerticalOffset<y[2]&&(this.maxVerticalOffset=y[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),pD(C,E,D);let T=Math.round(100*w.a)+w.b/1.05;for(let I=0;I<e.instancedDataCount;++I){let S=e.instancedDataOffset+I,R=16*S,F=c.instancedDataArray.float32,B=0;p&&(B=F[R+6]-c.instancesEvaluatedElevation[S]);let U=0|F[R+1];F[R]=(0|F[R])+w.r/1.05,F[R+1]=U+w.g/1.05,F[R+2]=T,F[R+3]=1/(x.z>10?this.tileToMeter:ge(x,U)),F[R+4]=y[0],F[R+5]=y[1],F[R+6]=y[2]+B,F[R+7]=C[0],F[R+8]=C[1],F[R+9]=C[2],F[R+10]=C[4],F[R+11]=C[5],F[R+12]=C[6],F[R+13]=C[8],F[R+14]=C[9],F[R+15]=C[10],c.instancesEvaluatedElevation[S]=y[2]}}}let xD,bD;mt(g1,"ModelBucket",{omit:["layers"]}),mt(vD,"PerModelAttributes"),mt(yD,"ModelFeature");let Cu=64,dd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wD(l,e,r,c,p,h,m,x,E,D=!1){let y=r.zoom,w=r.project(c),C=we(c.lat,y),T=1/C;be.mat4.identity(l),be.mat4.translate(l,l,[w.x+m[0]*T,w.y+m[1]*T,m[2]]);let I=1,S=1,R=r.worldSize;if(D){if(r.projection.name==="mercator"){let k=0;r.elevation&&(k=r.elevation.getAtPointOrZero(new Me(w.x/R,w.y/R),0));let G=be.vec4.transformMat4([],[w.x,w.y,k,1],r.projMatrix)[3]/r.cameraToCenterDistance;I=G,S=G*we(r.center.lat,y)}else if(r.projection.name==="globe"){let k=m1(l,r),G=be.mat4.multiply([],r.projMatrix,k),H=[0,0,0,1];be.vec4.transformMat4(H,H,G);let K=H[3]/r.cameraToCenterDistance,te=ec(y),ie=r.projection.pixelsPerMeter(c.lat,R)*we(c.lat,y),Q=r.projection.pixelsPerMeter(r.center.lat,R)*we(r.center.lat,y);I=K/Pt(ie,pe(r.center.lat),te),S=K*C/ie,I*=Q,S*=Q}}else I=T;be.mat4.scale(l,l,[I,I,S]);let F=[...l],B=e.orientation,U=[];if(pD(U,[B[0]+p[0],B[1]+p[1],B[2]+p[2]],h),be.mat4.multiply(l,F,U),x&&r.elevation){let k=0,G=[];if(E&&r.elevation){k=function(te,ie,Q,ue,se){let de=ie.elevation;if(!de)return 0;let ve=ni.projectAabbCorners(Q,ue),Te=ee(1,se.lat)*ie.worldSize,Ee=function(It,ct){let pt=[0,0,1],Nt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let sn of Nt){let Kt=It[sn.corners[0]],Jt=It[sn.corners[1]],dn=It[sn.corners[2]],pn=[Jt[0]-Kt[0],Jt[1]-Kt[1],ct*(Jt[2]-Kt[2])],Kn=be.vec3.cross(pn,pn,[dn[0]-Kt[0],dn[1]-Kt[1],ct*(dn[2]-Kt[2])]);be.vec3.normalize(Kn,Kn),sn.dotProductWithUp=be.vec3.dot(Kn,pt)}return Nt.sort((sn,Kt)=>sn.dotProductWithUp-Kt.dotProductWithUp),Nt[0].corners}(ve,Te),Ie=ve[Ee[0]],Oe=ve[Ee[1]],De=ve[Ee[2]],je=ve[Ee[3]],We=de.getAtPointOrZero(new Me(Ie[0]/ie.worldSize,Ie[1]/ie.worldSize),0),Ne=de.getAtPointOrZero(new Me(Oe[0]/ie.worldSize,Oe[1]/ie.worldSize),0),ut=de.getAtPointOrZero(new Me(De[0]/ie.worldSize,De[1]/ie.worldSize),0),ot=de.getAtPointOrZero(new Me(je[0]/ie.worldSize,je[1]/ie.worldSize),0),tt=(We+ot)/2,Ke=(Ne+ut)/2;return tt>Ke?Ne<ut?Y_(te,Oe,je,Ie,Ne,ot,We,Te):Y_(te,De,Ie,je,ut,We,ot,Te):We<ot?Y_(te,Ie,Oe,De,We,Ne,ut,Te):Y_(te,je,De,Oe,ot,ut,Ne,Te),Math.max(tt,Ke)}(G,r,e.aabb,l,c);let H=be.mat4.fromQuat([],G),K=be.mat4.multiply([],H,U);be.mat4.multiply(l,F,K)}else k=r.elevation.getAtPointOrZero(new Me(w.x/R,w.y/R),0);k!==0&&(l[14]+=k)}}function Zp(l,e,r=!1){l.uploaded||(l.gfxTexture=new d1(e,l.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:l.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function gF(l,e,r){l.indexBuffer=e.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=e.createVertexBuffer(l.vertexArray,cF.members,!1,!0),l.normalArray&&(l.normalBuffer=e.createVertexBuffer(l.normalArray,fF.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=e.createVertexBuffer(l.texcoordArray,dF.members,!1,!0)),l.colorArray&&(l.colorBuffer=e.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?uF:hF).members,!1,!0)),l.featureArray&&(l.pbrBuffer=e.createVertexBuffer(l.featureArray,mF.members,!0)),l.segments=xi.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);let c=l.material;c.pbrMetallicRoughness.baseColorTexture&&Zp(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&Zp(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&Zp(c.normalTexture,e),c.occlusionTexture&&Zp(c.occlusionTexture,e,r),c.emissionTexture&&Zp(c.emissionTexture,e)}function _1(l,e,r){if(l.meshes)for(let c of l.meshes)gF(c,e,r);if(l.children)for(let c of l.children)_1(c,e,r)}function J_(l){if(l.meshes)for(let e of l.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(l.children)for(let e of l.children)J_(e)}function y1(l){if(l.meshes)for(let r of l.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(l.children)for(let r of l.children)y1(r)}class fd{constructor(e,r,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=c}static create(e,r,c){let p=c||e.findDEMTileFor(r);if(!p||!p.dem)return;let h=p.dem,m=p.tileID,x=1<<r.canonical.z-m.canonical.z;return new fd(p,h.dim/at/x,[(r.canonical.x/x-m.canonical.x)*h.dim,(r.canonical.y/x-m.canonical.y)*h.dim])}tileCoordToPixel(e,r){let c=r*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(c);return new st(p,h)}getElevationAt(e,r,c,p){let h=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],x=Math.floor(h),E=Math.floor(m),D=this._dem;return p=!!p,c?Pt(Pt(D.get(x,E,p),D.get(x,E+1,p),m-E),Pt(D.get(x+1,E,p),D.get(x+1,E+1,p),m-E),h-x):D.get(x,E,p)}getElevationAtPixel(e,r,c){return this._dem.get(e,r,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ee(1,e)*this._dem.stride}}let v1=new Float32Array(262144),Du=new Uint8Array(262144);function TD(l){let e=0;if(l.meshes)for(let r of l.meshes)e=Math.max(e,r.aabb.max[2]);if(l.children)for(let r of l.children)e=Math.max(e,TD(r));return e}function ED(l,e,r){if(l.meshes)for(let c of l.meshes)c.aabb.min[0]!==1/0&&r.insert(e,c.aabb.min[0],c.aabb.min[1],c.aabb.max[0],c.aabb.max[1]);if(l.children)for(let c of l.children)ED(c,e,r)}let ID=["","wall","door","roof","window","lamp","logo"];class CD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:TD(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ni([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,r=new ni([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=ni.applyTransformFast(c.aabb,this.node.matrix),r.encapsulate(c.transformedAabb)),e++;this.aabb=r}return this.aabb}}class Q_{constructor(e,r,c,p,h,m){this.id=r,this.modelTraits|=dd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=dd.HasMapboxMeshFeatures),p&&(this.modelTraits|=dd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let x of e)this.nodesInfo.push(new CD(x)),ED(x,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(e,r){for(let c of this.getNodesInfo()){let p=c.node;p.footprint&&r.push({footprint:p.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let r=this.getNodesInfo();for(let c of r){let p=c.node;this.uploaded?this.updatePbrBuffer(p):_1(p,e,!0)}for(let c of r)J_(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(let c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),r=!0);return r}needsReEvaluation(e,r,c){let p=e.transform.projectionOptions,h=e.style.getBrightness(),m=this.brightness!==h;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||Xp(c.paint.get("model-color").value,m)||Xp(c.paint.get("model-color-mix-intensity").value,m)||Xp(c.paint.get("model-roughness").value,m)||Xp(c.paint.get("model-emissive-strength").value,m)||Xp(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=p,this.brightness=h,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let c=this.getNodesInfo(),p=this.id.canonical;for(let h of c){let m=h.feature;h.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},p)}}evaluate(e){let r=this.getNodesInfo();for(let c of r){if(!c.node.meshes)continue;let p=c.feature,h=c.node.meshes&&c.node.meshes[0].featureData,m=c.evaluatedColor[2],x=c.evaluatedRMEA[2],E=this.id.canonical;if(c.hasTranslucentParts=!1,h){for(let D=0;D<ID.length;D++){let y=ID[D];y.length&&(p.properties.part=y);let w=e.paint.get("model-color").evaluate(p,{},E).toRenderColor(null),C=e.paint.get("model-color-mix-intensity").evaluate(p,{},E);c.evaluatedColor[D]=[w.r,w.g,w.b,C],c.evaluatedRMEA[D][0]=e.paint.get("model-roughness").evaluate(p,{},E),c.evaluatedRMEA[D][2]=e.paint.get("model-emissive-strength").evaluate(p,{},E),c.evaluatedRMEA[D][3]=w.a,c.emissionHeightBasedParams[D]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,{},E),!c.hasTranslucentParts&&w.a<1&&(c.hasTranslucentParts=!0)}delete p.properties.part,yF(c,m!==c.evaluatedColor[2]||x!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,{},E);c.evaluatedScale=e.paint.get("model-scale").evaluate(p,{},E),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,c,p){let h=e.findDEMTileFor(c);if(h&&(h.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;let m=fd.create(e,c,h);if(!m)return;this.modelTraits&dd.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,p);for(let x of this.getNodesInfo()){let E=x.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;let D=E.footprint.vertices,y=m.getElevationAt(D[0].x,D[0].y,!0,!0);for(let w=1;w<D.length;w++)y=Math.min(y,m.getElevationAt(D[w].x,D[w].y,!0,!0));E.elevation=y}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,c,p){let h=r._dem._modifiedForSources[p];if(h===void 0&&(r._dem._modifiedForSources[p]=[],h=r._dem._modifiedForSources[p]),h.includes(c.canonical))return;let m=r._dem.dim;h.push(c.canonical);let x=!1;for(let E of this.getNodesInfo()){let D=E.node;if(!D.footprint||!D.footprint.grid)continue;let y=D.footprint.grid,w=r.tileCoordToPixel(y.min.x,y.min.y),C=r.tileCoordToPixel(y.max.x,y.max.y),T=Math.min(Math.min(m-C.y,w.x),Math.min(w.y,m-C.x));if(T<0)continue;let I=Qt(T,2,5),S=Math.max(0,w.x-I),R=Math.max(0,w.y-I),F=Math.min(C.x+I,m-1),B=Math.min(C.y+I,m-1);for(let H=R;H<=B;++H)for(let K=S;K<=F;++K)Du[H*m+K]=255;let U=0,k=0;for(let H=0;H<y.cellsY;++H)for(let K=0;K<y.cellsX;++K){if(!y.cells[H*y.cellsX+K])continue;let te=r.tileCoordToPixel(y.min.x+K/y.xScale,y.min.y+H/y.yScale),ie=r.tileCoordToPixel(y.min.x+(K+1)/y.xScale,y.min.y+(H+1)/y.yScale);for(let Q=te.y;Q<=Math.min(ie.y+1,m-1);++Q)for(let ue=te.x;ue<=Math.min(ie.x+1,m-1);++ue)Du[Q*m+ue]===255&&(Du[Q*m+ue]=0,U+=r.getElevationAtPixel(ue,Q),k++)}let G=U/k;S=Math.max(1,w.x-I),R=Math.max(1,w.y-I),F=Math.min(C.x+I,m-2),B=Math.min(C.y+I,m-2),x=!0;for(let H=R;H<=B;++H)for(let K=S;K<=F;++K)Du[H*m+K]===0&&(v1[H*m+K]=r._dem.set(K,H,G));for(let H=1;H<I;++H){S=Math.max(1,w.x-H),R=Math.max(1,w.y-H),F=Math.min(C.x+H,m-2),B=Math.min(C.y+H,m-2);for(let K=R;K<=B;++K)for(let te=S;te<=F;++te){let ie=K*m+te;if(Du[ie]===255){let Q=0,ue=0,se=-1,de=-1;for(let ve=-1;ve<=1;++ve)for(let Te=-1;Te<=1;++Te){let Ee=(K+ve)*m+te+Te;if(Du[Ee]>=H)continue;let Ie=v1[Ee],Oe=Math.abs(Ie);Oe>ue&&(Q=Ie,ue=Oe,se=Te,de=ve)}if(ue>.1){let ve=1-(H+.5*Math.abs(se*de))/I,Te=r._dem.get(te,K)+Q*ve,Ee=r._dem.get(te+se,K+de),Ie=r._dem.get(te-se,K-de,!0);(Te-Ee)*(Te-Ie)>0&&(Te=(Ee+Ie)/2),v1[ie]=r._dem.set(te,K,Te),Du[ie]=H}}}}}x&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=dt.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let r of e)J_(r.node),y1(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let c=r.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){let m=p[h].node;p[h].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(e,r){let c=this.getNodesInfo(),p=[],h=[0,0,0],m=be.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){let E=c[x],D=E.node.meshes[0],y=D.transformedAabb;if(e<y.min[0]||r<y.min[1]||e>y.max[0]||r>y.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};be.mat4.invert(m,E.node.matrix),h[0]=e,h[1]=r,be.vec3.transformMat4(h,h,m);let w=(h[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*Cu|0,C=Math.min(63,(h[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*Cu|0)*Cu+Math.min(63,w),T=D.heightmap[C];if(!(T<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:T,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new st(e,r),new st(e,r),p),p.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function Xp(l,e){return!l.isLightConstant&&e}function _F(l,e,r,c,p,h,m,x){let E=(61440&e|(61440&e)>>4)>>8,D=(3840&e|(3840&e)>>4)>>4,y=240&e|(240&e)>>4;r[3]>0&&(E=Pt(E,255*r[0],r[3]),D=Pt(D,255*r[1],r[3]),y=Pt(y,255*r[2],r[3]));let w=E<<8|D,C=y<<8|Math.floor(255*c[3]),T=function(H){let K=Qt(H,0,2);return Math.min(Math.round(.5*K*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],I=Qt(p[0],0,1),S=Qt(p[1],0,1),R=Qt(p[2],0,1),F=Qt(p[3],0,1),B,U,k,G;if(I!==S&&m!==h&&S!==I){let H=m-h;U=1/(H*(S-I)),k=-(h+H*I)/(H*(S-I));let K=Qt(p[4],-1,1);G=Math.pow(10,K),B=255*R<<8|255*F}else B=65535,U=0,k=1,G=1;if(l.emplaceBack(w,C,T,B,U,k,G),x){let H=x.length;x.clear();for(let K=0;K<H;K++)x.emplaceBack(w,C,T,B,U,k,G)}}function yF(l,e,r){let c=l.node,p=0,h=r&dd.HasMeshoptCompression;for(let m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new Kh,m.featureArray.reserve(m.featureData.length);let x=e;for(let E of m.featureData){let D=h?65535&E:E>>16&65535,y=h?E>>16&65535:65535&E,w=(15&y)<8?15&y:0,C=l.evaluatedRMEA[w],T=l.evaluatedColor[w],I=l.emissionHeightBasedParams[w],S;if(x&&w===2&&c.lights&&(S=new Kh,S.resize(10*c.lights.length)),_F(m.featureArray,D,T,C,I,m.aabb.min[2],m.aabb.max[2],S),S&&x){x=!1;let R=c.meshes[c.lightMeshIndex];R.featureArray=S,R.featureArray._trim()}}m.featureArray._trim(),p++}}function DD(l,e,r,c){let p=1<<l.z;e.lat=ae((c/at+l.y)/p),e.lng=le((r/at+l.x)/p)}mt(Q_,"Tiled3dModelBucket",{omit:["layers"]}),mt(CD,"Tiled3dModelFeature");let vF={circle:class extends yr{constructor(l,e,r,c){super(l,{layout:kn||(kn=new ui({"circle-sort-key":new Tt(Re.layout_circle["circle-sort-key"]),visibility:new it(Re.layout_circle.visibility)})),paint:bi||(bi=new ui({"circle-radius":new Tt(Re.paint_circle["circle-radius"]),"circle-color":new Tt(Re.paint_circle["circle-color"]),"circle-blur":new Tt(Re.paint_circle["circle-blur"]),"circle-opacity":new Tt(Re.paint_circle["circle-opacity"]),"circle-translate":new it(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new it(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new it(Re.paint_circle["circle-emissive-strength"])}))},e,r,c)}createBucket(l){return new Et(l)}queryRadius(l){let e=l;return hi("circle-radius",this,e)+hi("circle-stroke-width",this,e)+$n(this.paint.get("circle-translate"))}queryIntersectsFeature(l,e,r,c,p,h,m,x){let E=Mn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return oI(l,c,h,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,e,r){let c=rI(this);return{config:new Ua(this,{zoom:e,lut:r}),defines:c,overrideFog:!1}}},heatmap:class extends yr{createBucket(l){return new aI(l)}constructor(l,e,r,c){super(l,{layout:lI||(lI=new ui({visibility:new it(Re.layout_heatmap.visibility)})),paint:cI||(cI=new ui({"heatmap-radius":new Tt(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ao(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(Re.paint_heatmap["heatmap-opacity"])}))},e,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return hi("heatmap-radius",this,l)}queryIntersectsFeature(l,e,r,c,p,h,m,x){let E=this.paint.get("heatmap-radius").evaluate(e,r);return oI(l,c,h,m,x,!0,!0,new st(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,e,r){return l==="heatmap"?{config:new Ua(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends yr{constructor(l,e,r,c){super(l,{layout:uI||(uI=new ui({visibility:new it(Re.layout_hillshade.visibility)})),paint:hI||(hI=new ui({"hillshade-illumination-direction":new it(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new it(Re.paint_hillshade["hillshade-emissive-strength"])}))},e,r,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,e,r){return{overrideFog:!1}}},fill:class extends yr{constructor(l,e,r,c){super(l,{layout:vI||(vI=new ui({"fill-sort-key":new Tt(Re.layout_fill["fill-sort-key"]),visibility:new it(Re.layout_fill.visibility)})),paint:xI||(xI=new ui({"fill-antialias":new it(Re.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Re.paint_fill["fill-opacity"]),"fill-color":new Tt(Re.paint_fill["fill-color"]),"fill-outline-color":new Tt(Re.paint_fill["fill-outline-color"]),"fill-translate":new it(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new it(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tt(Re.paint_fill["fill-pattern"]),"fill-emissive-strength":new it(Re.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Tt(Re.paint_fill["fill-z-offset"])}))},e,r,c)}getProgramIds(){let l=this.paint.get("fill-pattern"),e=l&&l.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(l,e,r){return{config:new Ua(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(l,e){super.recalculate(l,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new kx(l)}queryRadius(){return $n(this.paint.get("fill-translate"))}queryIntersectsFeature(l,e,r,c,p,h){return!l.queryGeometry.isAboveHorizon&&Ot(on(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends yr{constructor(l,e,r,c){super(l,{layout:tC||(tC=new ui({visibility:new it(Re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new it(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:nC||(nC=new ui({"fill-extrusion-opacity":new it(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new it(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new it(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new it(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new it(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new it(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new it(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new it(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new it(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new it(Re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new it(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new it(Re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Tt(Re["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new it(Re["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new A_(l)}queryRadius(){return $n(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,e,r,c,p,h,m,x,E){let D=Mn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),y=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),C=[0,0],T=x&&h.elevation,I=h.elevation?h.elevation.exaggeration():1,S=l.tile.getBucket(this);if(T&&S instanceof A_){let k=S.centroidVertexArray,G=E+1;G<k.length&&(C[0]=k.geta_centroid_pos0(G),C[1]=k.geta_centroid_pos1(G))}if(C[0]===0&&C[1]===1)return!1;h.projection.name==="globe"&&(c=eC([c],[new st(0,0),new st(at,at)],l.tileID.canonical).map(k=>k.polygon).flat());let R=T?x:null,[F,B]=function(k,G,H,K,te,ie,Q,ue,se,de,ve){return k.projection.name==="globe"?function(Te,Ee,Ie,Oe,De,je,We,Ne,ut,ot,tt){let Ke=[],It=[],ct=Te.projection.upVectorScale(tt,Te.center.lat,Te.worldSize).metersToTile,pt=[0,0,0,1],Nt=[0,0,0,1],sn=(Jt,dn,pn,Kn)=>{Jt[0]=dn,Jt[1]=pn,Jt[2]=Kn,Jt[3]=1},Kt=QI();Ie>0&&(Ie+=Kt),Oe+=Kt;for(let Jt of Ee){let dn=[],pn=[];for(let Kn of Jt){let Nn=Kn.x+De.x,jt=Kn.y+De.y,An=Te.projection.projectTilePoint(Nn,jt,tt),On=Te.projection.upVector(tt,Kn.x,Kn.y),si=Ie,Ti=Oe;if(We){let Ni=rC(Nn,jt,Ie,Oe,We,Ne,ut,ot);si+=Ni.base,Ti+=Ni.top}Ie!==0?sn(pt,An.x+On[0]*ct*si,An.y+On[1]*ct*si,An.z+On[2]*ct*si):sn(pt,An.x,An.y,An.z),sn(Nt,An.x+On[0]*ct*Ti,An.y+On[1]*ct*Ti,An.z+On[2]*ct*Ti),be.vec3.transformMat4(pt,pt,je),be.vec3.transformMat4(Nt,Nt,je),dn.push(new Iu(pt[0],pt[1],pt[2])),pn.push(new Iu(Nt[0],Nt[1],Nt[2]))}Ke.push(dn),It.push(pn)}return[Ke,It]}(k,G,H,K,te,ie,Q,ue,se,de,ve):Q?function(Te,Ee,Ie,Oe,De,je,We,Ne,ut){let ot=[],tt=[],Ke=[0,0,0,1];for(let It of Te){let ct=[],pt=[];for(let Nt of It){let sn=Nt.x+Oe.x,Kt=Nt.y+Oe.y,Jt=rC(sn,Kt,Ee,Ie,je,We,Ne,ut);Ke[0]=sn,Ke[1]=Kt,Ke[2]=Jt.base,Ke[3]=1,be.vec4.transformMat4(Ke,Ke,De),Ke[3]=Math.max(Ke[3],1e-5);let dn=new Iu(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);Ke[0]=sn,Ke[1]=Kt,Ke[2]=Jt.top,Ke[3]=1,be.vec4.transformMat4(Ke,Ke,De),Ke[3]=Math.max(Ke[3],1e-5);let pn=new Iu(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);ct.push(dn),pt.push(pn)}ot.push(ct),tt.push(pt)}return[ot,tt]}(G,H,K,te,ie,Q,ue,se,de):function(Te,Ee,Ie,Oe,De){let je=[],We=[],Ne=De[8]*Ee,ut=De[9]*Ee,ot=De[10]*Ee,tt=De[11]*Ee,Ke=De[8]*Ie,It=De[9]*Ie,ct=De[10]*Ie,pt=De[11]*Ie;for(let Nt of Te){let sn=[],Kt=[];for(let Jt of Nt){let dn=Jt.x+Oe.x,pn=Jt.y+Oe.y,Kn=De[0]*dn+De[4]*pn+De[12],Nn=De[1]*dn+De[5]*pn+De[13],jt=De[2]*dn+De[6]*pn+De[14],An=De[3]*dn+De[7]*pn+De[15],On=Kn+Ne,si=Nn+ut,Ti=jt+ot,Ni=Math.max(An+tt,1e-5),Ei=Kn+Ke,_i=Nn+It,Qi=jt+ct,Vi=Math.max(An+pt,1e-5);sn.push(new Iu(On/Ni,si/Ni,Ti/Ni)),Kt.push(new Iu(Ei/Vi,_i/Vi,Qi/Vi))}je.push(sn),We.push(Kt)}return[je,We]}(G,H,K,te,ie)}(h,c,w,y,D,m,R,C,I,h.center.lat,l.tileID.canonical),U=l.queryGeometry;return function(k,G,H){let K=1/0;Ot(H,G)&&(K=iC(H,G[0]));for(let te=0;te<G.length;te++){let ie=G[te],Q=k[te];for(let ue=0;ue<ie.length-1;ue++){let se=ie[ue],de=[se,ie[ue+1],Q[ue+1],Q[ue],se];rt(H,de)&&(K=Math.min(K,iC(H,de)))}}return K!==1/0&&K}(F,B,U.isPointQuery()?U.screenBounds:U.screenGeometry)}},line:class extends yr{constructor(l,e,r,c){let p=pC();super(l,p,e,r,c),p.layout&&(this.layout=new $l(p.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof iu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,e){super.recalculate(l,e),this.paint._values["line-floorwidth"]=(()=>{if(Np)return Np;let r=pC();return Np=new wL(r.paint.properties["line-width"].specification),Np.useIntegerZoom=!0,Np})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new qx(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,e,r){let c=dC(this);return{config:new Ua(this,{zoom:e,lut:r}),defines:c,overrideFog:!1}}queryRadius(l){let e=l,r=mC(hi("line-width",this,e),hi("line-gap-width",this,e)),c=hi("line-offset",this,e);return r/2+Math.abs(c)+$n(this.paint.get("line-translate"))}queryIntersectsFeature(l,e,r,c,p,h){if(l.queryGeometry.isAboveHorizon)return!1;let m=on(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*mC(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),E=this.paint.get("line-offset").evaluate(e,r);return E&&(c=function(D,y){let w=[],C=new st(0,0);for(let T=0;T<D.length;T++){let I=D[T],S=[];for(let R=0;R<I.length;R++){let F=I[R],B=I[R+1],U=R===0?C:F.sub(I[R-1])._unit()._perp(),k=R===I.length-1?C:B.sub(F)._unit()._perp(),G=U._add(k)._unit();G._mult(1/(G.x*k.x+G.y*k.y)),S.push(G._mult(y)._add(F))}w.push(S)}return w}(c,E*l.pixelToTileUnitsFactor)),function(D,y,w){for(let C=0;C<y.length;C++){let T=y[C];if(D.length>=3){for(let I=0;I<T.length;I++)if(oi(D,T[I]))return!0}if(_t(D,T,w))return!0}return!1}(m,c,x)}isTileClipped(){return!0}isDraped(l){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:H_,background:class extends yr{constructor(l,e,r,c){super(l,{layout:JC||(JC=new ui({visibility:new it(Re.layout_background.visibility)})),paint:QC||(QC=new ui({"background-pitch-alignment":new it(Re.paint_background["background-pitch-alignment"]),"background-color":new it(Re.paint_background["background-color"]),"background-pattern":new it(Re.paint_background["background-pattern"]),"background-opacity":new it(Re.paint_background["background-opacity"]),"background-emissive-strength":new it(Re.paint_background["background-emissive-strength"])}))},e,r,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,e,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:rD,"raster-particle":uD,sky:class extends yr{constructor(l,e,r,c){super(l,{layout:aD||(aD=new ui({visibility:new it(Re.layout_sky.visibility)})),paint:lD||(lD=new ui({"sky-type":new it(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new it(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new it(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new it(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new it(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ao(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new it(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new it(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new it(Re.paint_sky["sky-opacity"])}))},e,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(l,e){if(this.paint.get("sky-type")==="atmosphere"){let c=this.paint.get("sky-atmosphere-sun"),p=!c,h=l.style.light,m=h.properties.get("position");return p&&h.properties.get("anchor")==="viewport"&&In("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?f1(m.azimuthal,90-m.polar,e):f1(c[0],90-c[1],e)}let r=this.paint.get("sky-gradient-center");return f1(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends yr{constructor(l,e,r,c){super(l,{paint:cD||(cD=new ui({}))},e,null)}},model:class extends yr{constructor(l,e,r,c){super(l,{layout:xD||(xD=new ui({visibility:new it(Re.layout_model.visibility),"model-id":new Tt(Re.layout_model["model-id"])})),paint:bD||(bD=new ui({"model-opacity":new it(Re.paint_model["model-opacity"]),"model-rotation":new Tt(Re.paint_model["model-rotation"]),"model-scale":new Tt(Re.paint_model["model-scale"]),"model-translation":new Tt(Re.paint_model["model-translation"]),"model-color":new Tt(Re.paint_model["model-color"]),"model-color-mix-intensity":new Tt(Re.paint_model["model-color-mix-intensity"]),"model-type":new it(Re.paint_model["model-type"]),"model-cast-shadows":new it(Re.paint_model["model-cast-shadows"]),"model-receive-shadows":new it(Re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new it(Re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Tt(Re.paint_model["model-emissive-strength"]),"model-roughness":new Tt(Re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Tt(Re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new it(Re.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new it(Re.paint_model["model-front-cutoff"])}))},e,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new g1(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof Q_?at-1:0}queryIntersectsFeature(l,e,r,c,p,h){if(!this.modelManager)return!1;let m=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof g1))return!1;let E=x;for(let D in E.instancesPerModel){let y=E.instancesPerModel[D],w=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(y.idToFeaturesIndex.hasOwnProperty(w)){let C=y.features[y.idToFeaturesIndex[w]],T=m.getModel(D,this.scope);if(!T)return!1;let I=be.mat4.create(),S=new j(0,0),R=E.canonical,F=Number.MAX_VALUE;for(let B=0;B<C.instancedDataCount;++B){let U=16*(C.instancedDataOffset+B),k=y.instancedDataArray.float32,G=[k[U+4],k[U+5],k[U+6]];DD(R,S,k[U],0|k[U+1]),wD(I,T,h,S,C.rotation,C.scale,G,!1,!1,!1),h.projection.name==="globe"&&(I=m1(I,h));let H=be.mat4.multiply([],h.projMatrix,I),K=l.queryGeometry,te=mD(K.isPointQuery()?K.screenBounds:K.screenGeometry,h,H,T.aabb);te!=null&&(F=Math.min(te,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(l,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){let e=this._transitionablePaint._values[l];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof qo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(l,e,r,c){let p=l.tile,h=p.getBucket(this),m=null,x=Number.MAX_VALUE;if(!(h&&h instanceof Q_))return{queryFeature:m,intersectionZ:x};let E=h.getNodesInfo()[e];if(E.hiddenByReplacement||!E.node.meshes||!r.filter(new vi(p.tileID.overscaledZ),E.feature,p.tileID.canonical))return{queryFeature:m,intersectionZ:x};let D=E.node,y=c.calculatePosMatrix(p.tileID.toUnwrapped(),c.worldSize),w=E.evaluatedScale,C=0;c.elevation&&D.elevation&&(C=D.elevation*c.elevation.exaggeration()),be.mat4.translate(y,y,[(D.anchor?D.anchor[0]:0)*(w[0]-1),(D.anchor?D.anchor[1]:0)*(w[1]-1),C]),be.mat4.scale(y,y,w),be.mat4.multiply(y,y,D.matrix);let T=l.queryGeometry,I=T.isPointQuery()?T.screenBounds:T.screenGeometry,S=function(F){let B=be.mat4.multiply([],y,F.matrix),U=be.mat4.multiply(B,c.expandedFarZProjMatrix,B);for(let k=0;k<F.meshes.length;++k){let G=F.meshes[k];if(k===F.lightMeshIndex)continue;let H=mD(I,c,U,G.aabb);H!=null&&(x=Math.min(H,x))}if(F.children)for(let k of F.children)S(k)};if(S(D),x===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:x};let R=new j(0,0);return DD(p.tileID.canonical,R,E.node.anchor[0],E.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[R.lng,R.lat]},properties:E.feature.properties,id:E.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:x}}},clip:class extends yr{constructor(l,e,r,c){super(l,{layout:bI||(bI=new ui({"clip-layer-types":new it(Re.layout_clip["clip-layer-types"]),"clip-layer-scope":new it(Re.layout_clip["clip-layer-scope"])})),paint:wI||(wI=new ui({}))},e,r,c)}recalculate(l,e){super.recalculate(l,e)}createBucket(l){return new TI(l)}isTileClipped(){return!0}is3D(){return!0}}};class xF{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class bF{constructor(){this.tasks={},this.taskQueue=[],fl(["process"],this),this.invoker=new xF(this.process),this.nextId=0}add(e,r){let c=this.nextId++,p=function({type:h,isSymbolTile:m,zoom:x}){return x=x||0,h==="message"?0:h!=="maybePrepare"||m?h!=="parseTile"||m?h==="parseTile"&&m?300-x:h==="maybePrepare"&&m?400-x:500:200-x:100-x}(r);if(p===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:r,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let p=0;p<this.taskQueue.length;p++){let h=this.tasks[this.taskQueue[p]];h.priority<r&&(r=h.priority,e=p)}if(e===null)return null;let c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class MD{constructor(e,r,c){this.target=e,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},fl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new bF}send(e,r,c,p,h=!1,m){let x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);let E=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!c,targetMapId:p,mustQueue:h,sourceMapId:this.mapId,data:Ks(r,E)},E),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){let r=e.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){let p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(r.mustQueue||Ma()){let p=this.callbacks[c],h=this.scheduler.add(()=>this.processTask(c,r),p&&p.metadata||{type:"message"});h&&(this.cancelCallbacks[c]=h)}else this.processTask(c,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){let c=this.callbacks[e];delete this.callbacks[e],c&&(r.error?c(Na(r.error)):c(null,Na(r.data)))}else{let c=new Set,p=r.hasCallback?(m,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Ks(m):null,data:Ks(x,c)},c)}:m=>{},h=Na(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,p);else if(this.parent.getWorkerSource){let m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],h.source,h.scope)[m[1]](h,p)}else p(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let x1=(()=>{class l{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Vc();let p=this.workerPool.acquire(this.id);for(let h=0;h<p.length;h++){let m=new l.Actor(p[h],c,this.id);m.name=`Worker ${h}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,p){Ca(this.actors,(h,m)=>{h.send(r,c,m)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return l.Actor=MD,l})();class SD{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let c=this.toIdx(e,r);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function AD(l,e,r,c){let p=0,h=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(r[m]<l[m]||r[m]>e[m])return null}else{let x=1/c[m],E=(l[m]-r[m])*x,D=(e[m]-r[m])*x;if(E>D){let y=E;E=D,D=y}if(E>p&&(p=E),D<h&&(h=D),p>h)return null}return p}function PD(l,e,r,c,p,h,m,x,E,D,y){let w=c-l,C=p-e,T=h-r,I=m-l,S=x-e,R=E-r,F=y[1]*R-y[2]*S,B=y[2]*I-y[0]*R,U=y[0]*S-y[1]*I,k=w*F+C*B+T*U;if(Math.abs(k)<1e-15)return null;let G=1/k,H=D[0]-l,K=D[1]-e,te=D[2]-r,ie=(H*F+K*B+te*U)*G;if(ie<0||ie>1)return null;let Q=K*T-te*C,ue=te*w-H*T,se=H*C-K*w,de=(y[0]*Q+y[1]*ue+y[2]*se)*G;return de<0||ie+de>1?null:(I*Q+S*ue+R*se)*G}function RD(l,e,r){return(l-e)/(r-e)}function OD(l,e,r,c,p,h,m,x,E){let D=1<<r,y=h-c,w=m-p,C=(l+1)/D*y+c,T=(e+0)/D*w+p,I=(e+1)/D*w+p;x[0]=(l+0)/D*y+c,x[1]=T,E[0]=C,E[1]=I}class LD{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(h){let m=Math.ceil(Math.log2(h.dim/8)),x=[],E=Math.ceil(Math.pow(2,m)),D=1/E,y=(T,I,S,R,F)=>{let B=R?1:0,U=(T+1)*S-B,k=I*S,G=(I+1)*S-B;F[0]=T*S,F[1]=k,F[2]=U,F[3]=G},w=new SD(E),C=[];for(let T=0;T<E*E;T++){y(T%E,Math.floor(T/E),D,!1,C);let I=ac(C[0],C[1],h),S=ac(C[2],C[1],h),R=ac(C[2],C[3],h),F=ac(C[0],C[3],h);w.minimums.push(Math.min(I,S,R,F)),w.maximums.push(Math.max(I,S,R,F)),w.leaves.push(1)}for(x.push(w),E/=2;E>=1;E/=2){let T=x[x.length-1];w=new SD(E);for(let I=0;I<E*E;I++){y(I%E,Math.floor(I/E),2,!0,C);let S=T.getElevation(C[0],C[1]),R=T.getElevation(C[2],C[1]),F=T.getElevation(C[2],C[3]),B=T.getElevation(C[0],C[3]),U=T.isLeaf(C[0],C[1]),k=T.isLeaf(C[2],C[1]),G=T.isLeaf(C[2],C[3]),H=T.isLeaf(C[0],C[3]),K=Math.min(S.min,R.min,F.min,B.min),te=Math.max(S.max,R.max,F.max,B.max),ie=U&&k&&G&&H;w.maximums.push(te),w.minimums.push(K),w.leaves.push(te-K<=5&&ie?1:0)}x.push(w)}return x}(this.dem),c=r.length-1,p=r[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(r,0,0,c,0)}raycastRoot(e,r,c,p,h,m,x=1){return AD([e,r,-100],[c,p,this.maximums[0]*x],h,m)}raycast(e,r,c,p,h,m,x=1){if(!this.nodeCount)return null;let E=this.raycastRoot(e,r,c,p,h,m,x);if(E==null)return null;let D=[],y=[],w=[],C=[],T=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;T.length>0;){let{idx:I,t:S,nodex:R,nodey:F,depth:B}=T.pop();if(this.leaves[I]){OD(R,F,B,e,r,c,p,w,C);let k=1<<B,G=(R+0)/k,H=(R+1)/k,K=(F+0)/k,te=(F+1)/k,ie=ac(G,K,this.dem)*x,Q=ac(H,K,this.dem)*x,ue=ac(H,te,this.dem)*x,se=ac(G,te,this.dem)*x,de=PD(w[0],w[1],ie,C[0],w[1],Q,C[0],C[1],ue,h,m),ve=PD(C[0],C[1],ue,w[0],C[1],se,w[0],w[1],ie,h,m),Te=Math.min(de!==null?de:Number.MAX_VALUE,ve!==null?ve:Number.MAX_VALUE);if(Te!==Number.MAX_VALUE)return Te;{let Ee=be.vec3.scaleAndAdd([],h,m,S);if(FD(ie,Q,se,ue,RD(Ee[0],w[0],C[0]),RD(Ee[1],w[1],C[1]))>=Ee[2])return S}continue}let U=0;for(let k=0;k<this._siblingOffset.length;k++){OD((R<<1)+this._siblingOffset[k][0],(F<<1)+this._siblingOffset[k][1],B+1,e,r,c,p,w,C),w[2]=-100,C[2]=this.maximums[this.childOffsets[I]+k]*x;let G=AD(w,C,h,m);if(G!=null){let H=G;D[k]=H;let K=!1;for(let te=0;te<U&&!K;te++)H>=D[y[te]]&&(y.splice(te,0,k),K=!0);K||(y[U]=k),U++}}for(let k=0;k<U;k++){let G=y[k];T.push({idx:this.childOffsets[I]+G,t:D[G],nodex:(R<<1)+this._siblingOffset[G][0],nodey:(F<<1)+this._siblingOffset[G][1],depth:B+1})}}return null}_addNode(e,r,c){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,c,p,h){if(e[p].isLeaf(r,c)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);let m=p-1,x=e[m],E=0,D=0;for(let y=0;y<this._siblingOffset.length;y++){let w=2*r+this._siblingOffset[y][0],C=2*c+this._siblingOffset[y][1],T=x.getElevation(w,C),I=x.isLeaf(w,C),S=this._addNode(T.min,T.max,I);I&&(E|=1<<y),D||(D=S)}for(let y=0;y<this._siblingOffset.length;y++)E&1<<y||this._construct(e,2*r+this._siblingOffset[y][0],2*c+this._siblingOffset[y][1],m,D+y)}}function FD(l,e,r,c,p,h){return Pt(Pt(l,r,h),Pt(e,c,h),p)}function ac(l,e,r){let c=r.dim,p=Qt(l*c-.5,0,c-1),h=Qt(e*c-.5,0,c-1),m=Math.floor(p),x=Math.floor(h),E=Math.min(m+1,c-1),D=Math.min(x+1,c-1);return FD(r.get(m,x),r.get(E,x),r.get(m,D),r.get(E,D),p-m,h-x)}let wF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TF(l,e,r){return(256*l*256+256*e+r)/10-1e4}function EF(l,e,r){return 256*l+e+r/256-32768}class ey{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,c,p=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void In(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let h=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let E=0;E<h;E++)m[this._idx(-1,E)]=m[this._idx(0,E)],m[this._idx(h,E)]=m[this._idx(h-1,E)],m[this._idx(E,-1)]=m[this._idx(E,0)],m[this._idx(E,h)]=m[this._idx(E,h-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(h,-1)]=m[this._idx(h-1,0)],m[this._idx(-1,h)]=m[this._idx(0,h-1)],m[this._idx(h,h)]=m[this._idx(h-1,h-1)]}let x=c==="terrarium"?EF:TF;for(let E=0;E<m.length;++E){let D=4*E;this.floatView[E]=x(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=dt.now()}_buildQuadTree(){this._tree=new LD(this)}get(e,r,c=!1){c&&(e=Qt(e,-1,this.dim),r=Qt(r,-1,this.dim));let p=this._idx(e,r);return this.floatView[p]}set(e,r,c){let p=this._idx(e,r),h=this.floatView[p];return this.floatView[p]=c,c-h}static getUnpackVector(e){return wF[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){let c=[0,0,0,0],p=ey.getUnpackVector(r),h=Math.floor((e+p[3])/p[2]);return c[2]=h%256,h=Math.floor(h/256),c[1]=h%256,h=Math.floor(h/256),c[0]=h,c}getPixels(){return new pI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,h=r*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(r){case-1:p=h-1;break;case 1:h=p+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}let E=-r*this.dim,D=-c*this.dim;for(let y=m;y<x;y++)for(let w=p;w<h;w++){let C=4*this._idx(w,y),T=4*this._idx(w+E,y+D);this.pixels[C+0]=e.pixels[T+0],this.pixels[C+1]=e.pixels[T+1],this.pixels[C+2]=e.pixels[T+2],this.pixels[C+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function IF(l,e,r){l===1?e.header_length=r.readFixed32():l===2?e.x=r.readVarint():l===3?e.y=r.readVarint():l===4?e.z=r.readVarint():l===5&&e.layers.push(function(c,p){return c.readFields(AF,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},p)}(r,r.readVarint()+r.pos))}function CF(l,e,r){l===1?(e.delta_filter=function(c,p){return c.readFields(DF,{block_size:0},p)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):l===2?(r.readVarint(),e.filter="zigzag_filter"):l===3?(r.readVarint(),e.filter="bitshuffle_filter"):l===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function DF(l,e,r){l===1&&(e.block_size=r.readVarint())}function MF(l,e,r){l===1?(r.readVarint(),e.codec="gzip_data"):l===2?(r.readVarint(),e.codec="jpeg_image"):l===3?(r.readVarint(),e.codec="webp_image"):l===4&&(r.readVarint(),e.codec="png_image")}function SF(l,e,r){l===1?e.first_byte=r.readFixed64():l===2?e.last_byte=r.readFixed64():l===3?e.filters.push(function(c,p){return c.readFields(CF,{},p)}(r,r.readVarint()+r.pos)):l===4?e.codec=function(c,p){return c.readFields(MF,{},p)}(r,r.readVarint()+r.pos):l===5?e.deprecated_offset=r.readFloat():l===6?e.deprecated_scale=r.readFloat():l===7?e.bands.push(r.readString()):l===8?e.offset=r.readDouble():l===9&&(e.scale=r.readDouble())}function AF(l,e,r){l===1?e.version=r.readVarint():l===2?e.name=r.readString():l===3?e.units=r.readString():l===4?e.tilesize=r.readVarint():l===5?e.buffer=r.readVarint():l===6?e.pixel_format=r.readVarint():l===7&&e.data_index.push(function(c,p){return c.readFields(SF,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},p)}(r,r.readVarint()+r.pos))}function PF(l,e,r){if(l===2)(function(c,p,h){c.readFields(RF,h,p)})(r,r.readVarint()+r.pos,e);else if(l===3)throw new Error("Not implemented")}function RF(l,e,r){if(l===1){let c=0,p=r.readVarint()+r.pos;for(;r.pos<p;)e[c++]=r.readVarint()}}mt(ey,"DEMData"),mt(LD,"DemMinMaxQuadTree",{omit:["dem"]});class OF{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}}function LF(l,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let c=2;c>=1;c--){let p=c===1?1:0,h=c===2?1:0;for(let m=0;m<e[0];m++){let x=e[1]*m;for(let E=p;E<e[1];E++){let D=e[2]*(E+x);for(let y=h;y<e[2];y++){let w=e[3]*(y+D);for(let C=0;C<e[3];C++){let T=w+C;l[T]+=l[T-r]}}}}r*=e[c]}return l}function FF(l){for(let e=0,r=l.length;e<r;e++)l[e]=l[e]>>>1^-(1&l[e]);return l}function kF(l,e){switch(e){case"uint32":return l;case"uint16":for(let r=0;r<l.length;r+=2){let c=l[r],p=l[r+1];l[r]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,l[r+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let r=0;r<l.length;r+=4){let c=l[r],p=l[r+1],h=l[r+2],m=l[r+3];l[r+0]=(192&c)>>6|(192&p)>>4|(192&h)>>2|192&m,l[r+1]=(48&c)>>4|(48&p)>>2|48&h|(48&m)<<2,l[r+2]=(12&c)>>2|12&p|(12&h)<<2|(12&m)<<4,l[r+3]=3&c|(3&p)<<2|(3&h)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${e}"`)}}var Lo=Uint8Array,Yp=Uint16Array,NF=Int32Array,kD=new Lo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ND=new Lo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zF=new Lo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zD=function(l,e){for(var r=new Yp(31),c=0;c<31;++c)r[c]=e+=1<<l[c-1];var p=new NF(r[30]);for(c=1;c<30;++c)for(var h=r[c];h<r[c+1];++h)p[h]=h-r[c]<<5|c;return{b:r,r:p}},BD=zD(kD,2),VD=BD.b,BF=BD.r;VD[28]=258,BF[258]=28;for(var VF=zD(ND,0).b,jD=new Yp(32768),ki=0;ki<32768;++ki){var pd=(43690&ki)>>1|(21845&ki)<<1;jD[ki]=((65280&(pd=(61680&(pd=(52428&pd)>>2|(13107&pd)<<2))>>4|(3855&pd)<<4))>>8|(255&pd)<<8)>>1}var Kp=function(l,e,r){for(var c=l.length,p=0,h=new Yp(e);p<c;++p)l[p]&&++h[l[p]-1];var m,x=new Yp(e);for(p=1;p<e;++p)x[p]=x[p-1]+h[p-1]<<1;m=new Yp(1<<e);var E=15-e;for(p=0;p<c;++p)if(l[p])for(var D=p<<4|l[p],y=e-l[p],w=x[l[p]-1]++<<y,C=w|(1<<y)-1;w<=C;++w)m[jD[w]>>E]=D;return m},Jp=new Lo(288);for(ki=0;ki<144;++ki)Jp[ki]=8;for(ki=144;ki<256;++ki)Jp[ki]=9;for(ki=256;ki<280;++ki)Jp[ki]=7;for(ki=280;ki<288;++ki)Jp[ki]=8;var UD=new Lo(32);for(ki=0;ki<32;++ki)UD[ki]=5;var jF=Kp(Jp,9),UF=Kp(UD,5),b1=function(l){for(var e=l[0],r=1;r<l.length;++r)l[r]>e&&(e=l[r]);return e},Es=function(l,e,r){var c=e/8|0;return(l[c]|l[c+1]<<8)>>(7&e)&r},w1=function(l,e){var r=e/8|0;return(l[r]|l[r+1]<<8|l[r+2]<<16)>>(7&e)},$F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Is=function(l,e,r){var c=new Error(e||$F[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,Is),!r)throw c;return c},GF=new Lo(0),HF=typeof TextDecoder<"u"&&new TextDecoder;try{HF.decode(GF,{stream:!0})}catch{}let qF={gzip_data:"gzip"};class Ko extends Error{constructor(e){super(e),this.name="MRTError"}}let WF={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},$D={uint32:1,uint16:2,uint8:4},ZF={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},T1;class E1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let r=this.layers[e];if(!r)throw new Ko(`Layer '${e}' not found`);return r}getHeaderLength(e){let r=new Uint8Array(e),c=new DataView(e);if(r[0]!==13)throw new Ko("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){let r=new Uint8Array(e),c=this.getHeaderLength(e);if(r.length<c)throw new Ko(`Expected header with length >= ${c} but got buffer of length ${r.length}`);let p=function(h,m){return h.readFields(IF,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new T1(r.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Ko(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(let h of p.layers)this.layers[h.name]=new XF(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let r=[],c=this.getLayer(e.layerName);for(let p of e.blockIndices){let h=c.dataIndex[p],m=h.first_byte-e.firstByte,x=h.last_byte-e.firstByte;if(c._blocksInProgress.has(p))continue;let E={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[h.bands.length].concat(c.bandShape),buffer:c.buffer,codec:h.codec.codec,filters:h.filters.map(D=>D.filter)};c._blocksInProgress.add(p),r.push(E)}return new GD(r,()=>{r.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,h)=>{if(r.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;h.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class XF{constructor({version:e,name:r,units:c,tilesize:p,pixel_format:h,buffer:m,data_index:x},E){if(this.version=e,this.version!==1)throw new Ko(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=WF[h],this.dataIndex=x,this.bandShape=[p+2*m,p+2*m,$D[this.pixelFormat]],this._decodedBlocks=new OF(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return $D[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(let[c,p]of this.dataIndex.entries()){for(let[h,m]of p.bands.entries())if(m===e)return{bandIndex:r+h,blockIndex:c,blockBandIndex:h};r+=p.bands.length}break;case"number":for(let[c,p]of this.dataIndex.entries()){if(e>=r&&e<r+p.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-r};r+=p.bands.length}break;default:throw new Ko(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ko(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,c=-1/0,p=[],h=new Set;for(let m of e){let{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new Ko(`Invalid band: ${JSON.stringify(m)}`);let E=this.dataIndex[x];p.includes(x)||p.push(x),h.add(x),r=Math.min(r,E.first_byte),c=Math.max(c,E.last_byte)}if(h.size>this.cacheSize)throw new Ko(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:c,blockIndices:p}}hasBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){let{blockIndex:r,blockBandIndex:c}=this.getBlockForBand(e),p=this._decodedBlocks.get(r.toString());if(!p)throw new Ko(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let h=this.dataIndex[r],m=this.bandShape.reduce((D,y)=>D*y,1),x=c*m,E=p.subarray(x,x+m);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset!==0?h.offset:h.deprecated_offset,scale:h.scale!==0?h.scale:h.deprecated_scale}}}E1.setPbf=function(l){T1=l};class GD{constructor(e,r,c){this.tasks=e,this._onCancel=r,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}E1.performDecoding=function(l,e){let r=new Uint8Array(l);return Promise.all(e.tasks.map(c=>{let{layerName:p,firstByte:h,lastByte:m,pixelFormat:x,blockShape:E,blockIndex:D,filters:y,codec:w}=c,C=r.subarray(h,m+1),T=new Uint32Array(E[0]*E[1]*E[2]),I;if(w!=="gzip_data")throw new Ko(`Unhandled codec: ${w}`);return I=function(S,R){if(!globalThis.DecompressionStream&&R==="gzip_data")return Promise.resolve(((k=function(K){K[0]==31&&K[1]==139&&K[2]==8||Is(6,"invalid gzip data");var te=K[3],ie=10;4&te&&(ie+=2+(K[10]|K[11]<<8));for(var Q=(te>>3&1)+(te>>4&1);Q>0;Q-=!K[ie++]);return ie+(2&te)}(U=S))+8>U.length&&Is(6,"invalid gzip data"),function(K,te,ie,Q){var ue=K.length;if(!ue||te.f&&!te.l)return ie||new Lo(0);var se=!ie,de=se||te.i!=2,ve=te.i;se&&(ie=new Lo(3*ue));var Te,Ee,Ie=function(lc){var Au=ie.length;if(lc>Au){var om=new Lo(Math.max(2*Au,lc));om.set(ie),ie=om}},Oe=te.f||0,De=te.p||0,je=te.b||0,We=te.l,Ne=te.d,ut=te.m,ot=te.n,tt=8*ue;do{if(!We){Oe=Es(K,De,1);var Ke=Es(K,De+1,3);if(De+=3,!Ke){var It=K[(jt=4+((De+7)/8|0))-4]|K[jt-3]<<8,ct=jt+It;if(ct>ue){ve&&Is(0);break}de&&Ie(je+It),ie.set(K.subarray(jt,ct),je),te.b=je+=It,te.p=De=8*ct,te.f=Oe;continue}if(Ke==1)We=jF,Ne=UF,ut=9,ot=5;else if(Ke==2){var pt=Es(K,De,31)+257,Nt=Es(K,De+10,15)+4,sn=pt+Es(K,De+5,31)+1;De+=14;for(var Kt=new Lo(sn),Jt=new Lo(19),dn=0;dn<Nt;++dn)Jt[zF[dn]]=Es(K,De+3*dn,7);De+=3*Nt;var pn=b1(Jt),Kn=(1<<pn)-1,Nn=Kp(Jt,pn);for(dn=0;dn<sn;){var jt,An=Nn[Es(K,De,Kn)];if(De+=15&An,(jt=An>>4)<16)Kt[dn++]=jt;else{var On=0,si=0;for(jt==16?(si=3+Es(K,De,3),De+=2,On=Kt[dn-1]):jt==17?(si=3+Es(K,De,7),De+=3):jt==18&&(si=11+Es(K,De,127),De+=7);si--;)Kt[dn++]=On}}var Ti=Kt.subarray(0,pt),Ni=Kt.subarray(pt);ut=b1(Ti),ot=b1(Ni),We=Kp(Ti,ut),Ne=Kp(Ni,ot)}else Is(1);if(De>tt){ve&&Is(0);break}}de&&Ie(je+131072);for(var Ei=(1<<ut)-1,_i=(1<<ot)-1,Qi=De;;Qi=De){var Vi=(On=We[w1(K,De)&Ei])>>4;if((De+=15&On)>tt){ve&&Is(0);break}if(On||Is(2),Vi<256)ie[je++]=Vi;else{if(Vi==256){Qi=De,We=null;break}var hr=Vi-254;Vi>264&&(hr=Es(K,De,(1<<(Ds=kD[dn=Vi-257]))-1)+VD[dn],De+=Ds);var ii=Ne[w1(K,De)&_i],to=ii>>4;if(ii||Is(3),De+=15&ii,Ni=VF[to],to>3){var Ds=ND[to];Ni+=w1(K,De)&(1<<Ds)-1,De+=Ds}if(De>tt){ve&&Is(0);break}de&&Ie(je+131072);var Jo=je+hr;if(je<Ni){var Qo=0-Ni,Su=Math.min(Ni,Jo);for(Qo+je<0&&Is(3);je<Su;++je)ie[je]=(void 0)[Qo+je]}for(;je<Jo;++je)ie[je]=ie[je-Ni]}}te.l=We,te.p=Qi,te.b=je,te.f=Oe,We&&(Oe=1,te.m=ut,te.d=Ne,te.n=ot)}while(!Oe);return je!=ie.length&&se?(Te=ie,((Ee=je)==null||Ee>Te.length)&&(Ee=Te.length),new Lo(Te.subarray(0,Ee))):ie.subarray(0,je)}(U.subarray(k,-8),{i:2},new Lo(((F=U)[(B=F.length)-4]|F[B-3]<<8|F[B-2]<<16|F[B-1]<<24)>>>0))));var F,B,U,k;let G=qF[R];if(!G)throw new Error(`Unhandled codec: ${R}`);let H=new globalThis.DecompressionStream(G);return new Response(new Blob([S]).stream().pipeThrough(H)).arrayBuffer().then(K=>new Uint8Array(K))}(C,w).then(S=>(function(R,F){R.readFields(PF,F)}(new T1(S),T),new ZF[x](T.buffer))),I.then(S=>{for(let R=y.length-1;R>=0;R--)switch(y[R]){case"delta_filter":LF(S,E);break;case"zigzag_filter":FF(S);break;case"bitshuffle_filter":kF(S,x);break;default:throw new Ko(`Unhandled filter "${y[R]}"`)}return{layerName:p,blockIndex:D,data:S}}).catch(S=>{throw S})}))},mt(GD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var Qp={workerUrl:"",workerClass:null,workerParams:void 0};let I1="mapboxgl_preloaded_worker_pool";class em{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<em.workerCount;)this.workers.push(Qp.workerClass!=null?new Qp.workerClass:new self.Worker(Qp.workerUrl,Qp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[I1]}numActive(){return Object.keys(this.active).length}}let tm;function ty(){return tm||(tm=new em),tm}em.workerCount=2;let nm,C1,Cs,md,D1,gd=null;function HD(){return Ma()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:C1||_e.DRACO_URL}function qD(){if(Ma()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(md)return md;let l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return md=WebAssembly.validate(l)?_e.MESHOPT_SIMD_URL:_e.MESHOPT_URL,md}let ny={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},YF={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},im={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function WD(l,e,r){let c=r.json.bufferViews.length,p=r.buffers.length;e.bufferView=c,r.json.bufferViews[c]={buffer:p,byteLength:l.byteLength},r.buffers[p]=l}let M1="KHR_draco_mesh_compression";function KF(l,e){let r=l.extensions&&l.extensions[M1];if(!r)return;let c=new Cs.Decoder,p=KD(e,r.bufferView),h=new Cs.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,h))throw new Error("Failed to decode Draco mesh");let m=e.json.accessors[l.indices],x=ny[m.componentType],E=m.count*x.BYTES_PER_ELEMENT,D=Cs._malloc(E);x===Uint16Array?c.GetTrianglesUInt16Array(h,E,D):c.GetTrianglesUInt32Array(h,E,D),WD(Cs.memory.buffer.slice(D,D+E),m,e),Cs._free(D);for(let y of Object.keys(r.attributes)){let w=c.GetAttributeByUniqueId(h,r.attributes[y]),C=e.json.accessors[l.attributes[y]],T=YF[C.componentType],I=C.count*im[C.type]*ny[C.componentType].BYTES_PER_ELEMENT,S=Cs._malloc(I);c.GetAttributeDataArrayForAllPoints(h,w,Cs[T],I,S),WD(Cs.memory.buffer.slice(S,S+I),C,e),Cs._free(S)}c.destroy(),h.destroy(),delete l.extensions[M1]}let iy="EXT_meshopt_compression";function JF(l,e){if(!l.extensions||!l.extensions[iy])return;let r=l.extensions[iy],c=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),p=new Uint8Array(r.count*r.byteStride);D1.decodeGltfBuffer(p,r.count,r.byteStride,c,r.mode,r.filter),l.buffer=e.buffers.length,l.byteOffset=0,e.buffers[l.buffer]=p.buffer,delete l.extensions[iy]}let ZD=1179937895,XD=new TextDecoder("utf8");function YD(l,e){return new URL(l,e).href}function QF(l,e,r,c){return fetch(YD(l.uri,c)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[r]=p})}function KD(l,e){let r=l.json.bufferViews[e];return new Uint8Array(l.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function ek(l,e,r,c){if(l.uri){let p=YD(l.uri,c);return fetch(p).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[r]=h})}if(l.bufferView!==void 0){let p=KD(e,l.bufferView),h=new Blob([p],{type:l.mimeType});return createImageBitmap(h).then(m=>{e.images[r]=m})}}function JD(l,e=0,r){let c={json:null,images:[],buffers:[]};if(new Uint32Array(l,e,1)[0]===ZD){let y=new Uint32Array(l,e),w=2,C=(y[w++]>>2)-3,T=y[w++]>>2;if(w++,c.json=JSON.parse(XD.decode(y.subarray(w,w+T))),w+=T,w<C){let I=y[w++];w++;let S=e+(w<<2);c.buffers[0]=l.slice(S,S+I)}}else c.json=JSON.parse(XD.decode(new Uint8Array(l,e)));let{buffers:p,images:h,meshes:m,extensionsUsed:x,bufferViews:E}=c.json,D=Promise.resolve();if(p){let y=[];for(let w=0;w<p.length;w++){let C=p[w];C.uri?y.push(QF(C,c,w,r)):c.buffers[w]||(c.buffers[w]=null)}D=Promise.all(y)}return D.then(()=>{let y=[],w=x&&x.includes(M1),C=x&&x.includes(iy);if(w&&y.push(function(){if(!Cs)return nm??(nm=function(T){let I,S=null;function R(){I=new Uint8Array(S.buffer)}function F(){throw new Error("Unexpected Draco error.")}let B={a:{a:F,d:function(U,k,G){return I.copyWithin(U,k,k+G)},c:function(U){let k=I.length,G=Math.max(U>>>0,Math.ceil(1.2*k)),H=Math.ceil((G-k)/65536);try{return S.grow(H),R(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,B):T.then(U=>U.arrayBuffer()).then(U=>WebAssembly.instantiate(U,B))).then(U=>{let{Rb:k,Qb:G,P:H,T:K,X:te,Ja:ie,La:Q,Qa:ue,Va:se,Wa:de,eb:ve,jb:Te,f:Ee,e:Ie,yb:Oe,zb:De,Ab:je,Bb:We,Db:Ne,Gb:ut}=U.instance.exports;S=Ie;let ot=(()=>{let tt=0,Ke=0,It=0,ct=0;return pt=>{It&&(k(ct),k(tt),Ke+=It,It=tt=0),tt||(Ke+=128,tt=G(Ke));let Nt=pt.length+7&-8,sn=tt;Nt>=Ke&&(It=Nt,sn=ct=G(Nt));for(let Kt=0;Kt<pt.length;Kt++)I[sn+Kt]=pt[Kt];return sn}})();return R(),Ee(),{memory:Ie,_free:k,_malloc:G,Mesh:class{constructor(){this.ptr=H()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=ie()}destroy(){Te(this.ptr)}DecodeArrayToMesh(tt,Ke,It){let ct=ot(tt),pt=Q(this.ptr,ct,Ke,It.ptr);return!!te(pt)}GetAttributeByUniqueId(tt,Ke){return{ptr:ue(this.ptr,tt.ptr,Ke)}}GetTrianglesUInt16Array(tt,Ke,It){se(this.ptr,tt.ptr,Ke,It)}GetTrianglesUInt32Array(tt,Ke,It){de(this.ptr,tt.ptr,Ke,It)}GetAttributeDataArrayForAllPoints(tt,Ke,It,ct,pt){ve(this.ptr,tt.ptr,Ke.ptr,It,ct,pt)}},DT_INT8:Oe(),DT_UINT8:De(),DT_INT16:je(),DT_UINT16:We(),DT_UINT32:Ne(),DT_FLOAT32:ut()}})}(fetch(HD())),nm.then(T=>{Cs=T,nm=void 0}))}()),C&&y.push(function(){if(D1)return;let T=function(I){let S,R=WebAssembly.instantiateStreaming(I,{}).then(U=>{S=U.instance,S.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},B={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:R,supported:!0,decodeGltfBuffer(U,k,G,H,K,te){(function(ie,Q,ue,se,de,ve,Te){let Ee=ie.exports.sbrk,Ie=se+3&-4,Oe=Ee(Ie*de),De=Ee(ve.length),je=new Uint8Array(ie.exports.memory.buffer);je.set(ve,De);let We=Q(Oe,se,de,De,ve.length);if(We===0&&Te&&Te(Oe,Ie,de),ue.set(je.subarray(Oe,Oe+se*de)),Ee(Oe-Ee(0)),We!==0)throw new Error(`Malformed buffer data: ${We}`)})(S,S.exports[B[K]],U,k,G,H,S.exports[F[te]])}}}(fetch(qD()));return T.ready.then(()=>{D1=T})}()),h)for(let T=0;T<h.length;T++)y.push(ek(h[T],c,T,r));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(w&&m)for(let{primitives:T}of m)for(let I of T)KF(I,c);if(C&&m&&E)for(let T of E)JF(T,c);return c})})}function Mu(l,e){let r=l.json.bufferViews[e.bufferView],c=ny[e.componentType];return new c(l.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==im[e.type]*c.BYTES_PER_ELEMENT?r.byteStride/c.BYTES_PER_ELEMENT:im[e.type]))}function S1(l,e,r,c){let p=ny[e.componentType],h=function(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=l.json.bufferViews[e.bufferView],x=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:im[e.type],E=r.float32,D=E.length/r.capacity;for(let y=0,w=0;y<e.count*x;y+=x,w+=D)for(let C=0;C<D;C++)E[w+C]=c[y+C]*h;r._trim()}function tk(l,e,r){let c=l.indices,p=l.attributes,h={};h.indexArray=new rr;let m=e.json.accessors[c],x=m.count/3;h.indexArray.reserve(x);let E=Mu(e,m);for(let C=0;C<x;C++)h.indexArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);h.indexArray._trim(),h.vertexArray=new ta;let D=e.json.accessors[p.POSITION];h.vertexArray.reserve(D.count);let y=Mu(e,D);for(let C=0;C<D.count;C++)h.vertexArray.emplaceBack(y[3*C],y[3*C+1],y[3*C+2]);if(h.vertexArray._trim(),h.aabb=new ni(D.min,D.max),h.centroid=function(C,T){let I=[0,0,0],S=C.length;if(S>0){for(let R=0;R<S;R++){let F=3*C[R];I[0]+=T[F],I[1]+=T[F+1],I[2]+=T[F+2]}I[0]/=S,I[1]/=S,I[2]/=S}return I}(E,y),p.COLOR_0!==void 0){let C=e.json.accessors[p.COLOR_0],T=im[C.type],I=Mu(e,C);h.colorArray=T===3?new ta:new _s,h.colorArray.resize(C.count),S1(e,C,h.colorArray,I)}if(p.NORMAL!==void 0){h.normalArray=new ta;let C=e.json.accessors[p.NORMAL];h.normalArray.resize(C.count);let T=Mu(e,C);S1(e,C,h.normalArray,T)}if(p.TEXCOORD_0!==void 0&&r.length>0){h.texcoordArray=new yu;let C=e.json.accessors[p.TEXCOORD_0];h.texcoordArray.resize(C.count);let T=Mu(e,C);S1(e,C,h.texcoordArray,T)}if(p._FEATURE_ID_RGBA4444!==void 0){let C=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Mu(e,C))}p._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Mu(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));let w=l.material;return h.material=function(C,T){let{emissiveFactor:I=[0,0,0],alphaMode:S="OPAQUE",alphaCutoff:R=.5,normalTexture:F,occlusionTexture:B,emissiveTexture:U,doubleSided:k}=C,{baseColorFactor:G=[1,1,1,1],metallicFactor:H=1,roughnessFactor:K=1,baseColorTexture:te,metallicRoughnessTexture:ie}=C.pbrMetallicRoughness||{},Q=B?T[B.index]:void 0;if(B&&B.extensions&&B.extensions.KHR_texture_transform&&Q){let ue=B.extensions.KHR_texture_transform;Q.offsetScale=[ue.offset[0],ue.offset[1],ue.scale[0],ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Fn(...G),metallicFactor:H,roughnessFactor:K,baseColorTexture:te?T[te.index]:void 0,metallicRoughnessTexture:ie?T[ie.index]:void 0},doubleSided:k,emissiveFactor:I,alphaMode:S,alphaCutoff:R,normalTexture:F?T[F.index]:void 0,occlusionTexture:Q,emissionTexture:U?T[U.index]:void 0,defined:C.defined===void 0}}(w!==void 0?e.json.materials[w]:{defined:!1},r),h}function QD(l,e,r){let{matrix:c,rotation:p,translation:h,scale:m,mesh:x,extras:E,children:D}=l,y={};if(y.matrix=c||be.mat4.fromRotationTranslationScale([],p||[0,0,0,1],h||[0,0,0],m||[1,1,1]),x!==void 0){y.meshes=r[x];let w=y.anchor=[0,0];for(let C of y.meshes){let{min:T,max:I}=C.aabb;w[0]+=T[0]+I[0],w[1]+=T[1]+I[1]}w[0]=Math.floor(w[0]/y.meshes.length/2),w[1]=Math.floor(w[1]/y.meshes.length/2)}if(E&&(E.id&&(y.id=E.id),E.lights&&(y.lights=function(w){if(!w.length)return[];let C=function(F){let B=atob(F),U=new Uint8Array(B.length);for(let k=0;k<B.length;k++)U[k]=B.codePointAt(k);return U}(w),T=[],I=C.length/24,S=new Uint16Array(C.buffer),R=new Float32Array(C.buffer);for(let F=0;F<I;F++){let B=S[2*F*6]/30,U=S[2*F*6+1]/30,k=S[2*F*6+10]/100,G=R[6*F+1],H=R[6*F+2],K=R[6*F+3],te=R[6*F+4],ie=K-G,Q=te-H,ue=Math.hypot(ie,Q);T.push({pos:[G+.5*ie,H+.5*Q,U],normal:[Q/ue,-ie/ue,0],width:ue,height:B,depth:k,points:[G,H,K,te]})}return T}(E.lights))),D){let w=[];for(let C of D)w.push(QD(e.json.nodes[C],e,r));y.children=w}return y}function nk(l){if(l.vertices.length===0||l.indices.length===0)return null;let e=new Nx(l.vertices,l.indices,8,256),[r,c]=[e.min.clone(),e.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:e,min:r,max:c}}function ik(l){if(!l.extras||!l.extras.ground)return null;let e=l.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;let c=[];for(let m of r){if(!Array.isArray(m)||m.length!==2)continue;let x=m[0],E=m[1];typeof x=="number"&&typeof E=="number"&&c.push(new st(x,E))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){let x=c[m],E=c[(m+1)%c.length],D=c[(m+2)%c.length];p+=(x.x-E.x)*(D.y-E.y)-(D.x-E.x)*(x.y-E.y)}p>0&&c.reverse();let h=Sp(c.flatMap(m=>[m.x,m.y]),[]);return h.length===0?null:{vertices:c,indices:h}}function rk(l,e){let r=[],c=[],p=0,h=[];for(let m of l){p=r.length;let x=m.vertexArray.float32,E=m.indexArray.uint16;for(let D=0;D<m.vertexArray.length;D++)h[0]=x[3*D+0],h[1]=x[3*D+1],h[2]=x[3*D+2],be.vec3.transformMat4(h,h,e),r.push(new st(h[0],h[1]));for(let D=0;D<3*m.indexArray.length;D++)c.push(E[D]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){let x=r[c[m+0]],E=r[c[m+1]],D=r[c[m+2]];(x.x-E.x)*(D.y-E.y)-(D.x-E.x)*(x.y-E.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:r,indices:c}}function eM(l){let e=function(E,D){let y=[],w=WebGL2RenderingContext;if(E.json.textures)for(let C of E.json.textures){let T={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};C.sampler!==void 0&&Object.assign(T,E.json.samplers[C.sampler]),y.push({image:D[C.source],sampler:T,uploaded:!1})}return y}(l,l.images),r=function(E,D){let y=[];for(let w of E.json.meshes){let C=[];for(let T of w.primitives)C.push(tk(T,E,D));y.push(C)}return y}(l,e),{scenes:c,scene:p,nodes:h}=l.json,m=c?c[p||0].nodes:h,x=[];for(let E of m)x.push(QD(h[E],l,r));return function(E,D,y){let w={},C=new Set;for(let T=0;T<E.length;T++){let I=y[D[T]];if(!I.extras)continue;let S=I.extras["mapbox:footprint:version"],R=I.extras["mapbox:footprint:id"];(S||R)&&C.add(T),S==="1.0.0"&&R&&(w[R]=T)}for(let T=0;T<E.length;T++){if(C.has(T))continue;let I=E[T],S=y[D[T]];if(!S.extras)continue;let R=null;I.id in w&&(R=rk(E[w[I.id]].meshes,I.matrix)),R||(R=ik(S)),R&&(I.footprint=nk(R))}if(C.size>0){let T=Array.from(C.values()).sort((I,S)=>I-S);for(let I=T.length-1;I>=0;I--)E.splice(T[I],1)}}(x,m,l.json.nodes),x}function ok(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);let e=l.vertexArray.float32,r=l.aabb.min[0]-1,c=l.aabb.min[1]-1,p=Cu/(l.aabb.max[0]-r+2),h=Cu/(l.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){let x=e[m+2],E=(e[m+0]-r)*p|0,D=(e[m+1]-c)*h|0;x>l.heightmap[D*Cu+E]&&(l.heightmap[D*Cu+E]=x)}}function sk(l,e){let r={};r.indexArray=new rr,r.indexArray.reserve(4*l.length),r.vertexArray=new ta,r.vertexArray.reserve(10*l.length),r.colorArray=new _s,r.vertexArray.reserve(10*l.length);let c=0;for(let m of l){let x=Math.min(10,Math.max(4,1.3*m.height))*e,E=[-m.normal[1],m.normal[0],0],D=Math.min(.29,.1*m.width/m.depth),y=m.width-2*m.depth*e*(D+.01),w=be.vec3.scaleAndAdd([],m.pos,E,y/2),C=be.vec3.scaleAndAdd([],m.pos,E,-y/2),T=[w[0],w[1],w[2]+m.height],I=[C[0],C[1],C[2]+m.height],S=be.vec3.scaleAndAdd([],m.normal,E,D);be.vec3.scale(S,S,x);let R=be.vec3.scaleAndAdd([],m.normal,E,-D);be.vec3.scale(R,R,x),be.vec3.add(S,w,S),be.vec3.add(R,C,R),w[2]+=.1,C[2]+=.1,r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]);let F=y/x/2;r.colorArray.emplaceBack(-F-D,-1,F,.8),r.colorArray.emplaceBack(F+D,-1,F,.8),r.colorArray.emplaceBack(-F,0,F,1.3),r.colorArray.emplaceBack(F,0,F,1.3),r.colorArray.emplaceBack(F+D,-.8,F,.7),r.colorArray.emplaceBack(F+D,-.8,F,.7),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(F+D,-1.2,F,.8),r.colorArray.emplaceBack(F+D,-1.2,F,.8),r.indexArray.emplaceBack(6+c,4+c,8+c),r.indexArray.emplaceBack(7+c,9+c,5+c),r.indexArray.emplaceBack(0+c,1+c,2+c),r.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}let p={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Fn.white,p.pbrMetallicRoughness=h,r.material=p,r.aabb=new ni([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class tM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let c=e[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let ak=["id","tile","layer","source","sourceLayer","state"];class nM{constructor(e,r,c,p,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=c,this._y=p,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let r of ak)this[r]!==void 0&&(e[r]=this[r]);return e}}class iM{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ka(at,16,0),this.featureIndexArray=new u_,this.promoteId=r,this.is3DTile=!1}insert(e,r,c,p,h,m=0,x=0){let E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,h,m);let D=this.grid;for(let y=0;y<r.length;y++){let w=r[y],C=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){let I=w[T];C[0]=Math.min(C[0],I.x),C[1]=Math.min(C[1],I.y),C[2]=Math.max(C[2],I.x),C[3]=Math.max(C[3],I.y)}x!==0&&(C[0]-=x,C[1]-=x,C[2]+=x,C[3]+=x),C[0]<at&&C[1]<at&&C[2]>=0&&C[3]>=0&&D.insert(E,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sd.VectorTile(new R_(this.rawTileData)).layers,this.sourceLayerCoder=new tM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,c,p){this.loadVTLayers();let h=e.params||{},m=Po(h.filter),x=e.tileResult,E=e.transform,D=x.bufferedTilespaceBounds,y=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(I,S,R,F)=>ho(x.bufferedTilespaceGeometry,I,S,R,F));y.sort(lk);let w=null;E.elevation&&y.length>0&&(w=fd.create(E.elevation,this.tileID));let C={},T;for(let I=0;I<y.length;I++){let S=y[I];if(S===T)continue;T=S;let R=this.featureIndexArray.get(S),F=null;if(this.is3DTile){let B=this.bucketLayerIDs[0][0],U=r[B];if(U.type!=="model")continue;let{queryFeature:k,intersectionZ:G}=U.queryIntersectsMatchingFeature(x,R.featureIndex,m,E);k&&this.appendToResult(C,B,R.featureIndex,k,G)}else this.loadMatchingFeature(C,R,m,h.layers,h.availableImages,r,c,p,(B,U,k,G=0)=>(F||(F=et(B,this.tileID.canonical,e.tileTransform)),U.queryIntersectsFeature(x,B,k,F,this.z,e.transform,e.pixelPosMatrix,w,G)))}return C}loadMatchingFeature(e,r,c,p,h,m,x,E,D){let{featureIndex:y,bucketIndex:w,sourceLayerIndex:C,layoutVertexArrayOffset:T}=r,I=this.bucketLayerIDs[w];if(p&&!function(B,U){for(let k=0;k<B.length;k++)if(U.indexOf(B[k])>=0)return!0;return!1}(p,I))return;let S=this.sourceLayerCoder.decode(C),R=this.vtLayers[S].feature(y);if(c.needGeometry){let B=nt(R,!0);if(!c.filter(new vi(this.tileID.overscaledZ),B,this.tileID.canonical))return}else if(!c.filter(new vi(this.tileID.overscaledZ),R))return;let F=this.getId(R,S);for(let B=0;B<I.length;B++){let U=I[B];if(p&&p.indexOf(U)<0)continue;let k=m[U];if(!k)continue;let G={};F!==void 0&&E&&(G=E.getState(k.sourceLayer||"_geojsonTileLayer",F));let H=!D||D(R,k,G,T);if(!H)continue;let K=new nM(R,this.z,this.x,this.y,F),te=mr({},x[U]);te.paint=rM(te.paint,k.paint,R,G,h),te.layout=rM(te.layout,k.layout,R,G,h),K.layer=te,this.appendToResult(e,U,y,K,H)}}appendToResult(e,r,c,p,h){let m=e[r];m===void 0&&(m=e[r]=[]),m.push({featureIndex:c,feature:p,intersectionZ:h})}lookupSymbolFeatures(e,r,c,p,h,m,x,E){let D={};this.loadVTLayers();let y=Po(h);for(let w of e)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:p,featureIndex:w,layoutVertexArrayOffset:0},y,m,x,E,r);return D}loadFeature(e){let{featureIndex:r,sourceLayerIndex:c}=e;this.loadVTLayers();let p=this.sourceLayerCoder.decode(c),h=this.vtFeatures[p];if(h[r])return h[r];let m=this.vtLayers[p].feature(r);return h[r]=m,m}hasLayer(e){for(let r of this.bucketLayerIDs)for(let c of r)if(e===c)return!0;return!1}getId(e,r){let c=e.id;if(this.promoteId){let p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];p!=null&&(c=e.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function rM(l,e,r,c,p){return Da(l,(h,m)=>{let x=e instanceof $l?e.get(m):null;return x&&x.evaluate?x.evaluate(r,c,p):x})}function lk(l,e){return e-l}mt(iM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let oM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class A1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,c]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let h=oM[15&c];if(!h)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new A1(x,m,h,e)}constructor(e,r=64,c=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let h=oM.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=r,c}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return P1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:m,nodeSize:x}=this,E=[0,h.length-1,0],D=[];for(;E.length;){let y=E.pop()||0,w=E.pop()||0,C=E.pop()||0;if(w-C<=x){for(let R=C;R<=w;R++){let F=m[2*R],B=m[2*R+1];F>=e&&F<=c&&B>=r&&B<=p&&D.push(h[R])}continue}let T=C+w>>1,I=m[2*T],S=m[2*T+1];I>=e&&I<=c&&S>=r&&S<=p&&D.push(h[T]),(y===0?e<=I:r<=S)&&(E.push(C),E.push(T-1),E.push(1-y)),(y===0?c>=I:p>=S)&&(E.push(T+1),E.push(w),E.push(1-y))}return D}within(e,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:h,nodeSize:m}=this,x=[0,p.length-1,0],E=[],D=c*c;for(;x.length;){let y=x.pop()||0,w=x.pop()||0,C=x.pop()||0;if(w-C<=m){for(let R=C;R<=w;R++)aM(h[2*R],h[2*R+1],e,r)<=D&&E.push(p[R]);continue}let T=C+w>>1,I=h[2*T],S=h[2*T+1];aM(I,S,e,r)<=D&&E.push(p[T]),(y===0?e-c<=I:r-c<=S)&&(x.push(C),x.push(T-1),x.push(1-y)),(y===0?e+c>=I:r+c>=S)&&(x.push(T+1),x.push(w),x.push(1-y))}return E}}function P1(l,e,r,c,p,h){if(p-c<=r)return;let m=c+p>>1;sM(l,e,m,c,p,h),P1(l,e,r,c,m-1,1-h),P1(l,e,r,m+1,p,1-h)}function sM(l,e,r,c,p,h){for(;p>c;){if(p-c>600){let D=p-c+1,y=r-c+1,w=Math.log(D),C=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*C*(D-C)/D)*(y-D/2<0?-1:1);sM(l,e,r,Math.max(c,Math.floor(r-y*C/D+T)),Math.min(p,Math.floor(r+(D-y)*C/D+T)),h)}let m=e[2*r+h],x=c,E=p;for(rm(l,e,c,r),e[2*p+h]>m&&rm(l,e,c,p);x<E;){for(rm(l,e,x,E),x++,E--;e[2*x+h]<m;)x++;for(;e[2*E+h]>m;)E--}e[2*c+h]===m?rm(l,e,c,E):(E++,rm(l,e,E,p)),E<=r&&(c=E+1),r<=E&&(p=E-1)}}function rm(l,e,r,c){R1(l,r,c),R1(e,2*r,2*c),R1(e,2*r+1,2*c+1)}function R1(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}function aM(l,e,r,c){let p=l-r,h=e-c;return p*p+h*h}i.$=e_,i.A=class extends K_{},i.B=Ra,i.C=bl,i.D=fu,i.E=xl,i.F=ep,i.G=Rh,i.H=Hg,i.I=e1,i.J=Fh,i.K=Gh,i.L=Yg,i.M=cu,i.N=Eh,i.O=nu,i.P=st,i.Q=tu,i.R=_l,i.S=Br,i.T=d1,i.U=Cf,i.V=K_,i.W=up,i.X=Oh,i.Y=Qf,i.Z=function(l){let e=l.value,r=[];if(!e)return r;let c=Ra(e);return c!=="string"?(r=r.concat([new K_(l.key,e,`string expected, "${c}" found`)]),r):(_D(e,!0)||(r=r.concat([new K_(l.key,e,`invalid url "${e}"`)])),r)},i._=Re,i.a=function(l){return _e.API_CDN_URL_REGEX.test(l)},i.a$=vp,i.a0=ui,i.a1=it,i.a2=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return Wr(l.expression.evaluate(e))}interpolate(l,e,r){return{x:Pt(l.x,e.x,r),y:Pt(l.y,e.y,r),z:Pt(l.z,e.z,r),azimuthal:Pt(l.azimuthal,e.azimuthal,r),polar:Pt(l.polar,e.polar,r)}}},i.a3=vi,i.a4=qo,i.a5=Me,i.a6=be,i.a7=dl,i.a8=$l,i.a9=ec,i.aA=ti,i.aB=rD,i.aC=uD,i.aD=iD,i.aE=function(l,e){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let c=0;c<l.length;c++){let p=document.createElement("source");uo(l[c])||(r.crossOrigin="Anonymous"),p.src=l[c],r.appendChild(p)}return{cancel:()=>{}}},i.aF=q_,i.aG=function(l){return fetch(l).then(e=>e.arrayBuffer()).then(e=>JD(e,0,l))},i.aH=eM,i.aI=class{constructor(l,e,r,c){this.id=l,this.position=e!=null?new j(e[0],e[1]):new j(0,0),this.orientation=r??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new ni([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,e){if(be.mat4.multiply(l.matrix,e,l.matrix),l.meshes)for(let r of l.meshes){let c=ni.applyTransformFast(r.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(let r of l.children)this._applyTransformations(r,l.matrix)}computeBoundsAndApplyParent(){let l=be.mat4.identity([]);for(let e of this.nodes)this._applyTransformations(e,l)}computeModelMatrix(l,e,r,c,p,h,m=!1){wD(this.matrix,this,l.transform,this.position,e,r,c,p,h,m)}upload(l){if(!this.uploaded){for(let e of this.nodes)_1(e,l);for(let e of this.nodes)J_(e);this.uploaded=!0}}destroy(){for(let l of this.nodes)y1(l)}},i.aJ=fl,i.aK=$p,i.aL=le,i.aM=ae,i.aN=ea,i.aO=rr,i.aP=Vc,i.aQ=ed,i.aR=G_,i.aS=function(){Vr.isLoading()||Vr.isLoaded()||ap()!=="deferred"||lp()},i.aT=Po,i.aU=nt,i.aV=nM,i.aW=$c,i.aX=qx,i.aY=kx,i.aZ=et,i.a_=Qs,i.aa=Pt,i.ab=at,i.ac=Xc,i.ad=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return function([r,c]){let p=Wr([1,r,c]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(e))}interpolate(l,e,r){return{x:Pt(l.x,e.x,r),y:Pt(l.y,e.y,r),z:Pt(l.z,e.z,r)}}},i.ae=function(l,e,r=0,c=!0){let p=new st(r,r),h=l.sub(p),m=e.add(p),x=[h,new st(m.x,h.y),m,new st(h.x,m.y)];return c&&x.push(h.clone()),x},i.af=function(l,e){let r=[];for(let c=0;c<l.length;c++){let p=hs(c-1,-1,l.length-1),h=hs(c+1,-1,l.length-1),m=l[c],x=l[h],E=l[p].sub(m).unit(),D=x.sub(m).unit(),y=D.angleWithSep(E.x,E.y),w=E.add(D).unit().mult(-1*e/Math.sin(y/2));r.push(m.add(w))}return r},i.ag=$C,i.ah=ho,i.ai=function(l,e,r=0){return be.vec3.fromValues(((e.x-r)*l.scale-l.x)*at,(e.y*l.scale-l.y)*at,fe(e.z,e.y))},i.aj=bs,i.ak=cC,i.al=function(l){let e=1/0,r=1/0,c=-1/0,p=-1/0;for(let h of l)e=Math.min(e,h.x),r=Math.min(r,h.y),c=Math.max(c,h.x),p=Math.max(p,h.y);return{min:new st(e,r),max:new st(c,p)}},i.am=ne,i.an=oi,i.ao=qe,i.ap=Qt,i.aq=t,i.ar=function(l,e){let r={};for(let c=0;c<e.length;c++){let p=e[c];p in l&&(r[p]=l[p])}return r},i.as=q,i.at=oe,i.au=class{constructor(l){this.entries={},this.scheduler=l}request(l,e,r,c){let p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){let[h,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(h,m)},e):c(h,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=r((h,m)=>{p.result=[h,m];for(let x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(h,m)},e):x(h,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(h=>h!==c),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},i.av=r_,i.aw=function(l,e,r){let c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{let h=yl(l.request,(m,x,E,D)=>{m?p(m):x&&p(null,{vectorTile:r?void 0:new sd.VectorTile(new R_(x)),rawData:x,cacheControl:E,expires:D})});return()=>{h.cancel(),p()}},e)},i.ax=function(l){Ui++,Ui>Ln&&(l.getActor().send("enforceCacheSizeLimit",Gt),Ui=0)},i.ay=ht,i.az=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},i.b=function(l){return _e.API_FONTS_REGEX.test(l)},i.b$=function(l){let{x:e,y:r}=l.point,{lng:c,lat:p}=l._center;return tI(e,r,l.worldSize,c,p)},i.b0=po,i.b1=xi,i.b2=Sp,i.b3=c1,i.b4=function(l,e){let r=ec(e.zoom);if(r===0)return oa(l);let c=y_(l),p=Dx(c),h=ne(c.getWest())*e.worldSize,m=ne(c.getEast())*e.worldSize,x=oe(c.getNorth())*e.worldSize,E=oe(c.getSouth())*e.worldSize,D=[h,x,0],y=[m,x,0],w=[h,E,0],C=[m,E,0],T=be.mat4.invert([],e.globeMatrix);return be.vec3.transformMat4(D,D,T),be.vec3.transformMat4(y,y,T),be.vec3.transformMat4(w,w,T),be.vec3.transformMat4(C,C,T),p[0]=Ga(p[0],w,r),p[1]=Ga(p[1],C,r),p[2]=Ga(p[2],y,r),p[3]=Ga(p[3],D,r),ni.fromPoints(p)},i.b5=x_,i.b6=Dp,i.b7=Ga,i.b8=Zh,i.b9=jr,i.bA=hs,i.bB=_n,i.bC=Sa,i.bD=ee,i.bE=function(l,e,r){l[4*e+0]=r[0],l[4*e+1]=r[1],l[4*e+2]=r[2],l[4*e+3]=r[3]},i.bF=wu,i.bG=Wo,i.bH=Tp,i.bI=vr,i.bJ=ja,i.bK=j,i.bL=ZC,i.bM=Gi,i.bN=Ql,i.bO=dD,i.bP=Zi,i.bQ=JE,i.bR=function(l,e,r,c,p,h,m,x,E){if(E.name==="globe")return JE(l,e,new Zi(r,c,p),!1);let D=$p({z:r,x:c,y:p},E);return new ni([(h+D.x/D.scale)*e,e*(D.y/D.scale),m],[(h+D.x2/D.scale)*e,e*(D.y2/D.scale),x])},i.bS=function(l,e,r){let c=0;for(let p=0;p<2;++p)l[p]>0&&(c+=(l[p]-0)*(l[p]-0)),e[p]<0&&(c+=(0-e[p])*(0-e[p]));return c},i.bT=he,i.bU=f,i.bV=function(l){let e=be.mat4.identity(new Float64Array(16));be.mat4.multiply(e,l.pixelMatrix,l.globeMatrix);let r=[0,M,0],c=[0,A,0];return be.vec3.transformMat4(r,r,e),be.vec3.transformMat4(c,c,e),[r[0]>0&&r[0]<=l.width&&r[1]>0&&r[1]<=l.height&&!Ax(l,new j(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!Ax(l,new j(l.center.lat,-90))]},i.bW=function(l,e){let{scale:r}=l.tileTransform,c=r*at/(l.tileSize*Math.pow(2,e.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return be.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},i.bX=X_,i.bY=hD,i.bZ=function(l){let e=hD(l,!0);return be.mat2.invert([],[e[0],e[1],e[4],e[5]])},i.b_=ra,i.ba=E1,i.bb=R_,i.bc=yl,i.bd=function(l){let e=[];for(let r in l)e.push(l[r]);return e},i.be=function(l,e){let r=[];for(let c in l)c in e||r.push(c);return r},i.bf=Ca,i.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bh=Ea,i.bi=function(l,e){let{x:r,y:c}=l.point,p=tI(r,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return be.mat4.multiply(p,p,Mx(oa(e)))},i.bj=ad,i.bk=Oo,i.bl=P_,i.bm=function(l,e,r,c,p){let h=5*e+2;l.float32[h+0]=r,l.float32[h+1]=c,l.float32[h+2]=p},i.bn=$_,i.bo=RC,i.bp=rt,i.bq=ur,i.br=LI,i.bs=gD,i.bt=BI,i.bu=VI,i.bv=i1,i.bw=BC,i.bx=Qx,i.by=A1,i.bz=Fn,i.c=Ce,i.c$=Pr,i.c0=Ki,i.c1=Ar,i.c2=a,i.c3=function(l){let e=Math.round((l+45+360)%360/90)%4;return To[e]},i.c4=45,i.c5=X,i.c6=id,i.c7=function(l,e,r){let c=Math.sqrt(l*l+e*e+r*r),p=c>0?Math.acos(r/c)*us:0,h=l!==0||e!==0?Math.atan2(-e,-l)*us+90:0;return h<0&&(h+=360),[c,h,p]},i.c8=ge,i.c9=ni,i.cA=function(l){let e=he-5;l=Qt(l,-e,e)/e*90;let r=Math.pow(Math.abs(Math.sin(_n(l))),3);return Math.round(r*(b.length-1))},i.cB=function(l,e,r,c){let p=e.getNorth(),h=e.getSouth(),m=e.getWest(),x=e.getEast(),E=1<<l.z,D=x-m,y=p-h,w=D/v,C=-y/b[r],T=[0,w,0,C,0,0,p,m,0];if(l.z>0){let I=180/c;be.mat3.multiply(T,T,[I/D+1,0,0,0,I/y+1,0,-.5*I/w,.5*I/C,1])}return T[2]=E,T[5]=l.x,T[8]=l.y,T},i.cC=oa,i.cD=function(l,e,r){let c=be.mat4.identity(new Float64Array(16)),p=(e/(1<<l)-.5)*Math.PI*2;return be.mat4.rotateY(c,r.globeMatrix,p),Float32Array.from(c)},i.cE=class{isDataAvailableAtPoint(l){let e=this._source();if(this.isUsingMockSource()||!e||l.y<0||l.y>1)return!1;let r=e.getSource().maxzoom,c=1<<r,p=Math.floor(l.x),h=Math.floor((l.x-p)*c),m=Math.floor(l.y*c),x=this.findDEMTileFor(new ti(r,p,r,h,m));return!(!x||!x.dem)}getAtPointOrZero(l,e=0){return this.getAtPoint(l,e)||0}getAtPoint(l,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let c=this._source();if(!c||l.y<0||l.y>1)return e;let p=c.getSource().maxzoom,h=1<<p,m=Math.floor(l.x),x=l.x-m,E=new ti(p,m,p,Math.floor(x*h),Math.floor(l.y*h)),D=this.findDEMTileFor(E);if(!D||!D.dem)return e;let y=D.dem,w=1<<D.tileID.canonical.z,C=(x*w-D.tileID.canonical.x)*y.dim,T=(l.y*w-D.tileID.canonical.y)*y.dim,I=Math.floor(C),S=Math.floor(T);return(r?this.exaggeration():1)*Pt(Pt(y.get(I,S),y.get(I,S+1),T-S),Pt(y.get(I+1,S),y.get(I+1,S+1),T-S),C-I)}getAtTileOffset(l,e,r){let c=1<<l.canonical.z;return this.getAtPointOrZero(new Me(l.wrap+(l.canonical.x+e/at)/c,(l.canonical.y+r/at)/c))}getAtTileOffsetFunc(l,e,r,c){return p=>{let h=this.getAtTileOffset(l,p.x,p.y),m=c.upVector(l.canonical,p.x,p.y),x=c.upVectorScale(l.canonical,e,r).metersToTile;return be.vec3.scale(m,m,h*x),m}}getForTilePoints(l,e,r,c){if(this.isUsingMockSource())return!1;let p=fd.create(this,l,c);return!!p&&(e.forEach(h=>{h[2]=this.exaggeration()*p.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(l);if(!e||!e.dem)return null;let r=e.dem.tree,c=e.tileID,p=1<<l.canonical.z-c.canonical.z,h=l.canonical.x/p-c.canonical.x,m=l.canonical.y/p-c.canonical.y,x=0;for(let E=0;E<l.canonical.z-c.canonical.z&&!r.leaves[x];E++){h*=2,m*=2;let D=2*Math.floor(m)+Math.floor(h);x=r.childOffsets[x]+D,h%=1,m%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let l=this.visibleDemTiles;if(l.length===0)return null;let e=!1,r=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let p of l){let h=this.getMinMaxForTile(p.tileID);h&&(r=Math.min(r,h.min),c=Math.max(c,h.max),e=!0)}return e?{min:r,max:c}:null}},i.cF=pI,i.cG=$a,i.cH=function(l,e){return[Math.pow(l[0],2.2)*e,Math.pow(l[1],2.2)*e,Math.pow(l[2],2.2)*e]},i.cI=eI,i.cJ=ce,i.cK=J,i.cL=256,i.cM=function(l,e){let r=[0,0,0],c=x_(oa(e.canonical));return be.vec3.transformMat4(r,r,c),be.vec3.transformMat4(r,r,l),r},i.cN=l=>({u_camera_to_center_distance:new vr(l),u_extrude_scale:new Ip(l),u_device_pixel_ratio:new vr(l),u_matrix:new wu(l),u_inv_rot_matrix:new wu(l),u_merc_center:new Wo(l),u_tile_id:new Tp(l),u_zoom_transition:new vr(l),u_up_dir:new Tp(l),u_emissive_strength:new vr(l)}),i.cO=l=>({u_matrix:new wu(l),u_pixels_to_tile_units:new Ip(l),u_device_pixel_ratio:new vr(l),u_units_to_pixels:new Wo(l),u_dash_image:new ja(l),u_gradient_image:new ja(l),u_image_height:new vr(l),u_texsize:new Wo(l),u_tile_units_to_pixels:new vr(l),u_alpha_discard_threshold:new vr(l),u_trim_offset:new Wo(l),u_trim_fade_range:new Wo(l),u_trim_color:new id(l),u_emissive_strength:new vr(l)}),i.cP=l=>({u_matrix:new wu(l),u_texsize:new Wo(l),u_pixels_to_tile_units:new Ip(l),u_device_pixel_ratio:new vr(l),u_image:new ja(l),u_units_to_pixels:new Wo(l),u_tile_units_to_pixels:new vr(l),u_alpha_discard_threshold:new vr(l),u_trim_offset:new Wo(l)}),i.cQ=Sr,i.cR=AL,i.cS=PL,i.cT=rI,i.cU=(l,e,r,c,p,h)=>{let m=l.transform,x=m.projection.name==="globe",E;if(h.paint.get("circle-pitch-alignment")==="map")if(x){let y=eI(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;E=Float32Array.from([y,0,0,y])}else E=m.calculatePixelsToTileUnitsMatrix(r);else E=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);let D={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(e.projMatrix,r,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:dt.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:LO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(x){D.u_inv_rot_matrix=c,D.u_merc_center=p,D.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],D.u_zoom_transition=ec(m.zoom);let y=p[0]*at,w=p[1]*at;D.u_up_dir=m.projection.upVector(new Zi(0,0,0),y,w)}return D},i.cV=dC,i.cW=(l,e,r,c,p,h)=>{let m=l.transform;return{u_matrix:hC(l,e,r,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:uC(e,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},i.cX=(l,e,r,c,p,h,m)=>{let x=l.transform,E=x.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:hC(l,e,r,c),u_pixels_to_tile_units:E,u_device_pixel_ratio:h,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:fC(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uC(e,l.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength")}},i.cY=jc,i.cZ=Mp,i.c_=QI,i.ca=Wr,i.cb=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.cc=function(l){return l({pluginStatus:Ji,pluginURL:Js}),sp.on("pluginStateChange",l),l},i.cd=x1,i.ce=ty,i.cf=cd,i.cg=t1,i.ch=bf,i.ci=Qg,i.cj=$t,i.ck=Nr,i.cl=co,i.cm=function(l){let e=l.indexOf(Hl);return e>=0?l.slice(0,e):l},i.cn=function(l){return l.indexOf(Hl)>=0},i.co=function(l){let e=l.indexOf(Hl);return e>=0?l.slice(e+1):""},i.cp=function(l){let e=[],r=l.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),l.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cq=function(l,e,r,c){return l.type==="custom"?new lF(l,e):new vF[l.type](l,e,r,c)},i.cr=pl,i.cs=sp,i.ct=qc,i.cu=Ep,i.cv=class extends xs{constructor(l){super(l),this.current=xx}set(l,e,r){if(this.fetchUniformLocation(l,e)){for(let c=0;c<9;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.cw=Ia,i.cx=function(l,e,r){let c=ec(r.zoom),p=l.style.map._antialias,h=e.options.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return c===0&&!p&&!h},i.cy=function(l){let e=l.pixelsPerMeter,r=e/ee(1,l.center.lat),c=be.mat4.identity(new Float64Array(16));return be.mat4.translate(c,c,[l.point.x,l.point.y,0]),be.mat4.scale(c,c,[r,r,e]),Float32Array.from(c)},i.cz=y_,i.d=function(l){return _e.API_TILEJSON_REGEX.test(l)},i.d$=P,i.d0=A_,i.d1=nc,i.d2=450,i.d3=7,i.d4=aF,i.d5=Dn,i.d6=Jh,i.d7=256,i.d8=Mx,i.d9=ta,i.dA=nI,i.dB=function(l){let e=[0,0,0],r=be.mat4.identity(new Float64Array(16));return be.mat4.multiply(r,l.pixelMatrix,l.globeMatrix),be.vec3.transformMat4(e,e,r),new st(e[0],e[1])},i.dC=function(l,e,r=!1){if(Ji===hu||Ji===du||Ji===Uh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Js=dt.resolveURL(l),Ji=hu,jl=e,op(),r||lp()},i.dD=ap,i.dE=function(){ty().acquire(I1)},i.dF=function(){let l=tm;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(I1),tm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dG=em,i.dH=function(l){let e=pi();if(!e)return;let r=e.delete(Ht);l&&r.catch(l).then(()=>l())},i.dI=Qp,i.dJ=HD,i.dK=function(l){C1=dt.resolveURL(l),gd||(gd=new x1(ty(),new xl)),gd.broadcast("setDracoUrl",C1)},i.dL=qD,i.dM=function(l){md=dt.resolveURL(l),gd||(gd=new x1(ty(),new xl)),gd.broadcast("setMeshoptUrl",md)},i.dN=mt,i.dO=tc,i.dP=Ts,i.dQ=tM,i.dR=iM,i.dS=oC,i.dT=Da,i.dU=LC,i.dV=function(l,e,r,c,p,h,m,x,E,D,y){l.createArrays(),l.tilePixelRatio=at/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;let w=l.layers[0].layout,C=l.layers[0]._unevaluatedLayout._values,T={};if(l.textSizeData.kind==="composite"){let{minZoom:F,maxZoom:B}=l.textSizeData;T.compositeTextSizes=[C["text-size"].possiblyEvaluate(new vi(F),x),C["text-size"].possiblyEvaluate(new vi(B),x)]}if(l.iconSizeData.kind==="composite"){let{minZoom:F,maxZoom:B}=l.iconSizeData;T.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new vi(F),x),C["icon-size"].possiblyEvaluate(new vi(B),x)]}T.layoutTextSize=C["text-size"].possiblyEvaluate(new vi(E+1),x),T.layoutIconSize=C["icon-size"].possiblyEvaluate(new vi(E+1),x),T.textMaxSize=C["text-size"].possiblyEvaluate(new vi(18),x);let I=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point",S=w.get("text-size"),R=!1;for(let F of l.features)if(F.icon&&F.icon.nameSecondary){R=!0;break}for(let F of l.features){let B=w.get("text-font").evaluate(F,{},x).join(","),U=S.evaluate(F,{},x),k=T.layoutTextSize.evaluate(F,{},x),G=(T.layoutIconSize.evaluate(F,{},x),{horizontal:{},vertical:void 0}),H=F.text,K,te=[0,0];if(H){let ue=H.toString(),se=w.get("text-letter-spacing").evaluate(F,{},x)*ur,de=w.get("text-line-height").evaluate(F,{},x)*ur,ve=lx(ue)?se:0,Te=w.get("text-anchor").evaluate(F,{},x),Ee=w.get("text-variable-anchor");if(!Ee){let We=w.get("text-radial-offset").evaluate(F,{},x);te=We?BC(Te,[We*ur,n1]):w.get("text-offset").evaluate(F,{},x).map(Ne=>Ne*ur)}let Ie=I?"center":w.get("text-justify").evaluate(F,{},x),Oe=w.get("symbol-placement")==="point",De=Oe?w.get("text-max-width").evaluate(F,{},x)*ur:1/0,je=We=>{l.allowVerticalPlacement&&Bh(ue)&&(G.vertical=Jx(H,e,r,p,B,De,de,Te,We,ve,te,Oo.vertical,!0,k,U))};if(!I&&Ee){let We=Ie==="auto"?Ee.map(ut=>i1(ut)):[Ie],Ne=!1;for(let ut=0;ut<We.length;ut++){let ot=We[ut];if(!G.horizontal[ot])if(Ne)G.horizontal[ot]=G.horizontal[0];else{let tt=Jx(H,e,r,p,B,De,de,"center",ot,ve,te,Oo.horizontal,!1,k,U);tt&&(G.horizontal[ot]=tt,Ne=tt.positionedLines.length===1)}}je("left")}else{if(Ie==="auto"&&(Ie=i1(Te)),Oe||w.get("text-writing-mode").indexOf("horizontal")>=0||!Bh(ue)){let We=Jx(H,e,r,p,B,De,de,Te,Ie,ve,te,Oo.horizontal,!1,k,U);We&&(G.horizontal[Ie]=We)}je(Oe?"left":Ie)}}let ie=!1;if(F.icon&&F.icon.namePrimary){let ue=c[F.icon.namePrimary];ue&&(K=jL(p[F.icon.namePrimary],F.icon.nameSecondary?p[F.icon.nameSecondary]:void 0,w.get("icon-offset").evaluate(F,{},x),w.get("icon-anchor").evaluate(F,{},x)),ie=ue.sdf,l.sdfIcons===void 0?l.sdfIcons=ue.sdf:l.sdfIcons!==ue.sdf&&In("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==l.pixelRatio||w.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}let Q=jC(G.horizontal)||G.vertical;l.iconsInText||(l.iconsInText=!!Q&&Q.iconsInText),(Q||K)&&ZL(l,F,G,K,c,T,k,0,te,ie,m,x,D,y,R)}h&&l.generateCollisionDebugBuffers(E,l.collisionBoxArray)},i.dW=sd,i.dX=ey,i.dY=Bc,i.dZ=AI,i.d_=vC,i.da=vs,i.db=yp,i.dc=function(l,e,r,c,p){return Qt((l-e)/(r-e)*(p-c)+c,c,p)},i.dd=Ph,i.de=we,i.df=class{constructor(l,e,r,c){this.context=l,this.format=c,this.size=r,this.texture=l.gl.createTexture();let[p,h,m]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,p,h,m,0,u1(this.format),h1(this.format),e.data)}bind(l,e){let{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.dg=m1,i.dh=[1,1,1],i.di=fd,i.dj=dd,i.dk=na,i.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,e=!1){let r=kI(new st(0,0),new st(at,at),l),c=[];if(e&&!jx(r,this._globalClipBounds))return c;for(let p of this._activeRegions){if(p.hiddenByOverlap||!jx(r,p))continue;let h=iL(p.min,p.max,l);c.push({min:h.min,max:h.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(l){this._setSources(l.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let r=[];for(let c of e.cache.getVisibleCoordinates()){let p=e.cache.getTile(c).buckets[e.layer];p&&p.updateFootprints(c.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(l){let e=l.getFootprints();if(e.length===0)return;let r=l.getOrder(),c=l.getClipMask(),p=l.getClipScope();for(let h of e){if(!h.footprint)continue;let m=kI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:r,clipMask:c,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||M_(e.min,r.min)||M_(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(c,p){let h=(m,x)=>m+x;return c.length-p.length||c.reduce(h,"").localeCompare(p.reduce(h,""))}(e.clipScope,r.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let e=0;for(;!l&&e!==this._activeRegions.length;){let r=this._activeRegions[e],c=this._prevRegions[e];l=r.priority!==c.priority||!FI(r,c)||r.order!==c.order||r.clipMask!==c.clipMask||!Ea(r.clipScope,c.clipScope),++e}}if(l){++this._updateTime;for(let r of this._activeRegions)r.order!==D_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));let e=r=>{let c=this._activeRegions;if(r>=c.length)return r;let p=c[r].priority;for(;r<c.length&&c[r].priority===p;)++r;return r};if(this._sourceIds.length>1){let r=0,c=e(r);for(;r!==c;){let p=r,h=r;for(;p!==c;){let m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let x=0;x<h;x++){let E=this._activeRegions[x];if(!E.hiddenByOverlap&&m.order===D_&&jx(m,E)&&(m.hiddenByOverlap=zI(m.footprint,m.tileId,E.footprint,E.tileId),m.hiddenByOverlap))break}++p}r=c,c=e(r)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=l.length-1;e>=0;e--)this._addSource(l[e]);this._computeReplacement()}},i.dm=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let l of this._poleSegments)l.destroy();for(let l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,e){let r=new Qs,c=new rr,p=[],h=l+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),E=(D,y,w)=>{let C=D===h-1?D-2:D===0?D:D-1;return C+=w?24575:0,[C,y]};for(let D=0;D<h;++D)r.emplaceBack(...E(D,0,!0));for(let D=0;D<m;++D)for(let y=0;y<h;++y)r.emplaceBack(...E(y,D,(y===0||y===h-1)&&!0));for(let D=0;D<e.length;++D){let y=e[D];for(let w=0;w<h;++w)r.emplaceBack(...E(w,y,!0))}for(let D=0;D<e.length;++D){let y=c.length,w=e[D]+1+2,C=new rr;for(let S=0;S<w-1;S++){let R=S===w-2,F=R?h*(x-e.length+D-S):h;for(let B=0;B<h-1;B++){let U=S*h+B;S===0||R||B===0||B===h-2?(C.emplaceBack(U+1,U,U+F),C.emplaceBack(U+F,U+F+1,U+1)):(c.emplaceBack(U+1,U,U+F),c.emplaceBack(U+F,U+F+1,U+1))}}let T=xi.simpleSegment(0,y,r.length,c.length-y);for(let S=0;S<C.uint16.length;S+=3)c.emplaceBack(C.uint16[S],C.uint16[S+1],C.uint16[S+2]);let I=xi.simpleSegment(0,y,r.length,c.length-y);p.push({withoutSkirts:T,withSkirts:I})}return{vertices:r,indices:c,segments:p}}_createGrid(l){let e=this._fillGridMeshWithLods(v,b);this._gridSegments=e.segments,this._gridBuffer=l.createVertexBuffer(e.vertices,po.members),this._gridIndexBuffer=l.createIndexBuffer(e.indices,!0)}_createPoles(l){let e=new rr;for(let m=0;m<=v;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(e,!0);let r=new vs,c=new vs,p=new vs,h=new vs;this._poleSegments=[];for(let m=0,x=0;m<a;m++){let E=360/(1<<m);r.emplaceBack(0,-t,0,.5,0),c.emplaceBack(0,-t,0,.5,1),p.emplaceBack(0,-t,0,.5,.5),h.emplaceBack(0,-t,0,.5,.5);for(let D=0;D<=v;D++){let y=D/v,w=0,C=Pt(0,E,y),[T,I,S]=O(RO,OO,C,t);r.emplaceBack(T,I,S,y,w),c.emplaceBack(T,I,S,y,1-w);let R=_n(C);y=.5+.5*Math.sin(R),w=.5+.5*Math.cos(R),p.emplaceBack(T,I,S,y,w),h.emplaceBack(T,I,S,y,1-w)}this._poleSegments.push(xi.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(r,eo,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,eo,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,eo,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(h,eo,!1)}getGridBuffers(l,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.dn=D_,i.dp=Gs,i.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dr=hl,i.ds=ye,i.dt=L,i.du=function([l,e,r]){let c=Math.hypot(l,e,r),p=Math.atan2(l,r),h=.5*Math.PI-Math.acos(-e/c);return new j(Ki(p),Ki(h))},i.dv=p1,i.dw=N,i.dx=function(l){let e=l.navigator?l.navigator.userAgent:null;return!!function(r){if(Gc==null){let c=r.navigator?r.navigator.userAgent:null;Gc=!!r.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Gc}(l)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dy=function(l,e){Gt=l,Ln=e},i.dz=Ax,i.e=_e,i.e0=function(l){let e=0;if(new Uint32Array(l,0,1)[0]!==ZD){let r=new Uint32Array(l,0,7),[,,c,p,h,m]=r;e=r.byteLength+p+h+m+h,(c!==l.byteLength||e>=l.byteLength)&&In("Invalid b3dm header information.")}return JD(l,e)},i.e1=function(l,e){let r=eM(l);for(let c of r){for(let p of c.meshes)ok(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(sk(c.lights,e)))}return r},i.e2=Q_,i.e3=MD,i.e4=Vr,i.e5=function(l){Bi(),nn?.then(e=>{e.keys().then(r=>{for(let c=0;c<r.length-l;c++)e.delete(r[c])})})},i.f=function(l){return l.indexOf("mapbox:")===0},i.g=function(l,e){return qc(mr(l,{method:"GET"}),e)},i.h=me,i.i=function(l){return _e.API_STYLE_REGEX.test(l)&&!Ce(l)},i.j=function(l){return decodeURIComponent(atob(l).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},i.l=mr,i.m=ir,i.n=function(l,e){return qc(mr(l,{type:"json"}),e)},i.o=Uo,i.p=function(l,e){return qc(mr(l,{method:"POST"}),e)},i.q=dt,i.r=Rr,i.s=function(l){try{let e=self[l];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Zc,i.u=function(){return function l(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=In,i.x=Hs,i.y=2,i.z=OC}),u(["./shared"],function(i){function P(ke){let Y=ke?ke.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function V(ke){if(typeof ke=="number"||typeof ke=="boolean"||typeof ke=="string"||ke==null)return JSON.stringify(ke);if(Array.isArray(ke)){let J="[";for(let ce of ke)J+=`${V(ce)},`;return`${J}]`}let Y="{";for(let J of Object.keys(ke).sort())Y+=`${J}:${V(ke[J])},`;return`${Y}}`}function $(ke){let Y="";for(let J of i.bg)Y+=`/${V(ke[J])}`;return Y}class re{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,J){this._layerConfigs={},this._layers={},this.update(Y,[],J)}update(Y,J,ce){this._options=ce;for(let me of Y)this._layerConfigs[me.id]=me,(this._layers[me.id]=i.cq(me,this.scope,null,this._options)).compileFilter(ce),this.keyCache[me.id]&&delete this.keyCache[me.id];for(let me of J)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};let _e=function(me,Ce){let Le={};for(let Fe=0;Fe<me.length;Fe++){let $e=Ce&&Ce[me[Fe].id]||$(me[Fe]);Ce&&(Ce[me[Fe].id]=$e);let Ve=Le[$e];Ve||(Ve=Le[$e]=[]),Ve.push(me[Fe])}let Ae=[];for(let Fe in Le)Ae.push(Le[Fe]);return Ae}(i.bd(this._layerConfigs),this.keyCache);for(let me of _e){let Ce=me.map(Qe=>this._layers[Qe.id]),Le=Ce[0];if(Le.visibility==="none")continue;let Ae=Le.source||"",Fe=this.familiesBySource[Ae];Fe||(Fe=this.familiesBySource[Ae]={});let $e=Le.sourceLayer||"_geojsonTileLayer",Ve=Fe[$e];Ve||(Ve=Fe[$e]=[]),Ve.push(Ce)}}}let xe=1*i.dP;class Pe{constructor(Y){let J={},ce=[];for(let Le in Y){let Ae=Y[Le],Fe=J[Le]={};for(let $e in Ae.glyphs){let Ve=Ae.glyphs[+$e];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;let Qe=Ve.metrics.localGlyph?xe:1,ht={x:0,y:0,w:Ve.bitmap.width+2*Qe,h:Ve.bitmap.height+2*Qe};ce.push(ht),Fe[$e]=ht}}let{w:_e,h:me}=i.z(ce),Ce=new i.dO({width:_e||1,height:me||1});for(let Le in Y){let Ae=Y[Le];for(let Fe in Ae.glyphs){let $e=Ae.glyphs[+Fe];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;let Ve=J[Le][Fe],Qe=$e.metrics.localGlyph?xe:1;i.dO.copy($e.bitmap,Ce,{x:0,y:0},{x:Ve.x+Qe,y:Ve.y+Qe},$e.bitmap)}}this.image=Ce,this.positions=J}}i.dN(Pe,"GlyphAtlas");class Xe{constructor(Y){this.tileID=new i.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=i.aK(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep}parse(Y,J,ce,_e,me){this.status="parsing",this.data=Y,this.collisionBoxArray=new i.aQ;let Ce=new i.dQ(Object.keys(Y.layers).sort()),Le=new i.dR(this.tileID,this.promoteId);Le.bucketLayerIDs=[];let Ae={},Fe=new i.dS(256,256),$e={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Fe,availableImages:ce,brightness:this.brightness},Ve=J.familiesBySource[this.source];for(let Gt in Ve){let Ln=Y.layers[Gt];if(!Ln)continue;let Un=!1,nn=!1,Vn=!1;for(let Ui of Ve[Gt])Ui[0].type==="symbol"?Un=!0:nn=!0,Ui[0].is3D()&&Ui[0].type!=="model"&&(Vn=!0);if(this.extraShadowCaster&&!Vn||this.isSymbolTile===!0&&!Un||this.isSymbolTile===!1&&!nn)continue;Ln.version===1&&i.w(`Vector tile source "${this.source}" layer "${Gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let pi=Ce.encode(Gt),Bi=[];for(let Ui=0;Ui<Ln.length;Ui++){let ir=Ln.feature(Ui),Eo=Le.getId(ir,Gt);Bi.push({feature:ir,id:Eo,index:Ui,sourceLayerIndex:pi})}for(let Ui of Ve[Gt]){let ir=Ui[0];(!this.extraShadowCaster||ir.is3D()&&ir.type!=="model")&&(this.isSymbolTile!==void 0&&ir.type==="symbol"!==this.isSymbolTile||ir.minzoom&&this.zoom<Math.floor(ir.minzoom)||ir.maxzoom&&this.zoom>=ir.maxzoom||ir.visibility!=="none"&&(Ze(Ui,this.zoom,$e.brightness,ce),(Ae[ir.id]=ir.createBucket({index:Le.bucketLayerIDs.length,layers:Ui,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Bi,$e,this.tileID.canonical,this.tileTransform),Le.bucketLayerIDs.push(Ui.map(Eo=>Eo.id))))}}let Qe,ht,dt,Vt;Fe.trim();let $t={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ht=()=>{if(Qe)return this.status="done",me(Qe);if(this.extraShadowCaster)this.status="done",me(null,{buckets:i.bd(Ae).filter(Gt=>!Gt.isEmpty()),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:$e.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ht&&dt&&Vt){let Gt=new Pe(ht),Ln=new i.dU(dt,Vt,this.lut);for(let Un in Ae){let nn=Ae[Un];nn instanceof i.aR?(Ze(nn.layers,this.zoom,$e.brightness,ce),i.dV(nn,ht,Gt.positions,dt,Ln.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):nn.hasPattern&&(nn instanceof i.aX||nn instanceof i.aY||nn instanceof i.d0)&&(Ze(nn.layers,this.zoom,$e.brightness,ce),nn.addFeatures($e,this.tileID.canonical,Ln.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",me(null,{buckets:i.bd(Ae).filter(Un=>!Un.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,lineAtlas:Fe,imageAtlas:Ln,brightness:$e.brightness})}};if(!this.extraShadowCaster){let Gt=i.dT($e.glyphDependencies,nn=>Object.keys(nn).map(Number));Object.keys(Gt).length?_e.send("getGlyphs",{uid:this.uid,stacks:Gt,scope:this.scope},(nn,Vn)=>{Qe||(Qe=nn,ht=Vn,Ht())},void 0,!1,$t):ht={};let Ln=Object.keys($e.iconDependencies);Ln.length?_e.send("getImages",{icons:Ln,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(nn,Vn)=>{Qe||(Qe=nn,dt=Vn,Ht())},void 0,!1,$t):dt={};let Un=Object.keys($e.patternDependencies);Un.length?_e.send("getImages",{icons:Un,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(nn,Vn)=>{Qe||(Qe=nn,Vt=Vn,Ht())},void 0,!1,$t):Vt={}}Ht()}}function Ze(ke,Y,J,ce){let _e=new i.a3(Y,{brightness:J});for(let me of ke)me.recalculate(_e,ce)}class yt extends i.E{constructor(Y,J,ce,_e,me,Ce){super(),this.actor=Y,this.layerIndex=J,this.availableImages=ce,this.loadVectorData=me||i.aw,this.loading={},this.loaded={},this.deduped=new i.au(Y.scheduler),this.isSpriteLoaded=_e,this.scheduler=Y.scheduler,this.brightness=Ce}loadTile(Y,J){let ce=Y.uid,_e=Y&&Y.request,me=_e&&_e.collectResourceTiming,Ce=this.loading[ce]=new Xe(Y);Ce.abort=this.loadVectorData(Y,(Le,Ae)=>{let Fe=!this.loading[ce];if(delete this.loading[ce],Fe||Le||!Ae)return Ce.status="done",Fe||(this.loaded[ce]=Ce),J(Le);let $e=Ae.rawData,Ve={};Ae.expires&&(Ve.expires=Ae.expires),Ae.cacheControl&&(Ve.cacheControl=Ae.cacheControl),Ce.vectorTile=Ae.vectorTile||new i.dW.VectorTile(new i.bb($e));let Qe=()=>{Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(ht,dt)=>{if(ht||!dt)return J(ht);let Vt={};if(me){let $t=P(_e);$t.length>0&&(Vt.resourceTiming=JSON.parse(JSON.stringify($t)))}J(null,i.l({rawTileData:$e.slice(0)},dt,Ve,Vt))})};this.isSpriteLoaded?Qe():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qe,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Qe()}),this.loaded=this.loaded||{},this.loaded[ce]=Ce})}reloadTile(Y,J){let ce=this.loaded,_e=Y.uid;if(ce&&ce[_e]){let me=ce[_e];me.showCollisionBoxes=Y.showCollisionBoxes,me.projection=Y.projection,me.brightness=Y.brightness,me.tileTransform=i.aK(Y.tileID.canonical,Y.projection),me.extraShadowCaster=Y.extraShadowCaster,me.lut=Y.lut;let Ce=(Le,Ae)=>{let Fe=me.reloadCallback;Fe&&(delete me.reloadCallback,me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Fe)),J(Le,Ae)};me.status==="parsing"?me.reloadCallback=Ce:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Ce):Ce())}else J(null,void 0)}abortTile(Y,J){let ce=Y.uid,_e=this.loading[ce];_e&&(_e.abort&&_e.abort(),delete this.loading[ce]),J()}removeTile(Y,J){let ce=this.loaded,_e=Y.uid;ce&&ce[_e]&&delete ce[_e],J()}}class lt{loadTile(Y,J){let{uid:ce,encoding:_e,rawImageData:me,padding:Ce}=Y,Le=ImageBitmap&&me instanceof ImageBitmap?this.getImageData(me,Ce):me;J(null,new i.dX(ce,Le,_e,Ce<1))}getImageData(Y,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let ce=this.offscreenCanvasContext.getImageData(-J,-J,Y.width+2*J,Y.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}i.ba.setPbf(i.bb);class Ut{decodeRasterArray({task:Y,buffer:J},ce){i.ba.performDecoding(J,Y).then(_e=>{ce(null,_e)},_e=>{ce(_e)})}}let un=i.dW.VectorTileFeature.prototype.toGeoJSON;class an{constructor(Y){this._feature=Y,this.extent=i.ab,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){let Y=[];for(let J of this._feature.geometry)Y.push([new i.P(J[0],J[1])]);return Y}{let Y=[];for(let J of this._feature.geometry){let ce=[];for(let _e of J)ce.push(new i.P(_e[0],_e[1]));Y.push(ce)}return Y}}toGeoJSON(Y,J,ce){return un.call(this,Y,J,ce)}}class Zn{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ab,this.length=Y.length,this._features=Y}feature(Y){return new an(this._features[Y])}}let Li=64/4096,At=128;class zi{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],J){for(let ce of Y){let _e=ce.id;if(_e==null)continue;let me=this.features.get(_e);me&&this.updateCache(me,J),ce.geometry?(me=Ft(ce),this.updateCache(me,J),this.features.set(_e,me)):this.features.delete(_e),this.updateCache(me,J)}}updateCache(Y,J){for(let{canonical:ce,uid:_e}of Object.values(J)){let{z:me,x:Ce,y:Le}=ce;Er(Y,Math.pow(2,me),Ce,Le)&&delete J[_e]}}getTile(Y,J,ce){let _e=Math.pow(2,Y),me=[];for(let Ce of this.features.values())Er(Ce,_e,J,ce)&&me.push(ih(Ce,_e,J,ce));return{features:me}}getFeatures(){return[...this.features.values()]}}function Er({minX:ke,minY:Y,maxX:J,maxY:ce},_e,me,Ce){return ke<(me+1+Li)/_e&&Y<(Ce+1+Li)/_e&&J>(me-Li)/_e&&ce>(Ce-Li)/_e}function Ft(ke){let{id:Y,geometry:J,properties:ce}=ke;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:_e,coordinates:me}=J,Ce={id:Y,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Le=Ce.geometry;if(_e==="Point")Bt(me,Le,Ce);else if(_e==="MultiPoint")for(let Ae of me)Bt(Ae,Le,Ce);else if(_e==="LineString")Ce.type=2,as(me,Le,Ce);else if(_e==="MultiLineString")Ce.type=2,Us(me,Le,Ce);else if(_e==="Polygon")Ce.type=3,Us(me,Le,Ce,!0);else{if(_e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ce.type=3;for(let Ae of me)Us(Ae,Le,Ce,!0)}return Ce}function Bt([ke,Y],J,ce){let _e=i.am(ke),me=i.at(Y);me=me<0?0:me>1?1:me,J.push(_e,me),ce.minX=Math.min(ce.minX,_e),ce.minY=Math.min(ce.minY,me),ce.maxX=Math.max(ce.maxX,_e),ce.maxY=Math.max(ce.maxY,me)}function as(ke,Y,J,ce=!1,_e=!1){let me=[];for(let Ce of ke)Bt(Ce,me,J);Y.push(me),ce&&function(Ce,Le){let Ae=0;for(let Fe=0,$e=Ce.length,Ve=$e-2;Fe<$e;Ve=Fe,Fe+=2)Ae+=(Ce[Fe]-Ce[Ve])*(Ce[Fe+1]+Ce[Ve+1]);if(Ae>0===Le)for(let Fe=0,$e=Ce.length;Fe<$e/2;Fe+=2){let Ve=Ce[Fe],Qe=Ce[Fe+1];Ce[Fe]=Ce[$e-2-Fe],Ce[Fe+1]=Ce[$e-1-Fe],Ce[$e-2-Fe]=Ve,Ce[$e-1-Fe]=Qe}}(me,_e)}function Us(ke,Y,J,ce=!1){for(let _e=0;_e<ke.length;_e++)as(ke[_e],Y,J,ce,_e===0)}function ih(ke,Y,J,ce){let{id:_e,type:me,geometry:Ce,tags:Le}=ke,Ae=[];if(me===1)(function(Fe,$e,Ve,Qe,ht){for(let dt=0;dt<Fe.length;dt+=2){let Vt=Math.round(i.ab*(Fe[dt+0]*$e-Ve)),$t=Math.round(i.ab*(Fe[dt+1]*$e-Qe));ht.push([Vt,$t])}})(Ce,Y,J,ce,Ae);else for(let Fe of Ce)hn(Fe,Y,J,ce,Ae);return{id:_e,type:me,geometry:Ae,tags:Le}}function hn(ke,Y,J,ce,_e){let me=-At,Ce=i.ab+At,Le;for(let Ae=0;Ae<ke.length-2;Ae+=2){let Fe=Math.round(i.ab*(ke[Ae+0]*Y-J)),$e=Math.round(i.ab*(ke[Ae+1]*Y-ce)),Ve=Math.round(i.ab*(ke[Ae+2]*Y-J)),Qe=Math.round(i.ab*(ke[Ae+3]*Y-ce)),ht=Ve-Fe,dt=Qe-$e;Fe<me&&Ve<me||(Fe<me?($e+=Math.round(dt*((me-Fe)/ht)),Fe=me):Ve<me&&(Qe=$e+Math.round(dt*((me-Fe)/ht)),Ve=me),$e<me&&Qe<me||($e<me?(Fe+=Math.round(ht*((me-$e)/dt)),$e=me):Qe<me&&(Ve=Fe+Math.round(ht*((me-$e)/dt)),Qe=me),Fe>=Ce&&Ve>=Ce||(Fe>=Ce?($e+=Math.round(dt*((Ce-Fe)/ht)),Fe=Ce):Ve>=Ce&&(Qe=$e+Math.round(dt*((Ce-Fe)/ht)),Ve=Ce),$e>=Ce&&Qe>=Ce||($e>=Ce?(Fe+=Math.round(ht*((Ce-$e)/dt)),$e=Ce):Qe>=Ce&&(Ve=Fe+Math.round(ht*((Ce-$e)/dt)),Qe=Ce),Le&&Fe===Le[Le.length-1][0]&&$e===Le[Le.length-1][1]||(Le=[[Fe,$e]],_e.push(Le)),Le.push([Ve,Qe])))))}}var Ir,ls,ll,tn={exports:{}},wa=function(){if(ll)return tn.exports;ll=1;var ke=i.d_(),Y=function(){if(ls)return Ir;ls=1;var $e=i.dY(),Ve=i.dZ().VectorTileFeature;function Qe(dt,Vt){this.options=Vt||{},this.features=dt,this.length=dt.length}function ht(dt,Vt){this.id=typeof dt.id=="number"?dt.id:void 0,this.type=dt.type,this.rawGeometry=dt.type===1?[dt.geometry]:dt.geometry,this.properties=dt.tags,this.extent=Vt||4096}return Ir=Qe,Qe.prototype.feature=function(dt){return new ht(this.features[dt],this.options.extent)},ht.prototype.loadGeometry=function(){var dt=this.rawGeometry;this.geometry=[];for(var Vt=0;Vt<dt.length;Vt++){for(var $t=dt[Vt],Ht=[],Gt=0;Gt<$t.length;Gt++)Ht.push(new $e($t[Gt][0],$t[Gt][1]));this.geometry.push(Ht)}return this.geometry},ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var dt=this.geometry,Vt=1/0,$t=-1/0,Ht=1/0,Gt=-1/0,Ln=0;Ln<dt.length;Ln++)for(var Un=dt[Ln],nn=0;nn<Un.length;nn++){var Vn=Un[nn];Vt=Math.min(Vt,Vn.x),$t=Math.max($t,Vn.x),Ht=Math.min(Ht,Vn.y),Gt=Math.max(Gt,Vn.y)}return[Vt,Ht,$t,Gt]},ht.prototype.toGeoJSON=Ve.prototype.toGeoJSON,Ir}();function J($e){var Ve=new ke;return function(Qe,ht){for(var dt in Qe.layers)ht.writeMessage(3,ce,Qe.layers[dt])}($e,Ve),Ve.finish()}function ce($e,Ve){var Qe;Ve.writeVarintField(15,$e.version||1),Ve.writeStringField(1,$e.name||""),Ve.writeVarintField(5,$e.extent||4096);var ht={keys:[],values:[],keycache:{},valuecache:{}};for(Qe=0;Qe<$e.length;Qe++)ht.feature=$e.feature(Qe),Ve.writeMessage(2,_e,ht);var dt=ht.keys;for(Qe=0;Qe<dt.length;Qe++)Ve.writeStringField(3,dt[Qe]);var Vt=ht.values;for(Qe=0;Qe<Vt.length;Qe++)Ve.writeMessage(4,Fe,Vt[Qe])}function _e($e,Ve){var Qe=$e.feature;Qe.id!==void 0&&Ve.writeVarintField(1,Qe.id),Ve.writeMessage(2,me,$e),Ve.writeVarintField(3,Qe.type),Ve.writeMessage(4,Ae,Qe)}function me($e,Ve){var Qe=$e.feature,ht=$e.keys,dt=$e.values,Vt=$e.keycache,$t=$e.valuecache;for(var Ht in Qe.properties){var Gt=Qe.properties[Ht],Ln=Vt[Ht];if(Gt!==null){Ln===void 0&&(ht.push(Ht),Vt[Ht]=Ln=ht.length-1),Ve.writeVarint(Ln);var Un=typeof Gt;Un!=="string"&&Un!=="boolean"&&Un!=="number"&&(Gt=JSON.stringify(Gt));var nn=Un+":"+Gt,Vn=$t[nn];Vn===void 0&&(dt.push(Gt),$t[nn]=Vn=dt.length-1),Ve.writeVarint(Vn)}}}function Ce($e,Ve){return(Ve<<3)+(7&$e)}function Le($e){return $e<<1^$e>>31}function Ae($e,Ve){for(var Qe=$e.loadGeometry(),ht=$e.type,dt=0,Vt=0,$t=Qe.length,Ht=0;Ht<$t;Ht++){var Gt=Qe[Ht],Ln=1;ht===1&&(Ln=Gt.length),Ve.writeVarint(Ce(1,Ln));for(var Un=ht===3?Gt.length-1:Gt.length,nn=0;nn<Un;nn++){nn===1&&ht!==1&&Ve.writeVarint(Ce(2,Un-1));var Vn=Gt[nn].x-dt,pi=Gt[nn].y-Vt;Ve.writeVarint(Le(Vn)),Ve.writeVarint(Le(pi)),dt+=Vn,Vt+=pi}ht===3&&Ve.writeVarint(Ce(7,1))}}function Fe($e,Ve){var Qe=typeof $e;Qe==="string"?Ve.writeStringField(1,$e):Qe==="boolean"?Ve.writeBooleanField(7,$e):Qe==="number"&&($e%1!=0?Ve.writeDoubleField(3,$e):$e<0?Ve.writeSVarintField(6,$e):Ve.writeVarintField(5,$e))}return tn.exports=J,tn.exports.fromVectorTileJs=J,tn.exports.fromGeojsonVt=function($e,Ve){Ve=Ve||{};var Qe={};for(var ht in $e)Qe[ht]=new Y($e[ht].features,Ve),Qe[ht].name=ht,Qe[ht].version=Ve.version,Qe[ht].extent=Ve.extent;return J({layers:Qe})},tn.exports.GeoJSONWrapper=Y,tn.exports}(),kc=i.d$(wa);let cl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},Xt=Math.fround||(Nc=new Float32Array(1),ke=>(Nc[0]=+ke,Nc[0]));var Nc;let wo=3,lo=5,ul=6;class zc{constructor(Y){this.options=Object.assign(Object.create(cl),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:J,minZoom:ce,maxZoom:_e}=this.options;J&&console.time("total time");let me=`prepare ${Y.length} points`;J&&console.time(me),this.points=Y;let Ce=[];for(let Ae=0;Ae<Y.length;Ae++){let Fe=Y[Ae];if(!Fe.geometry)continue;let[$e,Ve]=Fe.geometry.coordinates,Qe=Xt(cs($e)),ht=Xt($s(Ve));Ce.push(Qe,ht,1/0,Ae,-1,1),this.options.reduce&&Ce.push(0)}let Le=this.trees[_e+1]=this._createTree(Ce);J&&console.timeEnd(me);for(let Ae=_e;Ae>=ce;Ae--){let Fe=+Date.now();Le=this.trees[Ae]=this._createTree(this._cluster(Le,Ae)),J&&console.log("z%d: %d clusters in %dms",Ae,Le.numItems,+Date.now()-Fe)}return J&&console.timeEnd("total time"),this}getClusters(Y,J){let ce=((Y[0]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,Y[1])),me=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,Ce=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ce=-180,me=180;else if(ce>me){let Ve=this.getClusters([ce,_e,180,Ce],J),Qe=this.getClusters([-180,_e,me,Ce],J);return Ve.concat(Qe)}let Le=this.trees[this._limitZoom(J)],Ae=Le.range(cs(ce),$s(Ce),cs(me),$s(_e)),Fe=Le.data,$e=[];for(let Ve of Ae){let Qe=this.stride*Ve;$e.push(Fe[Qe+lo]>1?Ta(Fe,Qe,this.clusterProps):this.points[Fe[Qe+wo]])}return $e}getChildren(Y){let J=this._getOriginId(Y),ce=this._getOriginZoom(Y),_e="No cluster with the specified id.",me=this.trees[ce];if(!me)throw new Error(_e);let Ce=me.data;if(J*this.stride>=Ce.length)throw new Error(_e);let Le=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ae=me.within(Ce[J*this.stride],Ce[J*this.stride+1],Le),Fe=[];for(let $e of Ae){let Ve=$e*this.stride;Ce[Ve+4]===Y&&Fe.push(Ce[Ve+lo]>1?Ta(Ce,Ve,this.clusterProps):this.points[Ce[Ve+wo]])}if(Fe.length===0)throw new Error(_e);return Fe}getLeaves(Y,J,ce){let _e=[];return this._appendLeaves(_e,Y,J=J||10,ce=ce||0,0),_e}getTile(Y,J,ce){let _e=this.trees[this._limitZoom(Y)],me=Math.pow(2,Y),{extent:Ce,radius:Le}=this.options,Ae=Le/Ce,Fe=(ce-Ae)/me,$e=(ce+1+Ae)/me,Ve={features:[]};return this._addTileFeatures(_e.range((J-Ae)/me,Fe,(J+1+Ae)/me,$e),_e.data,J,ce,me,Ve),J===0&&this._addTileFeatures(_e.range(1-Ae/me,Fe,1,$e),_e.data,me,ce,me,Ve),J===me-1&&this._addTileFeatures(_e.range(0,Fe,Ae/me,$e),_e.data,-1,ce,me,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(Y){let J=this._getOriginZoom(Y)-1;for(;J<=this.options.maxZoom;){let ce=this.getChildren(Y);if(J++,ce.length!==1)break;Y=ce[0].properties.cluster_id}return J}_appendLeaves(Y,J,ce,_e,me){let Ce=this.getChildren(J);for(let Le of Ce){let Ae=Le.properties;if(Ae&&Ae.cluster?me+Ae.point_count<=_e?me+=Ae.point_count:me=this._appendLeaves(Y,Ae.cluster_id,ce,_e,me):me<_e?me++:Y.push(Le),Y.length===ce)break}return me}_createTree(Y){let J=new i.by(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Y.length;ce+=this.stride)J.add(Y[ce],Y[ce+1]);return J.finish(),J.data=Y,J}_addTileFeatures(Y,J,ce,_e,me,Ce){for(let Le of Y){let Ae=Le*this.stride,Fe=J[Ae+lo]>1,$e,Ve,Qe;if(Fe)$e=be(J,Ae,this.clusterProps),Ve=J[Ae],Qe=J[Ae+1];else{let Vt=this.points[J[Ae+wo]];$e=Vt.properties;let[$t,Ht]=Vt.geometry.coordinates;Ve=cs($t),Qe=$s(Ht)}let ht={type:1,geometry:[[Math.round(this.options.extent*(Ve*me-ce)),Math.round(this.options.extent*(Qe*me-_e))]],tags:$e},dt;dt=Fe||this.options.generateId?J[Ae+wo]:this.points[J[Ae+wo]].id,dt!==void 0&&(ht.id=dt),Ce.features.push(ht)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,J){let{radius:ce,extent:_e,reduce:me,minPoints:Ce}=this.options,Le=ce/(_e*Math.pow(2,J)),Ae=Y.data,Fe=[],$e=this.stride;for(let Ve=0;Ve<Ae.length;Ve+=$e){if(Ae[Ve+2]<=J)continue;Ae[Ve+2]=J;let Qe=Ae[Ve],ht=Ae[Ve+1],dt=Y.within(Ae[Ve],Ae[Ve+1],Le),Vt=Ae[Ve+lo],$t=Vt;for(let Ht of dt){let Gt=Ht*$e;Ae[Gt+2]>J&&($t+=Ae[Gt+lo])}if($t>Vt&&$t>=Ce){let Ht,Gt=Qe*Vt,Ln=ht*Vt,Un=-1,nn=(Ve/$e<<5)+(J+1)+this.points.length;for(let Vn of dt){let pi=Vn*$e;if(Ae[pi+2]<=J)continue;Ae[pi+2]=J;let Bi=Ae[pi+lo];Gt+=Ae[pi]*Bi,Ln+=Ae[pi+1]*Bi,Ae[pi+4]=nn,me&&(Ht||(Ht=this._map(Ae,Ve,!0),Un=this.clusterProps.length,this.clusterProps.push(Ht)),me(Ht,this._map(Ae,pi)))}Ae[Ve+4]=nn,Fe.push(Gt/$t,Ln/$t,1/0,nn,-1,$t),me&&Fe.push(Un)}else{for(let Ht=0;Ht<$e;Ht++)Fe.push(Ae[Ve+Ht]);if($t>1)for(let Ht of dt){let Gt=Ht*$e;if(!(Ae[Gt+2]<=J)){Ae[Gt+2]=J;for(let Ln=0;Ln<$e;Ln++)Fe.push(Ae[Gt+Ln])}}}}return Fe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,J,ce){if(Y[J+lo]>1){let Ce=this.clusterProps[Y[J+ul]];return ce?Object.assign({},Ce):Ce}let _e=this.points[Y[J+wo]].properties,me=this.options.map(_e);return ce&&me===_e?Object.assign({},me):me}}function Ta(ke,Y,J){return{type:"Feature",id:ke[Y+wo],properties:be(ke,Y,J),geometry:{type:"Point",coordinates:[(ce=ke[Y],360*(ce-.5)),Bc(ke[Y+1])]}};var ce}function be(ke,Y,J){let ce=ke[Y+lo],_e=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,me=ke[Y+ul],Ce=me===-1?{}:Object.assign({},J[me]);return Object.assign(Ce,{cluster:!0,cluster_id:ke[Y+wo],point_count:ce,point_count_abbreviated:_e})}function cs(ke){return ke/360+.5}function $s(ke){let Y=Math.sin(ke*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function Bc(ke){let Y=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function st(ke,Y,J,ce){let _e=ce,me=Y+(J-Y>>1),Ce,Le=J-Y,Ae=ke[Y],Fe=ke[Y+1],$e=ke[J],Ve=ke[J+1];for(let Qe=Y+3;Qe<J;Qe+=3){let ht=Ea(ke[Qe],ke[Qe+1],Ae,Fe,$e,Ve);if(ht>_e)Ce=Qe,_e=ht;else if(ht===_e){let dt=Math.abs(Qe-me);dt<Le&&(Ce=Qe,Le=dt)}}_e>ce&&(Ce-Y>3&&st(ke,Y,Ce,ce),ke[Ce+2]=_e,J-Ce>3&&st(ke,Ce,J,ce))}function Ea(ke,Y,J,ce,_e,me){let Ce=_e-J,Le=me-ce;if(Ce!==0||Le!==0){let Ae=((ke-J)*Ce+(Y-ce)*Le)/(Ce*Ce+Le*Le);Ae>1?(J=_e,ce=me):Ae>0&&(J+=Ce*Ae,ce+=Le*Ae)}return Ce=ke-J,Le=Y-ce,Ce*Ce+Le*Le}function nr(ke,Y,J,ce){let _e={id:ke??null,type:Y,geometry:J,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")us(_e,J);else if(Y==="Polygon")us(_e,J[0]);else if(Y==="MultiLineString")for(let me of J)us(_e,me);else if(Y==="MultiPolygon")for(let me of J)us(_e,me[0]);return _e}function us(ke,Y){for(let J=0;J<Y.length;J+=3)ke.minX=Math.min(ke.minX,Y[J]),ke.minY=Math.min(ke.minY,Y[J+1]),ke.maxX=Math.max(ke.maxX,Y[J]),ke.maxY=Math.max(ke.maxY,Y[J+1])}function _n(ke,Y,J,ce){if(!Y.geometry)return;let _e=Y.geometry.coordinates;if(_e&&_e.length===0)return;let me=Y.geometry.type,Ce=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2),Le=[],Ae=Y.id;if(J.promoteId?Ae=Y.properties[J.promoteId]:J.generateId&&(Ae=ce||0),me==="Point")Ki(_e,Le);else if(me==="MultiPoint")for(let Fe of _e)Ki(Fe,Le);else if(me==="LineString")To(_e,Le,Ce,!1);else if(me==="MultiLineString"){if(J.lineMetrics){for(let Fe of _e)Le=[],To(Fe,Le,Ce,!1),ke.push(nr(Ae,"LineString",Le,Y.properties));return}Ia(_e,Le,Ce,!1)}else if(me==="Polygon")Ia(_e,Le,Ce,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(let Fe of Y.geometry.geometries)_n(ke,{id:Ae,geometry:Fe,properties:Y.properties},J,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Fe of _e){let $e=[];Ia(Fe,$e,Ce,!0),Le.push($e)}}ke.push(nr(Ae,me,Le,Y.properties))}function Ki(ke,Y){Y.push(Gs(ke[0]),hl(ke[1]),0)}function To(ke,Y,J,ce){let _e,me,Ce=0;for(let Ae=0;Ae<ke.length;Ae++){let Fe=Gs(ke[Ae][0]),$e=hl(ke[Ae][1]);Y.push(Fe,$e,0),Ae>0&&(Ce+=ce?(_e*$e-Fe*me)/2:Math.sqrt(Math.pow(Fe-_e,2)+Math.pow($e-me,2))),_e=Fe,me=$e}let Le=Y.length-3;Y[2]=1,st(Y,0,Le,J),Y[Le+2]=1,Y.size=Math.abs(Ce),Y.start=0,Y.end=Y.size}function Ia(ke,Y,J,ce){for(let _e=0;_e<ke.length;_e++){let me=[];To(ke[_e],me,J,ce),Y.push(me)}}function Gs(ke){return ke/360+.5}function hl(ke){let Y=Math.sin(ke*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function Qt(ke,Y,J,ce,_e,me,Ce,Le){if(ce/=Y,me>=(J/=Y)&&Ce<ce)return ke;if(Ce<J||me>=ce)return null;let Ae=[];for(let Fe of ke){let $e=Fe.geometry,Ve=Fe.type,Qe=_e===0?Fe.minX:Fe.minY,ht=_e===0?Fe.maxX:Fe.maxY;if(Qe>=J&&ht<ce){Ae.push(Fe);continue}if(ht<J||Qe>=ce)continue;let dt=[];if(Ve==="Point"||Ve==="MultiPoint")dl($e,dt,J,ce,_e);else if(Ve==="LineString")hs($e,dt,J,ce,_e,!1,Le.lineMetrics);else if(Ve==="MultiLineString")mr($e,dt,J,ce,_e,!1);else if(Ve==="Polygon")mr($e,dt,J,ce,_e,!0);else if(Ve==="MultiPolygon")for(let Vt of $e){let $t=[];mr(Vt,$t,J,ce,_e,!0),$t.length&&dt.push($t)}if(dt.length){if(Le.lineMetrics&&Ve==="LineString"){for(let Vt of dt)Ae.push(nr(Fe.id,Ve,Vt,Fe.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(dt.length===1?(Ve="LineString",dt=dt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=dt.length===3?"Point":"MultiPoint"),Ae.push(nr(Fe.id,Ve,dt,Fe.tags))}}return Ae.length?Ae:null}function dl(ke,Y,J,ce,_e){for(let me=0;me<ke.length;me+=3){let Ce=ke[me+_e];Ce>=J&&Ce<=ce&&qr(Y,ke[me],ke[me+1],ke[me+2])}}function hs(ke,Y,J,ce,_e,me,Ce){let Le=Ca(ke),Ae=_e===0?Vc:jc,Fe,$e,Ve=ke.start;for(let $t=0;$t<ke.length-3;$t+=3){let Ht=ke[$t],Gt=ke[$t+1],Ln=ke[$t+2],Un=ke[$t+3],nn=ke[$t+4],Vn=_e===0?Ht:Gt,pi=_e===0?Un:nn,Bi=!1;Ce&&(Fe=Math.sqrt(Math.pow(Ht-Un,2)+Math.pow(Gt-nn,2))),Vn<J?pi>J&&($e=Ae(Le,Ht,Gt,Un,nn,J),Ce&&(Le.start=Ve+Fe*$e)):Vn>ce?pi<ce&&($e=Ae(Le,Ht,Gt,Un,nn,ce),Ce&&(Le.start=Ve+Fe*$e)):qr(Le,Ht,Gt,Ln),pi<J&&Vn>=J&&($e=Ae(Le,Ht,Gt,Un,nn,J),Bi=!0),pi>ce&&Vn<=ce&&($e=Ae(Le,Ht,Gt,Un,nn,ce),Bi=!0),!me&&Bi&&(Ce&&(Le.end=Ve+Fe*$e),Y.push(Le),Le=Ca(ke)),Ce&&(Ve+=Fe)}let Qe=ke.length-3,ht=ke[Qe],dt=ke[Qe+1],Vt=_e===0?ht:dt;Vt>=J&&Vt<=ce&&qr(Le,ht,dt,ke[Qe+2]),Qe=Le.length-3,me&&Qe>=3&&(Le[Qe]!==Le[0]||Le[Qe+1]!==Le[1])&&qr(Le,Le[0],Le[1],Le[2]),Le.length&&Y.push(Le)}function Ca(ke){let Y=[];return Y.size=ke.size,Y.start=ke.start,Y.end=ke.end,Y}function mr(ke,Y,J,ce,_e,me){for(let Ce of ke)hs(Ce,Y,J,ce,_e,me,!1)}function qr(ke,Y,J,ce){ke.push(Y,J,ce)}function Vc(ke,Y,J,ce,_e,me){let Ce=(me-Y)/(ce-Y);return qr(ke,me,J+(_e-J)*Ce,1),Ce}function jc(ke,Y,J,ce,_e,me){let Ce=(me-J)/(_e-J);return qr(ke,Y+(ce-Y)*Ce,me,1),Ce}function fl(ke,Y){let J=[];for(let ce=0;ce<ke.length;ce++){let _e=ke[ce],me=_e.type,Ce;if(me==="Point"||me==="MultiPoint"||me==="LineString")Ce=ds(_e.geometry,Y);else if(me==="MultiLineString"||me==="Polygon"){Ce=[];for(let Le of _e.geometry)Ce.push(ds(Le,Y))}else if(me==="MultiPolygon"){Ce=[];for(let Le of _e.geometry){let Ae=[];for(let Fe of Le)Ae.push(ds(Fe,Y));Ce.push(Ae)}}J.push(nr(_e.id,me,Ce,_e.tags))}return J}function ds(ke,Y){let J=[];J.size=ke.size,ke.start!==void 0&&(J.start=ke.start,J.end=ke.end);for(let ce=0;ce<ke.length;ce+=3)J.push(ke[ce]+Y,ke[ce+1],ke[ce+2]);return J}function Da(ke,Y){if(ke.transformed)return ke;let J=1<<ke.z,ce=ke.x,_e=ke.y;for(let me of ke.features){let Ce=me.geometry,Le=me.type;if(me.geometry=[],Le===1)for(let Ae=0;Ae<Ce.length;Ae+=2)me.geometry.push(pl(Ce[Ae],Ce[Ae+1],Y,J,ce,_e));else for(let Ae=0;Ae<Ce.length;Ae++){let Fe=[];for(let $e=0;$e<Ce[Ae].length;$e+=2)Fe.push(pl(Ce[Ae][$e],Ce[Ae][$e+1],Y,J,ce,_e));me.geometry.push(Fe)}}return ke.transformed=!0,ke}function pl(ke,Y,J,ce,_e,me){return[Math.round(J*(ke*ce-_e)),Math.round(J*(Y*ce-me))]}function co(ke,Y,J,ce,_e){let me=Y===_e.maxZoom?0:_e.tolerance/((1<<Y)*_e.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:ke.length,source:null,x:J,y:ce,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Le of ke)Uc(Ce,Le,me,_e);return Ce}function Uc(ke,Y,J,ce){let _e=Y.geometry,me=Y.type,Ce=[];if(ke.minX=Math.min(ke.minX,Y.minX),ke.minY=Math.min(ke.minY,Y.minY),ke.maxX=Math.max(ke.maxX,Y.maxX),ke.maxY=Math.max(ke.maxY,Y.maxY),me==="Point"||me==="MultiPoint")for(let Le=0;Le<_e.length;Le+=3)Ce.push(_e[Le],_e[Le+1]),ke.numPoints++,ke.numSimplified++;else if(me==="LineString")In(Ce,_e,ke,J,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(let Le=0;Le<_e.length;Le++)In(Ce,_e[Le],ke,J,me==="Polygon",Le===0);else if(me==="MultiPolygon")for(let Le=0;Le<_e.length;Le++){let Ae=_e[Le];for(let Fe=0;Fe<Ae.length;Fe++)In(Ce,Ae[Fe],ke,J,!0,Fe===0)}if(Ce.length){let Le=Y.tags||null;if(me==="LineString"&&ce.lineMetrics){Le={};for(let Fe in Y.tags)Le[Fe]=Y.tags[Fe];Le.mapbox_clip_start=_e.start/_e.size,Le.mapbox_clip_end=_e.end/_e.size}let Ae={geometry:Ce,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Le};Y.id!==null&&(Ae.id=Y.id),ke.features.push(Ae)}}function In(ke,Y,J,ce,_e,me){let Ce=ce*ce;if(ce>0&&Y.size<(_e?Ce:ce))return void(J.numPoints+=Y.length/3);let Le=[];for(let Ae=0;Ae<Y.length;Ae+=3)(ce===0||Y[Ae+2]>Ce)&&(J.numSimplified++,Le.push(Y[Ae],Y[Ae+1])),J.numPoints++;_e&&function(Ae,Fe){let $e=0;for(let Ve=0,Qe=Ae.length,ht=Qe-2;Ve<Qe;ht=Ve,Ve+=2)$e+=(Ae[Ve]-Ae[ht])*(Ae[Ve+1]+Ae[ht+1]);if($e>0===Fe)for(let Ve=0,Qe=Ae.length;Ve<Qe/2;Ve+=2){let ht=Ae[Ve],dt=Ae[Ve+1];Ae[Ve]=Ae[Qe-2-Ve],Ae[Ve+1]=Ae[Qe-1-Ve],Ae[Qe-2-Ve]=ht,Ae[Qe-1-Ve]=dt}}(Le,me),ke.push(Le)}let jo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rh{constructor(Y,J){let ce=(J=this.options=function(me,Ce){for(let Le in Ce)me[Le]=Ce[Le];return me}(Object.create(jo),J)).debug;if(ce&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=function(me,Ce){let Le=[];if(me.type==="FeatureCollection")for(let Ae=0;Ae<me.features.length;Ae++)_n(Le,me.features[Ae],Ce,Ae);else _n(Le,me.type==="Feature"?me:{geometry:me},Ce);return Le}(Y,J);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(me,Ce){let Le=Ce.buffer/Ce.extent,Ae=me,Fe=Qt(me,1,-1-Le,Le,0,-1,2,Ce),$e=Qt(me,1,1-Le,2+Le,0,-1,2,Ce);return(Fe||$e)&&(Ae=Qt(me,1,-Le,1+Le,0,-1,2,Ce)||[],Fe&&(Ae=fl(Fe,1).concat(Ae)),$e&&(Ae=Ae.concat(fl($e,-1)))),Ae}(_e,J),_e.length&&this.splitTile(_e,0,0,0),ce&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,J,ce,_e,me,Ce,Le){let Ae=[Y,J,ce,_e],Fe=this.options,$e=Fe.debug;for(;Ae.length;){_e=Ae.pop(),ce=Ae.pop(),J=Ae.pop(),Y=Ae.pop();let Ve=1<<J,Qe=Wr(J,ce,_e),ht=this.tiles[Qe];if(!ht&&($e>1&&console.time("creation"),ht=this.tiles[Qe]=co(Y,J,ce,_e,Fe),this.tileCoords.push({z:J,x:ce,y:_e}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ce,_e,ht.numFeatures,ht.numPoints,ht.numSimplified),console.timeEnd("creation"));let Bi=`z${J}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(ht.source=Y,me==null){if(J===Fe.indexMaxZoom||ht.numPoints<=Fe.indexMaxPoints)continue}else{if(J===Fe.maxZoom||J===me)continue;if(me!=null){let Bi=me-J;if(ce!==Ce>>Bi||_e!==Le>>Bi)continue}}if(ht.source=null,Y.length===0)continue;$e>1&&console.time("clipping");let dt=.5*Fe.buffer/Fe.extent,Vt=.5-dt,$t=.5+dt,Ht=1+dt,Gt=null,Ln=null,Un=null,nn=null,Vn=Qt(Y,Ve,ce-dt,ce+$t,0,ht.minX,ht.maxX,Fe),pi=Qt(Y,Ve,ce+Vt,ce+Ht,0,ht.minX,ht.maxX,Fe);Y=null,Vn&&(Gt=Qt(Vn,Ve,_e-dt,_e+$t,1,ht.minY,ht.maxY,Fe),Ln=Qt(Vn,Ve,_e+Vt,_e+Ht,1,ht.minY,ht.maxY,Fe),Vn=null),pi&&(Un=Qt(pi,Ve,_e-dt,_e+$t,1,ht.minY,ht.maxY,Fe),nn=Qt(pi,Ve,_e+Vt,_e+Ht,1,ht.minY,ht.maxY,Fe),pi=null),$e>1&&console.timeEnd("clipping"),Ae.push(Gt||[],J+1,2*ce,2*_e),Ae.push(Ln||[],J+1,2*ce,2*_e+1),Ae.push(Un||[],J+1,2*ce+1,2*_e),Ae.push(nn||[],J+1,2*ce+1,2*_e+1)}}getTile(Y,J,ce){Y=+Y,J=+J,ce=+ce;let _e=this.options,{extent:me,debug:Ce}=_e;if(Y<0||Y>24)return null;let Le=1<<Y,Ae=Wr(Y,J=J+Le&Le-1,ce);if(this.tiles[Ae])return Da(this.tiles[Ae],me);Ce>1&&console.log("drilling down to z%d-%d-%d",Y,J,ce);let Fe,$e=Y,Ve=J,Qe=ce;for(;!Fe&&$e>0;)$e--,Ve>>=1,Qe>>=1,Fe=this.tiles[Wr($e,Ve,Qe)];return Fe&&Fe.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",$e,Ve,Qe),console.time("drilling down")),this.splitTile(Fe.source,$e,Ve,Qe,Y,J,ce),Ce>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Da(this.tiles[Ae],me):null):null}}function Wr(ke,Y,J){return 32*((1<<ke)*J+Y)+ke}function Ma(ke,Y){let J=ke.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);let ce=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!ce)return void Y(null,null);let _e=new Zn(ce.features),me=kc(_e);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),Y(null,{vectorTile:_e,rawData:me.buffer})}class $c extends yt{constructor(Y,J,ce,_e,me,Ce){super(Y,J,ce,_e,Ma,Ce),me&&(this.loadGeoJSON=me),this._dynamicIndex=new zi}loadData(Y,J){let ce=Y&&Y.request,_e=ce&&ce.collectResourceTiming;this.loadGeoJSON(Y,(me,Ce)=>{if(me||!Ce)return J(me);if(typeof Ce!="object")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){let Ae=i.M(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));Ce.features=Ce.features.filter(Fe=>Ae.value.evaluate({zoom:0},Fe))}Y.dynamic?(Ce.type==="Feature"&&(Ce={type:"FeatureCollection",features:[Ce]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ce.features,this.loaded),Y.cluster&&(Ce.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new zc(function({superclusterOptions:Ae,clusterProperties:Fe}){if(!Fe||!Ae)return Ae;let $e={},Ve={},Qe={accumulated:null,zoom:0},ht={properties:null},dt=Object.keys(Fe);for(let Vt of dt){let[$t,Ht]=Fe[Vt],Gt=i.M(Ht),Ln=i.M(typeof $t=="string"?[$t,["accumulated"],["get",Vt]]:$t);$e[Vt]=Gt.value,Ve[Vt]=Ln.value}return Ae.map=Vt=>{ht.properties=Vt;let $t={};for(let Ht of dt)$t[Ht]=$e[Ht].evaluate(Qe,ht);return $t},Ae.reduce=(Vt,$t)=>{ht.properties=$t;for(let Ht of dt)Qe.accumulated=Vt[Ht],Vt[Ht]=Ve[Ht].evaluate(Qe,ht)},Ae}(Y)).load(Ce.features):Y.dynamic?this._dynamicIndex:function(Ae,Fe){return new rh(Ae,Fe)}(Ce,Y.geojsonVtOptions)}catch(Ae){return J(Ae)}let Le={};if(_e){let Ae=P(ce);Ae&&(Le.resourceTiming={},Le.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ae)))}J(null,Le)}})}reloadTile(Y,J){let ce=this.loaded;return ce&&ce[Y.uid]?Y.partial?J(null,void 0):super.reloadTile(Y,J):this.loadTile(Y,J)}loadGeoJSON(Y,J){if(Y.request)i.n(Y.request,J);else{if(typeof Y.data!="string")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(Y.data))}catch{return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ce){J(ce)}}getClusterChildren(Y,J){try{J(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ce){J(ce)}}getClusterLeaves(Y,J){try{J(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ce){J(ce)}}}class ml{constructor(Y,J){this.tileID=new i.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=J}parse(Y,J,ce,_e){this.status="parsing";let me=new i.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ce={},Le=J.familiesBySource[ce.source],Ae=new i.dR(me,ce.promoteId);return Ae.bucketLayerIDs=[],Ae.is3DTile=!0,i.e0(Y).then(Fe=>{if(!Fe)return _e(new Error("Could not parse tile"));let $e=i.e1(Fe,1/i.c8(ce.tileID.canonical)),Ve=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Fe.json.asset.extras&&Fe.json.asset.extras.MAPBOX_mesh_features,Qe=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("EXT_meshopt_compression"),ht=new i.a3(this.zoom,{brightness:this.brightness});for(let dt in Le)for(let Vt of Le[dt]){let $t=Vt[0];Ae.bucketLayerIDs.push(Vt.map(Gt=>Gt.id)),$t.recalculate(ht,[]);let Ht=new i.e2($e,me,Ve,Qe,this.brightness,Ae);Ve||(Ht.needsUpload=!0),Ce[$t.fqid]=Ht,Ht.evaluate($t)}this.status="done",_e(null,{buckets:Ce,featureIndex:Ae})}).catch(Fe=>_e(new Error(Fe.message)))}}class Gc{constructor(Y,J,ce,_e,me,Ce){this.actor=Y,this.layerIndex=J,this.brightness=Ce,this.loading={},this.loaded={}}loadTile(Y,J){let ce=Y.uid,_e=this.loading[ce]=new ml(Y,this.brightness);i.bc(Y.request,(me,Ce)=>{let Le=!this.loading[ce];return delete this.loading[ce],Le||me?(_e.status="done",Le||(this.loaded[ce]=_e),J(me)):Ce&&Ce.byteLength!==0?void _e.parse(Ce,this.layerIndex,Y,(Ae,Fe)=>{_e.status="done",this.loaded=this.loaded||{},this.loaded[ce]=_e,Ae||!Fe?J(Ae):J(null,Fe)}):(_e.status="done",this.loaded[ce]=_e,J())})}reloadTile(Y,J){let ce=this.loaded,_e=Y.uid;if(ce&&ce[_e]){let me=ce[_e];me.projection=Y.projection,me.brightness=Y.brightness;let Ce=(Le,Ae)=>{me.reloadCallback&&(delete me.reloadCallback,this.loadTile(Y,J)),J(Le,Ae)};me.status==="parsing"?me.reloadCallback=Ce:me.status==="done"&&this.loadTile(Y,J)}}abortTile(Y,J){let ce=Y.uid;this.loading[ce]&&delete this.loading[ce],J()}removeTile(Y,J){let ce=this.loaded,_e=Y.uid;ce&&ce[_e]&&delete ce[_e],J()}}class Sa{constructor(Y){this.self=Y,this.actor=new i.e3(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.bL({name:"mercator"}),this.workerSourceTypes={vector:yt,geojson:$c,"batched-model":Gc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,ce)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=ce},this.self.registerRTLTextPlugin=J=>{if(i.e4.isParsed())throw new Error("RTL text plugin already registered.");i.e4.applyArabicShaping=J.applyArabicShaping,i.e4.processBidirectionalText=J.processBidirectionalText,i.e4.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(Y,J,ce){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,ce()}checkIfReady(Y,J,ce){ce()}setReferrer(Y,J){this.referrer=J}spriteLoaded(Y,{scope:J,isLoaded:ce}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][J]=ce,this.workerSources[Y]&&this.workerSources[Y][J])for(let _e in this.workerSources[Y][J]){let me=this.workerSources[Y][J][_e];for(let Ce in me){let Le=me[Ce];Le instanceof yt&&(Le.isSpriteLoaded=ce,Le.fire(new i.x("isSpriteLoaded")))}}}setImages(Y,{scope:J,images:ce},_e){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][J]=ce,this.workerSources[Y]&&this.workerSources[Y][J]){for(let me in this.workerSources[Y][J]){let Ce=this.workerSources[Y][J][me];for(let Le in Ce)Ce[Le].availableImages=ce}_e()}else _e()}setProjection(Y,J){this.projections[Y]=i.bL(J)}setBrightness(Y,J,ce){this.brightness=J,ce()}setLayers(Y,J,ce){this.getLayerIndex(Y,J.scope).replace(J.layers,J.options),ce()}updateLayers(Y,J,ce){this.getLayerIndex(Y,J.scope).update(J.layers,J.removedIds,J.options),ce()}loadTile(Y,J,ce){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).loadTile(J,ce)}loadDEMTile(Y,J,ce){this.getDEMWorkerSource(Y,J.source,J.scope).loadTile(J,ce)}decodeRasterArray(Y,J,ce){this.getRasterArrayWorkerSource().decodeRasterArray(J,ce)}reloadTile(Y,J,ce){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).reloadTile(J,ce)}abortTile(Y,J,ce){this.getWorkerSource(Y,J.type,J.source,J.scope).abortTile(J,ce)}removeTile(Y,J,ce){this.getWorkerSource(Y,J.type,J.source,J.scope).removeTile(J,ce)}removeSource(Y,J,ce){if(!(this.workerSources[Y]&&this.workerSources[Y][J.scope]&&this.workerSources[Y][J.scope][J.type]&&this.workerSources[Y][J.scope][J.type][J.source]))return;let _e=this.workerSources[Y][J.scope][J.type][J.source];delete this.workerSources[Y][J.scope][J.type][J.source],_e.removeSource!==void 0?_e.removeSource(J,ce):ce()}loadWorkerSource(Y,J,ce){try{this.self.importScripts(J.url),ce()}catch(_e){ce(_e.toString())}}syncRTLPluginState(Y,J,ce){try{i.e4.setState(J);let _e=i.e4.getPluginURL();if(i.e4.isLoaded()&&!i.e4.isParsed()&&_e!=null){this.self.importScripts(_e);let me=i.e4.isParsed();ce(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),me)}}catch(_e){ce(_e.toString())}}setDracoUrl(Y,J){this.dracoUrl=J}getAvailableImages(Y,J){this.availableImages[Y]||(this.availableImages[Y]={});let ce=this.availableImages[Y][J];return ce||(ce=[]),ce}getLayerIndex(Y,J){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let ce=this.layerIndexes[Y][J];return ce||(ce=this.layerIndexes[Y][J]=new re,ce.scope=J),ce}getWorkerSource(Y,J,ce,_e){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][_e]||(this.workerSources[Y][_e]={}),this.workerSources[Y][_e][J]||(this.workerSources[Y][_e][J]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.workerSources[Y][_e][J][ce]||(this.workerSources[Y][_e][J][ce]=new this.workerSourceTypes[J]({send:(me,Ce,Le,Ae,Fe,$e)=>{this.actor.send(me,Ce,Le,Y,Fe,$e)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,_e),this.getAvailableImages(Y,_e),this.isSpriteLoaded[Y][_e],void 0,this.brightness)),this.workerSources[Y][_e][J][ce]}getDEMWorkerSource(Y,J,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]={}),this.demWorkerSources[Y][ce][J]||(this.demWorkerSources[Y][ce][J]=new lt),this.demWorkerSources[Y][ce][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ut),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,J){i.e5(J)}getWorkerPerformanceMetrics(Y,J,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sa(self)),Sa}),u(["./shared"],function(i){var P="3.7.0";let V={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(d){performance.mark(d)},measure(d,t,a){performance.measure(d,t,a)}};function re(d){let t=d.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var xe,Pe={},Xe=function(){if(xe)return Pe;function d(f){return!t(f)}function t(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,M=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(M);try{b=new Worker(A),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(A),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var M=b.getImageData(0,0,1,1);return M&&M.width===v.width}()?(a[g=f&&f.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(v){var b,M=function(A){var O=document.createElement("canvas"),L=Object.create(d.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,O.getContext("webgl2",L)}(v);if(!M)return!1;try{b=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!b||M.isContextLost())&&(M.shaderSource(b,"void main() {}"),M.compileShader(b),M.getShaderParameter(b,M.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}xe=1,Pe.supported=d,Pe.notSupportedReason=t;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Pe}();function Ze(d,t,a){let f=document.createElement(d);return t!=null&&(f.className=t),a&&a.appendChild(f),f}function yt(d,t,a){let f=document.createElementNS("http://www.w3.org/2000/svg",d);for(let g of Object.keys(t))f.setAttributeNS(null,g,String(t[g]));return a&&a.appendChild(f),f}let lt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ut=lt&&lt.userSelect!==void 0?"userSelect":"WebkitUserSelect",un;function an(){lt&&Ut&&(un=lt[Ut],lt[Ut]="none")}function Zn(){lt&&Ut&&(lt[Ut]=un)}function Li(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Li,!0)}function At(){window.addEventListener("click",Li,!0),window.setTimeout(()=>{window.removeEventListener("click",Li,!0)},0)}function zi(d,t){let a=d.getBoundingClientRect();return Bt(d,a,t)}function Er(d,t){let a=d.getBoundingClientRect(),f=[];for(let g=0;g<t.length;g++)f.push(Bt(d,a,t[g]));return f}function Ft(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Bt(d,t,a){let f=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new i.P((a.clientX-t.left)*f,(a.clientY-t.top)*f)}let as="01",Us="NO_ACCESS_TOKEN";class ih{constructor(t,a,f){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){let t=function(){let a="";for(let f=0;f<10;f++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",as,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!i.f(t))return t;let f=Ir(t);return f.params.push(`sdk=js-${P}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!i.f(t))return t;let f=Ir(t);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeModelURL(t,a){if(!i.f(t))return t;let f=Ir(t);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeSourceURL(t,a,f,g){if(!i.f(t))return t;let v=Ir(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),g&&v.params.push(`worldview=${g}`),this._makeAPIURL(v,this._customAccessToken||a)}normalizeSpriteURL(t,a,f,g){let v=Ir(t);return i.f(t)?(v.path=`/styles/v1${v.path}/sprite${a}${f}`,this._makeAPIURL(v,this._customAccessToken||g)):(v.path+=`${a}${f}`,ls(v))}normalizeTileURL(t,a,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.f(t))return t;let g=Ir(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||f&&g.authority!=="raster"&&f===512?"@2x":""}${i.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${i.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${i.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${i.e.TILE_URL_VERSION}${g.path}`);let v=this._customAccessToken||function(b){for(let M of b){let A=M.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(g.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,v)}canonicalizeTileURL(t,a){let f=Ir(t);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return t;let g="mapbox://";f.path.match(/^\/raster\/v1\//)?g+=`raster/${f.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${f.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${f.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return a&&(v=v.filter(b=>!b.match(/^access_token=/))),v.length&&(g+=`?${v.join("&")}`),g}canonicalizeTileset(t,a){let f=!!a&&i.f(a),g=[];for(let v of t.tiles||[])i.h(v)?g.push(this.canonicalizeTileURL(v,f)):g.push(v);return g}_makeAPIURL(t,a){let f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Ir(i.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){let v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return ls(t);if(a=a||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return t.params=t.params.filter(v=>v.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),ls(t)}}let hn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ir(d){let t=d.match(hn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ls(d){let t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}let ll="mapbox.eventData";function tn(d){if(!d)return null;let t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.j(t[1]))}catch{return null}}class wa{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let a=tn(i.e.ACCESS_TOKEN),f="";return f=a&&a.u?i.k(a.u):i.e.ACCESS_TOKEN||"",t?`${ll}.${t}:${f}`:`${ll}:${f}`}fetchEventData(){let t=i.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(t)try{let g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));let v=localStorage.getItem(f);v&&(this.anonId=v)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){let t=i.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(f,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,f,g){if(!i.e.EVENTS_URL)return;let v=Ir(i.e.EVENTS_URL);v.params.push(`access_token=${g||i.e.ACCESS_TOKEN||""}`);let b={event:this.type,created:new Date(t).toISOString()},M=a?i.l(b,a):b,A={url:ls(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=i.p(A,O=>{this.pendingRequest=null,f(O),this.saveEventData(),this.processRequests(g)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}let kc=new class extends wa{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(a=>i.f(a)||i.h(a))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=tn(i.e.ACCESS_TOKEN),a=t?t.u:i.e.ACCESS_TOKEN,f=a!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),f=!0);let g=this.queue.shift();if(this.eventData.lastSuccess){let v=new Date(this.eventData.lastSuccess),b=new Date(g),M=(g-this.eventData.lastSuccess)/864e5;f=f||M>=1||M<-1||v.getDate()!==b.getDate()}else f=!0;f?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:as,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},d):this.processRequests()}},cl=kc.postTurnstileEvent.bind(kc),Xt=new class extends wa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,a,f){this.skuToken=t,this.errorCb=f,i.e.EVENTS_URL&&(a||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Us)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:as,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},Nc=Xt.postMapLoadEvent.bind(Xt),wo=new class extends wa{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=i.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){let t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){let{map:a,style:f,importedStyles:g}=t;if(!i.e.EVENTS_URL||!d&&!i.e.ACCESS_TOKEN)return;let v=this.getMapInstanceId(a),b={mapInstanceId:v,eventId:this.getEventId(v),style:f};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},d)}},lo=wo.postStyleLoadEvent.bind(wo),ul=new class extends wa{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:a}=this.queue.shift(),f=function(g){let v=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),M=function(j){let q={};if(j){for(let W in j)if(W!=="other")for(let Z of j[W]){let X=`${W}ResolveRangeMin`,ne=`${W}ResolveRangeMax`,oe=`${W}RequestCount`,ee=`${W}RequestCachedCount`;q[X]=Math.min(q[X]||1/0,Z.startTime),q[ne]=Math.max(q[ne]||-1/0,Z.responseEnd);let le=ae=>{q[ae]===void 0&&(q[ae]=0),++q[ae]};Z.transferSize!==void 0&&Z.transferSize===0&&le(ee),le(oe)}}return q}(function(j,q){let W={};if(j)for(let Z of j){let X=q(Z);W[X]===void 0&&(W[X]=[]),W[X].push(Z)}return W}(v,re)),A=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=O?O.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},z=(j,q,W)=>{W!=null&&j.push({name:q,value:W.toString()})};for(let j in M)z(N.counters,j,M[j]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(z(N.counters,"interactionRangeMin",g.interactionRange[0]),z(N.counters,"interactionRangeMax",g.interactionRange[1])),b)for(let j of Object.keys(V)){let q=V[j],W=b.find(Z=>Z.name===q);W&&z(N.counters,q,W.startTime)}return z(N.counters,"visibilityHidden",g.visibilityHidden),z(N.attributes,"style",function(j){if(j)for(let q of j){let W=q.name.split("?")[0];if(i.i(W)){let Z=W.split("/").slice(-2);if(Z.length===2)return`mapbox://styles/${Z[0]}/${Z[1]}`}}}(v)),z(N.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),z(N.attributes,"fogEnabled",g.fogEnabled?"true":"false"),z(N.attributes,"projection",g.projection),z(N.attributes,"zoom",g.zoom),z(N.metadata,"devicePixelRatio",A),z(N.metadata,"connectionEffectiveType",L),z(N.metadata,"navigatorUserAgent",navigator.userAgent),z(N.metadata,"screenWidth",window.screen.width),z(N.metadata,"screenHeight",window.screen.height),z(N.metadata,"windowWidth",window.innerWidth),z(N.metadata,"windowHeight",window.innerHeight),z(N.metadata,"mapWidth",g.width/A),z(N.metadata,"mapHeight",g.height/A),z(N.metadata,"webglRenderer",g.renderer),z(N.metadata,"webglVendor",g.vendor),z(N.metadata,"sdkVersion",P),z(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(a);for(let g of f.metadata);for(let g of f.counters);for(let g of f.attributes);this.postEvent(t,f,()=>{},d)}},zc=ul.postPerformanceEvent.bind(ul),Ta=new class extends wa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,a,f){if(!i.e.API_URL||!i.e.SESSION_PATH)return;let g=Ir(i.e.API_URL+i.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${f||i.e.ACCESS_TOKEN||""}`);let v={url:ls(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(v,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,t,a,f){this.skuToken=t,this.errorCb=f,i.e.SESSION_PATH&&i.e.API_URL&&(a||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Us)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},be=Ta.getSessionAPI.bind(Ta),cs=new Set;function $s(d,t){t?cs.add(d):cs.delete(d)}class Bc{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){let a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function st(d){let{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ea extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new i.r({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,a){if(this.loaded[a]!==t&&(this.loaded[a]=t,t)){for(let{ids:f,callback:g}of this.requestors)this._notify(f,a,g);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images[a][t]}addImage(t,a,f){this._validate(t,f)&&(this.images[a][t]=f)}_validate(t,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new i.t(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new i.t(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new i.t(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,a){if(!t)return!0;let f=0;for(let g of t){if(g[0]<f||g[1]<g[0]||a<g[1])return!1;f=g[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a,f){f.version=this.images[a][t].version+1,this.images[a][t]=f,this.updatedImages[a][t]=!0}removeImage(t,a){let f=this.images[a][t];delete this.images[a][t],delete this.patterns[a][t],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,a,f){let g=!0,v=!!this.loaded[a];if(!v)for(let b of t)this.images[a][b]||(g=!1);v||g?this._notify(t,a,f):this.requestors.push({ids:t,scope:a,callback:f})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,a,f){let g={};for(let v of t){this.images[a][v]||this.fire(new i.x("styleimagemissing",{id:v}));let b=this.images[a][v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:i.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,g)}getPixelSize(t){let{width:a,height:f}=this.atlasImage[t];return{width:a,height:f}}getPattern(t,a,f){let g=this.patterns[a][t],v=this.getImage(t,a);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{let b={w:v.data.width+2*i.y,h:v.data.height+2*i.y,x:0,y:0},M=new i.I(b,v,i.y);this.patterns[a][t]={bin:b,position:M}}return this._updatePatternAtlas(a,f),this.patterns[a][t].position}bind(t,a){let f=t.gl,g=this.atlasTexture[a];g?this.dirty&&(g.update(this.atlasImage[a]),this.dirty=!1):(g=new i.T(t,this.atlasImage[a],f.RGBA8),this.atlasTexture[a]=g),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){let f=[];for(let M in this.patterns[t])f.push(this.patterns[t][M].bin);let{w:g,h:v}=i.z(f),b=this.atlasImage[t];b.resize({width:g||1,height:v||1});for(let M in this.patterns[t]){let{bin:A,position:O}=this.patterns[t][M],L=O.padding,N=A.x+L,z=A.y+L,j=this.images[t][M].data,q=j.width,W=j.height;L=L>1?L-1:L,i.r.copy(j,b,{x:0,y:0},{x:N,y:z},{width:q,height:W},a),i.r.copy(j,b,{x:0,y:W-L},{x:N,y:z-L},{width:q,height:L},a),i.r.copy(j,b,{x:0,y:0},{x:N,y:z+W},{width:q,height:L},a),i.r.copy(j,b,{x:q-L,y:0},{x:N-L,y:z},{width:L,height:W},a),i.r.copy(j,b,{x:0,y:0},{x:N+q,y:z},{width:L,height:W},a),i.r.copy(j,b,{x:q-L,y:W-L},{x:N-L,y:z-L},{width:L,height:L},a),i.r.copy(j,b,{x:0,y:W-L},{x:N+q,y:z-L},{width:L,height:L},a),i.r.copy(j,b,{x:0,y:0},{x:N+q,y:z+W},{width:L,height:L},a),i.r.copy(j,b,{x:q-L,y:0},{x:N-L,y:z+W},{width:L,height:L},a)}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,a){for(let f of t){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;let g=this.images[a][f];st(g)&&this.updateImage(f,a,g)}}}function nr(d){let t=d.key,a=d.value,f=d.valueSpec||{},g=d.objectElementValidators||{},v=d.style,b=d.styleSpec,M=[],A=i.B(a);if(A!=="object")return[new i.V(t,a,`object expected, ${A} found`)];for(let O in a){let L=O.split(".")[0],N;g[L]?N=g[L]:f[L]?N=In:g["*"]?N=g["*"]:f["*"]&&(N=In),N?M=M.concat(N({key:(t&&`${t}.`)+O,value:a[O],valueSpec:f[L]||f["*"],style:v,styleSpec:b,object:a,objectKey:O},a)):M.push(new i.A(t,a[O],`unknown property "${O}"`))}for(let O in f)g[O]||f[O].required&&f[O].default===void 0&&a[O]===void 0&&M.push(new i.V(t,a,`missing required property "${O}"`));return M}function us(d){let t=d.value,a=d.valueSpec,f=d.style,g=d.styleSpec,v=d.key,b=d.arrayElementValidator||In;if(i.B(t)!=="array")return[new i.V(v,t,`array expected, ${i.B(t)} found`)];if(a.length&&t.length!==a.length)return[new i.V(v,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new i.V(v,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let M={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(M.function=a.function),i.B(a.value)==="object"&&(M=a.value);let A=[];for(let O=0;O<t.length;O++)A=A.concat(b({array:t,arrayIndex:O,value:t[O],valueSpec:M,style:f,styleSpec:g,key:`${v}[${O}]`},!0));return A}function _n(d){let t=d.key,a=d.value,f=d.valueSpec,g=i.B(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new i.V(t,a,`number expected, ${g} found`)];if("minimum"in f){let v=f.minimum;if(i.B(f.minimum)==="array"&&(v=f.minimum[d.arrayIndex]),a<v)return[new i.V(t,a,`${a} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(i.B(f.maximum)==="array"&&(v=f.maximum[d.arrayIndex]),a>v)return[new i.V(t,a,`${a} is greater than the maximum value ${v}`)]}return[]}function Ki(d){let t=d.valueSpec,a=i.D(d.value.type),f,g,v,b={},M=a!=="categorical"&&d.value.property===void 0,A=!M,O=i.B(d.value.stops)==="array"&&i.B(d.value.stops[0])==="array"&&i.B(d.value.stops[0][0])==="object",L=nr({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(j){if(a==="identity")return[new i.V(j.key,j.value,'identity function may not have a "stops" property')];let q=[],W=j.value;return q=q.concat(us({key:j.key,value:W,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:N})),i.B(W)==="array"&&W.length===0&&q.push(new i.V(j.key,W,"array must have at least one stop")),q},default:function(j){return In({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return a==="identity"&&M&&L.push(new i.V(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||L.push(new i.V(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!i.F(d.valueSpec)&&L.push(new i.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(A&&!i.G(d.valueSpec)?L.push(new i.V(d.key,d.value,"property functions not supported")):M&&!i.H(d.valueSpec)&&L.push(new i.V(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!O||d.value.property!==void 0||L.push(new i.V(d.key,d.value,'"property" property is required')),L;function N(j){let q=[],W=j.value,Z=j.key;if(i.B(W)!=="array")return[new i.V(Z,W,`array expected, ${i.B(W)} found`)];if(W.length!==2)return[new i.V(Z,W,`array length 2 expected, length ${W.length} found`)];if(O){if(i.B(W[0])!=="object")return[new i.V(Z,W,`object expected, ${i.B(W[0])} found`)];if(W[0].zoom===void 0)return[new i.V(Z,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new i.V(Z,W,"object stop key must have value")];let X=i.D(W[0].zoom);if(typeof X!="number")return[new i.V(Z,W[0].zoom,"stop zoom values must be numbers")];if(v&&v>X)return[new i.V(Z,W[0].zoom,"stop zoom values must appear in ascending order")];X!==v&&(v=X,g=void 0,b={}),q=q.concat(nr({key:`${Z}[0]`,value:W[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:_n,value:z}}))}else q=q.concat(z({key:`${Z}[0]`,value:W[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},W));return i.J(i.K(W[1]))?q.concat([new i.V(`${Z}[1]`,W[1],"expressions are not allowed in function stops.")]):q.concat(In({key:`${Z}[1]`,value:W[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function z(j,q){let W=i.B(j.value),Z=i.D(j.value),X=j.value!==null?j.value:q;if(f){if(W!==f)return[new i.V(j.key,X,`${W} stop domain type must match previous stop domain type ${f}`)]}else f=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new i.V(j.key,X,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&a!=="categorical"){let ne=`number expected, ${W} found`;return i.G(t)&&a===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(j.key,X,ne)]}return a!=="categorical"||W!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?a!=="categorical"&&W==="number"&&typeof Z=="number"&&typeof g=="number"&&g!==void 0&&Z<g?[new i.V(j.key,X,"stop domain values must appear in ascending order")]:(g=Z,a==="categorical"&&Z in b?[new i.V(j.key,X,"stop domain values must be unique")]:(b[Z]=!0,[])):[new i.V(j.key,X,`integer expected, found ${String(Z)}`)]}}function To(d){let t=(d.expressionContext==="property"?i.L:i.M)(i.K(d.value),d.valueSpec);if(t.result==="error")return t.value.map(f=>new i.V(`${d.key}${f.key}`,d.value,f.message));let a=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new i.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!i.N(a))return[new i.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Ia(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!i.O(a,["zoom","feature-state"]))return[new i.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!i.Q(a))return[new i.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ia(d,t){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let g of t.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];let f=[];return d instanceof i.S&&a.has(d.name)?[new i.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(g=>{f.push(...Ia(g,t))}),f)}function Gs(d){let t=d.key,a=d.value,f=d.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(i.D(a))===-1&&g.push(new i.V(t,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(i.D(a))===-1&&g.push(new i.V(t,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function hl(d){return i.W(i.K(d.value))?To(i.C({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Qt(d)}function Qt(d){let t=d.value,a=d.key;if(i.B(t)!=="array")return[new i.V(a,t,`array expected, ${i.B(t)} found`)];let f=d.styleSpec,g,v=[];if(t.length<1)return[new i.V(a,t,"filter array must have at least 1 element")];switch(v=v.concat(Gs({key:`${a}[0]`,value:t[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),i.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.D(t[1])==="$type"&&v.push(new i.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new i.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=i.B(t[1]),g!=="string"&&v.push(new i.V(`${a}[1]`,t[1],`string expected, ${g} found`)));for(let b=2;b<t.length;b++)g=i.B(t[b]),i.D(t[1])==="$type"?v=v.concat(Gs({key:`${a}[${b}]`,value:t[b],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new i.V(`${a}[${b}]`,t[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)v=v.concat(Qt({key:`${a}[${b}]`,value:t[b],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":g=i.B(t[1]),t.length!==2?v.push(new i.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new i.V(`${a}[1]`,t[1],`string expected, ${g} found`))}return v}function dl(d,t){let a=d.key,f=d.style,g=d.layer,v=d.styleSpec,b=d.value,M=d.objectKey,A=v[`${t}_${d.layerType}`];if(!A)return[];let O=M.match(/^(.*)-transition$/);if(t==="paint"&&O&&A[O[1]]&&A[O[1]].transition)return In({key:a,value:b,valueSpec:v.transition,style:f,styleSpec:v});let L=d.valueSpec||A[M];if(!L)return[new i.A(a,b,`unknown property "${M}"`)];let N;if(i.B(b)==="string"&&i.G(L)&&!L.tokens&&(N=/^{([^}]+)}$/.exec(b))){let j=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new i.V(a,b,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let z=[];if(d.layerType==="symbol")M!=="text-field"||!f||f.glyphs||f.imports||z.push(new i.V(a,b,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&i.X(i.K(b))&&i.D(b.type)==="identity"&&z.push(new i.V(a,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&i.G(L)&&(i.Y(L)||i.H(L))){let j=i.L(i.K(b),L),q=j.value.expression||j.value._styleExpression.expression;q&&!i.O(q,["measure-light"])&&(M==="model-emissive-strength"&&i.Q(q)&&i.N(q)||z.push(new i.V(a,b,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(In({key:d.key,value:b,valueSpec:L,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:M}))}function hs(d){return dl(d,"paint")}function Ca(d){return dl(d,"layout")}function mr(d){let t=[],a=d.value,f=d.key,g=d.style,v=d.styleSpec;a.type||a.ref||t.push(new i.V(f,a,'either "type" or "ref" is required'));let b=i.D(a.type),M=i.D(a.ref);if(a.id){let A=i.D(a.id);for(let O=0;O<d.arrayIndex;O++){let L=g.layers[O];i.D(L.id)===A&&t.push(new i.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${L.id.__line__}`))}}if("ref"in a){let A;["type","source","source-layer","filter","layout"].forEach(O=>{O in a&&t.push(new i.V(f,a[O],`"${O}" is prohibited for ref layers`))}),g.layers.forEach(O=>{i.D(O.id)===M&&(A=O)}),A?A.ref?t.push(new i.V(f,a.ref,"ref cannot reference another ref layer")):b=i.D(A.type):typeof M=="string"&&t.push(new i.V(f,a.ref,`ref layer "${M}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(a.source){let A=g.sources&&g.sources[a.source],O=A&&i.D(A.type);A?O==="vector"&&b==="raster"?t.push(new i.V(f,a.source,`layer "${a.id}" requires a raster source`)):O==="raster"&&b!=="raster"?t.push(new i.V(f,a.source,`layer "${a.id}" requires a vector source`)):O!=="vector"||a["source-layer"]?O==="raster-dem"&&b!=="hillshade"?t.push(new i.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||O==="geojson"&&A.lineMetrics?b==="raster-particle"&&O!=="raster-array"&&t.push(new i.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new i.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new i.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new i.V(f,a.source,`source "${a.source}" not found`))}else t.push(new i.V(f,a,'missing required property "source"'));return t=t.concat(nr({key:f,value:a,valueSpec:v.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>In({key:`${f}.type`,value:a.type,valueSpec:v.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:A=>hl(i.C({layerType:b},A)),layout:A=>nr({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>Ca(i.C({layerType:b},O))}}),paint:A=>nr({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>hs(i.C({layerType:b,layer:a},O))}})}})),t}function qr(d){let t=d.value,a=d.key,f=i.B(t);return f!=="string"?[new i.V(a,t,`string expected, ${f} found`)]:[]}let Vc={promoteId:function({key:d,value:t}){if(i.B(t)==="string")return qr({key:d,value:t});{let a=[];for(let f in t)a.push(...qr({key:`${d}.${f}`,value:t[f]}));return a}}};function jc(d){let t=d.value,a=d.key,f=d.styleSpec,g=d.style;if(!t.type)return[new i.V(a,t,'"type" is required')];let v=i.D(t.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(t.url||t.tiles||b.push(new i.A(a,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(nr({key:a,value:t,valueSpec:f[`source_${v.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Vc})),b;case"geojson":if(b=nr({key:a,value:t,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:Vc}),t.cluster)for(let M in t.clusterProperties){let[A,O]=t.clusterProperties[M],L=typeof A=="string"?[A,["accumulated"],["get",M]]:A;b.push(...To({key:`${a}.${M}.map`,value:O,expressionContext:"cluster-map"})),b.push(...To({key:`${a}.${M}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return b;case"video":return nr({key:a,value:t,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return nr({key:a,value:t,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new i.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gs({key:`${a}.type`,value:t.type,valueSpec:{values:fl(f)},style:g,styleSpec:f})}}function fl(d){return d.source.reduce((t,a)=>{let f=d[a];return f.type.type==="enum"&&(t=t.concat(Object.keys(f.type.values))),t},[])}function ds(d){let t=d.value,a=d.styleSpec,f=a.light,g=d.style,v=[],b=i.B(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new i.V("light",t,`object expected, ${b} found`)]),v;for(let M in t){let A=M.match(/^(.*)-transition$/);v=v.concat(A&&f[A[1]]&&f[A[1]].transition?In({key:M,value:t[M],valueSpec:a.transition,style:g,styleSpec:a}):f[M]?In({key:M,value:t[M],valueSpec:f[M],style:g,styleSpec:a}):[new i.V(M,t[M],`unknown property "${M}"`)])}return v}function Da(d){let t=d.value,a=[];if(!t)return a;let f=i.B(t);if(f!=="object")return a=a.concat([new i.V("light-3d",t,`object expected, ${f} found`)]),a;let g=d.styleSpec,v=g["light-3d"],b=d.key,M=d.style,A=d.style.lights;for(let N of["type","id"])if(!(N in t))return a=a.concat([new i.V("light-3d",t,`missing property ${N} on light`)]),a;if(t.type&&A)for(let N=0;N<d.arrayIndex;N++){let z=i.D(t.type),j=A[N];i.D(j.type)===z&&a.push(new i.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}let O=`properties_light_${t.type}`;if(!(O in g))return a=a.concat([new i.V("light-3d",t,`Invalid light type ${t.type}`)]),a;let L=g[O];for(let N in t)if(N==="properties"){let z=t[N],j=i.B(z);if(j!=="object")return a=a.concat([new i.V("properties",z,`object expected, ${j} found`)]),a;for(let q in z)a=a.concat(L[q]?In({key:q,value:z[q],valueSpec:L[q],style:M,styleSpec:g}):[new i.A(d.key,z[q],`unknown property "${q}"`)])}else{let z=N.match(/^(.*)-transition$/);a=a.concat(z&&v[z[1]]&&v[z[1]].transition?In({key:N,value:t[N],valueSpec:g.transition,style:M,styleSpec:g}):v[N]?In({key:N,value:t[N],valueSpec:v[N],style:M,styleSpec:g}):[new i.A(N,t[N],`unknown property "${N}"`)])}return a}function pl(d){let t=d.value,a=d.key,f=d.style,g=d.styleSpec,v=g.terrain,b=[],M=i.B(t);if(t===void 0||M==="null")return b;if(M!=="object")return b=b.concat([new i.V("terrain",t,`object expected, ${M} found`)]),b;for(let A in t){let O=A.match(/^(.*)-transition$/);b=b.concat(O&&v[O[1]]&&v[O[1]].transition?In({key:A,value:t[A],valueSpec:g.transition,style:f,styleSpec:g}):v[A]?In({key:A,value:t[A],valueSpec:v[A],style:f,styleSpec:g}):[new i.A(A,t[A],`unknown property "${A}"`)])}if(t.source){let A=f.sources&&f.sources[t.source],O=A&&i.D(A.type);A?O!=="raster-dem"&&b.push(new i.V(a,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):b.push(new i.V(a,t.source,`source "${t.source}" not found`))}else b.push(new i.V(a,t,'terrain is missing required property "source"'));return b}function co(d){let t=d.value,a=d.style,f=d.styleSpec,g=f.fog,v=[],b=i.B(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new i.V("fog",t,`object expected, ${b} found`)]),v;for(let M in t){let A=M.match(/^(.*)-transition$/);v=v.concat(A&&g[A[1]]&&g[A[1]].transition?In({key:M,value:t[M],valueSpec:f.transition,style:a,styleSpec:f}):g[M]?In({key:M,value:t[M],valueSpec:g[M],style:a,styleSpec:f}):[new i.A(M,t[M],`unknown property "${M}"`)])}return v}let Uc={"*":()=>[],array:us,boolean:function(d){let t=d.value,a=d.key,f=i.B(t);return f!=="boolean"?[new i.V(a,t,`boolean expected, ${f} found`)]:[]},number:_n,color:function(d){let t=d.key,a=d.value,f=i.B(a);return f!=="string"?[new i.V(t,a,`color expected, ${f} found`)]:i.U.parseCSSColor(a)===null?[new i.V(t,a,`color expected, "${a}" found`)]:[]},enum:Gs,filter:hl,function:Ki,layer:mr,object:nr,source:jc,model:i.Z,light:ds,"light-3d":Da,terrain:pl,fog:co,string:qr,formatted:function(d){return qr(d).length===0?[]:To(d)},resolvedImage:function(d){return qr(d).length===0?[]:To(d)},projection:function(d){let t=d.value,a=d.styleSpec,f=a.projection,g=d.style,v=[],b=i.B(t);if(b==="object")for(let M in t)v=v.concat(In({key:M,value:t[M],valueSpec:f[M],style:g,styleSpec:a}));else b!=="string"&&(v=v.concat([new i.V("projection",t,`object or string expected, ${b} found`)]));return v},import:function(d){let{value:t,styleSpec:a}=d,b=t,{data:f}=b,g=oy(b,["data"]);Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let v=nr(i.C({},d,{value:g,valueSpec:a.import}));return i.D(g.id)===""&&v.push(new i.V(`${d.key}.id`,g,"import id can't be an empty string")),f&&(v=v.concat(rh(f,a,{key:`${d.key}.data`}))),v}};function In(d,t=!1){let a=d.value,f=d.valueSpec,g=d.styleSpec;if(f.expression&&i.X(i.D(a)))return Ki(d);if(f.expression&&i.J(i.K(a)))return To(d);if(f.type&&Uc[f.type]){let v=Uc[f.type](d);return t===!0&&v.length>0&&i.B(d.value)==="array"?To(d):v}return nr(i.C({},d,{valueSpec:f.type?g[f.type]:f}))}function jo(d){let t=d.value,a=d.key,f=qr(d);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new i.V(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new i.V(a,t,'"glyphs" url must include a "{range}" token'))),f}function rh(d,t=i._,a={}){return In({key:a.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:jo,"*":()=>[]}})}function Wr(d,t=i._){return me(rh(d,t))}let Ma=d=>me(jc(d)),$c=d=>me(ds(d)),ml=d=>me(Da(d)),Gc=d=>me(pl(d)),Sa=d=>me(co(d)),ke=d=>me(mr(d)),Y=d=>me(hl(d)),J=d=>me(hs(d)),ce=d=>me(Ca(d)),_e=d=>me(i.Z(d));function me(d){return d.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function Ce(d,t){let a=!1;if(t&&t.length)for(let f of t)f instanceof i.A?i.w(f.message):(d.fire(new i.t(new Error(f.message))),a=!0);return a}let Le;class Ae extends i.E{constructor(t,a="flat"){super(),this._transitionable=new i.$(Le||(Le=new i.a0({anchor:new i.a1(i._.light.anchor),position:new i.a2(i._.light.position),color:new i.a1(i._.light.color),intensity:new i.a1(i._.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,f={}){this._validate($c,t,f)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,f){return(!f||f.validate!==!1)&&Ce(this,t.call(Wr,i.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i._})))}}let Fe=new i.a0({source:new i.a1(i._.terrain.source),exaggeration:new i.a1(i._.terrain.exaggeration)}),$e=class extends i.E{constructor(d,t,a,f){super(),this.scope=a,this._transitionable=new i.$(Fe,a,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new i.a3(d)).get("exaggeration")}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof i.a4}},Ve=45,Qe=65,ht=.05;function dt(d,t,a,f){let g=i.a7(Ve,Qe,a),[v,b]=Vt(d,f),M=1-Math.min(1,Math.exp((t-v)/(b-v)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*g*d.alpha}function Vt(d,t){let a=.5/Math.tan(.5*t);return[d.range[0]+a,d.range[1]+a]}function $t(d,t,a,f,g){let v=i.a6.vec3.transformMat4([],[t,a,f],g.mercatorFogMatrix);return dt(d,i.a6.vec3.length(v),g.pitch,g._fov)}function Ht(d,t,a,f,g,v,b){let M=[[a,f,0],[g,f,0],[g,v,0],[a,v,0]],A=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let L of M){let N=i.a6.vec3.transformMat4([],L,t),z=i.a6.vec3.length(N);A=Math.min(A,z),O=Math.max(O,z)}return[dt(d,A,b.pitch,b._fov),dt(d,O,b.pitch,b._fov)]}let Gt=new i.a0({range:new i.a1(i._.fog.range),color:new i.a1(i._.fog.color),"high-color":new i.a1(i._.fog["high-color"]),"space-color":new i.a1(i._.fog["space-color"]),"horizon-blend":new i.a1(i._.fog["horizon-blend"]),"star-intensity":new i.a1(i._.fog["star-intensity"]),"vertical-range":new i.a1(i._.fog["vertical-range"])});class Ln extends i.E{constructor(t,a,f,g){super(),this._transitionable=new i.$(Gt,f,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new i.a8(Gt),this.scope=f}get state(){let t=this._transform,a=t.projection.name==="globe",f=i.a9(t.zoom),g=this.properties.get("range"),v=[.5,3];return{range:a?[i.aa(v[0],g[0],f),i.aa(v[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,f={}){if(this._validate(Sa,t,f))return;let g=i.l({},t);for(let v of Object.keys(i._.fog))g[v]===void 0&&(g[v]=i._.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.a7(Ve,Qe,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(f,g,v){let b=i.a5.fromLngLat(g),M=v.elevation?v.elevation.getAtPointOrZero(b):0;return $t(f,b.x,b.y,M,v)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ht(this.state,a,0,0,i.ab,i.ab,this._transform)}getOpacityForBounds(t,a,f,g,v){return this._transform.projection.supportsFog?Ht(this.state,t,a,f,g,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Vt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let f of a){let g=t.points[f],v;if(g[2]>=0)v=g;else{let b=t.points[f-4];v=i.ac(b,g,b[2]/(b[2]-g[2]))}if($t(this.state,v[0],v[1],0,this._transform)>=ht)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,f){return(!f||f.validate!==!1)&&Ce(this,t.call(Wr,i.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i._})))}}class Un extends i.E{constructor(t,a,f,g){super(),this.scope=f,this._options=t,this.properties=new i.a8(a),this._transitionable=new i.$(a,f,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let nn,Vn;class pi{constructor(t,a,f,g){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,a){let f,g;if(t instanceof i.P||typeof t[0]=="number"){let v=i.P.convert(t);f=[v],g=a.isPointAboveHorizon(v)}else{let v=i.P.convert(t[0]),b=i.P.convert(t[1]);f=[v,b],g=i.ae(v,b).every(M=>a.isPointAboveHorizon(M))}return new pi(f,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.ae(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),i.af(g,t)}bufferedCameraGeometryGlobe(t){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.ae(a,f,t),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>f.y))+((v.x>a.x)+(v.x>f.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(t,a,f,g=0){let v=t.queryPadding/a._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a),M=t.tileID.wrap+(b.unwrapped?g:0),A=b.polygon.map(Z=>i.ag(t.tileTransform,Z,M));if(!i.ah(A,0,0,i.ab,i.ab))return;M=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let O=this.screenGeometryMercator.polygon.map(Z=>i.ai(t.tileTransform,Z,M)),L=O.map(Z=>new i.P(Z[0],Z[1])),N=a.getFreeCameraOptions().position||new i.a5(0,0,0),z=i.ai(t.tileTransform,N,M),j=O.map(Z=>{let X=i.a6.vec3.sub(Z,Z,z);return i.a6.vec3.normalize(X,X),new i.aj(z,X)}),q=i.ak(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(W=i.al(A),W.min.x=i.ap(W.min.x,0,i.ab),W.min.y=i.ap(W.min.y,0,i.ab),W.max.x=i.ap(W.max.x,0,i.ab),W.max.y=i.ap(W.max.y,0,i.ab),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var W}_bufferedScreenMercator(t,a){let f=ir(t);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(t,a){let f=ir(t);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(t,a){let f=function(v,b){let M=i.a6.mat4.multiply([],b.pixelMatrix,b.globeMatrix),A=[0,-i.aq,0,1],O=[0,i.aq,0,1],L=[0,0,0,1];i.a6.vec4.transformMat4(A,A,M),i.a6.vec4.transformMat4(O,O,M),i.a6.vec4.transformMat4(L,L,M);let N=new i.P(A[0]/A[3],A[1]/A[3]),z=new i.P(O[0]/O[3],O[1]/O[3]),j=i.an(v,N)&&A[3]<L[3],q=i.an(v,z)&&O[3]<L[3];if(!j&&!q)return null;let W=function(fe,he,pe){for(let we=1;we<fe.length;we++){let ye=Ui(he.pointCoordinate3D(fe[we-1]).x),ge=Ui(he.pointCoordinate3D(fe[we]).x);if(pe<0){if(ye<ge)return{idx:we,t:-ye/(ge-1-ye)}}else if(ge<ye)return{idx:we,t:(1-ye)/(ge+1-ye)}}return null}(v,b,j?-1:1);if(!W)return null;let{idx:Z,t:X}=W,ne=Z>1?Bi(v.slice(0,Z),b):[],oe=Z<v.length?Bi(v.slice(Z),b):[];ne=ne.map(fe=>new i.P(Ui(fe.x),fe.y)),oe=oe.map(fe=>new i.P(Ui(fe.x),fe.y));let ee=[...ne];ee.length===0&&ee.push(oe[oe.length-1]);let le=i.aa(ee[ee.length-1].y,(oe.length===0?ne[0]:oe[0]).y,X),ae;return ae=j?[new i.P(0,le),new i.P(0,0),new i.P(1,0),new i.P(1,le)]:[new i.P(1,le),new i.P(1,1),new i.P(0,1),new i.P(0,le)],ee.push(...ae),oe.length===0?ee.push(ne[0]):ee.push(...oe),{polygon:ee.map(fe=>new i.a5(fe.x,fe.y)),unwrapped:!1}}(t,a);if(f)return f;let g=function(v,b){let M=!1,A=-1/0,O=0;for(let N=0;N<v.length-1;N++)v[N].x>A&&(A=v[N].x,O=N);for(let N=0;N<v.length-1;N++){let z=(O+N)%(v.length-1),j=v[z],q=v[z+1];Math.abs(j.x-q.x)>.5&&(j.x<q.x?(j.x+=1,z===0&&(v[v.length-1].x+=1)):(q.x+=1,z+1===v.length-1&&(v[0].x+=1)),M=!0)}let L=i.am(b.center.lng);return M&&L<Math.abs(L-1)&&v.forEach(N=>{N.x-=1}),{polygon:v,unwrapped:M}}(Bi(t,a).map(v=>new i.P(Ui(v.x),v.y)),a);return{polygon:g.polygon.map(v=>new i.a5(v.x,v.y)),unwrapped:g.unwrapped}}}function Bi(d,t){return i.ao(d,a=>{let f=t.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function Ui(d){return d<0?1+d%1:d%1}function ir(d){return 100*d|0}function Eo(d,t,a,f,g){let v=function(M,A){if(M)return g(M);if(A){if(d.url&&A.tiles&&d.tiles&&delete d.tiles,A.variants){if(!Array.isArray(A.variants))return g(new Error("variants must be an array"));for(let L of A.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return g(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){A=i.l(A,L);break}}}let O=i.ar(i.l(A,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(O.vectorLayers=A.vector_layers,O.vectorLayerIds=O.vectorLayers.map(L=>L.id)),A.raster_layers&&(O.rasterLayers=A.raster_layers,O.rasterLayerIds=O.rasterLayers.map(L=>L.id)),O.tiles=t.canonicalizeTileset(O,d.url),g(null,O)}},b=function(M,A,O){if(!M)return null;if(!A&&!O)return M;O=O||M.worldview_default;let L=Object.values(M.language||{});if(L.length===0)return null;let N=Object.values(M.worldview||{});if(N.length===0)return null;let z=L.every(q=>q===A),j=N.every(q=>q===O);return z&&j?M:A in(M.language_options||{})||O in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(d.data,a,f);return b?i.q.frame(()=>v(null,b)):d.url?i.n(t.transformRequest(t.normalizeSourceURL(d.url,null,a,f),i.R.Source),v):i.q.frame(()=>{let O=d,{data:M}=O,A=oy(O,["data"]);v(null,A)})}class fs{constructor(t,a,f){this.bounds=i.as.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let a=Math.pow(2,t.z),f=Math.floor(i.am(this.bounds.getWest())*a),g=Math.floor(i.at(this.bounds.getNorth())*a),v=Math.ceil(i.am(this.bounds.getEast())*a),b=Math.ceil(i.at(this.bounds.getSouth())*a);return t.x>=f&&t.x<v&&t.y>=g&&t.y<b}}class oh extends i.E{constructor(t,a,f,g){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.ar(a,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new i.au}load(t){this._loaded=!1,this.fire(new i.x("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Eo(this._options,this.map._requestManager,a,f,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.t(g))):v&&(i.l(this,v),v.bounds&&(this.tileBounds=new fs(v.bounds,this.minzoom,this.maxzoom)),cl(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=i.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(t,a){let f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),g=this.map._requestManager.transformRequest(f,i.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,b={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,lut:v?{image:v.image.clone()}:null,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(b.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",b,M.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",b,M.bind(this),void 0,!0);else{let A=i.aw.call({deduped:this._deduped},b,(O,L)=>{O||!L?M.call(this,O):(b.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},t.actor&&t.actor.send("loadTile",b,M.bind(this),void 0,!0))},!0);t.request={cancel:A}}function M(A,O){return delete t.request,t.aborted?a(null):A&&A.status!==404?a(A):(O&&O.resourceTiming&&(t.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&t.setExpiryData(O),t.loadVectorData(O,this.map.painter),i.ax(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Hc extends i.E{constructor(t,a,f,g){super(),this.id=t,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},a),i.l(this,i.ar(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Eo(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new i.t(a)):f&&(i.l(this,f),f.bounds&&(this.tileBounds=new fs(f.bounds,this.minzoom,this.maxzoom)),cl(f.tiles),this.fire(new i.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=i.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){let f=i.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);t.request=i.o(this.map._requestManager.transformRequest(g,i.R.Tile),(v,b,M,A)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):v?(t.state="errored",a(v)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:A}),t.setTexture(b,this.map.painter),t.state="loaded",i.ax(this.dispatcher),void a(null)):a(null)))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof i.T?(t.destroy(!0),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gl extends Hc{constructor(t,a,f,g){super(t,a,f,g),this.type="raster-array",this.maxzoom=22,this._options=i.l({type:"raster-array"},a)}triggerRepaint(t){let a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){let f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,i.R.Tile);t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(v,b,M,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(v)return v.code===20?void 0:(t.state="errored",a(v));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:A}),t.state="empty",a(null)})}unloadTile(t,a){let f=t.texture;f&&f instanceof i.T?(t.destroy(!0),this.map.painter.saveTileTexture(f)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,a,f){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(a,f,(g,v)=>{if(g)return t.state="errored",this.fire(new i.t(g)),void this.triggerRepaint(t);v&&(t.setTexture(v,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:v})=>v===t),f=a&&a.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(t,a,f){if(!t)return;let g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;a instanceof i.aB?v=a.paint.get("raster-array-band"):a instanceof i.aC&&(v=a.paint.get("raster-particle-array-band"));let b=v||this.getInitialBand(g);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,b)||f)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,b)}}let sh={vector:oh,raster:Hc,"raster-dem":class extends Hc{constructor(d,t,a,f){super(d,t,a,f),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){let a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,v){g&&(d.state="errored",t(g)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=i.o(this.map._requestManager.transformRequest(a,i.R.Tile),function(g,v,b,M){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(g)d.state="errored",t(g);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:M});let A=ImageBitmap&&v instanceof ImageBitmap&&i.ay(),O=1-(v.width-i.az(v.width))/2;O<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let L=A?v:i.q.getImageData(v,O),N={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:O};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",N,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){let t=d.canonical,a=Math.pow(2,t.z),f=(t.x-1+a)%a,g=t.x===0?d.wrap-1:d.wrap,v=(t.x+1+a)%a,b=t.x+1===a?d.wrap+1:d.wrap,M={};return M[new i.aA(d.overscaledZ,g,t.z,f,t.y).key]={backfilled:!1},M[new i.aA(d.overscaledZ,b,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(M[new i.aA(d.overscaledZ,g,t.z,f,t.y-1).key]={backfilled:!1},M[new i.aA(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},M[new i.aA(d.overscaledZ,b,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<a&&(M[new i.aA(d.overscaledZ,g,t.z,f,t.y+1).key]={backfilled:!1},M[new i.aA(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},M[new i.aA(d.overscaledZ,b,t.z,v,t.y+1).key]={backfilled:!1}),M}},"raster-array":gl,geojson:class extends i.E{constructor(d,t,a,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=t.data,this._options=i.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let g=i.ab/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:i.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new i.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new i.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let a of this._data.features)t.set(a.id,a);for(let a of d.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:a},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.x("dataloading",{dataType:"source"})),this._loaded=!1;let t=i.l({append:d},this.workerOptions);t.scope=this.scope;let a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(i.q.resolveURL(a),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(f,g)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.t(f));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new i.x("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,t){let a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,g=this._partialReload,v={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f?{image:f.image.clone()}:null,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:g};d.request=this.actor.send(a,v,(b,M)=>g&&!M?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):b?t(b):(d.loadVectorData(M,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aD{constructor(d,t,a,f){super(d,t,a,f),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aE(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new i.t(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new i.t(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aD,model:class extends i.E{constructor(d,t,a,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let d=[];for(let t in this._options.models){let a=this._options.models[t],f=i.aG(this.map._requestManager.transformRequest(a.uri,i.R.Model).url).then(g=>{if(!g)return;let v=i.aH(g),b=new i.aI(t,a.position,a.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new i.t(new Error(`Could not load model ${t} from ${a.uri}: ${g.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new i.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new i.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(d,t,a,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new i.x("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=Eo(this._options,this.map._requestManager,t,a,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new i.t(f))):g&&(i.l(this,g),g.bounds&&(this.tileBounds=new fs(g.bounds,this.minzoom,this.maxzoom)),cl(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.x("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){let a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,i.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){let v=Object.values(d.buckets);for(let b of v)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(v,b){return d.aborted?t(null):v&&v.status!==404?t(v):(b&&(b.resourceTiming&&(d.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(b),d.buckets=St(St({},d.buckets),b.buckets),b.featureIndex&&(d.latestFeatureIndex=b.featureIndex)),d.state="loaded",void t(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aD{constructor(d,t,a,f){super(d,t,a,f),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new i.t(new i.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.t(new i.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.t(new i.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.t(new i.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.t(new i.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof i.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.E{constructor(d,t,a,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new i.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:t,y:a,z:f}=d.canonical;return this._implementation.hasTile({x:t,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){let{x:a,y:f,z:g}=d.tileID.canonical,v=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:g},{signal:v.signal})).then(function(b){return delete d.request,d.aborted?(d.state="unloaded",t(null)):b===void 0?(d.state="errored",t(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(b)?(this.loadTileData(d,b),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(b=>{b.code!==20&&(d.state="errored",t(b))}),d.request.cancel=()=>v.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof i.T?(d.destroy(!0),d.texture&&d.texture instanceof i.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:a,y:f,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:g})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=i.av(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new i.x("data",{dataType:"source",sourceDataType:"content"}))}}},_l=function(d,t,a,f){let g=new sh[t.type](d,t,a,f);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return i.aJ(["load","abort","unload","serialize","prepare"],g),g};function xf(d,t){let a=i.a6.mat4.identity([]);return i.a6.mat4.scale(a,a,[.5*d.width,.5*-d.height,1]),i.a6.mat4.translate(a,a,[1,-1,0]),i.a6.mat4.multiply(a,a,d.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(a)}function bf(d,t,a,f,g,v,b,M=!1){let A=d.tilesIn(f,b,M);A.sort(yl);let O=[];for(let N of A)O.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,a,d._state,N,g,v,xf(d.transform,N.tile.tileID),M)});let L=function(N){let z={},j={};for(let q of N){let W=q.queryResults,Z=q.wrappedTileID,X=j[Z]=j[Z]||{};for(let ne in W){let oe=W[ne],ee=X[ne]=X[ne]||{},le=z[ne]=z[ne]||[];for(let ae of oe)ee[ae.featureIndex]||(ee[ae.featureIndex]=!0,le.push(ae))}}return z}(O);for(let N in L)L[N].forEach(z=>{let j=z.feature,q=j.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(j.source=q.source,q["source-layer"]&&(j.sourceLayer=q["source-layer"]),j.state=j.id!==void 0?d.getFeatureState(q["source-layer"],j.id):{})});return L}function qc(d,t){let a=d.getRenderableIds().map(v=>d.getTileByID(v)),f=[],g={};for(let v=0;v<a.length;v++){let b=a[v],M=b.tileID.canonical.key;g[M]||(g[M]=!0,b.querySourceFeatures(f,t))}return f}function yl(d,t){let a=d.tileID,f=t.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}let uo=32,Io=33,Co=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,a=0,f=0,g=0,v=0,b=0,M=0;for(1&t?g=v=b=uo:a=f=M=uo;(t>>=1)>1;){let O=a+g>>1,L=f+v>>1;1&t?(g=a,v=f,a=b,f=M):(a=g,f=v,g=b,v=M),b=O,M=L}let A=4*d;Co[A+0]=a,Co[A+1]=f,Co[A+2]=g,Co[A+3]=v}let kr=new Uint16Array(2178),Uo=new Uint8Array(1089),Wc=new Uint16Array(1089);function wf(d){return d===0?-.03125:d===32?.03125:0}let Tf={type:2,extent:i.ab,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ab+1,0),new i.P(i.ab+1,i.ab+1),new i.P(0,i.ab+1),new i.P(0,0)]]};class $o{constructor(t,a,f,g,v){this.tileID=t,this.uid=i.aP(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(t){let a=t+this.timeAdded;a<i.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,f){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(g,v){let b={};if(!v)return b;for(let M of g){let A=M.layerIds.map(O=>v.getLayer(O)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(O=>A.filter(L=>L.id===O)[0]));for(let O of A)b[O.fqid]=M}}return b}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aR){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aR&&v.hasRTLText){this.hasRTLText=!0,i.aS();break}}this.queryPadding=0;for(let g in this.buckets){let v=this.buckets[g],b=a.style.getOwnLayer(g);if(!b)continue;let M=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,M)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.aQ}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let g in this.buckets){let v=this.buckets[g];v.uploadPending()&&v.upload(t)}let a=t.gl,f=this.imageAtlas;if(f&&!f.uploaded){let g=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new i.T(t,f.image,a.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(a)))}queryRenderedFeatures(t,a,f,g,v,b,M,A){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:M,transform:b,params:v,tileTransform:this.tileTransform},t,a,f):{}}querySourceFeatures(t,a){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let g=f.loadVTLayers(),v=a?a.sourceLayer:"",b=g._geojsonTileLayer||g[v];if(!b)return;let M=i.aT(a&&a.filter),{z:A,x:O,y:L}=this.tileID.canonical,N={z:A,x:O,y:L};for(let z=0;z<b.length;z++){let j=b.feature(z);if(M.needGeometry){let Z=i.aU(j,!0);if(!M.filter(new i.a3(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!M.filter(new i.a3(this.tileID.overscaledZ),j))continue;let q=f.getId(j,v),W=new i.aV(j,A,O,L,q);W.tile=N,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let a=this.expirationTime;if(t.cacheControl){let f=i.aW(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let f=Date.now(),g=!1;if(this.expirationTime>f)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{let v=this.expirationTime-a;v?this.expirationTime=f+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&a&&this.updateBuckets(a)}updateBuckets(t){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),f=t.style.listImages(),g=t.style.getBrightness();for(let v in this.buckets){if(!t.style.hasLayer(v))continue;let b=this.buckets[v],M=b.layers[0].sourceLayer||"_geojsonTileLayer",A=a[M],O=t.style.getOwnSourceCache(b.layers[0].source),L={};O&&(L=O._state.getState(M,void 0)),b.update(L,A,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),(b instanceof i.aX||b instanceof i.aY)&&t._terrain&&t._terrain.enabled&&O&&b.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(O.id,this.tileID);let N=t&&t.style&&t.style.getOwnLayer(v);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.q.now()+t}setTexture(t,a){let f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(f,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,a){let f={};for(let g of a)f[g]=!0;this.dependencies[t]=f}hasDependency(t,a){for(let f of t){let g=this.dependencies[f];if(g){for(let v of a)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;let f=i.aZ(Tf,this.tileID.canonical,this.tileTransform)[0],g=new i.a_,v=new i.a$;for(let b=0;b<f.length;b++){let{x:M,y:A}=f[b];g.emplaceBack(M,A),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(g,i.b0.members),this._tileDebugSegments=i.b1.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;let f=i.aZ(Tf,this.tileID.canonical,this.tileTransform)[0],g,v;if(this.isRaster){let b=function(M,A){let O=i.aK(M,A),L=Math.pow(2,M.z);for(let Z=0;Z<Io;Z++)for(let X=0;X<Io;X++){let ne=i.aL((M.x+(X+wf(X))/uo)/L),oe=i.aM((M.y+(Z+wf(Z))/uo)/L),ee=A.project(ne,oe),le=Z*Io+X;kr[2*le+0]=Math.round((ee.x*O.scale-O.x)*i.ab),kr[2*le+1]=Math.round((ee.y*O.scale-O.y)*i.ab)}Uo.fill(0),Wc.fill(0);for(let Z=2045;Z>=0;Z--){let X=4*Z,ne=Co[X+0],oe=Co[X+1],ee=Co[X+2],le=Co[X+3],ae=ne+ee>>1,fe=oe+le>>1,he=ae+fe-oe,pe=fe+ne-ae,we=oe*Io+ne,ye=le*Io+ee,ge=fe*Io+ae,Me=Math.hypot((kr[2*we+0]+kr[2*ye+0])/2-kr[2*ge+0],(kr[2*we+1]+kr[2*ye+1])/2-kr[2*ge+1])>=16;Uo[ge]=Uo[ge]||(Me?1:0),Z<1022&&(Uo[ge]=Uo[ge]||Uo[(oe+pe>>1)*Io+(ne+he>>1)]||Uo[(le+pe>>1)*Io+(ee+he>>1)])}let N=new i.aN,z=new i.aO,j=0;function q(Z,X){let ne=X*Io+Z;return Wc[ne]===0&&(N.emplaceBack(kr[2*ne+0],kr[2*ne+1],Z*i.ab/uo,X*i.ab/uo),Wc[ne]=++j),Wc[ne]-1}function W(Z,X,ne,oe,ee,le){let ae=Z+ne>>1,fe=X+oe>>1;if(Math.abs(Z-ee)+Math.abs(X-le)>1&&Uo[fe*Io+ae])W(ee,le,Z,X,ae,fe),W(ne,oe,ee,le,ae,fe);else{let he=q(Z,X),pe=q(ne,oe),we=q(ee,le);z.emplaceBack(he,pe,we)}}return W(0,0,uo,uo,uo,0),W(uo,uo,0,0,0,uo),{vertices:N,indices:z}}(this.tileID.canonical,a);g=b.vertices,v=b.indices}else{g=new i.aN,v=new i.aO;for(let{x:M,y:A}of f)g.emplaceBack(M,A,0,0);let b=i.b2(g.int16,void 0,4);for(let M=0;M<b.length;M+=3)v.emplaceBack(b[M],b[M+1],b[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,i.b3.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=i.b1.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(t,a){let f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;let g=this.tileID.canonical,v=i.b4(g,a),b=i.b5(v),M=i.a9(a.zoom),A;M>0&&(A=i.a6.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,a,b,A,M),this._makeGlobeTileDebugTextBuffer(t,g,a,b,A,M)}_globePoint(t,a,f,g,v,b,M){let A=i.b6(t,a,f);if(b){let O=1<<f.z,L=i.am(g.center.lng),N=i.at(g.center.lat),z=(f.x+.5)/O-L,j=0;z>.5?j=-1:z<-.5&&(j=1);let q=(t/i.ab+f.x)/O+j,W=(a/i.ab+f.y)/O;q=(q-L)*g._pixelsPerMercatorPixel+L,W=(W-N)*g._pixelsPerMercatorPixel+N;let Z=[q*g.worldSize,W*g.worldSize,0];i.a6.vec3.transformMat4(Z,Z,b),A=i.b7(A,Z,M)}return i.a6.vec3.transformMat4(A,A,v)}_makeGlobeTileDebugBorderBuffer(t,a,f,g,v,b){let M=new i.a_,A=new i.a$,O=new i.b8,L=(z,j,q,W,Z)=>{let X=(q-z)/(Z-1),ne=(W-j)/(Z-1),oe=M.length;for(let ee=0;ee<Z;ee++){let le=z+ee*X,ae=j+ee*ne;M.emplaceBack(le,ae);let fe=this._globePoint(le,ae,a,f,g,v,b);O.emplaceBack(fe[0],fe[1],fe[2]),A.emplaceBack(oe+ee)}},N=i.ab;L(0,0,N,0,16),L(N,0,N,N,16),L(N,N,0,N,16),L(0,N,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(M,i.b0.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,i.b9.members),this._tileDebugSegments=i.b1.simpleSegment(0,0,M.length,A.length)}_makeGlobeTileDebugTextBuffer(t,a,f,g,v,b){let M=i.ab/4,A=new i.a_,O=new i.aO,L=new i.b8,N=25;O.reserve(32),A.reserve(N),L.reserve(N);let z=(j,q)=>N*j+q;for(let j=0;j<N;j++){let q=j*M;for(let W=0;W<N;W++){let Z=W*M;A.emplaceBack(Z,q);let X=this._globePoint(Z,q,a,f,g,v,b);L.emplaceBack(X[0],X[1],X[2])}}for(let j=0;j<4;j++)for(let q=0;q<4;q++){let W=z(j,q),Z=z(j,q+1),X=z(j+1,q),ne=z(j+1,q+1);O.emplaceBack(W,Z,X),O.emplaceBack(X,Z,ne)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(A,i.b0.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,i.b9.members),this._tileDebugTextSegments=i.b1.simpleSegment(0,0,N,32)}destroy(t=!1){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.ba.setPbf(i.bb);class ah extends $o{constructor(t,a,f,g,v){super(t,a,f,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,a){let f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t,{premultiply:!1}):this.texture=new i.T(f,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,a){let f=this._mrt=new i.ba(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bc(g,(v,b,M,A)=>{if(v)a(v);else try{let O=f.getHeaderLength(b);if(O>t)return void(this.request=this.fetchHeader(O,a));f.parseHeader(b),this._isHeaderLoaded=!0;let L=0;for(let N of Object.values(f.layers))L=Math.max(L,N.dataIndex[N.dataIndex.length-1].last_byte);b.byteLength>=L&&(this.entireBuffer=b),a(null,this.entireBuffer||b,M,A)}catch(O){a(O)}}),this.request}fetchBand(t,a,f){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void f(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let b,M=(N,z)=>{b.complete(N,z),N?f(N):(this.updateTextureDescriptor(t,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(N,z)=>{if(N)return f(N);let j=v.send("decodeRasterArray",{buffer:z,task:b},M,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),b.cancel()})},O=g.getLayer(t);if(!O)return void f(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(a))return this.updateTextureDescriptor(t,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);let L=O.getDataRange([a]);if(b=g.createDecodingTask(L),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{let N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),z=i.bc(N,A);this._fetchQueue.push(()=>{z.cancel(),b.cancel()})}else f(null)}updateNeeded(t,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,a){if(!this._mrt)return;let f=this._mrt.getLayer(t);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;let{bytes:g,tileSize:v,buffer:b,offset:M,scale:A}=f.getBandView(a),O=v+2*b,L={data:g,width:O,height:O},N=this.texture;N&&N instanceof i.T&&N.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:a,img:L,buffer:b,offset:M,tileSize:v,format:f.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class mg{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(let t in this.data)for(let a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,f){let g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let v={value:a,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},f)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){let a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;let f=t.wrapped().key,g=a===void 0?0:this.data[f].indexOf(a),v=this.data[f][g];return this.data[f].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){let a=[];for(let f in this.data)for(let g of this.data[f])t(g.value)||a.push(g);for(let f of a)this.remove(f.value.tileID,f)}}class Xv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,f){let g=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},i.l(this.stateChanges[t][g],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(let v in this.state[t])v!==g&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(let v in this.state[t][g])f[v]||(this.deletedStates[t][g][v]=null)}else for(let v in f)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][v]===null&&delete this.deletedStates[t][g][v]}removeFeatureState(t,a,f){if(this.deletedStates[t]===null)return;let g=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&a!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][f]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(f in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][f]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,a){let f=this.state[t]||{},g=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(a!==void 0){let M=String(a),A=i.l({},f[M],g[M]);if(v){let O=v[a];if(O===null)return{};for(let L in O)delete A[L]}return A}let b=i.l({},f,g);if(v)for(let M in v)delete b[M];return b}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){let f={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let v={};for(let b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),i.l(this.state[g][b],this.stateChanges[g][b]),v[b]=this.state[g][b];f[g]=v}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let v={};if(this.deletedStates[g]===null)for(let b in this.state[g])v[b]={},this.state[g][b]={};else for(let b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(let M of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][M];v[b]=this.state[g][b]}f[g]=f[g]||{},i.l(f[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let g in t)t[g].setFeatureState(f,a)}}class Nr extends i.E{constructor(t,a,f){super(),this.id=t,this._onlySymbols=f,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new mg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Xv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let f=this._tiles[a];f.upload(t),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return i.bd(this._tiles).map(t=>t.tileID).sort(Hs).map(t=>t.key)}getRenderableIds(t,a){let f=[];for(let g in this._tiles)this._isIdRenderable(+g,t,a)&&f.push(this._tiles[g]);return t?f.sort((g,v)=>{let b=g.tileID,M=v.tileID,A=new i.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-M.overscaledZ||O.y-A.y||O.x-A.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(Hs).map(g=>g.key)}hasRenderableParent(t){let a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(f||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){let f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,t,a)))}_tileLoaded(t,a,f,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new i.t(g,{tile:t}));else{if(this._source.fire(new i.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=i.q.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new i.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let a=this.getRenderableIds();for(let g=0;g<a.length;g++){let v=a[g];if(t.neighboringTiles&&t.neighboringTiles[v]){let b=this.getTileByID(v);f(t,b),f(b,t)}}function f(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-g.tileID.canonical.x,M=v.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),O=v.tileID.key;b===0&&M===0||Math.abs(M)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,b,M),g.neighboringTiles&&g.neighboringTiles[O]&&(g.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,f,g){for(let v in this._tiles){let b=this._tiles[v];if(g[v]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>f)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){let O=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[O.key],b&&b.hasData()&&(M=O)}let A=M;for(;A.overscaledZ>a;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){g[M.key]=M;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){let f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=t.overscaledZ-1;f>=a;f--){let g=t.scaledTo(f),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(t){let a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;let f=Math.ceil(t.width/a)+1,g=Math.ceil(t.height/a)+1,v=Math.floor(f*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(M)}handleWrapJump(t){let a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){let f={};for(let g in this._tiles){let v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+a),f[v.tileID.key]=v}this._tiles=f;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,a,f,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let v=this._source.type==="batched-model",b;if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new i.aA(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){let O=t.clone();O.tileCoverLift=this.tileCoverLift,b=O.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new i.aA(1,0,1,0,0)),b.push(new i.aA(1,0,1,1,0)),b.push(new i.aA(1,0,1,0,1)),b.push(new i.aA(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){let O=this._source.hasTile.bind(this._source);b=b.filter(L=>O(L))}}else b=[];if(b.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Zc(this._source.type)){let O=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),L=Math.min(O,this._source.maxzoom);if(v){let N=t.extendTileCover(b,L);for(let z of N)b.push(z)}else{let N=t.extendTileCover(b,L,g);for(let z of N)this._shadowCasterTiles[z.key]=!0,b.push(z)}}let M=this._updateRetainedTiles(b);if(Zc(this._source.type)&&b.length!==0){let O={},L={},N=Object.keys(M);for(let j of N){let q=M[j],W=this._tiles[j];if(!W||W.fadeEndTime&&W.fadeEndTime<=i.q.now())continue;let Z=this.findLoadedParent(q,Math.max(q.overscaledZ-Nr.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),O[Z.tileID.key]=Z.tileID),L[j]=q}let z=b[b.length-1].overscaledZ;for(let j in this._tiles){let q=this._tiles[j];if(M[j]||!q.hasData())continue;let W=q.tileID;for(;W.overscaledZ>z;){W=W.scaledTo(W.overscaledZ-1);let Z=this._tiles[W.key];if(Z&&Z.hasData()&&L[W.key]){M[j]=q.tileID;break}}}for(let j in O)M[j]||(this._coveredTiles[j]=!0,M[j]=O[j])}for(let O in M)this._tiles[O].clearFadeHold();let A=i.be(this._tiles,M);for(let O of A){let L=this._tiles[O];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let a={};if(t.length===0)return a;let f={},g=t.reduce((O,L)=>Math.min(O,L.overscaledZ),1/0),v=t[0].overscaledZ,b=Math.max(v-Nr.maxOverzooming,this._source.minzoom),M=Math.max(v+Nr.maxUnderzooming,this._source.minzoom),A={};for(let O of t){let L=this._addTile(O);a[O.key]=O,L.hasData()||g<this._source.maxzoom&&(A[O.key]=O)}this._retainLoadedChildren(A,g,M,a);for(let O of t){let L=this._tiles[O.key];if(L.hasData())continue;if(O.canonical.z>=this._source.maxzoom){let z=O.children(this._source.maxzoom)[0],j=this.getTile(z);if(j&&j.hasData()){a[z.key]=z;continue}}else{let z=O.children(this._source.maxzoom);if(a[z[0].key]&&a[z[1].key]&&a[z[2].key]&&a[z[3].key])continue}let N=L.wasRequested();for(let z=O.overscaledZ-1;z>=b;--z){let j=O.scaledTo(z);if(f[j.key]||(f[j.key]=!0,L=this.getTile(j),!L&&N&&(L=this._addTile(j)),L&&(a[j.key]=j,N=L.wasRequested(),L.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let a=[],f,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}a.push(g.key);let v=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;g=v}for(let v of a)this._loadedParentTiles[v]=f}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));let f=!!a;if(!f){let g=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new ah(t,v,this.transform.tileZoom,g,this._isRaster):new $o(t,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a?(a.uses++,this._tiles[t.key]=a,f||this._source.fire(new i.x("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let f=a.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){let a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,f){let g=[],v=this.transform;if(!v)return g;let b=v.projection.name==="globe",M=i.am(v.center.lng);for(let A in this._tiles){let O=this._tiles[A];if(f&&O.clearQueryDebugViz(),O.holdingForFade())continue;let L;if(b){let N=O.tileID.canonical;if(N.z===0){let z=[Math.abs(i.ap(M,...vl(N,-1))-M),Math.abs(i.ap(M,...vl(N,1))-M)];L=[0,2*z.indexOf(Math.min(...z))-1]}else{let z=[Math.abs(i.ap(M,...vl(N,-1))-M),Math.abs(i.ap(M,...vl(N,0))-M),Math.abs(i.ap(M,...vl(N,1))-M)];L=[z.indexOf(Math.min(...z))-1]}}else L=[0];for(let N of L){let z=t.containsTile(O,v,a,N);z&&g.push(z)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){let f=this.getRenderableIds(t,a).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(let v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(t){let a=t.slice(),f=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(let b of a){let M=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*M+b.wrap-f[0])*g[0]+((b.canonical.y+.5)*M-f[1])*g[1]-f[2]*g[2]}return a.sort((b,M)=>v[b.key]-v[M.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Zc(this._source.type))for(let t in this._tiles){let a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(t,a,f){this._state.updateState(t=t||"_geojsonTileLayer",a,f)}removeFeatureState(t,a,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,f)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,f){let g=this._tiles[t];g&&g.setDependencies(a,f)}reloadTilesForDependencies(t,a){for(let f in this._tiles)this._tiles[f].hasDependency(t,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){let A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,a))};return void this._source.on("data",A)}let f=new Map,g=Array.isArray(t)?t:[t],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let A of g){let O=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let L of O)f.set(L.key,L);this.usedForTerrain&&A.updateElevation(!1)}let M=Array.from(f.values());i.bf(M,(A,O)=>{let L=new $o(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,N=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),O(N,L)})},a)}}function Hs(d,t){let a=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||f-a||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Zc(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function vl(d,t){let a=1<<d.z;return[d.x/a+t,(d.x+1)/a+t]}Nr.maxOverzooming=10,Nr.maxUnderzooming=3;class Ef{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,a=!1;for(let f in this.style._mergedLayers){let g=this.style._mergedLayers[f];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:t,visibilityChanged:a});else if(g.type==="model"){let v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(let a of this.layers){let f=a.layer,g=!1;f.type==="fill-extrusion"?g=!f.isHidden(t)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(g=!f.isHidden(t)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(let g of this.layers){let v=g.layer,b=this.style.getLayerSourceCache(v),M=1;v.type==="fill-extrusion"&&(M=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let A=b?b.getTile(a):null;if(!A&&b&&a.canonical.z>b.getSource().minzoom){let O=a.scaledTo(Math.min(b.getSource().maxzoom,a.overscaledZ-1));for(;O.overscaledZ>=b.getSource().minzoom&&(A=b.getTile(O),!A&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(v):null,tileID:A?A.tileID:a,verticalScale:M})}t.hasAnyZOffset=!1;let f=!1;for(let g=0;g<t.symbolInstances.length;g++){let v=t.symbolInstances.get(g),b=v.zOffset,M=this._getHeightAtTileOffset(a,v.tileAnchorX,v.tileAnchorY);v.zOffset=M!==Number.NEGATIVE_INFINITY?M:b,f||b===v.zOffset||(f=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}f&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,f,g){let v=a,b=f;if(t.canonical.z!==g.canonical.z){let M=g.canonical,A=1/(1<<t.canonical.z-M.z);v=(a+t.canonical.x*i.ab)*A-M.x*i.ab|0,b=(f+t.canonical.y*i.ab)*A-M.y*i.ab|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(t,a,f){let g,v;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:M,tileID:A,verticalScale:O}=this.currentBuildingBuckets[b];if(!M)continue;let{tileX:L,tileY:N}=this._mapCoordToOverlappingTile(t,a,f,A),z=M.getHeightAtTileCoord(L,N);z&&z.height!==void 0&&(z.hidden?g=z.height:v=Math.max(z.height*O,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){let M=this.layers[b];if(M.layer.type!=="model"||!M.visible)continue;let{bucket:A,tileID:O}=this.currentBuildingBuckets[b];if(!A)continue;let{tileX:L,tileY:N}=this._mapCoordToOverlappingTile(t,a,f,O),z=A.getHeightAtTileCoord(L,N);if(z&&!z.hidden)return z.height===void 0&&g!==void 0?Math.min(z.maxHeight,g)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xl(d,t){let a={};for(let f in d)f!=="ref"&&(a[f]=d[f]);return i.bg.forEach(f=>{f in t&&(a[f]=t[f])}),a}function If(d){d=d.slice();let t=Object.create(null);for(let a=0;a<d.length;a++)t[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=xl(d[a],t[d[a].ref]));return d}let Cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Cf(d,t,a){a.push({command:Cn.addSource,args:[d,t[d]]})}function Fn(d,t,a){t.push({command:Cn.removeSource,args:[d]}),a[d]=!0}function Yv(d,t,a,f){Fn(d,a,f),Cf(d,t,a)}function Pt(d,t,a){let f;for(f in d[a])if(d[a].hasOwnProperty(f)&&f!=="data"&&!i.bh(d[a][f],t[a][f]))return!1;for(f in t[a])if(t[a].hasOwnProperty(f)&&f!=="data"&&!i.bh(d[a][f],t[a][f]))return!1;return!0}function Xc(d,t,a,f,g,v){let b;for(b in t=t||{},d=d||{})d.hasOwnProperty(b)&&(i.bh(d[b],t[b])||a.push({command:v,args:[f,b,t[b],g]}));for(b in t)t.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(i.bh(d[b],t[b])||a.push({command:v,args:[f,b,t[b],g]}))}function Aa(d){return d.id}function bl(d,t){return d[t.id]=t,d}class Go{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.ap(t,0,1);let a=1,f=this._distances[a],g=t*this.paddedLength+this.padding;for(;f<g&&a<this._distances.length;)f=this._distances[++a];let v=a-1,b=this._distances[v],M=f-b,A=M>0?(g-b)/M:0;return this.points[v].mult(1-A).add(this.points[a].mult(A))}}class lh{constructor(t,a,f){let g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(a/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,f,g,v){this._forEachCell(a,f,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(t,a,f,g){this._forEachCell(a-g,f-g,a+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(f),this.circles.push(g)}_insertBoxCell(t,a,f,g,v,b){this.boxCells[v].push(b)}_insertCircleCell(t,a,f,g,v,b){this.circleCells[v].push(b)}_query(t,a,f,g,v,b){if(f<0||t>this.width||g<0||a>this.height)return!v&&[];let M=[];if(t<=0&&a<=0&&this.width<=f&&this.height<=g){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)M.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let O=this.circles[3*A],L=this.circles[3*A+1],N=this.circles[3*A+2];M.push({key:this.circleKeys[A],x1:O-N,y1:L-N,x2:O+N,y2:L+N})}return b?M.filter(b):M}return this._forEachCell(t,a,f,g,this._queryCell,M,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?M.length>0:M}_queryCircle(t,a,f,g,v){let b=t-f,M=t+f,A=a-f,O=a+f;if(M<0||b>this.width||O<0||A>this.height)return!g&&[];let L=[];return this._forEachCell(b,A,M,O,this._queryCellCircle,L,{hitTest:g,circle:{x:t,y:a,radius:f},seenUids:{box:{},circle:{}}},v),g?L.length>0:L}query(t,a,f,g,v){return this._query(t,a,f,g,!1,v)}hitTest(t,a,f,g,v){return this._query(t,a,f,g,!0,v)}hitTestCircle(t,a,f,g){return this._queryCircle(t,a,f,!0,g)}_queryCell(t,a,f,g,v,b,M,A){let O=M.seenUids,L=this.boxCells[v];if(L!==null){let z=this.bboxes;for(let j of L)if(!O.box[j]){O.box[j]=!0;let q=4*j;if(t<=z[q+2]&&a<=z[q+3]&&f>=z[q+0]&&g>=z[q+1]&&(!A||A(this.boxKeys[j]))){if(M.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[j],x1:z[q],y1:z[q+1],x2:z[q+2],y2:z[q+3]})}}}let N=this.circleCells[v];if(N!==null){let z=this.circles;for(let j of N)if(!O.circle[j]){O.circle[j]=!0;let q=3*j;if(this._circleAndRectCollide(z[q],z[q+1],z[q+2],t,a,f,g)&&(!A||A(this.circleKeys[j]))){if(M.hitTest)return b.push(!0),!0;{let W=z[q],Z=z[q+1],X=z[q+2];b.push({key:this.circleKeys[j],x1:W-X,y1:Z-X,x2:W+X,y2:Z+X})}}}}}_queryCellCircle(t,a,f,g,v,b,M,A){let O=M.circle,L=M.seenUids,N=this.boxCells[v];if(N!==null){let j=this.bboxes;for(let q of N)if(!L.box[q]){L.box[q]=!0;let W=4*q;if(this._circleAndRectCollide(O.x,O.y,O.radius,j[W+0],j[W+1],j[W+2],j[W+3])&&(!A||A(this.boxKeys[q])))return b.push(!0),!0}}let z=this.circleCells[v];if(z!==null){let j=this.circles;for(let q of z)if(!L.circle[q]){L.circle[q]=!0;let W=3*q;if(this._circlesCollide(j[W],j[W+1],j[W+2],O.x,O.y,O.radius)&&(!A||A(this.circleKeys[q])))return b.push(!0),!0}}}_forEachCell(t,a,f,g,v,b,M,A){let O=this._convertToXCellCoord(t),L=this._convertToYCellCoord(a),N=this._convertToXCellCoord(f),z=this._convertToYCellCoord(g);for(let j=O;j<=N;j++)for(let q=L;q<=z;q++)if(v.call(this,t,a,f,g,this.xCellCount*q+j,b,M,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,f,g,v,b){let M=g-t,A=v-a,O=f+b;return O*O>M*M+A*A}_circleAndRectCollide(t,a,f,g,v,b,M){let A=(b-g)/2,O=Math.abs(t-(g+A));if(O>A+f)return!1;let L=(M-v)/2,N=Math.abs(a-(v+L));if(N>L+f)return!1;if(O<=A||N<=L)return!0;let z=O-A,j=N-L;return z*z+j*j<=f*f}}let Do={unknown:0,flipRequired:1,flipNotRequired:2},gt=Math.tan(85*Math.PI/180);function vn(d,t,a,f,g,v,b){let M=i.a6.mat4.create();if(a)if(v.name==="globe"){let A=i.bi(g,t);i.a6.mat4.multiply(M,M,A)}else{let A=i.a6.mat2.invert([],b);M[0]=A[0],M[1]=A[1],M[4]=A[2],M[5]=A[3],f||i.a6.mat4.rotateZ(M,M,g.angle)}else i.a6.mat4.multiply(M,g.labelPlaneMatrix,d);return M}function xn(d,t,a,f,g,v,b){let M=vn(d,t,a,f,g,v,b);return v.name==="globe"&&a||(M[2]=M[6]=M[10]=M[14]=0),M}function zr(d,t,a,f,g,v,b){if(a){if(v.name==="globe"){let M=vn(d,t,a,f,g,v,b);return i.a6.mat4.invert(M,M),i.a6.mat4.multiply(M,d,M),M}{let M=i.a6.mat4.clone(d),A=i.a6.mat4.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],i.a6.mat4.multiply(M,M,A),f||i.a6.mat4.rotateZ(M,M,-g.angle),M}}return g.glCoordMatrix}function gr(d,t,a,f){let g=[d,t,a,1];a?i.a6.vec4.transformMat4(g,g,f):uh(g,g,f);let v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Tn(d,t){return Math.min(.5+d/t*.5,1.5)}function ch(d,t){let a=d[0]/d[3],f=d[1]/d[3];return a>=-t[0]&&a<=t[0]&&f>=-t[1]&&f<=t[1]}function wl(d,t,a,f,g,v,b,M,A,O){let L=a.transform,N=f?d.textSizeData:d.iconSizeData,z=i.bj(N,a.transform.zoom),j=L.projection.name==="globe",q=[256/a.width*2+1,256/a.height*2+1],W=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;W.clear();let Z=null;j&&(Z=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let X=d.lineVertexArray,ne=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,oe=a.transform.width/a.transform.height,ee,le=!1;for(let ae=0;ae<ne.length;ae++){let fe=ne.get(ae),{numGlyphs:he,writingMode:pe}=fe;if(pe!==i.bk.vertical||le||ee===i.bk.horizontal||(le=!0),ee=pe,(fe.hidden||pe===i.bk.vertical)&&!le){Ho(he,W);continue}le=!1;let we=new i.P(fe.tileAnchorX,fe.tileAnchorY),{x:ye,y:ge,z:Me}=L.projection.projectTilePoint(we.x,we.y,O.canonical);if(A){let[He,Ye,Et]=A(we);ye+=He,ge+=Ye,Me+=Et}let Be=[ye,ge,Me,1];if(i.a6.vec4.transformMat4(Be,Be,t),!ch(Be,q)){Ho(he,W);continue}let qe=Be[3],ze=Tn(a.transform.getCameraToCenterDistance(L.projection),qe),Je=i.bl(N,z,fe),Se=b?Je/ze:Je*ze,Ge=gr(ye,ge,Me,g);if(Ge[3]<=0){Ho(he,W);continue}let Ue={},et=b?null:A,nt=wi(fe,Se,!1,M,t,g,v,d.glyphOffsetArray,X,W,Z,Ge,we,Ue,oe,et,L.projection,O,b);le=nt.useVertical,et&&nt.needsFlipping&&(Ue={}),(nt.notEnoughRoom||le||nt.needsFlipping&&wi(fe,Se,!0,M,t,g,v,d.glyphOffsetArray,X,W,Z,Ge,we,Ue,oe,et,L.projection,O,b).notEnoughRoom)&&Ho(he,W)}f?(d.text.dynamicLayoutVertexBuffer.updateData(W),Z&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(Z)):(d.icon.dynamicLayoutVertexBuffer.updateData(W),Z&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(Z))}function Tl(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W){let{lineStartIndex:Z,glyphStartIndex:X,segment:ne}=M,oe=X+M.numGlyphs,ee=Z+M.lineLength,le=t.getoffsetX(X),ae=t.getoffsetX(oe-1),fe=Il(d*le,a,f,g,v,b,ne,Z,ee,A,O,L,N,z,!0,j,q,W);if(!fe)return null;let he=Il(d*ae,a,f,g,v,b,ne,Z,ee,A,O,L,N,z,!0,j,q,W);return he?{first:fe,last:he}:null}function Cr(d,t,a,f){return d===i.bk.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:d===i.bk.vertical?f>0?{needsFlipping:!0}:null:t!==Do.unknown&&function(g,v){return g===0||Math.abs(v/g)>gt}(a,f)?t===Do.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function wi(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X,ne){let oe=t/24,ee=d.lineOffsetX*oe,le=d.lineOffsetY*oe,{lineStartIndex:ae,glyphStartIndex:fe,numGlyphs:he,segment:pe,writingMode:we,flipState:ye}=d,ge=ae+d.lineLength,Me=Be=>{if(L){let[Se,Ge,Ue]=Be.up,et=O.length;i.bm(L,et+0,Se,Ge,Ue),i.bm(L,et+1,Se,Ge,Ue),i.bm(L,et+2,Se,Ge,Ue),i.bm(L,et+3,Se,Ge,Ue)}let[qe,ze,Je]=Be.point;i.bn(O,qe,ze,Je,Be.angle)};if(he>1){let Be=Tl(oe,M,ee,le,a,N,z,d,A,v,j,W,!1,Z,X,ne);if(!Be)return{notEnoughRoom:!0};if(f&&!a){let[qe,ze,Je]=Be.first.point,[Se,Ge,Ue]=Be.last.point;[qe,ze]=gr(qe,ze,Je,b),[Se,Ge]=gr(Se,Ge,Ue,b);let et=Cr(we,ye,(Se-qe)*q,Ge-ze);if(d.flipState=et&&et.needsFlipping?Do.flipRequired:Do.flipNotRequired,et)return et}Me(Be.first);for(let qe=fe+1;qe<fe+he-1;qe++){let ze=Il(oe*M.getoffsetX(qe),ee,le,a,N,z,pe,ae,ge,A,v,j,W,!1,!1,Z,X,ne);if(!ze)return O.length-=4*(qe-fe),{notEnoughRoom:!0};Me(ze)}Me(Be.last)}else{if(f&&!a){let qe=gr(z.x,z.y,0,g),ze=ae+pe+1,Je=new i.P(A.getx(ze),A.gety(ze)),Se=gr(Je.x,Je.y,0,g),Ge=Se[3]>0?Se:El(z,Je,qe,1,g,void 0,Z,X.canonical),Ue=Cr(we,ye,(Ge[0]-qe[0])*q,Ge[1]-qe[1]);if(d.flipState=Ue&&Ue.needsFlipping?Do.flipRequired:Do.flipNotRequired,Ue)return Ue}let Be=Il(oe*M.getoffsetX(fe),ee,le,a,N,z,pe,ae,ge,A,v,j,W,!1,!1,Z,X,ne);if(!Be)return{notEnoughRoom:!0};Me(Be)}return{}}function gg(d,t,a,f,g){let{x:v,y:b,z:M}=f.projectTilePoint(d.x,d.y,t);if(!g)return gr(v,b,M,a);let[A,O,L]=g(d);return gr(v+A,b+O,M+L,a)}function El(d,t,a,f,g,v,b,M){let A=gg(d.sub(t)._unit()._add(d),M,g,b,v);return i.a6.vec3.sub(A,a,A),i.a6.vec3.normalize(A,A),i.a6.vec3.scaleAndAdd(A,a,A,f)}function Il(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X){let ne=f?d-t:d+t,oe=ne>0?1:-1,ee=0;f&&(oe*=-1,ee=Math.PI),oe<0&&(ee+=Math.PI);let le=M+b+(oe>0?0:1)|0,ae=g,fe=g,he=0,pe=0,we=Math.abs(ne),ye=[],ge=[],Me=v,Be=Me,qe=()=>El(Be,Me,fe,we-he+1,L,z,W,Z.canonical);for(;he+pe<=we;){if(le+=oe,le<M||le>=A)return null;if(fe=ae,Be=Me,ye.push(fe),j&&ge.push(Be),Me=new i.P(O.getx(le),O.gety(le)),ae=N[le],!ae){let Ye=gg(Me,Z.canonical,L,W,z);ae=Ye[3]>0?N[le]=Ye:qe()}he+=pe,pe=i.a6.vec3.distance(fe,ae)}q&&z&&(N[le]&&(ae=qe(),pe=i.a6.vec3.distance(fe,ae)),N[le]=ae);let ze=(we-he)/pe,Je=Me.sub(Be)._mult(ze)._add(Be),Se=i.a6.vec3.sub([],ae,fe),Ge=i.a6.vec3.scaleAndAdd([],fe,Se,ze),Ue=[0,0,1],et=Se[0],nt=Se[1];if(X&&(Ue=W.upVector(Z.canonical,Je.x,Je.y),Ue[0]!==0||Ue[1]!==0||Ue[2]!==1)){let Ye=[Ue[2],0,-Ue[0]],Et=i.a6.vec3.cross([],Ue,Ye);i.a6.vec3.normalize(Ye,Ye),i.a6.vec3.normalize(Et,Et),et=i.a6.vec3.dot(Se,Ye),nt=i.a6.vec3.dot(Se,Et)}if(a){let Ye=i.a6.vec3.cross([],Ue,Se);i.a6.vec3.normalize(Ye,Ye),i.a6.vec3.scaleAndAdd(Ge,Ge,Ye,a*oe)}let He=ee+Math.atan2(nt,et);return ye.push(Ge),j&&ge.push(Je),{point:Ge,angle:He,path:ye,tilePath:ge,up:Ue}}function Ho(d,t){let a=t.length,f=a+4*d;t.resize(f),t.float32.fill(-1/0,4*a,4*f)}function uh(d,t,a){let f=t[0],g=t[1];return d[0]=a[0]*f+a[4]*g+a[12],d[1]=a[1]*f+a[5]*g+a[13],d[3]=a[3]*f+a[7]*g+a[15],d}let Zr=100;class _r{constructor(t,a,f=new lh(t.width+200,t.height+200,25),g=new lh(t.width+200,t.height+200,25)){this.transform=t,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zr,this.screenBottomBoundary=t.height+Zr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,f,g,v,b,M,A){let O=f.projectedAnchorX,L=f.projectedAnchorY,N=f.projectedAnchorZ,z=f.elevation,j=f.tileID,q=t.getProjection();if(z&&j){let[ae,fe,he]=q.upVector(j.canonical,f.tileAnchorX,f.tileAnchorY),pe=q.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ae*z*pe,L+=fe*z*pe,N+=he*z*pe}let W=this.projectAndGetPerspectiveRatio(M,O,L,N,f.tileID,q.name==="globe"||!!z||this.transform.pitch>0,q),Z=b*W.perspectiveRatio,X=(f.x1*a+g.x-f.padding)*Z+W.point.x,ne=(f.y1*a+g.y-f.padding)*Z+W.point.y,oe=(f.x2*a+g.x+f.padding)*Z+W.point.x,ee=(f.y2*a+g.y+f.padding)*Z+W.point.y,le=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(X,ne,oe,ee)||!v&&this.grid.hitTest(X,ne,oe,ee,A)||le?{box:[],offscreen:!1,occluded:W.occluded}:{box:[X,ne,oe,ee],offscreen:this.isOffscreen(X,ne,oe,ee),occluded:!1}}placeCollisionCircles(t,a,f,g,v,b,M,A,O,L,N,z,j,q,W){let Z=[],X=this.transform.elevation,ne=t.getProjection(),oe=X?X.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ne):null,ee=new i.P(f.tileAnchorX,f.tileAnchorY),{x:le,y:ae,z:fe}=ne.projectTilePoint(ee.x,ee.y,W.canonical);if(oe){let[Je,Se,Ge]=oe(ee);le+=Je,ae+=Se,fe+=Ge}let he=ne.name==="globe",pe=this.projectAndGetPerspectiveRatio(M,le,ae,fe,W,he||!!X||this.transform.pitch>0,ne),{perspectiveRatio:we}=pe,ye=(N?b/we:b*we)/i.bq,ge=gr(le,ae,fe,A),Me=pe.signedDistanceFromCamera>0?Tl(ye,v,f.lineOffsetX*ye,f.lineOffsetY*ye,!1,ge,ee,f,g,A,{},X&&!N?oe:null,N&&!!X,ne,W,N):null,Be=!1,qe=!1,ze=!0;if(Me&&!pe.occluded){let Je=.5*j*we+q,Se=new i.P(-100,-100),Ge=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Ue=new Go,{first:et,last:nt}=Me,He=et.path.length,Ye=[];for(let ft=He-1;ft>=1;ft--)Ye.push(et.path[ft]);for(let ft=1;ft<nt.path.length;ft++)Ye.push(nt.path[ft]);let Et=2.5*Je;O&&(Ye=Ye.map(([ft,Ot,_t],Mt)=>(oe&&!he&&(_t=oe(Mt<He-1?et.tilePath[He-1-Mt]:nt.tilePath[Mt-He+2])[2]),gr(ft,Ot,_t,O))),Ye.some(ft=>ft[3]<=0)&&(Ye=[]));let rt=[];if(Ye.length>0){let ft=1/0,Ot=-1/0,_t=1/0,Mt=-1/0;for(let ln of Ye)ft=Math.min(ft,ln[0]),_t=Math.min(_t,ln[1]),Ot=Math.max(Ot,ln[0]),Mt=Math.max(Mt,ln[1]);Ot>=Se.x&&ft<=Ge.x&&Mt>=Se.y&&_t<=Ge.y&&(rt=[Ye.map(ln=>new i.P(ln[0],ln[1]))],(ft<Se.x||Ot>Ge.x||_t<Se.y||Mt>Ge.y)&&(rt=i.bo(rt,Se.x,Se.y,Ge.x,Ge.y)))}for(let ft of rt){Ue.reset(ft,.25*Je);let Ot=0;Ot=Ue.length<=.5*Je?1:Math.ceil(Ue.paddedLength/Et)+1;for(let _t=0;_t<Ot;_t++){let Mt=_t/Math.max(Ot-1,1),ln=Ue.lerp(Mt),rn=ln.x+Zr,jn=ln.y+Zr;Z.push(rn,jn,Je,0);let Yn=rn-Je,oi=jn-Je,ho=rn+Je,Mi=jn+Je;if(ze=ze&&this.isOffscreen(Yn,oi,ho,Mi),qe=qe||this.isInsideGrid(Yn,oi,ho,Mi),!a&&this.grid.hitTestCircle(rn,jn,Je,z)&&(Be=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!L&&Be||!qe?[]:Z,offscreen:ze,collisionDetected:Be,occluded:pe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],f=1/0,g=1/0,v=-1/0,b=-1/0;for(let L of t){let N=new i.P(L.x+Zr,L.y+Zr);f=Math.min(f,N.x),g=Math.min(g,N.y),v=Math.max(v,N.x),b=Math.max(b,N.y),a.push(N)}let M=this.grid.query(f,g,v,b).concat(this.ignoredGrid.query(f,g,v,b)),A={},O={};for(let L of M){let N=L.key;if(A[N.bucketInstanceId]===void 0&&(A[N.bucketInstanceId]={}),A[N.bucketInstanceId][N.featureIndex])continue;let z=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.bp(a,z)&&(A[N.bucketInstanceId][N.featureIndex]=!0,O[N.bucketInstanceId]===void 0&&(O[N.bucketInstanceId]=[]),O[N.bucketInstanceId].push(N.featureIndex))}return O}insertCollisionBox(t,a,f,g,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,f,g,v){let b=a?this.ignoredGrid:this.grid,M={bucketInstanceId:f,featureIndex:g,collisionGroupID:v};for(let A=0;A<t.length;A+=4)b.insertCircle(M,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,f,g,v,b,M){let A=[a,f,g,1],O=!1;g||this.transform.pitch>0?(i.a6.vec4.transformMat4(A,A,t),this.fogState&&v&&M.name!=="globe"&&(O=function(z,j,q,W,Z,X){let ne=X.calculateFogTileMatrix(Z),oe=[j,q,W];return i.a6.vec3.transformMat4(oe,oe,ne),dt(z,i.a6.vec3.length(oe),X.pitch,X._fov)}(this.fogState,a,f,g,v.toUnwrapped(),this.transform)>.9)):uh(A,A,t);let L=A[3];return{point:new i.P((A[0]/L+1)/2*this.transform.width+Zr,(-A[1]/L+1)/2*this.transform.height+Zr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/L*.5,1.5),signedDistanceFromCamera:L,occluded:b&&A[2]>L||O}}isOffscreen(t,a,f,g){return f<Zr||t>=this.screenRightBoundary||g<Zr||a>this.screenBottomBoundary}isInsideGrid(t,a,f,g){return f>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let t=i.a6.mat4.identity([]);return i.a6.mat4.translate(t,t,[-100,-100,0]),t}}function Dr(d,t,a){let f=t.createTileMatrix(d,d.worldSize,a.toUnwrapped());return i.a6.mat4.multiply(new Float32Array(16),d.projMatrix,f)}function _g(d,t,a){if(t.projection.name===a.projection.name)return d.projMatrix;let f=a.clone();return f.setProjection(t.projection),Dr(f,t.getProjection(),d)}function qs(d,t,a){return t.name===a.projection.name?d.projMatrix:Dr(a,t,d)}class Fi{constructor(t,a,f,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Mr{constructor(t,a,f,g,v,b=!1){this.text=new Fi(t?t.text:null,a,f,v),this.icon=new Fi(t?t.icon:null,a,g,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mo{constructor(t,a,f,g=!1){this.text=t,this.icon=a,this.skipFade=f,this.clipped=g}}class Wi{constructor(){this.invProjMatrix=i.a6.mat4.create(),this.viewportMatrix=i.a6.mat4.create(),this.circles=[]}}class Df{constructor(t,a,f,g,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=v}}class So{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[t]}}function Cl(d,t,a,f,g){let{horizontalAlign:v,verticalAlign:b}=i.bx(d),M=-(v-.5)*t,A=-(b-.5)*a,O=i.bw(d,f);return new i.P(M+O[0]*g,A+O[1]*g)}function Pa(d,t,a,f,g){let v=new i.P(d,t);return a&&v._rotate(f?g:-g),v}class Ra{constructor(t,a,f,g,v,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new _r(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new So(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,f,g){let v=f.getBucket(a),b=f.latestFeatureIndex;if(!v||!b||a.fqid!==v.layerIds[0])return;let M=v.layers[0].layout,A=v.layers[0].paint,O=f.collisionBoxArray,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),N=f.tileSize/i.ab,z=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);let j=(q=f.tileID,W=v.getProjection(),Z=this.transform,W.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):Dr(Z,W,q));var q,W,Z;let X=M.get("text-pitch-alignment")==="map",ne=M.get("text-rotation-alignment")==="map";a.compileFilter();let oe=a.dynamicFilter(),ee=a.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(f),ae=xn(j,f.tileID.canonical,X,ne,this.transform,v.getProjection(),le),fe=null;if(X){let we=zr(j,f.tileID.canonical,X,ne,this.transform,v.getProjection(),le);fe=i.a6.mat4.multiply([],this.transform.labelPlaneMatrix,we)}let he=null;oe&&f.latestFeatureIndex&&(he={unwrappedTileID:z,dynamicFilter:oe,dynamicFilterNeedsFeature:ee}),this.retainedQueryData[v.bucketInstanceId]=new Df(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,f.tileID);let pe={bucket:v,layout:M,paint:A,posMatrix:j,textLabelPlaneMatrix:ae,labelToScreenMatrix:fe,clippingData:he,scale:L,textPixelRatio:N,holdingForFade:f.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:i.bj(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.bj(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(g)for(let we of v.sortKeyRanges){let{sortKey:ye,symbolInstanceStart:ge,symbolInstanceEnd:Me}=we;t.push({sortKey:ye,symbolInstanceStart:ge,symbolInstanceEnd:Me,parameters:pe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X,ne){let{textOffset0:oe,textOffset1:ee,crossTileID:le}=z,ae=[oe,ee],fe=Cl(t,f,g,ae,v),he=this.collisionIndex.placeCollisionBox(q,v,a,Pa(fe.x,fe.y,b,M,this.transform.angle),N,A,O,L.predicate);if(Z){let pe=q.getSymbolInstanceIconSize(ne,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,pe,Z,Pa(fe.x,fe.y,b,M,this.transform.angle),N,A,O,L.predicate).box.length===0)return}if(he.box.length>0){let pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[le]&&this.prevPlacement.placements[le]&&this.prevPlacement.placements[le].text&&(pe=this.prevPlacement.variableOffsets[le].anchor),this.variableOffsets[le]={textOffset:ae,width:f,height:g,anchor:t,textScale:v,prevAnchor:pe},this.markUsedJustification(q,t,z,W),q.allowVerticalPlacement&&(this.markUsedOrientation(q,W,z),this.placedOrientations[le]=W),{shift:fe,placedGlyphBoxes:he}}}placeLayerBucketPart(t,a,f,g){let{bucket:v,layout:b,paint:M,posMatrix:A,textLabelPlaneMatrix:O,labelToScreenMatrix:L,clippingData:N,textPixelRatio:z,holdingForFade:j,collisionBoxArray:q,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:Z,collisionGroup:X,latestFeatureIndex:ne}=t.parameters,oe=b.get("text-optional"),ee=b.get("icon-optional"),le=b.get("text-allow-overlap"),ae=b.get("icon-allow-overlap"),fe=b.get("text-rotation-alignment")==="map",he=b.get("text-pitch-alignment")==="map",pe=b.get("symbol-z-elevate"),we=M.get("symbol-z-offset"),ye=M.get("symbol-elevation-reference")==="sea";this.transform.setProjection(v.projection);let ge=le&&(ae||!v.hasIconData()||ee),Me=ae&&(le||!v.hasTextData()||oe),Be=!we.isConstant();!v.collisionArrays&&q&&v.deserializeCollisionBoxes(q),f&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,q);let qe=(ze,Je,Se)=>{let{crossTileID:Ge,numVerticalGlyphVertices:Ue}=ze,et=null;if(N&&N.dynamicFilterNeedsFeature||Be){let on=this.retainedQueryData[v.bucketInstanceId];et=ne.loadFeature({featureIndex:ze.featureIndex,bucketIndex:on.bucketIndex,sourceLayerIndex:on.sourceLayerIndex,layoutVertexArrayOffset:0})}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},et,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new i.P(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Ge]=new Mo(!1,!1,!1,!0),void a.add(Ge);let nt=we.evaluate(et,{});if(a.has(Ge))return;if(j)return void(this.placements[Ge]=new Mo(!1,!1,!1));let He=!1,Ye=!1,Et=!0,rt=!1,ft=!1,Ot=null,_t={box:null,offscreen:null,occluded:null},Mt={box:null,offscreen:null,occluded:null},ln=null,rn=null,jn=null,Yn=0,oi=0,ho=0;Se.textFeatureIndex?Yn=Se.textFeatureIndex:ze.useRuntimeCollisionCircles&&(Yn=ze.featureIndex),Se.verticalTextFeatureIndex&&(oi=Se.verticalTextFeatureIndex);let Mi=on=>{on.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let Mn=this.transform.elevation;on.elevation=ye?nt:nt+(Mn?Mn.getAtTileOffset(on.tileID,on.tileAnchorX,on.tileAnchorY):0),on.elevation+=ze.zOffset},gn=Se.textBox;if(gn){Mi(gn);let on=kn=>{let bi=i.bk.horizontal;if(v.allowVerticalPlacement&&!kn&&this.prevPlacement){let Si=this.prevPlacement.placedOrientations[Ge];Si&&(this.placedOrientations[Ge]=Si,bi=Si,this.markUsedOrientation(v,bi,ze))}return bi},Mn=(kn,bi)=>{if(v.allowVerticalPlacement&&Ue>0&&Se.verticalTextBox){for(let Si of v.writingModes)if(Si===i.bk.vertical?(_t=bi(),Mt=_t):_t=kn(),_t&&_t.box&&_t.box.length)break}else _t=kn()};if(b.get("text-variable-anchor")){let kn=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ge]){let wn=this.prevPlacement.variableOffsets[Ge];kn.indexOf(wn.anchor)>0&&(kn=kn.filter($i=>$i!==wn.anchor),kn.unshift(wn.anchor))}let bi=(wn,$i,Zi)=>{let Gi=v.getSymbolInstanceTextSize(W,ze,this.transform.zoom,Je),ti=(wn.x2-wn.x1)*Gi+2*wn.padding,Ar=(wn.y2-wn.y1)*Gi+2*wn.padding,Pr=ze.hasIconTextFit&&!ae?$i:null;Pr&&Mi(Pr);let fo={box:[],offscreen:!1,occluded:!1},eo=le?2*kn.length:kn.length;for(let jr=0;jr<eo;++jr){let po=this.attemptAnchorPlacement(kn[jr%kn.length],wn,ti,Ar,Gi,fe,he,z,A,X,jr>=kn.length,ze,Je,v,Zi,Pr,W,Z);if(po&&(fo=po.placedGlyphBoxes,fo&&fo.box&&fo.box.length)){He=!0,Ot=po.shift;break}}return fo};Mn(()=>bi(gn,Se.iconBox,i.bk.horizontal),()=>{let wn=Se.verticalTextBox;return wn&&Mi(wn),v.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&Ue>0&&wn?bi(wn,Se.verticalIconBox,i.bk.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(He=_t.box,Et=_t.offscreen,rt=_t.occluded);let Si=on(!(!_t||!_t.box));if(!He&&this.prevPlacement){let wn=this.prevPlacement.variableOffsets[Ge];wn&&(this.variableOffsets[Ge]=wn,this.markUsedJustification(v,wn.anchor,ze,Si))}}else{let kn=(bi,Si)=>{let wn=v.getSymbolInstanceTextSize(W,ze,this.transform.zoom,Je),$i=this.collisionIndex.placeCollisionBox(v,wn,bi,new i.P(0,0),le,z,A,X.predicate);return $i&&$i.box&&$i.box.length&&(this.markUsedOrientation(v,Si,ze),this.placedOrientations[Ge]=Si),$i};Mn(()=>kn(gn,i.bk.horizontal),()=>{let bi=Se.verticalTextBox;return v.allowVerticalPlacement&&Ue>0&&bi?(Mi(bi),kn(bi,i.bk.vertical)):{box:null,offscreen:null,occluded:null}}),on(!!(_t&&_t.box&&_t.box.length))}}if(ln=_t,He=ln&&ln.box&&ln.box.length>0,Et=ln&&ln.offscreen,rt=ln&&ln.occluded,ze.useRuntimeCollisionCircles){let on=v.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),Mn=i.bl(v.textSizeData,W,on),kn=b.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(v,le,on,v.lineVertexArray,v.glyphOffsetArray,Mn,A,O,L,f,he,X.predicate,ze.collisionCircleDiameter*Mn/i.bq,kn,this.retainedQueryData[v.bucketInstanceId].tileID),He=le||rn.circles.length>0&&!rn.collisionDetected,Et=Et&&rn.offscreen,rt=rn.occluded}if(Se.iconFeatureIndex&&(ho=Se.iconFeatureIndex),Se.iconBox){let on=Mn=>{Mi(Mn);let kn=ze.hasIconTextFit&&Ot?Pa(Ot.x,Ot.y,fe,he,this.transform.angle):new i.P(0,0),bi=v.getSymbolInstanceIconSize(Z,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,bi,Mn,kn,ae,z,A,X.predicate)};Mt&&Mt.box&&Mt.box.length&&Se.verticalIconBox?(jn=on(Se.verticalIconBox),Ye=jn.box.length>0):(jn=on(Se.iconBox),Ye=jn.box.length>0),Et=Et&&jn.offscreen,ft=jn.occluded}let qn=oe||ze.numHorizontalGlyphVertices===0&&Ue===0,hi=ee||ze.numIconVertices===0;if(qn||hi?hi?qn||(Ye=Ye&&He):He=Ye&&He:Ye=He=Ye&&He,He&&ln&&ln.box&&this.collisionIndex.insertCollisionBox(ln.box,b.get("text-ignore-placement"),v.bucketInstanceId,Mt&&Mt.box&&oi?oi:Yn,X.ID),Ye&&jn&&this.collisionIndex.insertCollisionBox(jn.box,b.get("icon-ignore-placement"),v.bucketInstanceId,ho,X.ID),rn&&(He&&this.collisionIndex.insertCollisionCircles(rn.circles,b.get("text-ignore-placement"),v.bucketInstanceId,Yn,X.ID),f)){let on=v.bucketInstanceId,Mn=this.collisionCircleArrays[on];Mn===void 0&&(Mn=this.collisionCircleArrays[on]=new Wi);for(let kn=0;kn<rn.circles.length;kn+=4)Mn.circles.push(rn.circles[kn+0]),Mn.circles.push(rn.circles[kn+1]),Mn.circles.push(rn.circles[kn+2]),Mn.circles.push(rn.collisionDetected?1:0)}let $n=v.projection.name!=="globe";ge=ge&&($n||!rt),Me=Me&&($n||!ft),this.placements[Ge]=new Mo(He||ge,Ye||Me,Et||v.justReloaded),a.add(Ge)};if(pe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),v.sortFeaturesByY){let ze=v.getSortedSymbolIndexes(this.transform.angle);for(let Je=ze.length-1;Je>=0;--Je){let Se=ze[Je];qe(v.symbolInstances.get(Se),Se,v.collisionArrays[Se])}v.hasAnyZOffset&&i.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let ze=v.getSortedIndexesByZOffset();for(let Je=0;Je<ze.length;++Je){let Se=ze[Je];qe(v.symbolInstances.get(Se),Se,v.collisionArrays[Se])}}else for(let ze=t.symbolInstanceStart;ze<t.symbolInstanceEnd;ze++)qe(v.symbolInstances.get(ze),ze,v.collisionArrays[ze]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){let ze=this.collisionCircleArrays[v.bucketInstanceId];i.a6.mat4.invert(ze.invProjMatrix,A),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,a,f,g){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:A,crossTileID:O}=f,L=i.bv(a),N=g===i.bk.vertical?A:L==="left"?v:L==="center"?b:L==="right"?M:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=N>=0&&v!==N?0:O),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:O),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:O),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=N>=0&&A!==N?0:O)}markUsedOrientation(t,a,f){let g=a===i.bk.horizontal||a===i.bk.horizontalOnly?a:0,v=a===i.bk.vertical?a:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:O}=f,L=t.text.placedSymbolArray;b>=0&&(L.get(b).placedOrientation=g),M>=0&&(L.get(M).placedOrientation=g),A>=0&&(L.get(A).placedOrientation=g),O>=0&&(L.get(O).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let g=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},b=a?a.variableOffsets:{},M=a?a.placedOrientations:{};for(let A in this.placements){let O=this.placements[A],L=v[A];L?(this.opacities[A]=new Mr(L,g,O.text,O.icon,null,O.clipped),f=f||O.text!==L.text.placed||O.icon!==L.icon.placed):(this.opacities[A]=new Mr(null,g,O.text,O.icon,O.skipFade,O.clipped),f=f||O.text||O.icon)}for(let A in v){let O=v[A];if(!this.opacities[A]){let L=new Mr(O,g,!1,!1);L.isHidden()||(this.opacities[A]=L,f=f||O.text.placed||O.icon.placed)}}for(let A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(let A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,f,g){let v=new Set;for(let b of a){let M=b.getBucket(t);M&&b.latestFeatureIndex&&t.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,v,b,b.collisionBoxArray,f,g,b.tileID,t.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,b.tileID),M.updateZOffset()))}}updateBucketOpacities(t,a,f,g,v,b,M,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let O=t.layers[0].layout,L=t.layers[0].paint,N=!!t.layers[0].dynamicFilter(),z=new Mr(null,0,!1,!1,!0),j=O.get("text-allow-overlap"),q=O.get("icon-allow-overlap"),W=O.get("text-variable-anchor"),Z=O.get("text-rotation-alignment")==="map",X=O.get("text-pitch-alignment")==="map",ne=L.get("symbol-z-offset"),oe=L.get("symbol-elevation-reference")==="sea",ee=!ne.isConstant(),le=new Mr(null,0,j&&(q||!t.hasIconData()||O.get("icon-optional")),q&&(j||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);let ae=(he,pe,we)=>{for(let ye=0;ye<pe/4;ye++)he.opacityVertexArray.emplaceBack(we)},fe=0;b&&t.updateReplacement(M,b);for(let he=0;he<t.symbolInstances.length;he++){let pe=t.symbolInstances.get(he),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:ye,crossTileID:ge,numIconVertices:Me,tileAnchorX:Be,tileAnchorY:qe}=pe,ze=null;if(pe&&ee){let rt=this.retainedQueryData[t.bucketInstanceId];ze=f.latestFeatureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:rt.bucketIndex,sourceLayerIndex:rt.sourceLayerIndex,layoutVertexArrayOffset:0})}let Je=ne.evaluate(ze,{}),Se=a.has(ge),Ge=this.opacities[ge];Se?Ge=z:Ge||(Ge=le,this.opacities[ge]=Ge),a.add(ge);let Ue=we>0||ye>0,et=Me>0,nt=this.placedOrientations[ge],He=nt===i.bk.vertical,Ye=nt===i.bk.horizontal||nt===i.bk.horizontalOnly;!Ue&&!et||Ge.isHidden()||fe++;let Et=!1;if((Ue||et)&&b)for(let rt of t.activeReplacements){if(i.br(rt,v,i.bs.Symbol,A)||rt.min.x>Be||Be>rt.max.x||rt.min.y>qe||qe>rt.max.y)continue;let ft=i.bt(Be,qe,M.canonical,rt.footprintTileId.canonical);if(Et=i.bu(ft,rt.footprint),Et)break}if(Ue){let rt=Et?Ml:Dl(Ge.text);ae(t.text,we,He?Ml:rt),ae(t.text,ye,Ye?Ml:rt);let ft=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:Ot,centerJustifiedTextSymbolIndex:_t,rightJustifiedTextSymbolIndex:Mt,verticalPlacedTextSymbolIndex:ln}=pe,rn=t.text.placedSymbolArray,jn=ft||He?1:0;Ot>=0&&(rn.get(Ot).hidden=jn),_t>=0&&(rn.get(_t).hidden=jn),Mt>=0&&(rn.get(Mt).hidden=jn),ln>=0&&(rn.get(ln).hidden=ft||Ye?1:0);let Yn=this.variableOffsets[ge];Yn&&this.markUsedJustification(t,Yn.anchor,pe,nt);let oi=this.placedOrientations[ge];oi&&(this.markUsedJustification(t,"left",pe,oi),this.markUsedOrientation(t,oi,pe))}if(et){let rt=Et?Ml:Dl(Ge.icon),{placedIconSymbolIndex:ft,verticalPlacedIconSymbolIndex:Ot}=pe,_t=t.icon.placedSymbolArray,Mt=Ge.icon.isHidden()?1:0;ft>=0&&(ae(t.icon,Me,He?Ml:rt),_t.get(ft).hidden=Mt),Ot>=0&&(ae(t.icon,pe.numVerticalIconVertices,Ye?Ml:rt),_t.get(Ot).hidden=Mt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let rt=t.collisionArrays[he];if(rt){let ft=new i.P(0,0),Ot=!0;if(rt.textBox||rt.verticalTextBox){if(W){let Mt=this.variableOffsets[ge];Mt?(ft=Cl(Mt.anchor,Mt.width,Mt.height,Mt.textOffset,Mt.textScale),Z&&ft._rotate(X?this.transform.angle:-this.transform.angle)):Ot=!1}N&&(Ot=!Ge.clipped),rt.textBox&&hh(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!Ot||He,Je,oe,ft.x,ft.y),rt.verticalTextBox&&hh(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!Ot||Ye,Je,oe,ft.x,ft.y)}let _t=Ot&&!!(!Ye&&rt.verticalIconBox);rt.iconBox&&hh(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,_t,Je,oe,pe.hasIconTextFit?ft.x:0,pe.hasIconTextFit?ft.y:0),rt.verticalIconBox&&hh(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!_t,Je,oe,pe.hasIconTextFit?ft.x:0,pe.hasIconTextFit?ft.y:0)}}}if(t.fullyClipped=fe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){let f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function hh(d,t,a,f,g,v,b){d.emplaceBack(t?1:0,a?1:0,v||0,b||0,f,g?1:0),d.emplaceBack(t?1:0,a?1:0,v||0,b||0,f,g?1:0),d.emplaceBack(t?1:0,a?1:0,v||0,b||0,f,g?1:0),d.emplaceBack(t?1:0,a?1:0,v||0,b||0,f,g?1:0)}let ps=Math.pow(2,25),Kv=Math.pow(2,24),yg=Math.pow(2,17),Br=Math.pow(2,16),Jv=Math.pow(2,9),dh=Math.pow(2,8),vg=Math.pow(2,1);function Dl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let t=d.placed?1:0,a=Math.floor(127*d.opacity);return a*ps+t*Kv+a*yg+t*Br+a*Jv+t*dh+a*vg+t}let Ml=0;class Qv{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,f,g,v){let b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(b,g,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<b.length;){let M=b[this._currentPartIndex];if(a.placeLayerBucketPart(M,this._seenCrossTileIDs,f,M.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Yc{constructor(t,a,f,g,v,b,M,A,O){this.placement=new Ra(t,v,b,M,A,O),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,f,g){let v=i.q.now(),b=()=>{let M=i.q.now()-v;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){let M=a[t[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=A)&&(!M.maxzoom||M.maxzoom>A)){let O=M,L=O.layout.get("symbol-z-elevate"),N=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,z=O.layout.get("symbol-z-order"),j=z==="viewport-y"||z==="auto"&&!(z!=="viewport-y"&&N),q=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),W=j&&q,Z=this._inProgressLayer=this._inProgressLayer||new Qv(O),X=i.av(M.source,M.scope);if(Z.continuePlacement(L||W?g[X]:f[X],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let Oa=512/i.ab/2;class ex{constructor(t,a,f){this.tileID=t,this.bucketInstanceId=f,this.index=new i.by(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=t.canonical.x*i.ab,v=t.canonical.y*i.ab;for(let b=0;b<a.length;b++){let{key:M,crossTileID:A,tileAnchorX:O,tileAnchorY:L}=a.get(b),N=Math.floor((g+O)*Oa),z=Math.floor((v+L)*Oa);this.index.add(N,z),this.keys.push(M),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,a,f){let g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=Oa/Math.pow(2,a.canonical.z-this.tileID.canonical.z),b=a.canonical.x*i.ab,M=a.canonical.y*i.ab;for(let A=0;A<t.length;A++){let O=t.get(A);if(O.crossTileID)continue;let{key:L,tileAnchorX:N,tileAnchorY:z}=O,j=Math.floor((b+N)*v),q=Math.floor((M+z)*v),W=this.index.range(j-g,q-g,j+g,q+g);for(let Z of W){let X=this.crossTileIDs[Z];if(this.keys[Z]===L&&!f.has(X)){f.add(X),O.crossTileID=X;break}}}}}class Sl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let a=Math.round((t-this.lng)/360);if(a!==0)for(let f in this.indexes){let g=this.indexes[f],v={};for(let b in g){let M=g[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+a),v[M.tileID.key]=M}this.indexes[f]=v}this.lng=t}addBucket(t,a,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let g=this.usedCrossTileIDs[t.overscaledZ];for(let v in this.indexes){let b=this.indexes[v];if(Number(v)>t.overscaledZ)for(let M in b){let A=b[M];A.tileID.isChildOf(t)&&A.findMatches(a.symbolInstances,t,g)}else{let M=b[t.scaledTo(Number(v)).key];M&&M.findMatches(a.symbolInstances,t,g)}}for(let v=0;v<a.symbolInstances.length;v++){let b=a.symbolInstances.get(v);b.crossTileID||(b.crossTileID=f.generate(),g.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ex(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(let f of a.crossTileIDs)this.usedCrossTileIDs[t].delete(f)}removeStaleBuckets(t){let a=!1;for(let f in this.indexes){let g=this.indexes[f];for(let v in g)t[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[v]),delete g[v],a=!0)}return a}}class fh{constructor(){this.layerIndexes={},this.crossTileIDs=new Sl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,f,g){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new xg);let b=!1,M={};g.name!=="globe"&&v.handleWrapJump(f);for(let A of a){let O=A.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,O,this.crossTileIDs)&&(b=!0),M[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(t){let a={};t.forEach(f=>{a[f]=!0});for(let f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}let Xr=771;class mn{constructor(t,a,f,g){this.blendFunction=t,this.blendColor=a,this.mask=f,this.blendEquation=g}}mn.Replace=[1,0,1,0],mn.disabled=new mn(mn.Replace,i.bz.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,i.bz.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,Xr,1,Xr],i.bz.transparent,[!0,!0,!0,!0]),mn.alphaBlendedNonPremultiplied=new mn([770,Xr,770,Xr],i.bz.transparent,[!0,!0,!0,!0]),mn.multiply=new mn([774,0,774,0],i.bz.transparent,[!0,!0,!0,!0]);class Dt{constructor(t,a,f){this.func=t,this.mask=a,this.range=f}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);let Mf=7680;class qt{constructor(t,a,f,g,v,b){this.test=t,this.ref=a,this.mask=f,this.fail=g,this.depthFail=v,this.pass=b}}qt.disabled=new qt({func:519,mask:0},0,0,Mf,Mf,Mf);let Sf=1029,Kc=2305;class kt{constructor(t,a,f){this.enable=t,this.mode=a,this.frontFace=f}}function Af(d,t){let a=i.bC(d,3);i.a6.mat4.fromQuat(d,t),i.bE(d,3,a)}function ph(d,t){let a=i.a6.quat.identity([]);return i.a6.quat.rotateZ(a,a,-t),i.a6.quat.rotateX(a,a,-d),a}function Pf(d,t){let a=[d[0],d[1],0],f=[t[0],t[1],0];if(i.a6.vec3.length(a)>=1e-15){let b=i.a6.vec3.normalize([],a);i.a6.vec3.scale(f,b,i.a6.vec3.dot(f,b)),t[0]=f[0],t[1]=f[1]}let g=i.a6.vec3.cross([],t,d);if(i.a6.vec3.len(g)<1e-15)return null;let v=Math.atan2(-g[1],g[0]);return ph(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}kt.disabled=new kt(!1,Sf,Kc),kt.backCCW=new kt(!0,Sf,Kc),kt.backCW=new kt(!0,Sf,2304),kt.frontCW=new kt(!0,1028,2304),kt.frontCCW=new kt(!0,1028,Kc);class Ws{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){let a=t instanceof i.a5?t:new i.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=i.bA(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;let f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(i.a5.fromLngLat(t)):0,v=i.a5.fromLngLat(t,g),b=[v.x-f.x,v.y-f.y,v.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Pf(b,a)}setPitchBearing(t,a){this.orientation=ph(i.bB(t),i.bB(-a))}}class La{constructor(t,a){this._transform=i.a6.mat4.identity([]),this.orientation=a,this.position=t}get mercatorPosition(){let t=this.position;return new i.a5(t[0],t[1],t[2])}get position(){let t=i.bC(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&i.bE(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.a6.quat.identity([]),t&&Af(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=ph(t,a),Af(this._transform,this._orientation)}forward(){let t=i.bC(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=i.bC(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=i.bC(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){let f=new Float64Array(16);return i.a6.mat4.invert(f,this.getWorldToCamera(t,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,f){let g=this.position;i.a6.vec3.scale(g,g,-t);let v=new Float64Array(16);return i.a6.mat4.fromScaling(v,[f,f,f]),i.a6.mat4.translate(v,v,g),v[10]*=a,v}getWorldToCamera(t,a){let f=new Float64Array(16),g=new Float64Array(4),v=this.position;return i.a6.quat.conjugate(g,this._orientation),i.a6.vec3.scale(v,v,-t),i.a6.mat4.fromQuat(f,g),i.a6.mat4.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(t,a,f,g){let v=new Float64Array(16);return i.a6.mat4.perspective(v,t,a,f,g),v}getCameraToClipOrthographic(t,a,f,g,v,b){let M=new Float64Array(16);return i.a6.mat4.ortho(M,t,a,f,g,v,b),M}getDistanceToElevation(t,a=!1){let f=t===0?0:i.bD(t,a?i.aM(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new La([...this.position],[...this.orientation])}}let cr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class mh{constructor(t=0,a=0,f=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=f,this.right=g}interpolate(t,a,f){return a.top!=null&&t.top!=null&&(this.top=i.aa(t.top,a.top,f)),a.bottom!=null&&t.bottom!=null&&(this.bottom=i.aa(t.bottom,a.bottom,f)),a.left!=null&&t.left!=null&&(this.left=i.aa(t.left,a.left,f)),a.right!=null&&t.right!=null&&(this.right=i.aa(t.right,a.right,f)),this}getCenter(t,a){let f=i.ap((this.left+t-this.right)/2,0,t),g=i.ap((this.top+a-this.bottom)/2,0,a);return new i.P(f,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new mh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Al=(d,t,a)=>(1-a)*d+a*t,Pl=d=>d*d*d*d*d;class gh{constructor(t,a,f,g,v,b,M){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new La,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new gh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(t||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return i.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=i.bL(this.projectionOptions);let f=this.getProjection(),g=!i.bh(a,f);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bL({name:"mercator"});let a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bA(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=i.a6.mat2.create(),i.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let a=i.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.bB(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),g=0,v=0;for(let b=0;b<a.length;b++){let M=new i.P(a[b][0]*this.width,f+a[b][1]*(this.height-f)),A=t.pointCoordinate(M);if(!A)continue;let O=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*O,v+=O}return v===0?NaN:g/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-f,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),f;f=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];let g=i.a6.vec3.length(i.a6.vec3.sub([],this._camera.position,f));return i.ap(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!i.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){let f=[t.position.x,t.position.y,t.position.z];i.a6.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,a=new Ws;return a.position=new i.a5(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!i.a6.quat.length(t))return!1;i.a6.quat.normalize(t,t);let a=i.a6.vec3.transformQuat([],[0,0,-1],t),f=i.a6.vec3.transformQuat([],[0,-1,0],t);if(f[2]<0)return!1;let g=Pf(a,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){let a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=i.ap(t[2],g/f,g/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,f){this._unmodified=!1,this._edgeInsets.interpolate(t,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){let a=[new i.bM(0,t)];if(this.renderWorldCopies){let f=this.pointCoordinate(new i.P(0,0)),g=this.pointCoordinate(new i.P(this.width,0)),v=this.pointCoordinate(new i.P(this.width,this.height)),b=this.pointCoordinate(new i.P(0,this.height)),M=Math.floor(Math.min(f.x,g.x,v.x,b.x)),A=Math.floor(Math.max(f.x,g.x,v.x,b.x)),O=1;for(let L=M-O;L<=A+O;L++)L!==0&&a.push(new i.bM(L,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,f){let g=[],v=f!==void 0,b=!v;if(b&&this.zoom<a||v&&f[0]===0&&f[1]===0)return g;let M=new Set,A=(L,N,z,j,q)=>{let W=i.c1(N,L,z,j,q);M.has(W)||(g.push(new i.aA(L,N,z,j,q)),M.add(W))};for(let L=0;L<t.length;L++){let N=t[L];if(b&&N.canonical.z!==a)continue;let z=N.canonical,j=N.overscaledZ,q=N.wrap,W=1<<z.z,Z=z.x+1<W,X=z.x>0,ne=z.y+1<W,oe=z.y>0,ee=N.wrap-(X?0:1),le=N.wrap+(Z?0:1),ae=X?z.x-1:W-1,fe=Z?z.x+1:0;if(v)f[0]<0?(A(j,le,z.z,fe,z.y),f[1]<0&&ne&&(A(j,q,z.z,z.x,z.y+1),A(j,le,z.z,fe,z.y+1)),f[1]>0&&oe&&(A(j,q,z.z,z.x,z.y-1),A(j,le,z.z,fe,z.y-1))):f[0]>0?(A(j,ee,z.z,ae,z.y),f[1]<0&&ne&&(A(j,q,z.z,z.x,z.y+1),A(j,ee,z.z,ae,z.y+1)),f[1]>0&&oe&&(A(j,q,z.z,z.x,z.y-1),A(j,ee,z.z,ae,z.y-1))):f[1]<0&&ne?A(j,q,z.z,z.x,z.y+1):oe&&A(j,q,z.z,z.x,z.y-1);else{let he=N.visibleQuadrants;1&he&&(A(j,ee,z.z,ae,z.y),oe&&(A(j,q,z.z,z.x,z.y-1),A(j,ee,z.z,ae,z.y-1))),2&he&&(A(j,le,z.z,fe,z.y),oe&&(A(j,q,z.z,z.x,z.y-1),A(j,le,z.z,fe,z.y-1))),4&he&&(A(j,ee,z.z,ae,z.y),ne&&(A(j,q,z.z,z.x,z.y+1),A(j,ee,z.z,ae,z.y+1))),8&he&&(A(j,le,z.z,fe,z.y),ne&&(A(j,q,z.z,z.x,z.y+1),A(j,le,z.z,fe,z.y+1)))}}let O=[];for(let L of g)g.some(N=>L.isChildOf(N))||O.push(L);if(g=O.filter(L=>!t.some(N=>!!(L.overscaledZ<a&&N.isChildOf(L))||L.equals(N)||L.isChildOf(N))),b){let L=1<<a,N=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[L*N.x,L*N.y],j=4,q=j*j;g=g.filter(W=>{let Z=W.canonical.x+.5-z[0],X=W.canonical.y+.5-z[1];return Z*Z+X*X<q})}return g}coveringTiles(t){let a=this.coveringZoomLevel(t),f=a,g=this.elevation&&this.elevation.exaggeration(),v=g&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);let M=this.locationCoordinate(this.center),A=this.center.lat,O=1<<a,L=[O*M.x,O*M.y,0],N=this.projection.name==="globe",z=!N,j=i.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,z),q=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=O*i.bD(1,this.center.lat),Z=this._camera.position[2]/i.bD(1,this.center.lat),X=[O*q.x,O*q.y,Z*(z?1:W)],ne=N||g,oe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ee=this.isLODDisabled(!0)?a:0,le;if(this._elevation&&t.isTerrainDEM)le=1e4*this._elevation.exaggeration();else if(this._elevation){let Se=this._elevation.getMinMaxForVisibleTiles();le=Se?Se.max:this._centerAltitude}else le=this._centerAltitude;let ae=t.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?i.bO(this):1,he=Se=>{let Ue=new i.a5(Se.x+25e-6,Se.y,Se.z),et=new i.a5(Se.x,Se.y+25e-6,Se.z),nt=Se.toLngLat(),He=Ue.toLngLat(),Ye=et.toLngLat(),Et=this.locationCoordinate(nt),rt=this.locationCoordinate(He),ft=this.locationCoordinate(Ye),Ot=Math.hypot(rt.x-Et.x,rt.y-Et.y),_t=Math.hypot(ft.x-Et.x,ft.y-Et.y);return Math.sqrt(Ot*_t)*fe/25e-6},pe=Se=>{let Ge=le,Ue=ae;return{aabb:i.bR(this,O,0,0,0,Se,Ue,Ge,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:Ge,wrap:Se,fullyVisible:!1}},we=[],ye=[],ge=a,Me=t.reparseOverscaled?f:a,Be=(Z-this._centerAltitude)*W,qe=Se=>{if(!this._elevation||!Se.tileID||!b)return;let Ge=this._elevation.getMinMaxForTile(Se.tileID),Ue=Se.aabb;Ge?(Ue.min[2]=Ge.min,Ue.max[2]=Ge.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Se.shouldSplit=Je(Se),Se.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},ze=(Se,Ge)=>{if(.707*Ge<Se)return 1;let Ue=Ge/Se;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},Je=Se=>{if(Se.zoom<ee)return!0;if(Se.zoom===ge)return!1;if(Se.shouldSplit!=null)return Se.shouldSplit;let Ge=Se.aabb.distanceX(X),Ue=Se.aabb.distanceY(X),et=Be,nt=1;if(N){et=Se.aabb.distanceZ(X);let _t=Math.pow(2,Se.zoom),Mt=i.aM((Se.y+1)/_t),ln=i.aM(Se.y/_t),rn=Math.min(Math.max(A,Mt),ln),jn=i.c5(rn)/i.c5(A);if(nt=rn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jn/this._mercatorScaleRatio),this.zoom<=i.c2&&Se.zoom===ge-1&&jn>=.9)return!0}else if(v&&(et=Se.aabb.distanceZ(X)*W),this.projection.isReprojectedInTileSpace&&f<=5){let _t=Math.pow(2,Se.zoom),Mt=he(new i.a5((Se.x+.5)/_t,(Se.y+.5)/_t));nt=Mt>.85?1:Mt}if(!b){let _t=Math.sqrt(Ge*Ge+Ue*Ue+et*et),Mt=(1<<ge-Se.zoom)*oe*nt;return Mt*=ze(Math.max(et,Be),_t),_t<Mt}let He=Number.MAX_VALUE,Ye=0,Et=Se.aabb.getCorners(),rt=[];for(let _t of Et){i.a6.vec3.sub(rt,_t,X),N||(v?rt[2]*=W:rt[2]=Be);let Mt=i.a6.vec3.dot(rt,this._camera.forward());Mt<He&&(He=Mt,Ye=Math.abs(rt[2]))}let ft=(1<<ge-Se.zoom)*oe*nt;if(ft*=ze(Math.max(Ye,Be),He),He<ft)return!0;let Ot=Se.aabb.closestPoint(L);return Ot[0]===L[0]&&Ot[1]===L[1]};if(this.renderWorldCopies)for(let Se=1;Se<=3;Se++)we.push(pe(-Se)),we.push(pe(Se));for(we.push(pe(0));we.length>0;){let Se=we.pop(),Ge=Se.x,Ue=Se.y,et=Se.fullyVisible,nt=()=>this.projection.name==="globe"&&(Se.y===0||Se.y===(1<<Se.zoom)-1);if(!et){let He=ne?Se.aabb.intersects(j):Se.aabb.intersectsFlat(j);if(He===0&&nt()){let Ye=new i.bP(Se.zoom,Ge,Ue);He=i.bQ(this,O,Ye,!0).intersects(j)}if(He===0)continue;et=He===2}if(Se.zoom!==ge&&Je(Se))for(let He=0;He<4;He++){let Ye=(Ge<<1)+He%2,Et=(Ue<<1)+(He>>1),rt={aabb:b?Se.aabb.quadrant(He):i.bR(this,O,Se.zoom+1,Ye,Et,Se.wrap,Se.minZ,Se.maxZ,this.projection),zoom:Se.zoom+1,x:Ye,y:Et,wrap:Se.wrap,fullyVisible:et,tileID:void 0,shouldSplit:void 0,minZ:Se.minZ,maxZ:Se.maxZ};v&&!N&&(rt.tileID=new i.aA(Se.zoom+1===ge?Me:Se.zoom+1,Se.wrap,Se.zoom+1,Ye,Et),qe(rt)),we.push(rt)}else{let He=Se.zoom===ge?Me:Se.zoom;if(t.minzoom&&t.minzoom>He)continue;let Ye=0;if(!et){let Ot=ne?Se.aabb.intersectsPrecise(j):Se.aabb.intersectsPreciseFlat(j);if(Ot===0&&nt()){let _t=new i.bP(Se.zoom,Ge,Ue);Ot=i.bQ(this,O,_t,!0).intersectsPrecise(j)}if(Ot===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(Se.aabb.center))Ye=15;else for(let _t=0;_t<4;_t++)Se.aabb.quadrant(_t).intersects(j)!==0&&(Ye|=1<<_t)}let Et=L[0]-(.5+Ge+(Se.wrap<<Se.zoom))*(1<<a-Se.zoom),rt=L[1]-.5-Ue,ft=Se.tileID?Se.tileID:new i.aA(He,Se.wrap,Se.zoom,Ge,Ue);t.calculateQuadrantVisibility&&(ft.visibleQuadrants=Ye),ye.push({tileID:ft,distanceSq:Et*Et+rt*rt})}}if(this.fogCullDistSq){let Se=this.fogCullDistSq,Ge=this.horizonLineFromTop();ye=ye.filter(Ue=>{let et=[0,0,0,1],nt=[i.ab,i.ab,0,1],He=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());i.a6.vec4.transformMat4(et,et,He),i.a6.vec4.transformMat4(nt,nt,He);let Ye=i.a6.vec4.min([],et,nt),Et=i.a6.vec4.max([],et,nt),rt=i.bS(Ye,Et);if(rt===0)return!0;let ft=!1,Ot=this._elevation;if(Ot&&rt>Se&&Ge!==0){let _t=this.calculateProjMatrix(Ue.tileID.toUnwrapped()),Mt;t.isTerrainDEM||(Mt=Ot.getMinMaxForTile(Ue.tileID)),Mt||(Mt={min:ae,max:le});let ln=i.c3(this.rotation),rn=[ln[0]*i.ab,ln[1]*i.ab,Mt.max];i.a6.vec3.transformMat4(rn,rn,_t),ft=(1-rn[1])*this.height*.5<Ge}return rt<Se||ft})}return ye.sort((Se,Ge)=>Se.distanceSq-Ge.distanceSq).map(Se=>Se.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let a=i.ap(t.lat,-i.bT,i.bT),f=this.projection.project(t.lng,a);return new i.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let f,g,v=this.centerPoint;if(this.projection.name==="globe"){let M=this.worldSize;f=(a.x-v.x)/M,g=(a.y-v.y)/M}else{let M=this.pointCoordinate(a),A=this.pointCoordinate(v);f=M.x-A.x,g=M.y-A.y}let b=this.locationCoordinate(t);this.setLocation(new i.a5(b.x-f,b.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,a){let f=a?i.bD(a,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new i.a5(g.x,g.y,f)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){let f=a??this._centerAltitude,g=[t.x,t.y,0,1],v=[t.x,t.y,1,1];i.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),i.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse);let b=v[3];i.a6.vec4.scale(g,g,1/g[3]),i.a6.vec4.scale(v,v,1/b);let M=g[2],A=v[2];return{p0:g,p1:v,t:M===A?0:(f-M)/(A-M)}}screenPointToMercatorRay(t){let a=[t.x,t.y,0,1],f=[t.x,t.y,1,1];return i.a6.vec4.transformMat4(a,a,this.pixelMatrixInverse),i.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),i.a6.vec4.scale(a,a,1/a[3]),i.a6.vec4.scale(f,f,1/f[3]),a[2]=i.bD(a[2],this._center.lat)*this.worldSize,f[2]=i.bD(f[2],this._center.lat)*this.worldSize,i.a6.vec4.scale(a,a,1/this.worldSize),i.a6.vec4.scale(f,f,1/this.worldSize),new i.aj([a[0],a[1],a[2]],i.a6.vec3.normalize([],i.a6.vec3.sub([],f,a)))}rayIntersectionCoordinate(t){let{p0:a,p1:f,t:g}=t,v=i.bD(a[2],this._center.lat),b=i.bD(f[2],this._center.lat);return new i.a5(i.aa(a[0],f[0],g)/this.worldSize,i.aa(a[1],f[1],g)/this.worldSize,i.aa(v,b,g))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let a=this.projection.pointCoordinate3D(this,t.x,t.y);if(a)return new i.a5(a[0],a[1],a[2]);let f=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);let v=.02*g,b=t.clone();for(let M=0;M<10&&g-f>v;M++){b.y=i.aa(f,g,.66);let A=this.projection.pointCoordinate3D(this,b.x,b.y);A?(g=b.y,a=A):f=b.y}return a?new i.a5(a[0],a[1],a[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.bU)return!this.isPointAboveHorizon(t);let a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){let f=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,f+t.toAltitude(),1];return i.a6.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new i.P(g[0]/g[3],g[1]/g[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new i.P(a,t)),b=this.pointLocation3D(new i.P(g,t)),M=this.pointLocation3D(new i.P(g,f)),A=this.pointLocation3D(new i.P(a,f)),O=Math.min(v.lng,b.lng,M.lng,A.lng),L=Math.max(v.lng,b.lng,M.lng,A.lng),N=Math.min(v.lat,b.lat,M.lat,A.lat),z=Math.max(v.lat,b.lat,M.lat,A.lat),j=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,W=(Z,X,ne,oe,ee)=>{let le=(Z+ne)/2,ae=(X+oe)/2,fe=new i.P(le,ae),{lng:he,lat:pe}=this.pointLocation3D(fe),we=Math.max(0,O-he,N-pe,he-L,pe-z);O=Math.min(O,he),L=Math.max(L,he),N=Math.min(N,pe),z=Math.max(z,pe),(ee<q||we>j)&&(W(Z,X,le,ae,ee+1),W(le,ae,ne,oe,ee+1))};if(W(a,t,g,t,1),W(g,t,g,f,1),W(g,f,a,f,1),W(a,f,a,t,1),this.projection.name==="globe"){let[Z,X]=i.bV(this);Z?(z=90,L=180,O=-180):X&&(N=-90,L=180,O=-180)}return new i.as(new i.bK(O,N),new i.bK(L,z))}_getBoundsRectangular(t,a){let{top:f,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,M=new i.P(g,f),A=new i.P(b,f),O=new i.P(b,v),L=new i.P(g,v),N=this.pointCoordinate(M,t),z=this.pointCoordinate(A,t),j=this.pointCoordinate(O,a),q=this.pointCoordinate(L,a),W=(Z,X)=>(X.y-Z.y)/(X.x-Z.x);return N.y>1&&z.y>=0?N=new i.a5((1-q.y)/W(q,N)+q.x,1):N.y<0&&z.y<=1&&(N=new i.a5(-q.y/W(q,N)+q.x,0)),z.y>1&&N.y>=0?z=new i.a5((1-j.y)/W(j,z)+j.x,1):z.y<0&&N.y<=1&&(z=new i.a5(-j.y/W(j,z)+j.x,0)),new i.as().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=t.visibleDemTiles.reduce((f,g)=>{if(g.dem){let v=g.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.bT,this.maxLat=i.bT,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.am(this.minLng)*this.tileSize,this.worldMaxX=i.am(this.maxLng)*this.tileSize,this.worldMinY=i.at(this.maxLat)*this.tileSize,this.worldMaxY=i.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){let a=t.key,f=this._distanceTileDataCache;if(f[a])return f[a];let g=t.canonical,v=1/this.height,b=this.cameraWorldSize,M=b/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*t.wrap)*M,O=g.y*M,L=this.point;L.x*=b/this.worldSize,L.y*=b/this.worldSize;let N=this.angle,z=Math.sin(-N),j=-Math.cos(-N);return f[a]={bearing:[z,j],center:[(L.x-A)*v,(L.y-O)*v],scale:M/i.ab*v},f[a]}calculateFogTileMatrix(t){let a=t.key,f=this._fogTileMatrixCache;if(f[a])return f[a];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.a6.mat4.multiply(g,this.worldToFogMatrix,g),f[a]=new Float32Array(g),f[a]}calculateProjMatrix(t,a=!1,f=!1){let g=t.key,v;if(v=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];let b=this.calculatePosMatrix(t,this.worldSize),M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,i.a6.mat4.multiply(b,M,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(t){let a=t.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];let g=i.bW(t,this);return f[a]=g,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,a=i.a6.mat4.fromScaling([],[t,t,t]);return i.a6.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let a=i.bD(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),g=this._camera.forward(),v=i.bD(1,this._center.lat);f[2]/=v,g[2]/=v,i.a6.vec3.normalize(g,g);let b=t.raycast(f,g,t.exaggeration());if(b){let M=i.a6.vec3.scaleAndAdd([],f,g,b),A=new i.a5(M[0],M[1],i.bD(M[2],i.aM(M[1]))),O=(A.z+i.a6.vec3.length([A.x-f[0],A.y-f[1],A.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let a=this._elevation,f=i.bD(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),v=a.getAtPointOrZero(new i.a5(...g)),b=this.pixelsPerMeter/this.worldSize*v,M=this._minimumHeightOverTerrain(),A=g[2]-b;if(A<=M)if(A<0||t){let O=this.locationCoordinate(this._center,this._centerAltitude),L=[g[0],g[1],O.z-g[2]],N=i.a6.vec3.length(L);L[2]-=(M-A)/this._pixelsPerMercatorPixel;let z=i.a6.vec3.length(L);if(z===0)return;i.a6.vec3.scale(L,L,N/z*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],O.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let z=this.center;return z.lat=i.ap(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=i.ap(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let a=this._unmodified,{x:f,y:g}=this.point,v=0,b=f,M=g,A=this.width/2,O=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(g-O<L&&(M=L+O),g+O>N&&(M=N-O),N-L<this.height&&(v=Math.max(v,this.height/(N-L)),M=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,q=this.worldSize/2-(z+j)/2;b=(f+q+this.worldSize)%this.worldSize-q,b-A<z&&(b=z+A),b+A>j&&(b=j-A),j-z<this.width&&(v=Math.max(v,this.width/(j-z)),b=(j+z)/2)}b===f&&M===g||(this.center=this.unproject(new i.P(b,M))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bD(1,this.center.lat)/i.bD(1,i.c4));let g=i.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,v),M,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=pe*this.aspect,ye=-we,ge=-pe;we-=t.x,ye-=t.x,pe+=t.y,ge+=t.y,M=this._camera.getCameraToClipOrthographic(ye,we,ge,pe,this._nearZ,this._farZ),((Me,Be,qe,ze)=>{for(let Je=0;Je<16;Je++)Me[Je]=Al(Be[Je],qe[Je],ze)})(M,M,A,Pl(this.pitch>=15?1:this.pitch/15))}else M=A;let O=i.a6.mat4.mul([],A,b),L=i.a6.mat4.mul([],M,b);if(this.projection.isReprojectedInTileSpace){let pe=this.locationCoordinate(this.center),we=i.a6.mat4.identity([]);i.a6.mat4.translate(we,we,[pe.x*this.worldSize,pe.y*this.worldSize,0]),i.a6.mat4.multiply(we,we,i.bY(this)),i.a6.mat4.translate(we,we,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),i.a6.mat4.multiply(L,L,we),i.a6.mat4.multiply(O,O,we),this.inverseAdjustmentMatrix=i.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.a6.mat4.scale([],L,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=L,this.invProjMatrix=i.a6.mat4.invert(new Float64Array(16),this.projMatrix),a){let pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);pe[8]=2*-t.x/this.width,pe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.a6.mat4.mul([],pe,b)}else this.expandedFarZProjMatrix=this.projMatrix;let N=i.a6.mat4.invert([],M);this.frustumCorners=i.b_.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let z=new Float32Array(16);i.a6.mat4.identity(z),i.a6.mat4.scale(z,z,[1,-1,1]),i.a6.mat4.rotateX(z,z,this._pitch),i.a6.mat4.rotateZ(z,z,this.angle);let j=i.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.a6.mat4.clone(j);let q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+q)/this.height,this.skyboxMatrix=i.a6.mat4.multiply(z,j,z);let W=this.point,Z=W.x,X=W.y,ne=this.width%2/2,oe=this.height%2/2,ee=Math.cos(this.angle),le=Math.sin(this.angle),ae=Z-Math.round(Z)+ee*ne+le*oe,fe=X-Math.round(X)+ee*oe+le*ne,he=new Float64Array(L);if(i.a6.mat4.translate(he,he,[ae>.5?ae-1:ae,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=he,L=i.a6.mat4.create(),i.a6.mat4.scale(L,L,[this.width/2,-this.height/2,1]),i.a6.mat4.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.a6.mat4.create(),i.a6.mat4.scale(L,L,[1,-1,1]),i.a6.mat4.translate(L,L,[-1,-1,0]),i.a6.mat4.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.b$(this);let pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.a6.vec3.transformMat4(pe,pe,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,a];i.a6.vec3.scale(v,v,g),i.a6.vec3.scale(f,f,-1),i.a6.vec3.multiply(f,f,v);let b=i.a6.mat4.create();i.a6.mat4.translate(b,b,f),i.a6.mat4.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,g)}_computeCameraPosition(t){let a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*v,g.y/this.worldSize-f[1]*v,t/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=t[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((a-f)/g,1)),this._camera.position=i.a6.vec3.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),v=i.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.bB(this._maxPitch)),M=Math.max((t[2]-v)/Math.cos(f),b),A=this._zoomFromMercatorZ(M);i.a6.vec3.scaleAndAdd(t,t,a,M),this._pitch=i.ap(f,i.bB(this.minPitch),i.bB(this.maxPitch)),this.angle=i.bA(g,-Math.PI,Math.PI),this._setZoom(i.ap(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,f=i.bU,g=0,v=1/0;for(;f-a>1e-6&&f>a;){let b=a+.5*(f-a),M=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,M),O=this.scaleZoom(A/(t*this.tileSize)),L=Math.abs(b-O);L<v&&(v=L,g=b),b<O?a=b:f=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){let f=Math.min(t.x,a.x),g=Math.max(t.x,a.x),v=Math.min(t.y,a.y),b=Math.max(t.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let M=[new i.P(f,v),new i.P(g,b),new i.P(f,b),new i.P(g,v)],A=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let L of M){let N=this.pointRayIntersection(L);if(N.t<0)return!0;let z=this.rayIntersectionCoordinate(N);if(z.x<A||z.y<0||z.x>O||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,a){let f=i.a6.vec3.length(i.a6.vec3.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([a,f,g],v){let b=[a,f,g,1];i.a6.vec4.transformMat4(b,b,v);let M=b[3]=Math.max(b[3],1e-6);return b[0]/=M,b[1]/=M,b[2]/=M,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,f=this.worldSize){let g=i.bX(t,a,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,f,g),b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=Al(1,b,Pl(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return i.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let ms=(d,t)=>{if(t>0&&d.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=d.transform,f=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?i.a7(60,45,a.pitch):i.a7(30,15,a.pitch),v=a._farZ-a._nearZ,b=t*a.height,M=((1-(A=g))*a.cameraToCenterDistance+A*(a._farZ+b))*f;var A;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(M-a._nearZ)/v,(M-b-a._nearZ)/v]}}},gi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Rf{constructor(t,a){this.aabb=t,this.lastCascade=a}}class at{add(t,a){let f=this.receivers[t.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[t.key]=new Rf(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,f){let g=i.c9.fromPoints(t.points),v=0;for(let b in this.receivers){let M=this.receivers[b];if(!M||!g.intersectsAabb(M.aabb))continue;M.aabb.min=g.closestPoint(M.aabb.min),M.aabb.max=g.closestPoint(M.aabb.max);let A=M.aabb.getCorners();for(let O=0;O<f.length;O++){let L=!0;for(let N of A){let z=[N[0]*a,N[1]*a,N[2]];if(i.a6.vec3.transformMat4(z,z,f[O].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){L=!1;break}}if(M.lastCascade=O,v=Math.max(v,O),L)break}}return v+1}}class bg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new at,this._depthMode=new Dt(t.context.gl.LEQUAL,Dt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(gi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(gi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(gi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((q,W)=>{let Z=f.style._mergedLayers[W];return q+(Z.hasShadowPass()&&!Z.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=f.context,b=gi.shadowMapResolution,M=gi.shadowMapResolution;if(this._cascades.length===0||gi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<gi.cascadeCount;++q){let W=f._shadowMapDebug,Z=v.gl,X=v.createFramebuffer(b,M,W,"texture"),ne=new i.T(v,{width:b,height:M,data:null},Z.DEPTH_COMPONENT16);if(X.depthAttachment.set(ne.texture),W){let oe=new i.T(v,{width:b,height:M,data:null},Z.RGBA8);X.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:X,texture:ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bN,scale:0})}}this.shadowDirection=_h(a);let A=0;if(t.elevation){let q=t.elevation,W=[1e4,-1e4];q.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{let X=Z.dem.tree;W[0]=Math.min(W[0],X.minimums[0]),W[1]=Math.max(W[1],X.maximums[0])}),W[0]!==1e4&&(A=(W[1]-W[0])*q.exaggeration())}let O=1.5*t.cameraToCenterDistance,L=3*O,N=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){let W=this._cascades[q],Z=t.height/50,X=1;gi.cascadeCount===1?X=L:q===0?X=O:(Z=O,X=L);let[ne,oe]=vh(t,this.shadowDirection,Z,X,gi.shadowMapResolution,A);W.scale=t.scale,W.matrix=ne,W.boundingSphereRadius=oe,i.a6.mat4.invert(N,W.matrix),W.frustum=i.bN.fromInvProjectionMatrix(N,1,0,!0),W.far=X}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/gi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=gi.shadowMapResolution,this._uniformValues.u_shadowmap_0=cr.ShadowMap0,this._uniformValues.u_shadowmap_1=cr.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let j=f.transform.elevation;for(let q of this._groundShadowTiles){let W={min:0,max:0};if(j){let Z=j.getMinMaxForTile(q);Z&&(W=Z)}this.addShadowReceiver(q.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;let f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,gi.shadowMapResolution,gi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:i.bz.white,depth:1});for(let b of t.order){let M=t._mergedLayers[b];if(!M.hasShadowPass()||M.isHidden(f.transform.zoom))continue;let A=t.getLayerSourceCache(M),O=A?a[A.id]:void 0;(M.type==="model"||O&&O.length)&&f.renderLayer(f,A,M,O)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,a=t.style,f=t.context,g=a.directionalLight,v=a.ambientLight;if(!g||!v)return;let b=[],M=ms(t,t.longestCutoffRange);M.shouldRenderCutoff&&b.push("RENDER_CUTOFF");let A=yh(a,g,v),O=new Dt(f.gl.LEQUAL,Dt.ReadOnly,t.depthRangeFor3D);for(let L of this._groundShadowTiles){let N=L.toUnwrapped(),z=t.isTileAffectedByFog(L),j=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:z});this.setupShadows(N,j),t.uploadCommonUniforms(f,j,N,null,M);let q={u_matrix:t.transform.calculateProjMatrix(N),u_ground_shadow_factor:A};j.draw(t,f.gl.TRIANGLES,O,qt.disabled,mn.multiply,kt.disabled,q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?mn.unblended:mn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let a=this.painter.transform,f=a.calculatePosMatrix(t,a.worldSize);return i.a6.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(t){return i.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,f,g=0){if(!this.enabled)return;let v=this.painter.transform,b=this.painter.context,M=b.gl,A=this._uniformValues,O=new Float64Array(16),L=v.calculatePosMatrix(t,v.worldSize);for(let N=0;N<this._cascades.length;N++)i.a6.mat4.multiply(O,this._cascades[N].matrix,L),A[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),b.activeTexture.set(M.TEXTURE0+cr.ShadowMap0+N),this._cascades[N].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){let N=i.c8(t.canonical),z=2/v.tileSize*i.ab/gi.shadowMapResolution,j=z*this._cascades[0].boundingSphereRadius,q=z*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(f==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-v.zoom+Math.floor(v.zoom)));A.u_shadow_normal_offset=[N,j*W,q*W],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,A)}setupShadowsFromMatrix(t,a,f=!1){if(!this.enabled)return;let g=this.painter.context,v=g.gl,b=this._uniformValues,M=new Float64Array(16);for(let A=0;A<gi.cascadeCount;A++)i.a6.mat4.multiply(M,this._cascades[A].matrix,t),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),g.activeTexture.set(v.TEXTURE0+cr.ShadowMap0+A),this._cascades[A].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){let A=gi.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,f,g){if(g[2]>=0)return{};let v=function(A,O,L){let N=L/(1<<A.canonical.z);return new i.c9([A.canonical.x*N+A.wrap*L,A.canonical.y*N+A.wrap*L,0],[(A.canonical.x+1)*N+A.wrap*L,(A.canonical.y+1)*N+A.wrap*L,O])}(t,a,f).getCorners(),b=a/-g[2];g[0]<0?(i.a6.vec3.add(v[0],v[0],[g[0]*b,0,0]),i.a6.vec3.add(v[3],v[3],[g[0]*b,0,0])):g[0]>0&&(i.a6.vec3.add(v[1],v[1],[g[0]*b,0,0]),i.a6.vec3.add(v[2],v[2],[g[0]*b,0,0])),g[1]<0?(i.a6.vec3.add(v[0],v[0],[0,g[1]*b,0]),i.a6.vec3.add(v[1],v[1],[0,g[1]*b,0])):g[1]>0&&(i.a6.vec3.add(v[2],v[2],[0,g[1]*b,0]),i.a6.vec3.add(v[3],v[3],[0,g[1]*b,0]));let M={};return M.vertices=v,M.planes=[Rl(v[1],v[0],v[4]),Rl(v[2],v[1],v[5]),Rl(v[3],v[2],v[6]),Rl(v[0],v[3],v[7])],M}addShadowReceiver(t,a,f){this._receivers.add(t,i.c9.fromTileIdAndHeight(t,a,f))}getMaxCascadeForTile(t){let a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function Rl(d,t,a){let f=i.a6.vec3.sub([],a,t),g=i.a6.vec3.sub([],d,t),v=i.a6.vec3.cross([],f,g),b=i.a6.vec3.length(v);return b===0?[0,0,1,0]:(i.a6.vec3.scale(v,v,1/b),[v[0],v[1],v[2],-i.a6.vec3.dot(v,t)])}function _h(d){let t=d.properties.get("direction"),a=i.c7(t.x,t.y,t.z);a[2]=i.ap(a[2],0,75);let f=i.ca([a[0],a[1],a[2]]);return i.a6.vec3.fromValues(f.x,f.y,f.z)}function yh(d,t,a){let f=t.properties.get("color"),g=t.properties.get("intensity"),v=t.properties.get("direction"),b=[v.x,v.y,v.z],M=a.properties.get("color"),A=a.properties.get("intensity"),O=Math.max(i.a6.vec3.dot([0,0,1],b),0),L=[0,0,0];i.a6.vec3.scale(L,M.toRenderColor(d.getLut(t.scope)).toArray01Linear().slice(0,3),A);let N=[0,0,0];return i.a6.vec3.scale(N,f.toRenderColor(d.getLut(a.scope)).toArray01Linear().slice(0,3),O*g),i.cb([L[0]>0?L[0]/(L[0]+N[0]):0,L[1]>0?L[1]/(L[1]+N[1]):0,L[2]>0?L[2]/(L[2]+N[2]):0])}function vh(d,t,a,f,g,v){let b=d.zoom,M=d.scale,A=d.worldSize,O=1/A,L=d.aspect,N=Math.sqrt(1+L*L)*Math.tan(.5*d.fovX),z=N*N,j=f-a,q=f+a,W,Z;z>j/q?(W=f,Z=f*N):(W=.5*q*(1+z),Z=.5*Math.sqrt(j*j+2*(f*f+a*a)*z+q*q*z*z));let X=d.projection.pixelsPerMeter(d.center.lat,A),ne=d._camera.getCameraToWorldMercator(),oe=[0,0,-W*O];i.a6.vec3.transformMat4(oe,oe,ne);let ee=Z*O,le=d._edgeInsets;if(!(le.left===0&&le.top===0&&le.right===0&&le.bottom===0||le.left===le.right&&le.top===le.bottom)){let et=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?X:1),nt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,f);nt[8]=2*-d.centerOffset.x/d.width,nt[9]=2*d.centerOffset.y/d.height;let He=new Float64Array(16);i.a6.mat4.mul(He,nt,et);let Ye=new Float64Array(16);i.a6.mat4.invert(Ye,He);let Et=i.bN.fromInvProjectionMatrix(Ye,A,b,!0);for(let rt of Et.points){let ft=((ae=rt)[0]/=M,ae[1]/=M,ae[2]=i.bD(ae[2],d._center.lat),ae);ee=Math.max(ee,i.a6.vec3.len(i.a6.vec3.subtract([],oe,ft)))}}var ae;ee*=g/(g-1);let fe=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),pe=new La;pe.position=oe,pe.setPitchBearing(fe,he);let we=pe.getWorldToCamera(A,X),ye=ee*A,ge=Math.min(d._mercatorZfromZoom(17)*A*-2,-2*ye),Me=pe.getCameraToClipOrthographic(-ye,ye,-ye,ye,ge,(ye+v*X)/t[2]),Be=new Float64Array(16);i.a6.mat4.multiply(Be,Me,we);let qe=i.a6.vec3.fromValues(Math.floor(1e6*oe[0])/1e6*A,Math.floor(1e6*oe[1])/1e6*A,0),ze=.5*g,Je=[0,0,0];i.a6.vec3.transformMat4(Je,qe,Be),i.a6.vec3.scale(Je,Je,ze);let Se=[Math.floor(Je[0]),Math.floor(Je[1]),Math.floor(Je[2])],Ge=[0,0,0];i.a6.vec3.sub(Ge,Je,Se),i.a6.vec3.scale(Ge,Ge,-1/ze);let Ue=new Float64Array(16);return i.a6.mat4.identity(Ue),i.a6.mat4.translate(Ue,Ue,Ge),i.a6.mat4.multiply(Be,Ue,Be),[Be,ye]}class gs extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,a){return i.aG(this.requestManager.transformRequest(a,i.R.Model).url).then(f=>{if(!f)return;let g=i.aH(f),v=new i.aI(t,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new i.t(new Error(`Could not load model ${t} from ${a}: ${f.message}`)))})}load(t,a){this.models[a]||(this.models[a]={});let f=Object.keys(t);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+f.length;let g=[];for(let v of f)g.push(this.loadModel(v,t[v]));Promise.allSettled(g).then(v=>{for(let b=0;b<v.length;b++){let{status:M,value:A}=v[b];M==="fulfilled"&&A&&(this.models[a][f[b]]={model:A,numReferences:1})}this.numModelsLoading[a]-=f.length,this.fire(new i.x("data",{dataType:"style"}))}).catch(v=>{this.fire(new i.t(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a){return!!this.getModel(t,a)}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}addModel(t,a,f){this.models[f]||(this.models[f]={}),this.hasModel(t,f)&&this.models[f][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(a)},f)}addModels(t,a){this.models[a]||(this.models[a]={});let f={};for(let g in t)this.models[a][g]={},f[g]=this.requestManager.normalizeModelURL(t[g]);this.load(f,a)}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={});let f={};for(let g of t)this.hasModel(g,a)?this.models[a][g].numReferences++:f[g]=this.requestManager.normalizeModelURL(g);this.load(f,a)}removeModel(t,a){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0)){let f=this.models[a][t].model;delete this.models[a][t],f.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(let f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(t.context)}}let Of=new i.a0({data:new i.a1(i._.colorTheme.data)}),Yr=(d,t)=>Ce(d,t&&t.filter(a=>a.identifier!=="source.canvas")),xh=i.ar(Cn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ol=i.ar(Cn,["setCenter","setZoom","setBearing","setPitch"]),wg={version:8,layers:[],sources:{}},Tg={duration:300,delay:0};class Kr extends i.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=i.l({},Tg),this._buildingIndex=new Ef(this),this.crossTileSymbolIndex=new fh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Bc,this.dispatcher=a.dispatcher?a.dispatcher:new i.cd(i.ce(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Ea,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new i.cf(t._requestManager,a.localFontFamily?i.cg.all:a.localIdeographFontFamily?i.cg.ideographs:i.cg.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new gs(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",i.ch());let f=this;this._rtlTextPluginCallback=Kr.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,b)=>{if(i.ci(v),b&&b.every(M=>M))for(let M in f._sourceCaches){let A=f._sourceCaches[M],O=A.getSource().type;O!=="vector"&&O!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(let b in this._layers){let M=this._layers[b];M.source===v.id&&this._validateLayer(M)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.f(t))return t;let a=i.cj(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${i.ck(JSON.stringify(t))}`}_diffStyle(t,a,f){this.globalId=this._getGlobalId(t);let g=(v,b)=>{try{b(null,this.setState(v,f))}catch(M){b(M,!1)}};if(typeof t=="string"){let v=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(v,i.R.Style);i.n(b,(M,A)=>{M?this.fire(new i.t(M)):A&&g(A,a)})}else typeof t=="object"&&g(t,a)}loadURL(t,a={}){this.fire(new i.x("dataloading",{dataType:"style"}));let f=typeof a.validate=="boolean"?a.validate:!i.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);let g=this.importsCache.get(t);if(g)return this._load(g,f);let v=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.n(v,(b,M)=>{if(this._request=null,b)this.fire(new i.t(b));else if(M)return this.importsCache.set(t,M),this._load(M,f)})}loadJSON(t,a={}){this.fire(new i.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.q.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new i.x("dataloading",{dataType:"style"})),this._load(wg,!1)}_loadImports(t,a,f){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let v of t){let b=this._createFragmentStyle(v),M=new Promise(L=>{b.once("style.import.load",L),b.once("error",L)}).then(()=>this.mergeAll());if(g.push(M),this.resolvedImports.has(v.url)){b.loadEmpty();continue}let A=v.data||this.importsCache.get(v.url);A?(b.loadJSON(A,{validate:a}),this._isInternalStyle(A)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:a}):b.loadEmpty();let O={style:b,id:v.id,config:v.config};if(f){let L=this.fragments.findIndex(({id:N})=>N===f);this.fragments=this.fragments.slice(0,L).concat(O).concat(this.fragments.slice(L))}else this.fragments.push(O)}return Promise.allSettled(g)}getImportGlobalIds(t=this,a=new Set){for(let f of t.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(t){let a=this.scope?i.av(t.id,this.scope):t.id,f,g=this._initialConfig&&this._initialConfig[a];(t.config||g)&&(f=i.l({},t.config,g));let v=new Kr(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){let f=t.schema;if(this._isInternalStyle(t)){let b=i.l({},wg,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,a)}if(this.updateConfig(this._config,f),a&&Yr(this,Wr(t)))return;this._loaded=!0,this.stylesheet=i.cl(t);let g=()=>{for(let O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let b=If(this.stylesheet.layers);if(this._order=b.map(O=>O.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let O=this.stylesheet.lights[0];this.light=new Ae(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ae(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let O of b){let L=i.cq(O,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let N=this.getOwnLayerSourceCache(L),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&L.canCastShadows()&&z&&(N.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.x("data",{dataType:"style"}));let A=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new i.x(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.x(A?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){let b=this._evaluateColorThemeData(v);this._loadColorTheme(b).then(()=>{g()}).catch(M=>{i.w(`Couldn't load color theme from the stylesheet: ${M}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,f,g,v,b,M,A,O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(t=L.light),L.stylesheet.lights)for(let N of L.stylesheet.lights)N.type==="ambient"&&L.ambientLight!=null&&(a=L.ambientLight),N.type==="directional"&&L.directionalLight!=null&&(f=L.directionalLight);g=this._prioritizeTerrain(g,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(v=L.fog),L.stylesheet.camera!=null&&(A=L.stylesheet.camera),L.stylesheet.projection!=null&&(b=L.stylesheet.projection),L.stylesheet.transition!=null&&(M=L.stylesheet.transition),O[L.scope]=L._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=f,this.fog=v,this._styleColorThemeForScope=O,g===null?delete this.terrain:this.terrain=g,this.camera=A||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=i.l({},Tg,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let a=f=>{for(let g of f.fragments)a(g.style);t(f)};a(this)}_prioritizeTerrain(t,a,f){let g=t&&t.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:g?t:null:a!=null&&(!t||g||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},a={},f={};this.forEachFragmentStyle(g=>{for(let v in g._sourceCaches){let b=i.av(v,g.scope);t[b]=g._sourceCaches[v]}for(let v in g._otherSourceCaches){let b=i.av(v,g.scope);a[b]=g._otherSourceCaches[v]}for(let v in g._symbolSourceCaches){let b=i.av(v,g.scope);f[b]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){let t={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let b of v._order){let M=v._layers[b];if(M.type==="slot"){let A=i.cm(b);if(t[A])continue;t[A]=[]}M.slot&&t[M.slot]?t[M.slot].push(M):a.push(M)}}),this._mergedOrder=[];let g=(v=[])=>{for(let b of v)if(b.type==="slot"){let M=i.cm(b.id);t[M]&&g(t[M]),this._mergedSlots.push(M)}else{let M=i.av(b.id,b.scope);this._mergedOrder.push(M),f[M]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};g(a),this._mergedOrder.sort((v,b)=>{let M=f[v],A=f[b];return M.hasInitialOcclusionOpacityProperties?A.is3D()?1:0:M.is3D()&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=i.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,f,g){let v=i.l({},f);for(let M of Object.keys(i._.colorTheme))v[M]===void 0&&(v[M]=i._.colorTheme[M].default);let b=new i.$(Of,a,new Map(g));return b.setTransitionOrValue(v,g),b.untransitioned().possiblyEvaluate(new i.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,g)=>{let v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=t;b.startsWith(v)||(b=v+b);let M="mapbox-reserved-lut",A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;let{width:O,height:L,data:N}=i.q.getImageData(A);if(L>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==L*L)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new i.r({width:O,height:L},N),pixelRatio:1,sdf:!1,version:0});let z=this.imageManager.getImage(M,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},f()):g(new Error("Missing LUT image."))}})}getLut(t){let a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,f,g){let v,b,M,A=i.q.devicePixelRatio>1?"@2x":"",O=i.n(f.transformRequest(f.normalizeSpriteURL(a,A,".json"),i.R.SpriteJSON),(z,j)=>{O=null,M||(M=z,v=j,N())}),L=i.o(f.transformRequest(f.normalizeSpriteURL(a,A,".png"),i.R.SpriteImage),(z,j)=>{L=null,M||(M=z,b=j,N())});function N(){if(M)g(M);else if(v&&b){let z=i.q.getImageData(b),j={};for(let q in v){let{width:W,height:Z,x:X,y:ne,sdf:oe,pixelRatio:ee,stretchX:le,stretchY:ae,content:fe}=v[q],he=new i.r({width:W,height:Z});i.r.copy(z,he,{x:X,y:ne},{x:0,y:0},{width:W,height:Z},null),j[q]={data:he,pixelRatio:ee,sdf:oe,stretchX:le,stretchY:ae,content:fe}}g(null,j)}}return{cancel(){O&&(O.cancel(),O=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new i.t(a));else if(f)for(let g in f)this.imageManager.addImage(g,this.scope,f[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.x("data",{dataType:"style"}))})}_validateLayer(t){let a=this.getOwnSource(t.source);if(!a)return;let f=t.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.t(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{let f=this.fragments[a];return f&&f.style&&(t.data=f.style.serialize()),t})}_serializeSources(){let t={};for(let a in this._sourceCaches){let f=this._sourceCaches[a].getSource();t[f.id]||(t[f.id]=f.serialize())}return t}_serializeLayers(t){let a=[];for(let f of t){let g=this._layers[f];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let a=this.getOwnLayer(t);if(a)return a;this.fire(new i.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let a=this.getOwnSource(t);if(a)return a;this.fire(new i.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){let f=this.map.painter;if(f)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){let v=t.getProgramIds();if(v)for(let b of v){let M=t.getDefaultProgramParams(b,a.zoom,this._styleColorTheme.lut);M&&(f.style=this,this.fog&&(f._fogVisible=!0,M.overrideFog=!0,f.getOrCreateProgram(b,M)),f._fogVisible=!1,M.overrideFog=!1,f.getOrCreateProgram(b,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,f.getOrCreateProgram(b,M)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let f=this._changes.isDirty(),g=!1;if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let M in b){let{updatedIds:A,removedIds:O}=b[M];(A||O)&&(this._updateWorkerLayers(M,A,O),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let v={};for(let b in this._mergedSourceCaches){let M=this._mergedSourceCaches[b];v[b]=M.used,M.used=!1,M.tileCoverLift=0}for(let b of this._mergedOrder){let M=this._mergedLayers[b];if(M.recalculate(t,this._availableImages),!M.isHidden(t.zoom)){let A=this.getLayerSourceCache(M);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,t)}):this.precompilePrograms(M,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(let b in v){let M=this._mergedSourceCaches[b];v[b]!==M.used&&M.getSource().fire(new i.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new i.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,a,f){let g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:t,removedIds:f||[],options:g.options})}setState(t,a){if(this._checkLoaded(),Yr(this,Wr(t)))return!1;(t=i.cl(t)).layers=If(t.layers);let f=function(b,M){if(!b)return[{command:Cn.setStyle,args:[M]}];let A=[];try{if(!i.bh(b.version,M.version))return[{command:Cn.setStyle,args:[M]}];if(i.bh(b.center,M.center)||A.push({command:Cn.setCenter,args:[M.center]}),i.bh(b.zoom,M.zoom)||A.push({command:Cn.setZoom,args:[M.zoom]}),i.bh(b.bearing,M.bearing)||A.push({command:Cn.setBearing,args:[M.bearing]}),i.bh(b.pitch,M.pitch)||A.push({command:Cn.setPitch,args:[M.pitch]}),i.bh(b.sprite,M.sprite)||A.push({command:Cn.setSprite,args:[M.sprite]}),i.bh(b.glyphs,M.glyphs)||A.push({command:Cn.setGlyphs,args:[M.glyphs]}),i.bh(b.imports,M.imports)||function(j=[],q=[],W){q=q||[];let Z=(j=j||[]).map(Aa),X=q.map(Aa),ne=j.reduce(bl,{}),oe=q.reduce(bl,{}),ee=Z.slice(),le,ae,fe,he;for(le=0,ae=0;le<Z.length;le++)fe=Z[le],oe.hasOwnProperty(fe)?ae++:(W.push({command:Cn.removeImport,args:[fe]}),ee.splice(ee.indexOf(fe,ae),1));for(le=0,ae=0;le<X.length;le++)fe=X[X.length-1-le],ee[ee.length-1-le]!==fe&&(ne.hasOwnProperty(fe)?(W.push({command:Cn.removeImport,args:[fe]}),ee.splice(ee.lastIndexOf(fe,ee.length-ae),1)):ae++,he=ee[ee.length-le],W.push({command:Cn.addImport,args:[oe[fe],he]}),ee.splice(ee.length-le,0,fe));for(let pe of q){let we=ne[pe.id];we&&!i.bh(we,pe)&&W.push({command:Cn.updateImport,args:[pe.id,pe]})}}(b.imports,M.imports,A),i.bh(b.transition,M.transition)||A.push({command:Cn.setTransition,args:[M.transition]}),i.bh(b.light,M.light)||A.push({command:Cn.setLight,args:[M.light]}),i.bh(b.fog,M.fog)||A.push({command:Cn.setFog,args:[M.fog]}),i.bh(b.projection,M.projection)||A.push({command:Cn.setProjection,args:[M.projection]}),i.bh(b.lights,M.lights)||A.push({command:Cn.setLights,args:[M.lights]}),i.bh(b.camera,M.camera)||A.push({command:Cn.setCamera,args:[M.camera]}),!i.bh(b["color-theme"],M["color-theme"]))return[{command:Cn.setStyle,args:[M]}];let O={},L=[];(function(j,q,W,Z){let X;for(X in q=q||{},j=j||{})j.hasOwnProperty(X)&&(q.hasOwnProperty(X)||Fn(X,W,Z));for(X in q){if(!q.hasOwnProperty(X))continue;let ne=q[X];j.hasOwnProperty(X)?i.bh(j[X],ne)||(j[X].type==="geojson"&&ne.type==="geojson"&&Pt(j,q,X)?W.push({command:Cn.setGeoJSONSourceData,args:[X,ne.data]}):Yv(X,q,W,Z)):Cf(X,q,W)}})(b.sources,M.sources,L,O);let N=[];b.layers&&b.layers.forEach(j=>{j.source&&O[j.source]?A.push({command:Cn.removeLayer,args:[j.id]}):N.push(j)});let z=b.terrain;z&&O[z.source]&&(A.push({command:Cn.setTerrain,args:[void 0]}),z=void 0),A=A.concat(L),i.bh(z,M.terrain)||A.push({command:Cn.setTerrain,args:[M.terrain]}),function(j,q,W){q=q||[];let Z=(j=j||[]).map(Aa),X=q.map(Aa),ne=j.reduce(bl,{}),oe=q.reduce(bl,{}),ee=Z.slice(),le=Object.create(null),ae,fe,he,pe,we,ye,ge;for(ae=0,fe=0;ae<Z.length;ae++)he=Z[ae],oe.hasOwnProperty(he)?fe++:(W.push({command:Cn.removeLayer,args:[he]}),ee.splice(ee.indexOf(he,fe),1));for(ae=0,fe=0;ae<X.length;ae++)he=X[X.length-1-ae],ee[ee.length-1-ae]!==he&&(ne.hasOwnProperty(he)?(W.push({command:Cn.removeLayer,args:[he]}),ee.splice(ee.lastIndexOf(he,ee.length-fe),1)):fe++,ye=ee[ee.length-ae],W.push({command:Cn.addLayer,args:[oe[he],ye]}),ee.splice(ee.length-ae,0,he),le[he]=!0);for(ae=0;ae<X.length;ae++)if(he=X[ae],pe=ne[he],we=oe[he],!le[he]&&!i.bh(pe,we))if(i.bh(pe.source,we.source)&&i.bh(pe["source-layer"],we["source-layer"])&&i.bh(pe.type,we.type)){for(ge in Xc(pe.layout,we.layout,W,he,null,Cn.setLayoutProperty),Xc(pe.paint,we.paint,W,he,null,Cn.setPaintProperty),i.bh(pe.slot,we.slot)||W.push({command:Cn.setSlot,args:[he,we.slot]}),i.bh(pe.filter,we.filter)||W.push({command:Cn.setFilter,args:[he,we.filter]}),i.bh(pe.minzoom,we.minzoom)&&i.bh(pe.maxzoom,we.maxzoom)||W.push({command:Cn.setLayerZoomRange,args:[he,we.minzoom,we.maxzoom]}),pe)pe.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?Xc(pe[ge],we[ge],W,he,ge.slice(6),Cn.setPaintProperty):i.bh(pe[ge],we[ge])||W.push({command:Cn.setLayerProperty,args:[he,ge,we[ge]]}));for(ge in we)we.hasOwnProperty(ge)&&!pe.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?Xc(pe[ge],we[ge],W,he,ge.slice(6),Cn.setPaintProperty):i.bh(pe[ge],we[ge])||W.push({command:Cn.setLayerProperty,args:[he,ge,we[ge]]}))}else W.push({command:Cn.removeLayer,args:[he]}),ye=ee[ee.lastIndexOf(he)+1],W.push({command:Cn.addLayer,args:[we,ye]})}(N,M.layers,A)}catch(O){console.warn("Unable to compute style diff:",O),A=[{command:Cn.setStyle,args:[M]}]}return A}(this.serialize(),t).filter(b=>!(b.command in Ol));if(f.length===0)return!1;let g=f.filter(b=>!(b.command in xh));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);let v=[];return f.forEach(b=>{v.push(this[b.command].apply(this,b.args))}),a&&Promise.all(v).then(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,a){return this.getImage(t)?this.fire(new i.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,a),this._afterImageUpdated(t),this)}updateImage(t,a){this.imageManager.updateImage(t,this.scope,a)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new i.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,a,f={}){return this._checkLoaded(),this._validate(_e,`models.${t}`,a,null,f)||(this.modelManager.addModel(t,a,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new i.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,f={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Ma,`sources.${t}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let g=_l(t,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let v=b=>{let M=(b?"symbol:":"other:")+g.id,A=i.av(M,this.scope),O=this._sourceCaches[M]=new Nr(A,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=O,O.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===t)return this.fire(new i.t(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let f=this.getOwnSourceCaches(t);for(let g of f){let v=i.cm(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new i.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){let a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){let t=[];for(let a in this._otherSourceCaches){let f=this.getOwnSourceCache(a);f&&t.push(f.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let a in t){let f=t[a]._tiles;for(let g in f){let v=f[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let g of t){if(this._validate(ml,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(g),v.updateTransitions(a)}else this.ambientLight=new Un(g,nn||(nn=new i.a0({color:new i.a1(i._.properties_light_ambient.color),intensity:new i.a1(i._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(g),v.updateTransitions(a)}else this.directionalLight=new Un(g,Vn||(Vn=new i.a0({direction:new i.ad(i._.properties_light_directional.direction),color:new i.a1(i._.properties_light_directional.color),intensity:new i.a1(i._.properties_light_directional.intensity),"cast-shadows":new i.a1(i._.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.a1(i._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=new i.a3(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;let f=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),g=t.properties.get("color").toRenderColor(null).toArray01(),v=t.properties.get("intensity"),b=t.properties.get("direction"),M=1-i.c7(b.x,b.y,b.z)[2]/90,A=f(g)*v*M,O=a.properties.get("color").toRenderColor(null).toArray01(),L=a.properties.get("intensity");return(A+f(O)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(i.cn(t)){let a=i.co(t),f=this.fragments.find(({id:v})=>v===a);if(!f)throw new Error(`Style import not found: ${t}`);let g=i.cm(t);return f.style.getFragmentStyle(g)}{let a=this.fragments.find(({id:f})=>f===t);if(!a)throw new Error(`Style import not found: ${t}`);return a.style}}getConfigProperty(t,a){let f=this.getFragmentStyle(t);if(!f)return null;let g=i.av(a,f.scope),v=f.options.get(g),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(t,a,f){let g=this.getFragmentStyle(t);if(!g)return;let v=g.stylesheet.schema;if(!v||!v[a])return;let b=i.M(f);if(b.result!=="success")return void Yr(this,b.value);let M=b.value.expression,A=i.av(a,g.scope),O=g.options.get(A);if(!O)return;let L,{minValue:N,maxValue:z,stepValue:j,type:q,values:W}=v[a],Z=i.M(v[a].default);Z.result==="success"&&(L=Z.value.expression),L?(this.options.set(A,yi(St({},O),{value:M,default:L,minValue:N,maxValue:z,stepValue:j,type:q,values:W})),this.updateConfigDependencies(a)):this.fire(new i.t(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){let a=this.getFragmentStyle(t);if(!a)return null;let f=a.stylesheet.schema;if(!f)return null;let g={};for(let v in f){let b=i.av(v,a.scope),M=a.options.get(b),A=M?M.value||M.default:null;g[v]=A?A.serialize():null}return g}setConfig(t,a){let f=this.getFragmentStyle(t);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){let f=this.getFragmentStyle(t);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(let f in a){let g,v,b=i.M(a[f].default);if(b.result==="success"&&(g=b.value.expression),t&&t[f]!==void 0){let z=i.M(t[f]);z.result==="success"&&(v=z.value.expression)}let{minValue:M,maxValue:A,stepValue:O,type:L,values:N}=a[f];if(g){let z=i.av(f,this.scope);this.options.set(z,{default:g,value:v,minValue:M,maxValue:A,stepValue:O,type:L,values:N})}else this.fire(new i.t(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new i.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(let a of this._configDependentLayers){let f=this.getLayer(a);if(f){if(t&&!f.configDependencies.has(t))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){let f=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut&&f!==""||a._styleColorTheme.lut&&f!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,a,f={}){this._checkLoaded();let g=t.id;if(this._layers[g])return void this.fire(new i.t(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(t.type==="custom"){if(Yr(this,i.cp(t)))return;v=i.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=i.cl(t),t=i.l(t,{source:g})),this._validate(ke,`layers.${g}`,t,{arrayIndex:-1},f))return;v=i.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize()}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(a){let L=this._order.indexOf(a);if(L===-1)return void this.fire(new i.t(new Error(`Layer with id "${a}" does not exist on this map.`)));v.slot===this._layers[a].slot?b=L:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=v;let M=this.getOwnLayerSourceCache(v),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&v.canCastShadows()&&A&&(M.castsShadows=!0);let O=this._changes.getRemovedLayer(v);if(O&&v.source&&M&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let L=i.av(v.source,v.scope);O.type!==v.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),M.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();let f=this._checkLayer(t);if(!f||t===a)return;let g=this._order.indexOf(t);this._order.splice(g,1);let v=this._order.length;if(a){let b=this._order.indexOf(a);if(b===-1)return void this.fire(new i.t(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?v=b:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);let f=this._order.indexOf(t);this._order.splice(f,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let v=!1;for(let b in this._layers)if(this._layers[b].source===a.source&&this._layers[b].canCastShadows()){v=!0;break}g.castsShadows=v}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,f){this._checkLoaded();let g=this._checkLayer(t);g&&(g.minzoom===a&&g.maxzoom===f||(a!=null&&(g.minzoom=a),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();let f=this._checkLayer(t);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(t,a,f={}){this._checkLoaded();let g=this._checkLayer(t);if(g&&!i.bh(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Y,`layers.${g.id}.filter`,a,{layerType:g.type},f)||(g.filter=i.cl(a),this._updateLayer(g)))}getFilter(t){let a=this._checkLayer(t);if(a)return i.cl(a.filter)}setLayoutProperty(t,a,f,g={}){this._checkLoaded();let v=this._checkLayer(t);if(v&&!i.bh(v.getLayoutProperty(a),f)){if(f!=null&&(!g||g.validate!==!1)&&Yr(v,ce.call(Wr,{key:`layers.${t}.layout.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:i._,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(a,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,a){let f=this._checkLayer(t);if(f)return f.getLayoutProperty(a)}setPaintProperty(t,a,f,g={}){this._checkLoaded();let v=this._checkLayer(t);if(!v||i.bh(v.getPaintProperty(a),f)||f!=null&&(!g||g.validate!==!1)&&Yr(v,J.call(Wr,{key:`layers.${t}.paint.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:i._})))return;let b=v.setPaintProperty(a,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,a){let f=this._checkLayer(t);if(f)return f.getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();let f=t.source,g=t.sourceLayer,v=this._checkSource(f);if(!v)return;let b=v.type;if(b==="geojson"&&g)return void this.fire(new i.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new i.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.t(new Error("The feature id parameter must be provided.")));let M=this.getOwnSourceCaches(f);for(let A of M)A.setFeatureState(g,t.id,a)}removeFeatureState(t,a){this._checkLoaded();let f=t.source,g=this._checkSource(f);if(!g)return;let v=g.type,b=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!b)return void this.fire(new i.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.t(new Error("A feature id is required to remove its specific state property.")));let M=this.getOwnSourceCaches(f);for(let A of M)A.removeFeatureState(b,t.id,a)}getFeatureState(t){this._checkLoaded();let a=t.source,f=t.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||f)return t.id===void 0&&this.fire(new i.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,t.id);this.fire(new i.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=i.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(t){this._changes.updateLayer(t);let a=this.getLayerSourceCache(t),f=i.av(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let a=M=>this._mergedLayers[M].is3D(),f=this.order,g={},v=[];for(let M=f.length-1;M>=0;M--){let A=f[M];if(a(A)){g[A]=M;for(let O of t){let L=O[A];if(L)for(let N of L)v.push(N)}}}v.sort((M,A)=>A.intersectionZ-M.intersectionZ);let b=[];for(let M=f.length-1;M>=0;M--){let A=f[M];if(a(A))for(let O=v.length-1;O>=0;O--){let L=v[O].feature;if(L.layer&&g[L.layer.id]<M)break;b.push(L),v.pop()}else for(let O of t){let L=O[A];if(L)for(let N of L)b.push(N.feature)}}return b}queryRenderedFeatures(t,a,f){a&&a.filter&&this._validate(Y,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new i.t(new Error("parameters.layers must be an Array."))),[];for(let O of a.layers){let L=this._mergedLayers[O];if(!L)return this.fire(new i.t(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];g[L.source]=!0}}let v=[],b=a.serializedLayers||{},M=a&&a.layers?a.layers.some(O=>{let L=this.getLayer(O);return L&&L.is3D()}):this.has3DLayers(),A=pi.createFromScreenPoints(t,f);for(let O in this._mergedSourceCaches){let L=this._mergedSourceCaches[O].getSource();if(!L||L.scope!==a.scope)continue;let N=this._mergedSourceCaches[O].getSource().id;a.layers&&!g[N]||v.push(bf(this._mergedSourceCaches[O],this._mergedLayers,b,A,a,f,M,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(O,L,N,z,j,q,W){let Z={},X=q.queryRenderedSymbols(z),ne=[];for(let oe of Object.keys(X).map(Number))ne.push(W[oe]);ne.sort(yl);for(let oe of ne){let ee=oe.featureIndex.lookupSymbolFeatures(X[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,j.filter,j.layers,j.availableImages,O);for(let le in ee){let ae=Z[le]=Z[le]||[],fe=ee[le];fe.sort((he,pe)=>{let we=oe.featureSortOrder;if(we){let ye=we.indexOf(he.featureIndex);return we.indexOf(pe.featureIndex)-ye}return pe.featureIndex-he.featureIndex});for(let he of fe)ae.push(he)}}for(let oe in Z)Z[oe].forEach(ee=>{let le=ee.feature,ae=N(O[oe]);if(!ae)return;let fe=ae.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=fe});return Z}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),A.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a&&a.filter&&this._validate(Y,"querySourceFeatures.filter",a.filter,null,a);let f=this.getOwnSourceCaches(t),g=[];for(let v of f)g=g.concat(qc(v,a));return g}addSourceType(t,a,f){return Kr.getSourceType(t)?f(new Error(`A source type called "${t}" already exists.`)):(Kr.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,f={}){this._checkLoaded();let g=this.light.getLight(),v=!1;for(let M in t)if(!i.bh(t[M],g[M])){v=!0;break}if(!v)return;let b=this._getTransitionParameters();this.light.setLight(t,a,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=t,g=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){let M="terrain-dem-src";this.addSource(M,f.source),f=i.cl(f),f=i.l(f,{source:M})}let v=i.l({},f),b={};if(this.terrain&&g){v.source=this.terrain.get().source;let M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(b.style=M.serialize())}if(this._validate(Gc,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new i.x("data",{dataType:"style"}))}else{let v=this.terrain,b=v.get();for(let M of Object.keys(i._.terrain))!f.hasOwnProperty(M)&&i._.terrain[M].default&&(f[M]=i._.terrain[M].default);for(let M in t)if(!i.bh(t[M],b[M])){v.set(t,this.options),this.stylesheet.terrain=t;let A=this._getTransitionParameters({duration:0});v.updateTransitions(A),this.fire(new i.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let a=this.fog=new Ln(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!i.bh(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();let a=()=>{for(let g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(let g in this._sourceCaches)this._sourceCaches[g].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void a();let f=this._evaluateColorThemeData(t);this._loadColorTheme(f).then(()=>{this.fire(new i.x("colorthemeset")),a()}).catch(g=>{i.w(`Couldn't set color theme: ${g}`)})}_getTransitionParameters(t){return{now:i.q.now(),transition:i.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],a=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?t.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){let f=this.terrain=new $e(t,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(let t in this._layers){let a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,f,g,v={}){if(v&&v.validate===!1)return!1;let b=i.l({},this.serialize());return Yr(this,t.call(Wr,i.l({key:a,style:b,value:f,styleSpec:i._},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let a=this.getSourceCaches(t);for(let f of a)f.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let a=this.getSourceCaches(t);for(let f of a)f.resume(),f.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let a;this.directionalLight&&(a=_h(this.directionalLight));for(let f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(t,void 0,void 0,a)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,f,g,v,b,M=!1){let A=!1,O=!1,L={},N={};for(let z of this._mergedOrder){let j=this._mergedLayers[z];if(j.type!=="symbol")continue;let q=i.av(j.source,j.scope),W=L[q];if(!W){let X=this.getLayerSourceCache(j);if(!X)continue;let ne=X.getRenderableIds(!0).map(oe=>X.getTileByID(oe));N[q]=ne.slice(),W=L[q]=ne.sort((oe,ee)=>ee.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ee.tileID)?-1:1))}let Z=this.crossTileSymbolIndex.addLayer(j,W,a.center.lng,a.projection);A=A||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new i.x("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),a.zoom))&&(this.pauseablePlacement=new Yc(a,this._mergedOrder,M,f,g,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),O=!0),A&&this.pauseablePlacement.placement.setStale()),O||A){this._buildingIndex.onNewFrame(a.zoom);for(let z=0;z<this._mergedOrder.length;z++){let j=this._mergedLayers[this._mergedOrder[z]];if(j.type!=="symbol")continue;let q=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,L[i.av(j.source,j.scope)],z,q?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===t.id)!==-1)return void this.fire(new i.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return f.push(t),this._loadImports([t],!0);let g=f.findIndex(({id:v})=>v===a);return g===-1&&this.fire(new i.t(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,g).concat(t).concat(f.slice(g)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==f[g].url&&this.setImportUrl(t,a.url),i.bh(a.config,f[g].config)||this.setImportConfig(t,a.config),i.bh(a.data,f[g].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;let v=this.getImportIndex(a);if(v===-1)return this;let b=f[g],M=this.fragments[g];return f=f.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=f.slice(0,v).concat(b).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(M).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;f[g].url=a;let v=this.fragments[g];return v.style=this._createFragmentStyle(f[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();let f=this.getImportIndex(t),g=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(t,g[f].url))}setImportConfig(t,a){this._checkLoaded();let f=this.getImportIndex(t),g=this.stylesheet.imports||[];if(f===-1)return this;a?g[f].config=a:delete g[f].config;let v=this.fragments[f],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.updateConfig(a,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let a=this.stylesheet.imports||[],f=this.getImportIndex(t);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(t){let a=(this.stylesheet.imports||[]).findIndex(f=>f.id===t);return a===-1&&this.fire(new i.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let a in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[a];f&&t.push(f.getSource())}return t}getSource(t,a){let f=this.getSourceCache(t,a);return f&&f.getSource()}getLayerSource(t){let a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){let f=i.av(t,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(t){let a=i.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let a in t){let f=t[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(t){let a=this._changes.getUpdatedPaintProperties();for(let f of a){let g=this.getLayer(f);g&&g.updateTransitions(t)}}getImages(t,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();let g=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(t,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(t,a,f){return i.ct(a,f)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){let a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new i.t(new Error(`There is no source with ID '${t}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;let f=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(f||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Kr.getSourceType=function(d){return sh[d]},Kr.setSourceType=function(d,t){sh[d]=t},Kr.registerForPluginStateChange=i.cc;var Eg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Lf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ff=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,bh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ig=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Cg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Dg=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Mg=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,kf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Sg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Jc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let wh=[];Xs(Eg,wh),Xs(Ff,wh),Xs(Lf,wh);let Qc={"_prelude_fog.vertex.glsl":Cg,"_prelude_terrain.vertex.glsl":Ig,"_prelude_shadow.vertex.glsl":Sg,"_prelude_fog.fragment.glsl":Dg,"_prelude_shadow.fragment.glsl":Jc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Mg,"_prelude_raster_particle.glsl":kf},Ll={};bn("",Ig),bn(Dg,Cg),bn(Jc,Sg),bn(Mg,""),bn(kf,"");let eu=bn(Lf,Ff),Th=Eg;var Zs={background:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:bn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:bn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:bn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:bn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:bn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:bn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:bn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:bn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:bn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:bn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:bn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:bn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:bn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:bn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bh),skyboxGradient:bn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bh),skyboxCapture:bn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:bn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:bn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:bn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:bn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:bn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Xs(d,t){let a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=f.split(" ");for(let v of g)t.includes(v)||t.push(v)}}function bn(d,t){let a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(O=>{let L=O.split(" ");return L[L.length-1]}),g=[...new Set(g)]);let v={},b=[],M=[];if(d=d.replace(a,(O,L)=>(M.push(L),"")),(t=t.replace(a,(O,L)=>(b.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...wh];Xs(d,A),Xs(t,A);for(let O of[...b,...M])Qc[O]||console.error(`Undefined include: ${O}`),Ll[O]||(Ll[O]=[],Xs(Qc[O],Ll[O])),A=[...A,...Ll[O]];return{fragmentSource:d=d.replace(f,(O,L,N,z,j)=>(v[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${N} ${z} ${j};
#else
uniform ${N} ${z} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${N} ${z} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${N} ${z} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(f,(O,L,N,z,j)=>{let q=z==="float"?"vec2":z,W=j.match(/color/)?"color":q;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${N} ${z} a_${j};
#endif
`:v[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${N} ${q} a_${j};
out ${N} ${z} ${j};
#else
uniform ${N} ${z} u_${j};
#endif
`:L==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${N} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${N} ${z} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${N} ${z} a_${j};
    out ${N} ${z} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${N} ${q} a_${j};
#else
uniform ${N} ${z} u_${j};
#endif
`:L==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${N} ${z} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${q} a_${j};
#else
uniform ${N} ${z} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${N} ${z} ${j} = a_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${N} ${z} ${j} = a_${j};
#else
    ${N} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${N} ${z} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${N} ${z} ${j} = u_${j};
#endif
`}),staticAttributes:g,usedDefines:A,vertexIncludes:b,fragmentIncludes:M}}class Fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,f,g,v,b,M,A){this.context=t;let O=this.boundPaintVertexBuffers.length!==g.length;for(let N=0;!O&&N<g.length;N++)this.boundPaintVertexBuffers[N]!==g[N]&&(O=!0);let L=this.boundDynamicVertexBuffers.length!==M.length;for(let N=0;!L&&N<M.length;N++)this.boundDynamicVertexBuffers[N]!==M[N]&&(L=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||O||L||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(a,f,g,v,b,M,A);else{t.bindVertexArrayOES.set(this.vao);for(let N of M)N&&(N.bind(),A&&N.instanceCount&&N.setVertexAttribDivisor(t.gl,a,A));v&&v.dynamicDraw&&v.bind()}}freshBind(t,a,f,g,v,b,M){let A=t.numAttributes,O=this.context,L=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,a.enableAttributes(L,t),a.bind(),a.setVertexAttribPointers(L,t,v);for(let N of f)N.enableAttributes(L,t),N.bind(),N.setVertexAttribPointers(L,t,v);for(let N of b)N&&(N.enableAttributes(L,t),N.bind(),N.setVertexAttribPointers(L,t,v),M&&N.instanceCount&&N.setVertexAttribDivisor(L,t,M));g&&g.bind(),O.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function tu(d,t){let a=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new i.a5(0,f/a).toLngLat().lat,new i.a5(0,(f+1)/a).toLngLat().lat]}function Eh(d,t,a,f,g,v,b){let M=d.context,A=M.gl,O=a.hillshadeFBO;if(!O)return;d.prepareDrawTile();let L=d.isTileAffectedByFog(t),N=d.getOrCreateProgram("hillshade",{overrideFog:L});M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get());let z=((Z,X,ne,oe)=>{let ee=ne.paint.get("hillshade-shadow-color"),le=ne.paint.get("hillshade-highlight-color"),ae=ne.paint.get("hillshade-accent-color"),fe=ne.paint.get("hillshade-emissive-strength"),he=i.bB(ne.paint.get("hillshade-illumination-direction"));if(ne.paint.get("hillshade-illumination-anchor")==="viewport")he-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){let we=Z.style.directionalLight.properties.get("direction"),ye=i.c7(we.x,we.y,we.z);he=i.bB(ye[1])}let pe=!Z.options.moving;return{u_matrix:oe||Z.transform.calculateProjMatrix(X.tileID.toUnwrapped(),pe),u_image:0,u_latrange:tu(0,X.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),he],u_shadow:ee.toRenderColor(ne.lut),u_highlight:le.toRenderColor(ne.lut),u_emissive_strength:fe,u_accent:ae.toRenderColor(ne.lut)}})(d,a,f,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(M,N,t.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=d.getTileBoundsBuffers(a);N.draw(d,A.TRIANGLES,g,v,b,kt.disabled,z,f.id,j,q,W)}function Ih(d,t,a){if(!t.needsDEMTextureUpload)return;let f=d.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(a.stride);let v=a.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new i.T(f,v,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function nu(d,t,a){let f=d.context,g=f.gl;if(!t.dem)return;let v=t.dem;if(f.activeTexture.set(g.TEXTURE1),Ih(d,t,v),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let b=v.dim;f.activeTexture.set(g.TEXTURE0);let M=t.hillshadeFBO;if(!M){let z=new i.T(f,{width:b,height:b,data:null},g.RGBA8);z.bind(g.LINEAR,g.CLAMP_TO_EDGE),M=t.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),M.colorAttachment.set(z.texture)}f.bindFramebuffer.set(M.framebuffer),f.viewport.set([0,0,b,b]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:O,tileBoundsSegments:L}=d.getMercatorTileBoundsBuffers(),N=[];d.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(d,g.TRIANGLES,Dt.disabled,qt.disabled,mn.unblended,kt.disabled,((z,j)=>{let q=j.stride,W=i.a6.mat4.create();return i.a6.mat4.ortho(W,0,i.ab,-i.ab,0,0,1),i.a6.mat4.translate(W,W,[0,-i.ab,0]),{u_matrix:W,u_image:1,u_dimension:[q,q],u_zoom:z.overscaledZ}})(t.tileID,v),a.id,A,O,L),t.needsHillshadePrepare=!1}class Xn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Nf extends Xn{getDefault(){return i.bz.transparent}set(t){let a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ag extends Xn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class zf extends Xn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ch extends Xn{getDefault(){return[!0,!0,!0,!0]}set(t){let a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class iu extends Xn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Pg extends Xn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Rg extends Xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Og extends Xn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class kl extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Lg extends Xn{getDefault(){return[0,1]}set(t){let a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class tx extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class nx extends Xn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ix extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Bf extends Xn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vf extends Xn{getDefault(){return i.bz.transparent}set(t){let a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jf extends Xn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Uf extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Fg extends Xn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class kg extends Xn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let rx=class extends Xn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class ru extends Xn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ou extends Xn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ng extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jr extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $f extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Dh extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Mh extends Xn{getDefault(){return null}set(t){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Gf extends Xn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Hf extends Xn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Sh extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qf extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class su extends Xn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Ah extends su{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wf extends su{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zg extends su{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nl extends Wf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let ox=(d,t,a)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),Bg=(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:M,u_frustum_br:A,u_frustum_bl:O,u_globe_pos:L,u_globe_radius:N,u_viewport:z,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:q});function Vg(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}let zl=new class{constructor(){this.operations={}}newMorphing(d,t,a,f,g){if(d in this.operations){let v=this.operations[d];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[d]={startTime:f,phase:0,duration:g,from:t,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(let t in this.operations){let a=this.operations[t];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},jg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ug(d,t,a){if(t===0)return 0;let f=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*f}function Zf(d,t){let a=1<<d.z;return!t&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}let au=d=>({u_matrix:d});function Ph(d,t,a,f,g){if(g>0){let v=i.q.now(),b=(v-d.timeAdded)/g,M=t?(v-t.timeAdded)/g:-1,A=a.getSource(),O=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(d.tileID.overscaledZ-O),N=L&&d.refreshedUponExpiration?1:i.ap(L?b:1-M,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Bl extends Nr{constructor(t){let a={type:"raster-dem",maxzoom:t.transform.maxZoom},f=new i.cd(i.ce(),null),g=_l("mock-dem",a,f,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class $g extends Nr{constructor(t){let a=_l("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new i.cd(i.ce(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,f){if(t.freezeTileCoverage)return;this.transform=t;let g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){let M=new $o(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);M.state="loaded",this._tiles[b.key]=M}return v},{});for(let v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){let a=this.proxyCachedFBO[t];if(a!==void 0){let f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xf extends i.aA{constructor(t,a,f){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class Yf extends i.cE{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,g,v]=function(A){let O=new i.a_,L=new i.aO,N=131;O.reserve(17161),L.reserve(33800);let z=i.ab/128,j=i.ab+z/2,q=j+z;for(let Z=-z;Z<q;Z+=z)for(let X=-z;X<q;X+=z){let ne=X<0||X>j||Z<0||Z>j?24575:0,oe=i.ap(Math.round(X),0,i.ab),ee=i.ap(Math.round(Z),0,i.ab);O.emplaceBack(oe+ne,ee)}let W=(Z,X)=>{let ne=X*N+Z;L.emplaceBack(ne+1,ne,ne+N),L.emplaceBack(ne+N,ne+N+1,ne+1)};for(let Z=1;Z<129;Z++)for(let X=1;X<129;X++)W(X,Z);return[0,129].forEach(Z=>{for(let X=0;X<130;X++)W(X,Z),W(Z,X)}),[O,L,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(f,i.b0.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=i.b1.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=i.b1.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $g(a.map),this.orthoMatrix=i.a6.mat4.create(),i.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ab,0,i.ab,0,1);let M=b.gl;this._overlapStencilMode=new qt({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bl(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,f){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let g=t.terrain.properties,v=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();let M=t.terrain&&t.terrain.scope,A=g.get("source"),O=v?this._mockSourceCache:t.getSourceCache(A,M);if(!O)return void i.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=O,this._exaggeration=b?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let N=this.getScaledDemTileSize();this.sourceCache.update(a,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){let a=this._previousCameraAltitude,f=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=f;let g=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let v=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let M=v-this._previousZoom,A=this._previousUpdateTimestamp,O=v;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(v-O)>.5&&(M=.5*(v-O+M)),M*g<0&&(O+=M)),this._evaluationZoom=O;let L=b.getExaggeration(O),N=L===b.getExaggeration(Math.max(0,O-.1));if(N&&Math.abs(L-this._exaggeration)<.01)return L;let z=Math.min(.1,.00375*(this._updateTimestamp-A));return(N||L<.1||Math.abs(M)<1e-4)&&(z=Math.min(.2,4*z)),i.aa(this._exaggeration,L,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.a5.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=a.getIds().map(A=>{let O=a.getTileByID(A).tileID;return O.projMatrix=f.calculateProjMatrix(O.toUnwrapped()),O});(function(A,O){let L=O.transform.pointCoordinate(O.transform.getCameraPoint()),N=new i.P(L.x,L.y);A.sort((z,j)=>{if(j.overscaledZ-z.overscaledZ)return j.overscaledZ-z.overscaledZ;let q=new i.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),W=new i.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Z=N.mult(1<<z.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(q)-Z.distSqr(W)})})(g,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let A in b){let O=b[A];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[A],v),O.usedForTerrain))continue;let L=t[A];O.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[a.id]=g.map(A=>new Xf(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let M={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let O=this.terrainTileForTile[A.key];if(!O)continue;let L=O.tileID.key;L in M||(this._visibleDemTiles.push(O),M[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;let f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){let t=this.painter.context,a=t.gl;for(let f in this.terrainTileForTile){let g=this.terrainTileForTile[f],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Ih(this.painter,g,v))}}_prepareDemTileUniforms(t,a,f,g){if(!a||a.demTexture==null)return!1;let v=t.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-v.z),M=g||"";return f[`u_dem_tl${M}`]=[v.x*b%1,v.y*b%1],f[`u_dem_scale${M}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,a=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;let v=g.dem.tree.minimums[0];return v>0&&t++,f+v},0);return t?a/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);let f=this._getLoadedAreaMinimum(),g=new i.cF({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new i.T(t,g,a.R32F,{premultiply:!1}),v}setupElevationDraw(t,a,f){let g=this.painter.context,v=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let M=null,A=null,O=1;if(f&&f.morphing&&this._useVertexMorphing){let j=f.morphing.srcDemTile,q=f.morphing.dstDemTile;O=f.morphing.phase,j&&q&&(this._prepareDemTileUniforms(t,j,b,"_prev")&&(A=j),this._prepareDemTileUniforms(t,q,b)&&(M=q))}let L=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,N=null;var z;if(this.enabled?A&&M?(N=M.demTexture,g.activeTexture.set(v.TEXTURE4),A.demTexture.bind(L(A),v.CLAMP_TO_EDGE),b.u_dem_lerp=O):(M=this.terrainTileForTile[t.tileID.key],N=this._prepareDemTileUniforms(t,M,b)?M.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,g.activeTexture.set(v.TEXTURE2),N&&(b.u_dem_size=(z=N).size[0]===1?1:z.size[0]-2,N.bind(L(M),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,b),f&&f.useMeterToDem&&M){let j=(1<<M.tileID.canonical.z)*i.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=j}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){let j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,j)}}globeUniformValues(t,a,f){let g=t.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,i.ab,0),u_tile_br_up:g.upVector(a,i.ab,i.ab),u_tile_bl_up:g.upVector(a,0,i.ab),u_tile_up_scale:f?i.cG(1):g.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let a=this.painter,f=this.painter.context;t.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,b,M,A){if(g.transform.projection.name==="globe")(function(O,L,N,z,j){let q=O.context,W=q.gl,Z,X,ne=O.transform,oe=i.cx(O,q,ne),ee=(Me,Be)=>{if(X===Be)return;let qe=[jg[Be],"PROJECTION_GLOBE_VIEW"];oe&&qe.push("CUSTOM_ANTIALIASING");let ze=O.isTileAffectedByFog(Me);Z=O.getOrCreateProgram("globeRaster",{defines:qe,overrideFog:ze}),X=Be},le=O.colorModeForRenderPass(),ae=new Dt(W.LEQUAL,Dt.ReadWrite,O.depthRangeFor3D);zl.update(j);let fe=i.cy(ne),he=[i.am(ne.center.lng),i.at(ne.center.lat)],pe=O.globeSharedBuffers,we=[ne.width*i.q.devicePixelRatio,ne.height*i.q.devicePixelRatio],ye=Float32Array.from(ne.globeMatrix),ge={useDenormalizedUpVectorScale:!0};{let Me=O.transform,Be=Ug(Me.zoom,L.exaggeration(),L.sourceCache._source.tileSize);X=-1;let qe=W.TRIANGLES;for(let ze of z){let Je=N.getTile(ze),Se=qt.disabled,Ge=L.prevTerrainTileForTile[ze.key],Ue=L.terrainTileForTile[ze.key];Vg(Ge,Ue)&&zl.newMorphing(ze.key,Ge,Ue,j,250),q.activeTexture.set(W.TEXTURE0),Je.texture&&Je.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let et=zl.getMorphValuesForProxy(ze.key),nt=et?1:0;et&&i.C(ge,{morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:i.cw(et.phase)}});let He=i.cz(ze.canonical),Ye=i.cA(He.getCenter().lat),Et=i.cB(ze.canonical,He,Ye,Me.worldSize/Me._pixelsPerMercatorPixel),rt=i.b5(i.cC(ze.canonical)),ft=Bg(Me.expandedFarZProjMatrix,ye,fe,rt,i.a9(Me.zoom),he,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,we,Be,Me._farZ,Et);if(ee(ze,nt),Z&&(L.setupElevationDraw(Je,Z,ge),O.uploadCommonUniforms(q,Z,ze.toUnwrapped()),pe)){let[Ot,_t,Mt]=pe.getGridBuffers(Ye,Be!==0);Z.draw(O,qe,ae,Se,le,kt.backCCW,ft,"globe_raster",Ot,_t,Mt)}}}if(pe&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let Me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Me.push("CUSTOM_ANTIALIASING"),Z=O.getOrCreateProgram("globeRaster",{defines:Me});for(let Be of z){let{x:qe,y:ze,z:Je}=Be.canonical,Se=ze===0,Ge=ze===(1<<Je)-1,[Ue,et,nt,He]=pe.getPoleBuffers(Je,!1);if(He&&(Se||Ge)){let Ye=N.getTile(Be);q.activeTexture.set(W.TEXTURE0),Ye.texture&&Ye.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Et=i.cD(Je,qe,ne),rt=i.b5(i.cC(Be.canonical)),ft=(Ot,_t)=>Ot.draw(O,W.TRIANGLES,ae,qt.disabled,le,kt.disabled,Bg(ne.expandedFarZProjMatrix,Et,Et,rt,0,he,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,we,0,ne._farZ),"globe_pole_raster",_t,nt,He);L.setupElevationDraw(Ye,Z,ge),O.uploadCommonUniforms(q,Z,Be.toUnwrapped()),Se&&O.renderDefaultNorthPole&&ft(Z,Ue),Ge&&O.renderDefaultSouthPole&&(Et=i.a6.mat4.scale(i.a6.mat4.create(),Et,[1,-1,1]),ft(Z,et))}}}})(g,v,b,M,A);else{let O=g.context,L=O.gl,N,z,j=g.shadowRenderer,q=ms(g,g.longestCutoffRange),W=le=>{if(z===le)return;let ae=[];ae.push(jg[le]),q.shouldRenderCutoff&&ae.push("RENDER_CUTOFF"),N=g.getOrCreateProgram("terrainRaster",{defines:ae}),z=le},Z=g.colorModeForRenderPass(),X=new Dt(L.LEQUAL,Dt.ReadWrite,g.depthRangeFor3D);zl.update(A);let ne=g.transform,oe=Ug(ne.zoom,v.exaggeration(),v.sourceCache._source.tileSize),ee=[0,0,0];if(j){let le=g.style.directionalLight,ae=g.style.ambientLight;le&&ae&&(ee=yh(g.style,le,ae))}{z=-1;let le=L.TRIANGLES,[ae,fe]=[v.gridIndexBuffer,v.gridSegments];for(let he of M){let pe=b.getTile(he),we=qt.disabled,ye=v.prevTerrainTileForTile[he.key],ge=v.terrainTileForTile[he.key];Vg(ye,ge)&&zl.newMorphing(he.key,ye,ge,A,250),O.activeTexture.set(L.TEXTURE0),pe.texture&&pe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Me=zl.getMorphValuesForProxy(he.key),Be=Me?1:0,qe;Me&&(qe={morphing:{srcDemTile:Me.from,dstDemTile:Me.to,phase:i.cw(Me.phase)}});let ze=ox(he.projMatrix,Zf(he.canonical,ne.renderWorldCopies)?oe/10:oe,ee);if(W(Be),!N)continue;v.setupElevationDraw(pe,N,qe);let Je=he.toUnwrapped();j&&j.setupShadows(Je,N),g.uploadCommonUniforms(O,N,Je,null,q),N.draw(g,le,X,we,Z,kt.backCCW,ze,"terrain_raster",v.gridBuffer,ae,fe)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let a=this.painter,f=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),M=a.style.order,A=[],O=0;for(let L of v){let N=g.getTileByID(L.proxyTileKey),z=g.proxyCachedFBO[L.key]?g.proxyCachedFBO[L.key][t]:void 0,j=z!==void 0?g.renderCache[z]:this.pool[O++],q=z!==void 0;if(N.texture=j.tex,q&&!j.dirty){A.push(N.tileID);continue}let W;f.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(f.clear({color:i.bz.transparent,stencil:0}),j.dirty=!1);for(let Z=b.start;Z<=b.end;++Z){let X=a.style._mergedLayers[M[Z]];if(X.isHidden(a.transform.zoom))continue;let ne=a.style.getLayerSourceCache(X),oe=ne?this.proxyToSource[L.key][ne.id]:[L];if(!oe)continue;let ee=oe;f.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(j,oe,X,ne),W=ne?ne.id:null),a.renderLayer(a,ne,X,ee)}if(this._drapedRenderBatches.length===0)for(let Z of this._pendingGroundEffectLayers){let X=a.style._mergedLayers[M[Z]];if(X.isHidden(a.transform.zoom))continue;let ne=a.style.getLayerSourceCache(X),oe=ne?this.proxyToSource[L.key][ne.id]:[L];if(!oe)continue;let ee=oe;f.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(j,oe,X,ne),W=ne?ne.id:null),a.renderLayer(a,ne,X,ee)}this.renderedToTile?(j.dirty=!0,A.push(N.tileID)):q||--O,O===5&&(O=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){let a=t.order.length,f=-1,g=a;for(let v=0;v<a;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?f=Math.max(f,v):g=Math.min(g,v);return g>f}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,f){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let b=v.tileID,M=1<<b.overscaledZ,{x:A,y:O}=b.canonical,L=A/M,N=(A+1)/M,z=O/M,j=(O+1)/M;return{minx:L,miny:z,maxx:N,maxy:j,t:v.dem.tree.raycastRoot(L,z,N,j,t,a,f),tile:v}});g.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let v of g){if(v.t==null)return null;let b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,a,f);if(b!=null)return b}return null}_createFBO(){let t=this.painter.context,a=t.gl,f=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);let g=new i.T(t,{width:f[0],height:f[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);let v=t.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new Nl(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let a=this._style._mergedLayers[t],f=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let f of this._style.getSources())if(f instanceof oh){t=!0;break}if(!t)return;let a={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(v&&!a[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof i.a4){a[v.id]=!0;for(let b of this.proxyCoords){let M=this.proxyToSource[b.key][v.id];if(M)for(let A of M)this._clearRenderCacheForTile(v.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Hc){t=!0;break}if(!t)return;let a={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(!v||a[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let b=g.paint.get("raster-fade-duration");for(let M of this.proxyCoords){let A=this.proxyToSource[M.key][v.id];if(A)for(let O of A){let L=Ph(v.getTile(O),v.findLoadedParent(O,0),v,this.painter.transform,b);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(v.id,O)}}}}_setupDrapedRenderBatches(){let t=this._style.order,a=t.length;if(a===0)return;let f=[];this._pendingGroundEffectLayers=[];let g,v=0,b=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<a;)b=this._style._mergedLayers[t[v]];for(;v<a;++v){let M=this._style._mergedLayers[t[v]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?g===void 0&&(g=v):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(f.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:v-1}),f.length!==0){let M=f[f.length-1];this._pendingGroundEffectLayers.every(A=>A>M.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(t){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let M=0;M<b.length;++M){let A=Object.values(b[M]);a.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,g=this._tilesDirty;for(let b=f.length-1;b>=0;b--){let M=f[b];if(a.getTileByID(M.key),a.proxyCachedFBO[M.key]!==void 0){let A=t[M.key],O=this.proxyToSource[M.key],L=0;for(let N in O){let z=O[N],j=A[N];if(!j||j.length!==z.length||z.some((q,W)=>q!==j[W]||g[N]&&g[N].hasOwnProperty(q.key))){L=-1;break}++L}for(let N in a.proxyCachedFBO[M.key])a.renderCache[a.proxyCachedFBO[M.key][N]].dirty=L<0||L!==Object.values(A).length}}let v=[...this._drapedRenderBatches];v.sort((b,M)=>M.end-M.start-(b.end-b.start));for(let b of v)for(let M of f){if(a.proxyCachedFBO[M.key])continue;let A=a.renderCachePool.pop();A===void 0&&a.renderCache.length<50&&(A=a.renderCache.length,a.renderCache.push(this._createFBO())),A!==void 0&&(a.proxyCachedFBO[M.key]={},a.proxyCachedFBO[M.key][b.start]=A,a.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,b=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let M;if(f.isTileClipped())M=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):qt.disabled}_renderTileClippingMasks(t,a){let f=this.painter,g=this.painter.context,v=g.gl;f._tileClippingMaskIDs={},g.setColorMode(mn.disabled),g.setDepthMode(Dt.disabled);let b=f.getOrCreateProgram("clippingMask");for(let M of t){let A=f._tileClippingMaskIDs[M.key]=--a;b.draw(f,v.TRIANGLES,Dt.disabled,new qt({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),mn.disabled,kt.disabled,au(M.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(t){let a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;let f=[t.x,t.y,1,1];i.a6.vec4.transformMat4(f,f,a.pixelMatrixInverse),i.a6.vec4.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;let g=a._camera.position,v=i.bD(1,a.center.lat),b=[g[0],g[1],g[2]/v,0],M=i.a6.vec3.subtract([],f.slice(0,3),b);i.a6.vec3.normalize(M,M);let A=this.raycast(b,M,this._exaggeration);return A!==null&&A?(i.a6.vec3.scaleAndAdd(b,b,M,A),b[3]=b[2],b[2]*=v,b):null}_setupProxiedCoordsForOrtho(t,a,f){if(t.getSource()instanceof i.aD)return this._setupProxiedCoordsForImageSource(t,a,f);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let g=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){let O=v[A],L=this._findTileCoveringTileID(O,t);if(L){let N=this._createProxiedId(O,L,f[O.key]&&f[O.key][t.id]);g.push(N),this.proxyToSource[O.key][t.id]=[N]}}let b=!1,M=new Set;for(let A=0;A<a.length;A++){let O=t.getTile(a[A]);if(!O||!O.hasData())continue;let L=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==O.tileID.canonical.z){let N=this.proxyToSource[L.tileID.key][t.id],z=this._createProxiedId(L.tileID,O,f[L.tileID.key]&&f[L.tileID.key][t.id]);N?N.splice(N.length-1,0,z):this.proxyToSource[L.tileID.key][t.id]=[z];let j=this.proxyToSource[L.tileID.key][t.id];M.has(j)||M.add(j),g.push(z),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let A of M)A.sort((O,L)=>L.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,f){if(!t.getSource().loaded())return;let g=this.proxiedCoords[t.id]=[],v=this.proxyCoords,b=t.getSource(),M=b.tileID;if(!M)return;let A=new i.P(M.x,M.y)._div(1<<M.z),O=b.coordinates.map(i.a5.fromLngLat).reduce((N,z)=>(N.min.x=Math.min(N.min.x,z.x-A.x),N.min.y=Math.min(N.min.y,z.y-A.y),N.max.x=Math.max(N.max.x,z.x-A.x),N.max.y=Math.max(N.max.y,z.y-A.y),N),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(N,z)=>{let j=N.wrap+N.canonical.x/(1<<N.canonical.z),q=N.canonical.y/(1<<N.canonical.z),W=i.ab/(1<<N.canonical.z),Z=z.wrap+z.canonical.x/(1<<z.canonical.z),X=z.canonical.y/(1<<z.canonical.z);return j+W<Z+O.min.x||j>Z+O.max.x||q+W<X+O.min.y||q>X+O.max.y};for(let N=0;N<v.length;N++){let z=v[N];for(let j=0;j<a.length;j++){let q=t.getTile(a[j]);if(!q||!q.hasData()||L(z,q.tileID))continue;let W=this._createProxiedId(z,q,f[z.key]&&f[z.key][t.id]),Z=this.proxyToSource[z.key][t.id];Z?Z.push(W):this.proxyToSource[z.key][t.id]=[W],g.push(W)}}}_createProxiedId(t,a,f){let g=this.orthoMatrix;if(f){let v=f.find(b=>b.key===a.tileID.key);if(v)return v}if(a.tileID.key!==t.key){let v=t.canonical.z-a.tileID.canonical.z,b,M,A;g=i.a6.mat4.create();let O=a.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(b=i.ab>>v,M=b*((a.tileID.canonical.x<<v)-t.canonical.x+O),A=b*((a.tileID.canonical.y<<v)-t.canonical.y)):(b=i.ab<<-v,M=i.ab*(a.tileID.canonical.x-(t.canonical.x+O<<-v)),A=i.ab*(a.tileID.canonical.y-(t.canonical.y<<-v))),i.a6.mat4.ortho(g,0,b,0,b,0,1),i.a6.mat4.translate(g,g,[M,A,0])}return new Xf(a.tileID,t.key,g)}_findTileCoveringTileID(t,a){let f=a.getTile(t);if(f&&f.hasData())return f;let g=this._findCoveringTileCache[a.id],v=g[t.key];if(f=v?a.getTileByID(v):null,f&&f.hasData()||v===null)return f;let b=f?f.tileID:t,M=b.overscaledZ,A=a.getSource().minzoom,O=[];if(!v){let N=a.getSource().maxzoom;if(t.canonical.z>=N){let z=t.canonical.z-N;a.getSource().reparseOverscaled?(M=Math.max(t.canonical.z+2,a.transform.tileZoom),b=new i.aA(M,t.wrap,N,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(M=N,b=new i.aA(M,t.wrap,N,t.canonical.x>>z,t.canonical.y>>z))}b.key!==t.key&&(O.push(b.key),f=a.getTile(b))}let L=N=>{O.forEach(z=>{g[z]=N}),O.length=0};for(M-=1;M>=A&&(!f||!f.hasData());M--){f&&L(f.tileID.key);let N=b.calculateScaledKey(M);if(f=a.getTileByID(N),f&&f.hasData())break;let z=g[N];if(z===null)break;z===void 0?O.push(N):f=a.getTileByID(z)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let f=this._tilesDirty[t];f||(f=this._tilesDirty[t]={}),f[a.key]=!0}}function Kf(d,t,a){let f=function(M,A,O){let L=i.a6.vec3.dot(A,M),N=i.a6.vec3.dot(O,[.2126,.7152,.0722]),z=(q,W,Z)=>(1-Z)*q+Z*W,j=z(1-.3*Math.min(N,1),1,Math.min(L+1,1));return z(.92,1,Math.asin(i.ap(A[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],t),g=[0,0,0];i.a6.vec3.scale(g,a.slice(0,3),f);let v=[0,0,0];i.a6.vec3.scale(v,t.slice(0,3),d[2]);let b=[0,0,0];return i.a6.vec3.add(b,g,v),i.cb(b)}let Fa=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Gg=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ys{static cacheKey(t,a,f,g){let v=`${a}${g?g.cacheKey:""}`;for(let b of f)t.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(t,a,f,g,v,b){let M=t.gl;this.program=M.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...b];let A=g?g.getBinderAttributes():[],O=(f.staticAttributes||[]).concat(A),L=g?g.defines():[];L=L.concat(b.map(Z=>`#define ${Z}`));let N=`#version 300 es
`,z=N+L.concat("precision mediump float;",Th,eu.fragmentSource).join(`
`);for(let Z of f.fragmentIncludes)z+=`
${Qc[Z]}`;z+=`
${f.fragmentSource}`;let j=N+L.concat("precision highp float;",Th,eu.vertexSource).join(`
`);for(let Z of f.vertexIncludes)j+=`
${Qc[Z]}`;j+=`
${f.vertexSource}`;let q=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(q,z),M.compileShader(q),M.attachShader(this.program,q);let W=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(W,j),M.compileShader(W),M.attachShader(this.program,W),this.attributes={},this.numAttributes=O.length;for(let Z=0;Z<this.numAttributes;Z++)if(O[Z]){let X=O[Z].startsWith("a_")?O[Z]:`a_${O[Z]}`;M.bindAttribLocation(this.program,Z,X),this.attributes[X]=Z}M.linkProgram(this.program),M.deleteShader(W),M.deleteShader(q),this.fixedUniforms=v(t),this.binderUniforms=g?g.getUniforms(t):[],(b.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(Z=>({u_dem:new i.bJ(Z),u_dem_prev:new i.bJ(Z),u_dem_tl:new i.bG(Z),u_dem_scale:new i.bI(Z),u_dem_tl_prev:new i.bG(Z),u_dem_scale_prev:new i.bI(Z),u_dem_size:new i.bI(Z),u_dem_lerp:new i.bI(Z),u_exaggeration:new i.bI(Z),u_depth:new i.bJ(Z),u_depth_size_inv:new i.bG(Z),u_depth_range_unpack:new i.bG(Z),u_occluder_half_size:new i.bI(Z),u_occlusion_depth_offset:new i.bI(Z),u_meter_to_dem:new i.bI(Z),u_label_plane_matrix_inv:new i.bF(Z)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new i.bH(Z),u_tile_tr_up:new i.bH(Z),u_tile_br_up:new i.bH(Z),u_tile_bl_up:new i.bH(Z),u_tile_up_scale:new i.bI(Z)}))(t)),b.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new i.bF(Z),u_fog_range:new i.bG(Z),u_fog_color:new i.c6(Z),u_fog_horizon_blend:new i.bI(Z),u_fog_vertical_limit:new i.bG(Z),u_fog_temporal_offset:new i.bI(Z),u_frustum_tl:new i.bH(Z),u_frustum_tr:new i.bH(Z),u_frustum_br:new i.bH(Z),u_frustum_bl:new i.bH(Z),u_globe_pos:new i.bH(Z),u_globe_radius:new i.bI(Z),u_globe_transition:new i.bI(Z),u_is_globe:new i.bJ(Z),u_viewport:new i.bG(Z)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new i.c6(Z)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new i.bH(Z),u_lighting_directional_dir:new i.bH(Z),u_lighting_directional_color:new i.bH(Z),u_ground_radiance:new i.bH(Z)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new i.bF(Z),u_light_matrix_1:new i.bF(Z),u_fade_range:new i.bG(Z),u_shadow_normal_offset:new i.bH(Z),u_shadow_intensity:new i.bI(Z),u_shadow_texel_size:new i.bI(Z),u_shadow_map_resolution:new i.bI(Z),u_shadow_direction:new i.bH(Z),u_shadow_bias:new i.bH(Z),u_shadowmap_0:new i.bJ(Z),u_shadowmap_1:new i.bJ(Z)}))(t))}}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in a)f[g]&&f[g].set(this.program,g,a[g])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in a)f[g]&&f[g].set(this.program,g,a[g])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;t.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}_drawDebugWireframe(t,a,f,g,v,b,M,A,O,L){let N=t.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;let z=t.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||t._terrain&&t._terrain.renderingToTexture||!Fa.includes(this.name))||!(!N.layers3D||!Gg.includes(this.name))))return;let j=z.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,z);if(!q)return;let W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");let Z=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});z.program.set(Z.program);let X=(ee,le,ae)=>{if(le[ee]&&ae[ee])for(let fe in le[ee])ae[ee][fe]&&ae[ee][fe].set(ae.program,fe,le[ee][fe].current)};O&&O.setUniforms(Z.program,z,Z.binderUniforms,M,{zoom:A}),X("fixedUniforms",this,Z),X("terrainUniforms",this,Z),X("globeUniforms",this,Z),X("fogUniforms",this,Z),X("lightsUniforms",this,Z),X("shadowUniforms",this,Z),q.bind(),z.setColorMode(new mn([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],i.bz.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Dt(a.func===j.LESS?j.LEQUAL:a.func,Dt.ReadOnly,a.range)),z.setStencilMode(qt.disabled);let ne=3*b.primitiveLength*2,oe=3*b.primitiveOffset*2*2;L&&L>1?j.drawElementsInstanced(j.LINES,ne,j.UNSIGNED_SHORT,oe,L):j.drawElements(j.LINES,ne,j.UNSIGNED_SHORT,oe),v.bind(),z.program.set(this.program),z.setDepthMode(a),z.setStencilMode(f),z.setColorMode(g)}draw(t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z){let X=t.context,ne=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(f),X.setStencilMode(g),X.setColorMode(v),X.setCullFace(b);for(let le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(this.program,le,M[le]);q&&q.setUniforms(this.program,X,this.binderUniforms,z,{zoom:j});let oe={[ne.POINTS]:1,[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[a],ee=Z&&Z>0?1:void 0;for(let le of N.get()){let ae=le.vaos||(le.vaos={});(ae[A]||(ae[A]=new Fl)).bind(X,this,O,q?q.getPaintVertexBuffers():[],L,le.vertexOffset,W||[],ee),Z&&Z>1?ne.drawElementsInstanced(a,le.primitiveLength*oe,ne.UNSIGNED_SHORT,le.primitiveOffset*oe*2,Z):L?ne.drawElements(a,le.primitiveLength*oe,ne.UNSIGNED_SHORT,le.primitiveOffset*oe*2):ne.drawArrays(a,le.vertexOffset,le.vertexLength),a===ne.TRIANGLES&&L&&this._drawDebugWireframe(t,f,g,v,L,le,z,j,q,Z)}}}function Jf(d,t){let a=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,d.transform.tileZoom)/a,g=f*(t.tileID.canonical.x+t.tileID.wrap*a),v=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ak(t,1,d.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}let Rh=i.a6.mat4.create(),Qf=(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W)=>{let Z=t.style.light,X=Z.properties.get("position"),ne=[X.x,X.y,X.z],oe=i.a6.mat3.create();Z.properties.get("anchor")==="viewport"&&(i.a6.mat3.fromRotation(oe,-t.transform.angle),i.a6.vec3.transformMat3(ne,ne,oe));let ee=Z.properties.get("color"),le=t.transform,ae={u_matrix:d,u_lightpos:ne,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v,u_width_scale:b,u_flood_light_color:z,u_vertical_scale:j,u_flood_light_intensity:q,u_ground_shadow_factor:W};return le.projection.name==="globe"&&(ae.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],ae.u_zoom_transition=O,ae.u_inv_rot_matrix=N,ae.u_merc_center=L,ae.u_up_dir=le.projection.upVector(new i.bP(0,0,0),L[0]*i.ab,L[1]*i.ab),ae.u_height_lift=A),ae},Hg=(d,t,a,f)=>({u_matrix:d,u_edge_radius:t,u_width_scale:a,u_vertical_scale:f}),ep=(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q)=>{let W=Qf(d,t,a,f,g,v,b,M,O,L,N,z,j,q,1,[0,0,0]),Z={u_height_factor:-Math.pow(2,M.overscaledZ)/A.tileSize/8};return i.l(W,Jf(t,A),Z)},Oh=(d,t)=>({u_matrix:d,u_emissive_strength:t}),qg=(d,t,a,f)=>i.l(Oh(d,t),Jf(a,f)),Wg=(d,t,a)=>({u_matrix:d,u_world:a,u_emissive_strength:t}),lu=(d,t,a,f,g)=>i.l(qg(d,t,a,f),{u_world:g}),sx=(d,t,a,f)=>{let g=i.ab/a.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.getCameraToCenterDistance(f),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},Zg=(d,t,a=1)=>({u_matrix:d,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),Xg=i.a6.mat4.create(),ax=(d,t,a,f,g,v,b)=>{let M=d.transform,A=M.projection.name==="globe",O=A?i.cI(M.zoom,t.canonical)*M._pixelsPerMercatorPixel:i.ak(a,1,v),L={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:b,u_inv_rot_matrix:Xg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=f,L.u_merc_center=g,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=i.a9(M.zoom);let N=g[0]*i.ab,z=g[1]*i.ab;L.u_up_dir=M.projection.upVector(new i.bP(0,0,0),N,z)}return L};function Lh(d,[t,a,f,g],[v,b]){if(v===b)return[0,0,0,0];let M=255*(d-1)/(d*(b-v));return[t*M,a*M,f*M,g*M]}function Fh(d,t,[a,f]){return a===f?0:.5/d+(t-a)*(d-1)/(d*(f-a))}let cu=(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X,ne,oe,ee)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:O,u_fade_t:L.mix,u_opacity:L.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:i.cJ(N.paint.get("raster-saturation")),u_contrast_factor:i.cK(N.paint.get("raster-contrast")),u_spin_weights:tp(N.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:j,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:A,u_colorization_mix:Lh(i.cL,W,X),u_colorization_offset:Fh(i.cL,Z,X),u_color_ramp:q,u_texture_offset:[oe/(ne+2*oe),ne/(ne+2*oe)],u_texture_res:[ne+2*oe,ne+2*oe],u_emissive_strength:ee});function tp(d){d*=Math.PI/180;let t=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}let qo=.05,Yg=(d,t,a,f,g,v,b,M,A,O,L,N)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:O,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:A}),kh=(d,t,a,f,g,v,b,M,A,O)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:f,u_color_ramp:v,u_velocity_res:g,u_max_speed:b,u_uv_offset:M,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[qo,qo]}),Nh=(d,t,a,f,g,v,b,M,A,O)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:f,u_max_speed:g,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[qo,qo]}),zh=i.a6.mat4.create(),np=(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X,ne,oe,ee)=>{let le=g.transform,ae={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:le.getCameraToCenterDistance(ne),u_rotate_symbol:+a,u_aspect_ratio:le.width/le.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:M,u_is_text:+O,u_elevation_from_sea:A?1:0,u_pitch_with_map:+f,u_texsize:L,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zh,u_up_vector:[0,-1,0],u_color_adj_mat:oe,u_icon_transition:ee||0,u_gamma_scale:f?g.transform.getCameraToCenterDistance(ne)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:+z};return ne.name==="globe"&&(ae.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ae.u_zoom_transition=q,ae.u_inv_rot_matrix=Z,ae.u_merc_center=W,ae.u_camera_forward=le._camera.forward(),ae.u_ecef_origin=i.cM(le.globeMatrix,j.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(le.globeMatrix),ae.u_up_vector=X),ae},Kg=(d,t,a,f)=>({u_matrix:d,u_emissive_strength:t,u_opacity:a,u_color:f}),ka=(d,t,a,f,g,v,b,M,A)=>i.l(function(O,L,N,z,j,q){let{width:W,height:Z}=z.imageManager.getPixelSize(L),X=Math.pow(2,q.tileID.overscaledZ),ne=q.tileSize*Math.pow(2,z.transform.tileZoom)/X,oe=ne*(q.tileID.canonical.x+q.tileID.wrap*X),ee=ne*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[W,Z],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:j?[z.transform.width,-1*z.transform.height]:[1/i.ak(q,1,z.transform.tileZoom),1/i.ak(q,1,z.transform.tileZoom)],u_pixel_coord_upper:[oe>>16,ee>>16],u_pixel_coord_lower:[65535&oe,65535&ee]}}(0,v,b,f,M,A),{u_matrix:d,u_emissive_strength:t,u_opacity:a}),Vl=new Float32Array(i.a6.mat4.identity([])),mt=(d,t,a,f,g,v,b,M,A,O,L,N,z,j=[0,0,0],q)=>{let W=g.style.light,Z=W.properties.get("position"),X=[-Z.x,-Z.y,Z.z],ne=i.a6.mat3.create();W.properties.get("anchor")==="viewport"&&(i.a6.mat3.fromRotation(ne,-g.transform.angle),i.a6.vec3.transformMat3(X,X,ne));let oe=L.alphaMode==="MASK",ee=W.properties.get("color").toRenderColor(null),le=z.paint.get("model-ambient-occlusion-intensity"),ae=z.paint.get("model-color").constantOr(i.bz.white).toRenderColor(null),fe=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:f||Vl,u_lightpos:X,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:j,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:A,u_roughnessFactor:O,u_baseColorTexture:cr.BaseColor,u_metallicRoughnessTexture:cr.MetallicRoughness,u_normalTexture:cr.Normal,u_occlusionTexture:cr.Occlusion,u_emissionTexture:cr.Emission,u_lutTexture:cr.LUT,u_color_mix:[ae.r,ae.g,ae.b,fe],u_aoIntensity:le,u_emissive_strength:N,u_occlusionTextureTransform:q||[0,0,0,0]}},ip=(d,t=Vl,a=Vl)=>({u_matrix:d,u_instance:t,u_node_matrix:a}),Jg={fillExtrusion:d=>({u_matrix:new i.bF(d),u_lightpos:new i.bH(d),u_lightintensity:new i.bI(d),u_lightcolor:new i.bH(d),u_vertical_gradient:new i.bI(d),u_opacity:new i.bI(d),u_edge_radius:new i.bI(d),u_width_scale:new i.bI(d),u_ao:new i.bG(d),u_tile_id:new i.bH(d),u_zoom_transition:new i.bI(d),u_inv_rot_matrix:new i.bF(d),u_merc_center:new i.bG(d),u_up_dir:new i.bH(d),u_height_lift:new i.bI(d),u_flood_light_color:new i.bH(d),u_vertical_scale:new i.bI(d),u_flood_light_intensity:new i.bI(d),u_ground_shadow_factor:new i.bH(d)}),fillExtrusionDepth:d=>({u_matrix:new i.bF(d),u_edge_radius:new i.bI(d),u_width_scale:new i.bI(d),u_vertical_scale:new i.bI(d)}),fillExtrusionPattern:d=>({u_matrix:new i.bF(d),u_lightpos:new i.bH(d),u_lightintensity:new i.bI(d),u_lightcolor:new i.bH(d),u_vertical_gradient:new i.bI(d),u_height_factor:new i.bI(d),u_edge_radius:new i.bI(d),u_width_scale:new i.bI(d),u_ao:new i.bG(d),u_tile_id:new i.bH(d),u_zoom_transition:new i.bI(d),u_inv_rot_matrix:new i.bF(d),u_merc_center:new i.bG(d),u_up_dir:new i.bH(d),u_height_lift:new i.bI(d),u_image:new i.bJ(d),u_texsize:new i.bG(d),u_pixel_coord_upper:new i.bG(d),u_pixel_coord_lower:new i.bG(d),u_tile_units_to_pixels:new i.bI(d),u_opacity:new i.bI(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new i.bF(d),u_opacity:new i.bI(d),u_ao_pass:new i.bI(d),u_meter_to_tile:new i.bI(d),u_ao:new i.bG(d),u_flood_light_intensity:new i.bI(d),u_flood_light_color:new i.bH(d),u_attenuation:new i.bI(d),u_edge_radius:new i.bI(d),u_fb:new i.bJ(d),u_fb_size:new i.bI(d),u_dynamic_offset:new i.bI(d)}),fill:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d)}),fillPattern:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d),u_image:new i.bJ(d),u_texsize:new i.bG(d),u_pixel_coord_upper:new i.bG(d),u_pixel_coord_lower:new i.bG(d),u_tile_units_to_pixels:new i.bI(d)}),fillOutline:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d),u_world:new i.bG(d)}),fillOutlinePattern:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d),u_world:new i.bG(d),u_image:new i.bJ(d),u_texsize:new i.bG(d),u_pixel_coord_upper:new i.bG(d),u_pixel_coord_lower:new i.bG(d),u_tile_units_to_pixels:new i.bI(d)}),circle:i.cN,collisionBox:d=>({u_matrix:new i.bF(d),u_camera_to_center_distance:new i.bI(d),u_extrude_scale:new i.bG(d)}),collisionCircle:d=>({u_matrix:new i.bF(d),u_inv_matrix:new i.bF(d),u_camera_to_center_distance:new i.bI(d),u_viewport_size:new i.bG(d)}),debug:d=>({u_color:new i.cu(d),u_matrix:new i.bF(d),u_overlay:new i.bJ(d),u_overlay_scale:new i.bI(d)}),clippingMask:d=>({u_matrix:new i.bF(d)}),heatmap:d=>({u_extrude_scale:new i.bI(d),u_intensity:new i.bI(d),u_matrix:new i.bF(d),u_inv_rot_matrix:new i.bF(d),u_merc_center:new i.bG(d),u_tile_id:new i.bH(d),u_zoom_transition:new i.bI(d),u_up_dir:new i.bH(d)}),heatmapTexture:d=>({u_image:new i.bJ(d),u_color_ramp:new i.bJ(d),u_opacity:new i.bI(d)}),hillshade:d=>({u_matrix:new i.bF(d),u_image:new i.bJ(d),u_latrange:new i.bG(d),u_light:new i.bG(d),u_shadow:new i.cu(d),u_highlight:new i.cu(d),u_emissive_strength:new i.bI(d),u_accent:new i.cu(d)}),hillshadePrepare:d=>({u_matrix:new i.bF(d),u_image:new i.bJ(d),u_dimension:new i.bG(d),u_zoom:new i.bI(d)}),line:i.cO,linePattern:i.cP,raster:d=>({u_matrix:new i.bF(d),u_normalize_matrix:new i.bF(d),u_globe_matrix:new i.bF(d),u_merc_matrix:new i.bF(d),u_grid_matrix:new i.cv(d),u_tl_parent:new i.bG(d),u_scale_parent:new i.bI(d),u_fade_t:new i.bI(d),u_opacity:new i.bI(d),u_image0:new i.bJ(d),u_image1:new i.bJ(d),u_brightness_low:new i.bI(d),u_brightness_high:new i.bI(d),u_saturation_factor:new i.bI(d),u_contrast_factor:new i.bI(d),u_spin_weights:new i.bH(d),u_perspective_transform:new i.bG(d),u_raster_elevation:new i.bI(d),u_zoom_transition:new i.bI(d),u_merc_center:new i.bG(d),u_cutoff_params:new i.c6(d),u_colorization_mix:new i.c6(d),u_colorization_offset:new i.bI(d),u_color_ramp:new i.bJ(d),u_texture_offset:new i.bG(d),u_texture_res:new i.bG(d),u_emissive_strength:new i.bI(d)}),rasterParticle:d=>({u_matrix:new i.bF(d),u_normalize_matrix:new i.bF(d),u_globe_matrix:new i.bF(d),u_merc_matrix:new i.bF(d),u_grid_matrix:new i.cv(d),u_tl_parent:new i.bG(d),u_scale_parent:new i.bI(d),u_fade_t:new i.bI(d),u_opacity:new i.bI(d),u_image0:new i.bJ(d),u_image1:new i.bJ(d),u_raster_elevation:new i.bI(d),u_zoom_transition:new i.bI(d),u_merc_center:new i.bG(d),u_cutoff_params:new i.c6(d)}),rasterParticleTexture:d=>({u_texture:new i.bJ(d),u_opacity:new i.bI(d)}),rasterParticleDraw:d=>({u_particle_texture:new i.bJ(d),u_particle_texture_side_len:new i.bI(d),u_tile_offset:new i.bG(d),u_velocity:new i.bJ(d),u_color_ramp:new i.bJ(d),u_velocity_res:new i.bG(d),u_max_speed:new i.bI(d),u_uv_offset:new i.bG(d),u_data_scale:new i.bG(d),u_data_offset:new i.bI(d),u_particle_pos_scale:new i.bI(d),u_particle_pos_offset:new i.bG(d)}),rasterParticleUpdate:d=>({u_particle_texture:new i.bJ(d),u_particle_texture_side_len:new i.bI(d),u_velocity:new i.bJ(d),u_velocity_res:new i.bG(d),u_max_speed:new i.bI(d),u_speed_factor:new i.bI(d),u_reset_rate:new i.bI(d),u_rand_seed:new i.bI(d),u_uv_offset:new i.bG(d),u_data_scale:new i.bG(d),u_data_offset:new i.bI(d),u_particle_pos_scale:new i.bI(d),u_particle_pos_offset:new i.bG(d)}),symbol:d=>({u_is_size_zoom_constant:new i.bJ(d),u_is_size_feature_constant:new i.bJ(d),u_size_t:new i.bI(d),u_size:new i.bI(d),u_camera_to_center_distance:new i.bI(d),u_rotate_symbol:new i.bJ(d),u_aspect_ratio:new i.bI(d),u_fade_change:new i.bI(d),u_matrix:new i.bF(d),u_label_plane_matrix:new i.bF(d),u_coord_matrix:new i.bF(d),u_is_text:new i.bJ(d),u_elevation_from_sea:new i.bJ(d),u_pitch_with_map:new i.bJ(d),u_texsize:new i.bG(d),u_texsize_icon:new i.bG(d),u_texture:new i.bJ(d),u_texture_icon:new i.bJ(d),u_gamma_scale:new i.bI(d),u_device_pixel_ratio:new i.bI(d),u_tile_id:new i.bH(d),u_zoom_transition:new i.bI(d),u_inv_rot_matrix:new i.bF(d),u_merc_center:new i.bG(d),u_camera_forward:new i.bH(d),u_tile_matrix:new i.bF(d),u_up_vector:new i.bH(d),u_ecef_origin:new i.bH(d),u_is_halo:new i.bJ(d),u_icon_transition:new i.bI(d),u_color_adj_mat:new i.bF(d)}),background:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d),u_opacity:new i.bI(d),u_color:new i.cu(d)}),backgroundPattern:d=>({u_matrix:new i.bF(d),u_emissive_strength:new i.bI(d),u_opacity:new i.bI(d),u_image:new i.bJ(d),u_pattern_tl:new i.bG(d),u_pattern_br:new i.bG(d),u_texsize:new i.bG(d),u_pattern_size:new i.bG(d),u_pixel_coord_upper:new i.bG(d),u_pixel_coord_lower:new i.bG(d),u_pattern_units_to_pixels:new i.bG(d)}),terrainRaster:d=>({u_matrix:new i.bF(d),u_image0:new i.bJ(d),u_skirt_height:new i.bI(d),u_ground_shadow_factor:new i.bH(d)}),skybox:d=>({u_matrix:new i.bF(d),u_sun_direction:new i.bH(d),u_cubemap:new i.bJ(d),u_opacity:new i.bI(d),u_temporal_offset:new i.bI(d)}),skyboxGradient:d=>({u_matrix:new i.bF(d),u_color_ramp:new i.bJ(d),u_center_direction:new i.bH(d),u_radius:new i.bI(d),u_opacity:new i.bI(d),u_temporal_offset:new i.bI(d)}),skyboxCapture:d=>({u_matrix_3f:new i.cv(d),u_sun_direction:new i.bH(d),u_sun_intensity:new i.bI(d),u_color_tint_r:new i.c6(d),u_color_tint_m:new i.c6(d),u_luminance:new i.bI(d)}),globeRaster:d=>({u_proj_matrix:new i.bF(d),u_globe_matrix:new i.bF(d),u_normalize_matrix:new i.bF(d),u_merc_matrix:new i.bF(d),u_zoom_transition:new i.bI(d),u_merc_center:new i.bG(d),u_image0:new i.bJ(d),u_grid_matrix:new i.cv(d),u_skirt_height:new i.bI(d),u_far_z_cutoff:new i.bI(d),u_frustum_tl:new i.bH(d),u_frustum_tr:new i.bH(d),u_frustum_br:new i.bH(d),u_frustum_bl:new i.bH(d),u_globe_pos:new i.bH(d),u_globe_radius:new i.bI(d),u_viewport:new i.bG(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.bH(d),u_frustum_tr:new i.bH(d),u_frustum_br:new i.bH(d),u_frustum_bl:new i.bH(d),u_horizon:new i.bI(d),u_transition:new i.bI(d),u_fadeout_range:new i.bI(d),u_color:new i.c6(d),u_high_color:new i.c6(d),u_space_color:new i.c6(d),u_temporal_offset:new i.bI(d),u_horizon_angle:new i.bI(d)}),model:d=>({u_matrix:new i.bF(d),u_lighting_matrix:new i.bF(d),u_normal_matrix:new i.bF(d),u_node_matrix:new i.bF(d),u_lightpos:new i.bH(d),u_lightintensity:new i.bI(d),u_lightcolor:new i.bH(d),u_camera_pos:new i.bH(d),u_opacity:new i.bI(d),u_baseColorFactor:new i.c6(d),u_emissiveFactor:new i.c6(d),u_metallicFactor:new i.bI(d),u_roughnessFactor:new i.bI(d),u_baseTextureIsAlpha:new i.bJ(d),u_alphaMask:new i.bJ(d),u_alphaCutoff:new i.bI(d),u_baseColorTexture:new i.bJ(d),u_metallicRoughnessTexture:new i.bJ(d),u_normalTexture:new i.bJ(d),u_occlusionTexture:new i.bJ(d),u_emissionTexture:new i.bJ(d),u_lutTexture:new i.bJ(d),u_color_mix:new i.c6(d),u_aoIntensity:new i.bI(d),u_emissive_strength:new i.bI(d),u_occlusionTextureTransform:new i.c6(d)}),modelDepth:d=>({u_matrix:new i.bF(d),u_instance:new i.bF(d),u_node_matrix:new i.bF(d)}),groundShadow:d=>({u_matrix:new i.bF(d),u_ground_shadow_factor:new i.bH(d)}),stars:d=>({u_matrix:new i.bF(d),u_up:new i.bH(d),u_right:new i.bH(d),u_intensity_multiplier:new i.bI(d)}),occlusion:d=>({u_matrix:new i.bF(d),u_anchorPos:new i.bH(d),u_screenSizePx:new i.bG(d),u_occluderSizePx:new i.bG(d),u_color:new i.c6(d)})},Ks=(()=>{class d{constructor(a,f,g,v){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++,this.context=a;let b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return d.uniqueIdxCounter=0,d})(),Na={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bt{constructor(t,a,f,g,v,b){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=t;let M=t.gl;this.buffer=M.createBuffer(),t.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let f=0;f<this.attributes.length;f++){let g=a.attributes[this.attributes[f].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,f){for(let g=0;g<this.attributes.length;g++){let v=this.attributes[g],b=a.attributes[v.name];b!==void 0&&t.vertexAttribPointer(b,v.components,t[Na[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(t,a,f){for(let g=0;g<this.attributes.length;g++){let v=a.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bh{constructor(t,a,f,g,v){this.context=t,this.width=a,this.height=f;let b=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Ah(t,b)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Wf(t,b):new zg(t,b))}destroy(){let t=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class lx{constructor(t,a){this.gl=t,this.clearColor=new Nf(this),this.clearDepth=new Ag(this),this.clearStencil=new zf(this),this.colorMask=new Ch(this),this.depthMask=new iu(this),this.stencilMask=new Pg(this),this.stencilFunc=new Rg(this),this.stencilOp=new Og(this),this.stencilTest=new kl(this),this.depthRange=new Lg(this),this.depthTest=new tx(this),this.depthFunc=new nx(this),this.blend=new ix(this),this.blendFunc=new Bf(this),this.blendColor=new Vf(this),this.blendEquation=new jf(this),this.cullFace=new Uf(this),this.cullFaceSide=new Fg(this),this.frontFace=new kg(this),this.program=new rx(this),this.activeTexture=new ru(this),this.viewport=new ou(this),this.bindFramebuffer=new Ng(this),this.bindRenderbuffer=new Jr(this),this.bindTexture=new $f(this),this.bindVertexBuffer=new Dh(this),this.bindElementBuffer=new Mh(this),this.bindVertexArrayOES=new Gf(this),this.pixelStoreUnpack=new Hf(this),this.pixelStoreUnpackPremultiplyAlpha=new Sh(this),this.pixelStoreUnpackFlipY=new qf(this),this.options=a?St({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,f){return new Ks(this,t,a,f)}createVertexBuffer(t,a,f,g,v){return new bt(this,t,a,f,g,v)}createRenderbuffer(t,a,f){let g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,t,a,f),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,f,g){return new Bh(this,t,a,f,g)}clear({color:t,depth:a,stencil:f,colorMask:g}){let v=this.gl,b=0;t&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.bh(t.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vh;function jh(d,t,a,f,g,v,b){let M=d.context,A=M.gl,O=d.transform,L=d.getOrCreateProgram("collisionBox"),N=[],z=0,j=0;for(let ee=0;ee<f.length;ee++){let le=f[ee],ae=t.getTile(le),fe=ae.getBucket(a);if(!fe)continue;let he=_g(le,fe,O),pe=he;g[0]===0&&g[1]===0||(pe=d.translatePosMatrix(he,ae,g,v));let we=b?fe.textCollisionBox:fe.iconCollisionBox,ye=fe.collisionCircleArray;if(ye.length>0){let ge=i.a6.mat4.create(),Me=pe;i.a6.mat4.mul(ge,fe.placementInvProjMatrix,O.glCoordMatrix),i.a6.mat4.mul(ge,ge,fe.placementViewportMatrix),N.push({circleArray:ye,circleOffset:j,transform:Me,invTransform:ge,projection:fe.getProjection()}),z+=ye.length/4,j=z}we&&(d.terrain&&d.terrain.setupElevationDraw(ae,L),L.draw(d,A.LINES,Dt.disabled,qt.disabled,d.colorModeForRenderPass(),kt.disabled,sx(pe,O,ae,fe.getProjection()),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,O.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!b||!N.length)return;let q=d.getOrCreateProgram("collisionCircle"),W=new i.cQ;W.resize(4*z),W._trim();let Z=0;for(let ee of N)for(let le=0;le<ee.circleArray.length/4;le++){let ae=4*le,fe=ee.circleArray[ae+0],he=ee.circleArray[ae+1],pe=ee.circleArray[ae+2],we=ee.circleArray[ae+3];W.emplace(Z++,fe,he,pe,we,0),W.emplace(Z++,fe,he,pe,we,1),W.emplace(Z++,fe,he,pe,we,2),W.emplace(Z++,fe,he,pe,we,3)}(!Vh||Vh.length<2*z)&&(Vh=function(ee){let le=2*ee,ae=new i.aO;ae.resize(le),ae._trim();for(let fe=0;fe<le;fe++){let he=6*fe;ae.uint16[he+0]=4*fe+0,ae.uint16[he+1]=4*fe+1,ae.uint16[he+2]=4*fe+2,ae.uint16[he+3]=4*fe+2,ae.uint16[he+4]=4*fe+3,ae.uint16[he+5]=4*fe+0}return ae}(z));let X=M.createIndexBuffer(Vh,!0),ne=M.createVertexBuffer(W,i.cR.members,!0);for(let ee of N){let le={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(oe=O).getCameraToCenterDistance(ee.projection),u_viewport_size:[oe.width,oe.height]};q.draw(d,A.TRIANGLES,Dt.disabled,qt.disabled,d.colorModeForRenderPass(),kt.disabled,le,a.id,ne,X,i.b1.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,O.zoom)}var oe;ne.destroy(),X.destroy()}let uu=i.a6.mat4.create();function rp(d){let t=d._camera.getWorldToCamera(d.worldSize,1),a=i.a6.mat4.multiply([],t,d.globeMatrix);i.a6.mat4.invert(a,a);let f=[0,0,0],g=[0,1,0,0];return i.a6.vec4.transformMat4(g,g,a),f[0]=g[0],f[1]=g[1],f[2]=g[2],i.a6.vec3.normalize(f,f),f}function cx({width:d,height:t,anchor:a,textOffset:f,textScale:g},v){let{horizontalAlign:b,verticalAlign:M}=i.bx(a),A=-(b-.5)*d,O=-(M-.5)*t,L=i.bw(a,f);return new i.P((A/g+L[0])*v,(O/g+L[1])*v)}function ux(d,t,a,f,g,v,b,M,A,O,L){let N=d.text.placedSymbolArray,z=d.text.dynamicLayoutVertexArray,j=d.icon.dynamicLayoutVertexArray,q={},W=d.getProjection(),Z=qs(M,W,v),X=v.elevation,ne=W.upVectorScale(M.canonical,v.center.lat,v.worldSize).metersToTile;z.clear();for(let oe=0;oe<N.length;oe++){let ee=N.get(oe),{tileAnchorX:le,tileAnchorY:ae,numGlyphs:fe}=ee,he=ee.hidden||!ee.crossTileID||d.allowVerticalPlacement&&!ee.placedOrientation?null:f[ee.crossTileID];if(he){let pe=0,we=0,ye=0;if(X){let Ue=X?X.getAtTileOffset(M,le,ae):0,[et,nt,He]=W.upVector(M.canonical,le,ae);pe=Ue*et*ne,we=Ue*nt*ne,ye=Ue*He*ne}let[ge,Me,Be,qe]=gr(ee.projectedAnchorX+pe,ee.projectedAnchorY+we,ee.projectedAnchorZ+ye,a?Z:b),ze=Tn(v.getCameraToCenterDistance(W),qe),Je=g.evaluateSizeForFeature(d.textSizeData,O,ee)*ze/i.bq;a&&(Je*=d.tilePixelRatio/A);let Se=cx(he,Je);a?({x:ge,y:Me,z:Be}=W.projectTilePoint(le+Se.x,ae+Se.y,M.canonical),[ge,Me,Be]=gr(ge+pe,Me+we,Be+ye,b)):(t&&Se._rotate(-v.angle),ge+=Se.x,Me+=Se.y,Be=0);let Ge=d.allowVerticalPlacement&&ee.placedOrientation===i.bk.vertical?Math.PI/2:0;for(let Ue=0;Ue<fe;Ue++)i.bn(z,ge,Me,Be,Ge);L&&ee.associatedIconIndex>=0&&(q[ee.associatedIconIndex]={x:ge,y:Me,z:Be,angle:Ge})}else Ho(fe,z)}if(L){j.clear();let oe=d.icon.placedSymbolArray;for(let ee=0;ee<oe.length;ee++){let le=oe.get(ee),{numGlyphs:ae}=le,fe=q[ee];if(le.hidden||!fe)Ho(ae,j);else{let{x:he,y:pe,z:we,angle:ye}=fe;for(let ge=0;ge<ae;ge++)i.bn(j,he,pe,we,ye)}}d.icon.dynamicLayoutVertexBuffer.updateData(j)}d.text.dynamicLayoutVertexBuffer.updateData(z)}function hu(d,t,a,f,g,v,b={}){let M=a.paint.get("icon-translate"),A=a.paint.get("text-translate"),O=a.paint.get("icon-translate-anchor"),L=a.paint.get("text-translate-anchor"),N=a.layout.get("icon-rotation-alignment"),z=a.layout.get("text-rotation-alignment"),j=a.layout.get("icon-pitch-alignment"),q=a.layout.get("text-pitch-alignment"),W=a.layout.get("icon-keep-upright"),Z=a.layout.get("text-keep-upright"),X=a.paint.get("icon-color-saturation"),ne=a.paint.get("icon-color-contrast"),oe=a.paint.get("icon-color-brightness-min"),ee=a.paint.get("icon-color-brightness-max"),le=a.paint.get("symbol-elevation-reference")==="sea",ae=a.paint.get("text-occlusion-opacity").constantOr(0),fe=d.context,he=fe.gl,pe=d.transform,we=N==="map",ye=z==="map",ge=j==="map",Me=q==="map",Be=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,qe=!1,ze=d.depthModeForSublayer(0,Dt.ReadOnly),Je=[i.am(pe.center.lng),i.at(pe.center.lat)],Se=a.layout.get("text-variable-anchor"),Ge=pe.projection.name==="globe",Ue=[],et=[0,-1,0];for(let nt of f){let He=t.getTile(nt),Ye=He.getBucket(a);if(!Ye||Ye.projection.name==="mercator"&&Ge||Ye.fullyClipped)continue;let Et=Ye.projection.name==="globe",rt=Et?i.a9(pe.zoom):0,ft=qs(nt,Ye.getProjection(),pe),Ot=pe.calculatePixelsToTileUnitsMatrix(He),_t=Se&&Ye.hasTextData(),Mt=Ye.hasIconTextFit()&&_t&&Ye.hasIconData(),ln=Ye.getProjection().createInversionMatrix(pe,nt.canonical),rn=$n=>{pe.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||d.terrain)&&($n.push("DEPTH_D24"),$n.push("DEPTH_OCCLUSION"))},jn=()=>{let $n=we&&a.layout.get("symbol-placement")!=="point",on=[];rn(on);let Mn=$n||Mt,kn=a.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&ge&&on.push("PITCH_WITH_MAP_TERRAIN"),Et&&(on.push("PROJECTION_GLOBE_VIEW"),Mn&&on.push("PROJECTED_POS_ON_VIEWPORT")),kn>0&&on.push("ICON_TRANSITION"),Ye.icon.zOffsetVertexBuffer&&on.push("Z_OFFSET"),X===0&&ne===0&&oe===0&&ee===1||on.push("COLOR_ADJUSTMENT"),Ye.sdfIcons&&on.push("RENDER_SDF");let bi=Ye.icon.programConfigurations.get(a.id),Si=d.getOrCreateProgram("symbol",{config:bi,defines:on}),wn=He.imageAtlasTexture?He.imageAtlasTexture.size:[0,0],$i=Ye.iconSizeData,Zi=i.bj($i,pe.zoom),Gi=ge||pe.pitch!==0,ti=vn(ft,He.tileID.canonical,ge,we,pe,Ye.getProjection(),Ot),Ar=zr(ft,He.tileID.canonical,ge,we,pe,Ye.getProjection(),Ot),Pr=d.translatePosMatrix(Ar,He,M,O,!0),fo=d.translatePosMatrix(ft,He,M,O),eo=Mn?uu:ti,jr=we&&!ge&&!$n,po=et;!Ge&&!pe.mercatorFromTransition||we||(po=rp(pe));let bs=Et?po:et,ra=a.getColorAdjustmentMatrix(X,ne,oe,ee),Yo=np($i.kind,Zi,jr,ge,d,fo,eo,Pr,le,!1,wn,[0,0],!0,nt,rt,Je,ln,bs,Ye.getProjection(),ra,kn),Kl=He.imageAtlasTexture?He.imageAtlasTexture:null,Jl=a.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear,rd=Ye.sdfIcons||d.options.rotating||d.options.zooming||Jl||Gi?he.LINEAR:he.NEAREST,Ql=Ye.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,ni=d.terrain&&ge&&$n?i.a6.mat4.invert(i.a6.mat4.create(),ti):uu;if($n&&Ye.icon){let $a=pe.elevation,Ix=$a?$a.getAtTileOffsetFunc(nt,pe.center.lat,pe.worldSize,Ye.getProjection()):null,__=xn(ft,He.tileID.canonical,ge,we,pe,Ye.getProjection(),Ot);wl(Ye,ft,d,!1,__,Ar,ge,W,Ix,nt)}return{program:Si,buffers:Ye.icon,uniformValues:Yo,atlasTexture:Kl,atlasTextureIcon:null,atlasInterpolation:rd,atlasInterpolationIcon:null,isSDF:Ye.sdfIcons,hasHalo:Ql,tile:He,labelPlaneMatrixInv:ni}},Yn=()=>{let $n=ye&&a.layout.get("symbol-placement")!=="point",on=[],Mn=$n||Se||Mt;d.terrainRenderModeElevated()&&Me&&on.push("PITCH_WITH_MAP_TERRAIN"),Et&&(on.push("PROJECTION_GLOBE_VIEW"),Mn&&on.push("PROJECTED_POS_ON_VIEWPORT")),Ye.text.zOffsetVertexBuffer&&on.push("Z_OFFSET"),Ye.iconsInText&&on.push("RENDER_TEXT_AND_SYMBOL"),on.push("RENDER_SDF"),rn(on);let kn=Ye.text.programConfigurations.get(a.id),bi=d.getOrCreateProgram("symbol",{config:kn,defines:on}),Si,wn=[0,0],$i=null,Zi=Ye.textSizeData;Ye.iconsInText&&(wn=He.imageAtlasTexture?He.imageAtlasTexture.size:[0,0],$i=He.imageAtlasTexture?He.imageAtlasTexture:null,Si=Me||pe.pitch!==0||d.options.rotating||d.options.zooming||Zi.kind==="composite"||Zi.kind==="camera"?he.LINEAR:he.NEAREST);let Gi=He.glyphAtlasTexture?He.glyphAtlasTexture.size:[0,0],ti=i.bj(Zi,pe.zoom),Ar=vn(ft,He.tileID.canonical,Me,ye,pe,Ye.getProjection(),Ot),Pr=zr(ft,He.tileID.canonical,Me,ye,pe,Ye.getProjection(),Ot),fo=d.translatePosMatrix(Pr,He,A,L,!0),eo=d.translatePosMatrix(ft,He,A,L),jr=Mn?uu:Ar,po=ye&&!Me&&!$n,bs=et;!Ge&&!pe.mercatorFromTransition||ye||(bs=rp(pe));let ra=np(Zi.kind,ti,po,Me,d,eo,jr,fo,le,!0,Gi,wn,!0,nt,rt,Je,ln,Et?bs:et,Ye.getProjection(),ae),Yo=He.glyphAtlasTexture?He.glyphAtlasTexture:null,Kl=he.LINEAR,Jl=a.paint.get("text-halo-width").constantOr(1)!==0,rd=d.terrain&&Me&&$n?i.a6.mat4.invert(i.a6.mat4.create(),Ar):uu;if($n&&Ye.text){let Ql=pe.elevation,ni=Ql?Ql.getAtTileOffsetFunc(nt,pe.center.lat,pe.worldSize,Ye.getProjection()):null,$a=xn(ft,He.tileID.canonical,Me,ye,pe,Ye.getProjection(),Ot);wl(Ye,ft,d,!0,$a,Pr,Me,Z,ni,nt)}return{program:bi,buffers:Ye.text,uniformValues:ra,atlasTexture:Yo,atlasTextureIcon:$i,atlasInterpolation:Kl,atlasInterpolationIcon:Si,isSDF:!0,hasHalo:Jl,tile:He,labelPlaneMatrixInv:rd}},oi=Ye.icon.segments.get().length,ho=Ye.text.segments.get().length,Mi=oi&&!b.onlyText?jn():null,gn=ho&&!b.onlyIcons?Yn():null,qn=a.paint.get("icon-opacity").constantOr(1),hi=a.paint.get("text-opacity").constantOr(1);if(Be&&Ye.canOverlap){qe=!0;let $n=qn&&!b.onlyText?Ye.icon.segments.get():[],on=hi&&!b.onlyIcons?Ye.text.segments.get():[];for(let Mn of $n)Ue.push({segments:new i.b1([Mn]),sortKey:Mn.sortKey,state:Mi});for(let Mn of on)Ue.push({segments:new i.b1([Mn]),sortKey:Mn.sortKey,state:gn})}else b.onlyText||Ue.push({segments:qn?Ye.icon.segments:new i.b1([]),sortKey:0,state:Mi}),b.onlyIcons||Ue.push({segments:hi?Ye.text.segments:new i.b1([]),sortKey:0,state:gn})}qe&&Ue.sort((nt,He)=>nt.sortKey-He.sortKey);for(let nt of Ue){let He=nt.state;if(He)if(d.terrain?d.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:He.labelPlaneMatrixInv}):d.setupDepthForOcclusion(pe.depthOcclusionForSymbolsAndCircles,He.program),fe.activeTexture.set(he.TEXTURE0),He.atlasTexture&&He.atlasTexture.bind(He.atlasInterpolation,he.CLAMP_TO_EDGE,!0),He.atlasTextureIcon&&(fe.activeTexture.set(he.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,he.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,He.program),He.hasHalo){let Ye=He.uniformValues;Ye.u_is_halo=1,du(He.buffers,nt.segments,a,d,He.program,ze,g,v,Ye,2),Ye.u_is_halo=0}else{if(He.isSDF){let Ye=He.uniformValues;He.hasHalo&&(Ye.u_is_halo=1,du(He.buffers,nt.segments,a,d,He.program,ze,g,v,Ye,1)),Ye.u_is_halo=0}du(He.buffers,nt.segments,a,d,He.program,ze,g,v,He.uniformValues,1)}}}function du(d,t,a,f,g,v,b,M,A,O){let L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];g.draw(f,f.context.gl.TRIANGLES,v,b,M,kt.disabled,A,a.id,d.layoutVertexBuffer,d.indexBuffer,t,a.paint,f.transform.zoom,d.programConfigurations.get(a.id),L,O)}function Uh(d,t,a,f,g,v,b){let M=d.context.gl,A=a.paint.get("fill-pattern"),O=a.is3D(),L=O?d.stencilModeFor3D():qt.disabled,N=A&&A.constantOr(1),z,j,q,W,Z;b?(j=N&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=M.LINES):(j=N?"fillPattern":"fill",z=M.TRIANGLES);for(let X of f){let ne=t.getTile(X);if(N&&!ne.patternsLoaded())continue;let oe=ne.getBucket(a);if(!oe)continue;d.prepareDrawTile();let ee=oe.programConfigurations.get(a.id),le=d.isTileAffectedByFog(X),ae=d.getOrCreateProgram(j,{config:ee,overrideFog:le});N&&(d.context.activeTexture.set(M.TEXTURE0),ne.imageAtlasTexture&&ne.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ee.updatePaintBuffers());let fe=A.constantOr(null);if(fe&&ne.imageAtlas){let we=ne.imageAtlas.patternPositions[fe.toString()];we&&ee.setConstantPatternPositions(we)}let he=d.translatePosMatrix(X.projMatrix,ne,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),pe=a.paint.get("fill-emissive-strength");if(b){W=oe.indexBuffer2,Z=oe.segments2;let we=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];q=j==="fillOutlinePattern"&&N?lu(he,pe,d,ne,we):Wg(he,pe,we)}else W=oe.indexBuffer,Z=oe.segments,q=N?qg(he,pe,d,ne):Oh(he,pe);d.uploadCommonUniforms(d.context,ae,X.toUnwrapped()),ae.draw(d,z,g,O?L:d.stencilModeForClipping(X),v,kt.disabled,q,a.id,oe.layoutVertexBuffer,W,Z,a.paint,d.transform.zoom,ee,void 0)}}function jl(d,t,a,f,g,v,b,M){a.resetLayerRenderingStats(d);let A=d.context,O=A.gl,L=d.transform,N=a.paint.get("fill-extrusion-pattern"),z=N.constantOr(1),j=a.paint.get("fill-extrusion-opacity"),q=d.style.enable3dLights(),W=a.paint.get(q&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],X=a.layout.get("fill-extrusion-edge-radius"),ne=X>0&&!a.paint.get("fill-extrusion-rounded-roof"),oe=ne?0:X,ee=L.projection.name==="globe"?i.c_():0,le=L.projection.name==="globe",ae=le?i.a9(L.zoom):0,fe=[i.am(L.center.lng),i.at(L.center.lat)],he=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),pe=a.paint.get("fill-extrusion-flood-light-intensity"),we=a.paint.get("fill-extrusion-vertical-scale"),ye=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ge=ms(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Me=[],Be;le&&Me.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&Me.push("FAUX_AO"),ne&&Me.push("ZERO_ROOF_RADIUS"),M&&Me.push("HAS_CENTROID"),pe>0&&Me.push("FLOOD_LIGHT"),ge.shouldRenderCutoff&&Me.push("RENDER_CUTOFF"),ye&&Me.push("RENDER_WALL_MODE");let qe=d.renderPass==="shadow",ze=d.shadowRenderer,Je=qe&&!!ze;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let Se=[0,0,0];if(ze){let et=d.style.directionalLight,nt=d.style.ambientLight;et&&nt&&(Se=yh(d.style,et,nt)),Be=Me.concat(["SHADOWS_SINGLE_CASCADE"])}let Ge=Je?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Ue=a.getLayerRenderingStats();for(let et of f){let nt=t.getTile(et),He=nt.getBucket(a);if(!He||He.projection.name!==L.projection.name)continue;let Ye=!1;ze&&(Ye=ze.getMaxCascadeForTile(et.toUnwrapped())===0);let Et=d.isTileAffectedByFog(et),rt=He.programConfigurations.get(a.id),ft=d.getOrCreateProgram(Ge,{config:rt,defines:Ye?Be:Me,overrideFog:Et});if(d.terrain&&d.terrain.setupElevationDraw(nt,ft,{useMeterToDem:!0}),!He.centroidVertexBuffer){let Yn=ft.attributes.a_centroid_pos;Yn!==void 0&&O.vertexAttrib2f(Yn,0,0)}!qe&&ze&&ze.setupShadows(nt.tileID.toUnwrapped(),ft,"vector-tile",nt.tileID.overscaledZ),z&&(d.context.activeTexture.set(O.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),rt.updatePaintBuffers());let Ot=N.constantOr(null);if(Ot&&nt.imageAtlas){let Yn=nt.imageAtlas.patternPositions[Ot.toString()];Yn&&rt.setConstantPatternPositions(Yn)}let _t=a.paint.get("fill-extrusion-vertical-gradient"),Mt=1/He.tileToMeter,ln;if(qe&&ze){if(ap(nt.tileID,He,d))continue;let Yn=ze.calculateShadowPassMatrixFromTile(nt.tileID.toUnwrapped());ln=Hg(Yn,oe,Mt,we)}else{let Yn=d.translatePosMatrix(et.expandedProjMatrix,nt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),oi=L.projection.createInversionMatrix(L,et.canonical);ln=z?ep(Yn,d,_t,j,Z,oe,Mt,et,nt,ee,ae,fe,oi,he,we):Qf(Yn,d,_t,j,Z,oe,Mt,et,ee,ae,fe,oi,he,we,pe,Se)}d.uploadCommonUniforms(A,ft,et.toUnwrapped(),null,ge);let rn=He.segments;if(L.projection.name==="mercator"&&!qe&&(rn=He.getVisibleSegments(nt.tileID,d.terrain,d.transform.getFrustum(0)),!rn.get().length))continue;if(Ue)if(qe)for(let Yn of rn.get())Ue.numRenderedVerticesInShadowPass+=Yn.primitiveLength;else for(let Yn of rn.get())Ue.numRenderedVerticesInTransparentPass+=Yn.primitiveLength;let jn=[];(d.terrain||M)&&jn.push(He.centroidVertexBuffer),le&&jn.push(He.layoutVertexExtBuffer),ye&&jn.push(He.wallVertexBuffer),ft.draw(d,A.gl.TRIANGLES,g,v,b,kt.backCCW,ln,a.id,He.layoutVertexBuffer,He.indexBuffer,rn,a.paint,d.transform.zoom,rt,jn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function Ji(d,t,a,f,g,v,b,M,A,O,L,N,z,j,q,W,Z,X,ne){let oe=d.context,ee=oe.gl,le=d.transform,ae=d.transform.zoom,fe=[],he=ms(d,a.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(fe.push("CLEAR_SUBPASS"),ne&&(fe.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ee.TEXTURE0),ne.bind(ee.LINEAR,ee.CLAMP_TO_EDGE))):O==="sdf"&&fe.push("SDF_SUBPASS"),Z&&fe.push("HAS_CENTROID"),he.shouldRenderCutoff&&fe.push("RENDER_CUTOFF");let pe=a.layout.get("fill-extrusion-edge-radius"),we=(ye,ge,Me,Be,qe)=>{let ze=ge.programConfigurations.get(a.id),Je=d.isTileAffectedByFog(ye),Se=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:ze,defines:fe,overrideFog:Je}),Ge=((et,nt,He,Ye,Et,rt,ft,Ot,_t,Mt,ln)=>({u_matrix:nt,u_opacity:He,u_ao_pass:Ye?1:0,u_meter_to_tile:Et,u_ao:rt,u_flood_light_intensity:ft,u_flood_light_color:Ot,u_attenuation:_t,u_edge_radius:Mt,u_fb:0,u_fb_size:ln,u_dynamic_offset:1}))(0,Be,L,A,qe,[N,z*qe],j,q,W,ae>=17?0:pe*qe,ne?ne.size[0]:0),Ue=[];Z&&Ue.push(ge.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(oe,Se,ye.toUnwrapped(),null,he),Se.draw(d,oe.gl.TRIANGLES,g,v,b,M,Ge,a.id,ge.vertexBuffer,ge.indexBuffer,Me,a.paint,ae,ze,Ue)};for(let ye of f){let ge=t.getTile(ye),Me=ge.getBucket(a);if(!Me||Me.projection.name!==le.projection.name||!Me.groundEffect||Me.groundEffect&&!Me.groundEffect.hasData())continue;let Be=Me.groundEffect,qe=1/Me.tileToMeter;{let ze=d.translatePosMatrix(ye.projMatrix,ge,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Je=Be.getDefaultSegment();we(ye,Be,Je,ze,qe)}if(X)for(let ze=0;ze<4;ze++){let Je=i.c$[ze](ye),Se=t.getTile(Je);if(!Se)continue;let Ge=Se.getBucket(a);if(!Ge||Ge.projection.name!==le.projection.name||!Ge.groundEffect||Ge.groundEffect&&!Ge.groundEffect.hasData())continue;let Ue=Ge.groundEffect,et,nt;ze===0?(et=[-i.ab,0,0],nt=1):ze===1?(et=[i.ab,0,0],nt=0):ze===2?(et=[0,-i.ab,0],nt=3):(et=[0,i.ab,0],nt=2);let He=Ue.regionSegments[nt];if(!He)continue;let Ye=new Float32Array(16);i.a6.mat4.translate(Ye,ye.projMatrix,et),we(ye,Ue,He,d.translatePosMatrix(Ye,ge,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qe)}}}function Js(d,t,a,f,g,v,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let M=v?v.findDEMTileFor(a):null;if(!(M&&M.dem||b))return;let A=X=>new i.P(Math.ceil((X+i.d2)*i.d3),0),O=X=>{let ne=t.getSource().minzoom,oe=le=>{let ae=t.getTileByID(le);if(ae&&ae.hasData())return ae.getBucket(g)},ee=[0,-1,1];for(let le of ee){if(X.overscaledZ+le<ne)continue;let ae=oe(X.calculateScaledKey(X.overscaledZ+le));if(ae)return ae}},L=[0,0,0],N=(X,ne)=>(L[0]=Math.min(X.min.y,ne.min.y),L[1]=Math.max(X.max.y,ne.max.y),L[2]=i.ab-ne.min.x>X.max.x?ne.min.x-i.ab:X.max.x,L),z=(X,ne)=>(L[0]=Math.min(X.min.x,ne.min.x),L[1]=Math.max(X.max.x,ne.max.x),L[2]=i.ab-ne.min.y>X.max.y?ne.min.y-i.ab:X.max.y,L),j=[(X,ne)=>N(X,ne),(X,ne)=>N(ne,X),(X,ne)=>z(X,ne),(X,ne)=>z(ne,X)],q=(X,ne,oe,ee,le,ae,fe)=>{if(!v)return 0;let he=[[ae?oe:X,ae?X:oe,0],[ae?oe:ne,ae?ne:oe,0]],pe=fe<0?i.ab+fe:fe,we=[ae?pe:(X+ne)/2,ae?(X+ne)/2:pe,0];return oe===0&&fe<0||oe!==0&&fe>0?v.getForTilePoints(le,[we],!0,ee):he.push(we),v.getForTilePoints(a,he,!0,M),Math.max(he[0][2],he[1][2],we[2])/v.exaggeration()};for(let X=0;X<4;X++){let ne=f.borderFeatureIndices[X];if(ne.length===0)continue;let oe=i.c$[X](a),ee=O(oe);if(!(ee&&ee instanceof i.d0)||f.borderDoneWithNeighborZ[X]===ee.canonical.z)continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();let le=v?v.findDEMTileFor(oe):null;if(!(le&&le.dem||b))continue;let ae=(X<2?1:5)-X,fe=ee.borderDoneWithNeighborZ[ae]!==f.canonical.z,he=ee.borderFeatureIndices[ae],pe=0;if(f.canonical.z!==ee.canonical.z){for(let we of ne)f.showCentroid(f.featuresOnBorder[we]);if(fe)for(let we of he)ee.showCentroid(ee.featuresOnBorder[we]);f.borderDoneWithNeighborZ[X]=ee.canonical.z,ee.borderDoneWithNeighborZ[ae]=f.canonical.z}for(let we of ne){let ye=f.featuresOnBorder[we],ge=f.centroidData[ye.centroidDataIndex],Me=ye.borders[X],Be;for(;pe<he.length;){Be=ee.featuresOnBorder[he[pe]];let qe=Be.borders[ae];if(qe[1]>Me[0]+3||qe[0]>Me[0]-3)break;ee.showCentroid(Be),pe++}if(Be&&pe<he.length){let qe=pe,ze=0;for(;!(Be.borders[ae][0]>Me[1]-3)&&(ze++,++pe!==he.length);)Be=ee.featuresOnBorder[he[pe]];Be=ee.featuresOnBorder[he[qe]];let Je=!1;if(ze>=1){let Ue=Be.borders[ae];Math.abs(Me[0]-Ue[0])<3&&Math.abs(Me[1]-Ue[1])<3&&(ze=1,Je=!0,pe=qe+1)}else if(ze===0){f.showCentroid(ye);continue}let Se=ee.centroidData[Be.centroidDataIndex];b&&Je&&(((W=ge).flags|(Z=Se).flags)&i.d1?(W.flags|=i.d1,Z.flags|=i.d1):(W.flags&=~i.d1,Z.flags&=~i.d1));let Ge=ye.intersectsCount()>1||Be.intersectsCount()>1;if(ze>1)pe=qe,ge.centroidXY=Se.centroidXY=new i.P(0,0);else if(le&&le.dem&&!Ge){let Ue=j[X](ge,Se),et=X%2?i.ab-1:0,nt=q(Ue[0],Math.min(i.ab-1,Ue[1]),et,le,oe,X<2,Ue[2]);ge.centroidXY=Se.centroidXY=A(nt)}else Ge?ge.centroidXY=Se.centroidXY=new i.P(0,0):(ge.centroidXY=f.encodeBorderCentroid(ye),Se.centroidXY=ee.encodeBorderCentroid(Be));f.writeCentroidToBuffer(ge),ee.writeCentroidToBuffer(Se)}else f.showCentroid(ye)}f.borderDoneWithNeighborZ[X]=ee.canonical.z,ee.borderDoneWithNeighborZ[ae]=f.canonical.z}var W,Z;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}let Qg=[1,0,0],op=[0,1,0],sp=[0,0,1];function ap(d,t,a){let f=a.transform,g=a.shadowRenderer;if(!g)return!0;let v=d.toUnwrapped(),b=f.tileSize*g._cascades[a.currentShadowCascade].scale,M=t.maxHeight;if(f.elevation){let W=f.elevation.getMinMaxForTile(d);W&&(M+=W.max)}let A=[...g.shadowDirection];A[2]=-A[2];let O=g.computeSimplifiedTileShadowVolume(v,M,b,A);if(!O)return!1;let L=[Qg,op,sp,A,[A[0],0,A[2]],[0,A[1],A[2]]],N=f.projection.name==="globe",z=f.scaleZoom(b),j=i.bN.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,z,!N),q=g.getCurrentCascadeFrustum();return j.intersectsPrecise(O.vertices,O.planes,L)===0||q.intersectsPrecise(O.vertices,O.planes,L)===0}function lp(d){return[d[0]*i.d4,d[1]*i.d4,d[2]*i.d4,0]}function Vr(d,t,a,f,g,v,b,M,A){let O=f.getSource(),L=a.globeSharedBuffers;if(!L)return;let N,z,j;if(t&&(N=f.getTile(t)),O instanceof i.aD?(z=O.texture,j=i.cD(0,0,a.transform)):N&&t&&(z=N.texture,j=i.cD(t.canonical.z,t.canonical.x,a.transform)),!z||!j)return;d||(j=i.a6.mat4.scale(i.a6.mat4.create(),j,[1,-1,1]));let q=a.context,W=q.gl,Z=g.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,X=a.colorModeForDrapableLayerRenderPass(v),ne=b.defines;ne.push("GLOBE_POLES");let oe=new Dt(W.LEQUAL,Dt.ReadWrite,a.depthRangeFor3D),ee=Float32Array.from(a.transform.expandedFarZProjMatrix),le=Float32Array.from(i.b5(i.cC(new i.bP(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),q.activeTexture.set(W.TEXTURE0),z.bind(Z,W.CLAMP_TO_EDGE),q.activeTexture.set(W.TEXTURE1),z.bind(Z,W.CLAMP_TO_EDGE),z.useMipmap&&q.extTextureFilterAnisotropic&&a.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);let[ae,fe,he,pe]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),we=g.paint.get("raster-elevation"),ye;d?(ye=ae,a.renderDefaultNorthPole=we!==0):(ye=fe,a.renderDefaultSouthPole=we!==0);let ge=lp(b.mix),Me=((qe,ze,Je,Se,Ge,Ue,et,nt,He,Ye,Et,rt,ft)=>cu(qe,ze,Je,new Float32Array(16),new Float32Array(9),[0,0],Se,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],nt,2,Ye,Et,rt,1,0,ft))(ee,le,j,i.a9(a.transform.zoom),0,g,0,we,0,ge,b.offset,b.range,v),Be=a.getOrCreateProgram("raster",{defines:ne});a.uploadCommonUniforms(q,Be,null),Be.draw(a,W.TRIANGLES,oe,A,X,M,Me,g.id,ye,he,pe)}function vi(d){let t=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-t,g=.2*d.height,v=t+g;return[t,a,(v-g-t)/f,(v-t)/f]}function $h(d,t,a,f){if(d)return t instanceof gl&&d instanceof ah?t.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:lp(f.mix),offset:f.offset,buffer:0,tileSize:1}}var cp=i.d5([{name:"a_index",type:"Int16",components:1}]);class e_{constructor(t,a,f,g){let v={width:f[0],height:f[1],data:null},b=t.gl;this.targetColorTexture=new i.T(t,v,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,v,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,g=a.width*a.height;this.particleTexture0=new i.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1});let v=new i.d6;v.reserve(g);for(let b=0;b<g;b++)v.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(v,cp.members,!0),this.particleSegment=i.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function t_(d,t,a){if(!d)return null;let f=t.getTextureDescriptor(d,a,!0);if(!f)return null;let{texture:g,mix:v,offset:b,tileSize:M,buffer:A,format:O}=f;if(!g||!O)return null;let L=!1;return O==="uint32"&&(L=!0,v[3]=0,v=Lh(i.d7,v,[0,a.paint.get("raster-particle-max-speed")]),b=Fh(i.d7,b,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[A/(M+2*A),M/(M+2*A)],tileSize:M,scalarData:L,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function n_(d){let t=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-t,g=.2*d.height,v=t+g;return[t,a,(v-g-t)/f,(v-t)/f]}let hx=new i.bz(1,0,0,1),Ul=new i.bz(0,1,0,1),$l=new i.bz(0,0,1,1),it=new i.bz(1,0,1,1),Tt=new i.bz(0,1,1,1);function Ao(d,t,a,f,g,v,b){let M=d.context,A=d.transform,O=M.gl,L=A.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[],z=i.a6.mat4.clone(a.projMatrix);if(L&&i.a9(A.zoom)>0){let ge=i.b4(a.canonical,A),Me=i.d8(ge);z=i.a6.mat4.multiply(new Float32Array(16),A.globeMatrix,Me),i.a6.mat4.multiply(z,A.projMatrix,z)}let j=i.a6.mat4.create();j[12]+=2*g/(i.q.devicePixelRatio*A.width),j[13]+=2*v/(i.q.devicePixelRatio*A.height),i.a6.mat4.multiply(z,j,z);let q=d.getOrCreateProgram("debug",{defines:N}),W=t.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(W,q);let Z=Dt.disabled,X=qt.disabled,ne=d.colorModeForRenderPass(),oe="$debug";M.activeTexture.set(O.TEXTURE0),d.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),L?W._makeGlobeTileDebugBuffers(d.context,A):W._makeDebugTileBoundsBuffers(d.context,A.projection);let ee=W._tileDebugBuffer||d.debugBuffer,le=W._tileDebugIndexBuffer||d.debugIndexBuffer,ae=W._tileDebugSegments||d.debugSegments;if(q.draw(d,O.LINE_STRIP,Z,X,ne,kt.disabled,Zg(z,f),oe,ee,le,ae,null,null,null,[W._globeTileDebugBorderBuffer]),b){let ge=W.latestRawTileData,Me=Math.floor((ge&&ge.byteLength||0)/1024),Be=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Be+=` => ${a.overscaledZ}`),Be+=` ${W.state}`,Be+=` ${Me}kb`,function(qe,ze){qe.initDebugOverlayCanvas();let Je=qe.debugOverlayCanvas,Se=qe.context.gl,Ge=qe.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Je.width,Je.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(ze,5,5),Ge.strokeText(ze,5,5),qe.debugOverlayTexture.update(Je),qe.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(d,Be)}let fe=t.getTile(a).tileSize,he=512/Math.min(fe,512)*(a.overscaledZ/A.zoom)*.5,pe=W._tileDebugTextBuffer||d.debugBuffer,we=W._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ye=W._tileDebugTextSegments||d.debugSegments;q.draw(d,O.TRIANGLES,Z,X,mn.alphaBlended,kt.disabled,Zg(z,i.bz.transparent,he),oe,pe,we,ye,null,null,null,[W._globeTileDebugTextBuffer])}function ui(d,t,a,f){fu(d,0,t+a/2,d.transform.width,a,f)}function Re(d,t,a,f){fu(d,t-a/2,0,a,d.transform.height,f)}function fu(d,t,a,f,g,v){let b=d.context,M=b.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*i.q.devicePixelRatio,a*i.q.devicePixelRatio,f*i.q.devicePixelRatio,g*i.q.devicePixelRatio),b.clear({color:v}),M.disable(M.SCISSOR_TEST)}let Gh=i.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:up}=Gh;function Po(d,t,a,f){d.emplaceBack(t,a,f)}class hp{constructor(t){this.vertexArray=new i.d9,this.indices=new i.aO,Po(this.vertexArray,-1,-1,1),Po(this.vertexArray,1,-1,1),Po(this.vertexArray,-1,1,1),Po(this.vertexArray,1,1,1),Po(this.vertexArray,-1,-1,-1),Po(this.vertexArray,1,-1,-1),Po(this.vertexArray,-1,1,-1),Po(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,up),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.b1.simpleSegment(0,0,36,12)}}function za(d,t,a,f,g,v){let b=d.context.gl,M=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),L=((N,z,j,q,W)=>({u_matrix_3f:N,u_sun_direction:z,u_sun_intensity:j,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(i.a6.mat3.fromMat4(i.a6.mat3.create(),f),g,O,M,A);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),a.draw(d,b.TRIANGLES,Dt.disabled,qt.disabled,mn.unblended,kt.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let Gl=i.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dx{constructor(t){let a=new i.da;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let f=new i.aO;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,Gl.members),this.indexBuffer=t.createIndexBuffer(f),this.segments=i.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let fx=i.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class i_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Hh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new mn([1,Xr,1,Xr],i.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new mn([1,0,1,0],i.bz.transparent,[!1,!1,!1,!0]),this.params=new i_,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){let a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dx(a);let f=this.params.sizeRange,g=this.params.intensityRange,v=function(L){let N=i.dd(30),z=[];for(let j=0;j<L;++j){let q=2*Math.PI*N(),W=Math.acos(1-2*N())-.5*Math.PI;z.push(i.a6.vec3.fromValues(Math.cos(W)*Math.cos(q),Math.cos(W)*Math.sin(q),Math.sin(W)))}return z}(this.params.starsCount),b=i.dd(300),M=new i.db,A=new i.aO,O=0;for(let L=0;L<v.length;++L){let N=i.a6.vec3.scale([],v[L],200),z=Math.max(0,1+.01*f*(1*b()-.5)),j=Math.max(0,1+.01*g*(1*b()-.5));M.emplaceBack(N[0],N[1],N[2],-1,-1,z,j),M.emplaceBack(N[0],N[1],N[2],1,-1,z,j),M.emplaceBack(N[0],N[1],N[2],1,1,z,j),M.emplaceBack(N[0],N[1],N[2],-1,1,z,j),A.emplaceBack(O+0,O+1,O+2),A.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=a.createVertexBuffer(M,fx.members),this.starsIdx=a.createIndexBuffer(A),this.starsSegments=i.b1.simpleSegment(0,0,M.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){let f=t.context,g=f.gl,v=t.transform,b=new Dt(g.LEQUAL,Dt.ReadOnly,[0,1]),M=i.a9(v.zoom),A=t.style.getLut(a.scope),O=a.properties.get("color").toRenderColor(A).toArray01(),L=a.properties.get("high-color").toRenderColor(A).toArray01(),N=a.properties.get("space-color").toRenderColor(A).toArray01PremultipliedAlpha(),z=5e-4,j=i.dc(a.properties.get("horizon-blend"),0,1,z,.25),q=i.cx(t,f,v)&&j===z?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,W=t.frameCounter/1e3%1,Z=i.a6.vec3.length(v.globeCenterInViewSpace),X=Math.sqrt(Math.pow(Z,2)-Math.pow(q,2)),ne=Math.acos(X/Z),oe=ee=>{let le=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ee&&le.push("ALPHA_PASS");let ae=t.getOrCreateProgram("globeAtmosphere",{defines:le}),fe=((pe,we,ye,ge,Me,Be,qe,ze,Je,Se,Ge,Ue)=>({u_frustum_tl:pe,u_frustum_tr:we,u_frustum_br:ye,u_frustum_bl:ge,u_horizon:Me,u_transition:Be,u_fadeout_range:qe,u_color:ze,u_high_color:Je,u_space_color:Se,u_temporal_offset:Ge,u_horizon_angle:Ue}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,M,j,O,L,N,W,ne);t.uploadCommonUniforms(f,ae);let he=this.atmosphereBuffer;he&&ae.draw(t,g.TRIANGLES,b,qt.disabled,ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,kt.backCW,fe,ee?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};oe(!1),oe(!0)}drawStars(t,a){let f=i.ap(a.properties.get("star-intensity"),0,1);if(f===0)return;let g=t.context,v=g.gl,b=t.transform,M=t.getOrCreateProgram("stars"),A=i.a6.quat.identity([]);i.a6.quat.rotateX(A,A,-b._pitch),i.a6.quat.rotateZ(A,A,-b.angle),i.a6.quat.rotateX(A,A,i.bB(b._center.lat)),i.a6.quat.rotateY(A,A,-i.bB(b._center.lng));let O=i.a6.mat4.fromQuat(new Float32Array(16),A),L=i.a6.mat4.multiply([],b.starsProjMatrix,O),N=i.a6.mat3.fromMat4([],O),z=i.a6.mat3.invert([],N),j=[0,1,0];i.a6.vec3.transformMat3(j,j,z),i.a6.vec3.scale(j,j,this.params.sizeMultiplier);let q=[1,0,0];i.a6.vec3.transformMat3(q,q,z),i.a6.vec3.scale(q,q,this.params.sizeMultiplier);let W=(Z=j,X=q,ne=f,{u_matrix:Float32Array.from(L),u_up:Z,u_right:X,u_intensity_multiplier:ne});var Z,X,ne;t.uploadCommonUniforms(g,M),this.starsVx&&this.starsIdx&&M.draw(t,v.TRIANGLES,Dt.disabled,qt.disabled,this.colorModeAlphaBlendedWriteRGB,kt.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function qh(d,t){let a=[...d],f=t.cameraWorldSizeForFog/t.worldSize,g=i.a6.mat4.identity([]);return i.a6.mat4.scale(g,g,[f,f,1]),i.a6.mat4.multiply(a,g,a),i.a6.mat4.multiply(a,t.worldToFogMatrix,a),a}function Wh(d,t,a,f,g){let v=a.material,b=f.context,{baseColorTexture:M,metallicRoughnessTexture:A}=v.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:L,emissionTexture:N}=v;function z(j,q,W){if(j&&(d.push(q),b.activeTexture.set(b.gl.TEXTURE0+W),j.gfxTexture)){let{minFilter:Z,magFilter:X,wrapS:ne,wrapT:oe}=j.sampler;j.gfxTexture.bindExtraParam(Z,X,ne,oe)}}z(M,"HAS_TEXTURE_u_baseColorTexture",cr.BaseColor),z(A,"HAS_TEXTURE_u_metallicRoughnessTexture",cr.MetallicRoughness),z(O,"HAS_TEXTURE_u_normalTexture",cr.Normal),z(L,"HAS_TEXTURE_u_occlusionTexture",cr.Occlusion),z(N,"HAS_TEXTURE_u_emissionTexture",cr.Emission),g&&(g.texture||(g.texture=new i.df(f.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+cr.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function pu(d,t,a,f,g,v){let b=a.paint.get("model-opacity"),M=t.context,A=new Dt(t.context.gl.LEQUAL,Dt.ReadWrite,t.depthRangeFor3D),O=t.transform,L=d.mesh,N=L.material,z=N.pbrMetallicRoughness,j=t.style.fog,q;q=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:i.a6.mat4.multiply([],f.zScaleMatrix,d.nodeModelMatrix),i.a6.mat4.multiply(q,f.negCameraPosMatrix,q);let W=i.a6.mat4.invert([],q);i.a6.mat4.transpose(W,W);let Z=a.paint.get("model-emissive-strength").constantOr(0),X=mt(new Float32Array(d.worldViewProjection),new Float32Array(q),new Float32Array(W),null,t,b,z.baseColorFactor.toRenderColor(null),N.emissiveFactor,z.metallicFactor,z.roughnessFactor,N,Z,a),ne={defines:[]},oe=[];Wh(ne.defines,oe,L,t,a.lut);let ee=t.shadowRenderer;ee&&(ee.useNormalOffset=!1);let le=null;if(j){let he=qh(d.nodeModelMatrix,t.transform);if(le=new Float32Array(he),O.projection.name!=="globe"){let pe=L.aabb.min,we=L.aabb.max,[ye,ge]=j.getOpacityForBounds(he,pe[0],pe[1],we[0],we[1]);ne.overrideFog=ye>=ht||ge>=ht}}let ae=ms(t,a.paint.get("model-cutoff-fade-range"));ae.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");let fe=t.getOrCreateProgram("model",ne);t.uploadCommonUniforms(M,fe,null,le,ae),t.renderPass!=="shadow"&&ee&&ee.setupShadowsFromMatrix(d.nodeModelMatrix,fe),fe.draw(t,M.gl.TRIANGLES,A,g,v,L.material.doubleSided?kt.disabled:kt.backCCW,X,a.id,L.vertexBuffer,L.indexBuffer,L.segments,a.paint,t.transform.zoom,void 0,oe)}function mu(d,t,a,f,g,v,b){let M;M=d.projection.name==="globe"?i.dg(a,d):[...a],i.a6.mat4.multiply(M,M,t.matrix);let A=i.a6.mat4.multiply([],f,M);if(t.meshes)for(let O of t.meshes){if(O.material.alphaMode!=="BLEND"){b.push({mesh:O,depth:0,modelIndex:g,worldViewProjection:A,nodeModelMatrix:M});continue}let L=i.a6.vec3.transformMat4([],O.centroid,A);L[2]>0&&v.push({mesh:O,depth:L[2],modelIndex:g,worldViewProjection:A,nodeModelMatrix:M})}if(t.children)for(let O of t.children)mu(d,O,a,f,g,v,b)}function Hl(d,t,a,f){let g=a.shadowRenderer;if(!g)return;let v=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),M=g.calculateShadowPassMatrixFromMatrix(t),A=ip(M);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,v,qt.disabled,b,kt.backCCW,A,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,a.transform.zoom,void 0,void 0)}function r_(d,t,a){let f=t.updateZoomBasedPaintProperties(),g=function(v,b,M){let A,O,L,N=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&N>0){let z=v.terrain,j=z.findDEMTileFor(M);j&&j.dem?A=i.di.create(z,M,j):N=0}if(N===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),N===b.validForExaggeration&&(N===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let z in b.instancesPerModel){let j=b.instancesPerModel[z];for(let q=0;q<j.instancedDataArray.length;++q){let W=(A?N*A.getElevationAt(0|j.instancedDataArray.float32[16*q],0|j.instancedDataArray.float32[16*q+1],!0,!0):0)+j.instancesEvaluatedElevation[q];j.instancedDataArray.float32[16*q+6]=W,O=O?Math.min(b.terrainElevationMin,W):W,L=L?Math.max(b.terrainElevationMax,W):W}}return b.terrainElevationMin=O||0,b.terrainElevationMax=L||0,b.validForExaggeration=N,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,a);(f||g)&&(t.uploaded=!1,t.upload(d.context))}let Ro={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.c9([0,0,0],[i.ab,i.ab,0])};function px(d,t){let a=1<<d.canonical.z,f=t.getFreeCameraOptions().position,g=t.elevation,v=d.canonical.x/a,b=(d.canonical.x+1)/a,M=d.canonical.y/a,A=(d.canonical.y+1)/a,O=t._centerAltitude;if(g){let j=g.getMinMaxForTile(d);j&&j.max>O&&(O=j.max)}let L=i.ap(f.x,v,b)-f.x,N=i.ap(f.y,M,A)-f.y,z=i.bD(O,t.center.lat)-f.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+N*N+z*z))}function yr(d,t,a,f,g,v,b){let M=d.context,A=d.renderPass==="shadow",O=d.shadowRenderer,L=A&&O?O.getShadowPassDepthMode():new Dt(M.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D),N=d.isTileAffectedByFog(v);if(a.meshes)for(let z of a.meshes){let j=["MODEL_POSITION_ON_GPU"],q=[],W,Z,X;f.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");let ne=ms(d,t.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&O)W=d.getOrCreateProgram("modelDepth",{defines:j}),Z=ip(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(a.matrix)),X=O.getShadowPassColorMode();else{Wh(j,q,z,d,t.lut),W=d.getOrCreateProgram("model",{defines:j,overrideFog:N});let ee=z.material,le=ee.pbrMetallicRoughness,ae=t.paint.get("model-opacity"),fe=t.paint.get("model-emissive-strength").constantOr(0);Z=mt(v.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,ae,le.baseColorFactor.toRenderColor(null),ee.emissiveFactor,le.metallicFactor,le.roughnessFactor,ee,fe,t,g),O&&(b.shadowUniformsInitialized?W.setShadowUniformValues(M,O.getShadowUniformValues()):(O.setupShadows(v.toUnwrapped(),W,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),X=ne.shouldRenderCutoff||ae<1||ee.alphaMode!=="OPAQUE"?mn.alphaBlended:mn.unblended}d.uploadCommonUniforms(M,W,v.toUnwrapped(),null,ne);let oe=z.material.doubleSided?kt.disabled:kt.backCCW;if(f.instancedDataArray.length>20)q.push(f.instancedDataBuffer),W.draw(d,M.gl.TRIANGLES,L,qt.disabled,X,oe,Z,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,d.transform.zoom,void 0,q,f.instancedDataArray.length);else{let ee=A?"u_instance":"u_normal_matrix";for(let le=0;le<f.instancedDataArray.length;++le)Z[ee]=new Float32Array(f.instancedDataArray.arrayBuffer,64*le,16),W.draw(d,M.gl.TRIANGLES,L,qt.disabled,X,oe,Z,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,d.transform.zoom,void 0,q)}}if(a.children)for(let z of a.children)yr(d,t,z,f,g,v,b)}let mx=[1,-1,1];function gu(d,t,a,f){if(!a.modelManager)return!0;let g=a.modelManager;if(!a.shadowRenderer)return!0;let v=a.shadowRenderer,b=t.aabb,M=!0,A=d.maxHeight;if(A===0){let L=0;for(let N in d.instancesPerModel){let z=g.getModel(N,f);z?L=Math.max(L,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):M=!1}A=d.maxScale*L*1.41+d.maxVerticalOffset,M&&(d.maxHeight=A)}b.max[2]=A,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,i.a6.vec3.transformMat4(b.min,b.min,t.tileMatrix),i.a6.vec3.transformMat4(b.max,b.max,t.tileMatrix);let O=b.intersects(v.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=O===2),O===0}function ai(d,t){let a=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],g=d.uniformValues.u_cutoff_params[2],v=d.uniformValues.u_cutoff_params[3];return f===a||v===g?1:i.ap(((t-a)/(f-a)-g)/(v-g),0,1)}function Dn(d,t,a,f){if(t.pitch<20)return 1;let g=t.getWorldToCameraMatrix();i.a6.mat4.multiply(g,g,d);let v=i.a6.vec4.fromValues(a.min[0],a.min[1],a.min[2],1),b=i.a6.vec4.transformMat4(i.a6.vec4.create(),v,g),M=b,A=b;v[1]=a.max[1],b=i.a6.vec4.transformMat4(i.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A,v[0]=a.max[0],b=i.a6.vec4.transformMat4(i.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A,v[1]=a.min[1],b=i.a6.vec4.transformMat4(i.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A;let O=i.ap(f[0],0,1),L=100*t.pixelsPerMeter*i.ap(f[1],0,1),N=i.ap(f[2],0,1),z=i.a6.vec4.lerp(i.a6.vec4.create(),M,A,O),j=Math.tan(.5*t.fovX),q=-z[2]*j;if(L===0)return z[1]<-Math.abs(q)?N:1;let W=(-Math.abs(q)-z[1])/L,Z=(ne,oe,ee)=>(1-ee)*ne+ee*oe,X=i.ap(Z(1,N,W),N,1);return Z(1,X,i.ap((t.pitch-20)/20,0,1))}class o_{}class Qs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,f){{let N=this._storage.get(a.id);if(N)return N.lastUsedFrameIdx=t,N.buf}let g=f.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(v),M=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let A=new i.dk;for(let N=0;N<v/2;N+=3){let z=M[N],j=M[N+1],q=M[N+2];A.emplaceBack(z,j),A.emplaceBack(j,q),A.emplaceBack(q,z)}let O=f.bindVertexArrayOES.current,L=new o_;return L.buf=new Ks(f,A),L.lastUsedFrameIdx=t,this._storage.set(a.id,L),f.bindVertexArrayOES.set(O),L.buf}update(t){for(let[a,f]of this._storage)t-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(let[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class Zh{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let ea={symbol:function(d,t,a,f,g){if(d.renderPass!=="translucent")return;let v=qt.disabled,b=d.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(O,L,N,z,j,q,W){let Z=L.transform,X=j==="map",ne=q==="map";for(let oe of O){let ee=z.getTile(oe),le=ee.getBucket(N);if(!le||!le.text||!le.text.segments.get().length)continue;let ae=i.bj(le.textSizeData,Z.zoom),fe=qs(oe,le.getProjection(),Z),he=Z.calculatePixelsToTileUnitsMatrix(ee),pe=vn(fe,ee.tileID.canonical,ne,X,Z,le.getProjection(),he),we=le.hasIconTextFit()&&le.hasIconData();if(ae){let ye=Math.pow(2,Z.zoom-ee.tileID.overscaledZ);ux(le,X,ne,W,i.cS,Z,pe,oe,ye,ae,we)}}}(f,d,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g);let M=a.paint.get("icon-opacity").constantOr(1)!==0,A=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||A)?hu(d,t,a,f,v,b):(M&&hu(d,t,a,f,v,b,{onlyIcons:!0}),A&&hu(d,t,a,f,v,b,{onlyText:!0})),t.map.showCollisionBoxes&&(jh(d,t,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),jh(d,t,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,a,f){if(d.renderPass!=="translucent")return;let g=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),M=a.layout.get("circle-sort-key").constantOr(1)!==void 0,A=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;let O=d.context,L=O.gl,N=d.transform,z=d.depthModeForSublayer(0,Dt.ReadOnly),j=qt.disabled,q=d.colorModeForDrapableLayerRenderPass(A),W=N.projection.name==="globe",Z=[i.am(N.center.lng),i.at(N.center.lat)],X=[];for(let oe=0;oe<f.length;oe++){let ee=f[oe],le=t.getTile(ee),ae=le.getBucket(a);if(!ae||ae.projection.name!==N.projection.name)continue;let fe=ae.programConfigurations.get(a.id),he=i.cT(a),pe=d.isTileAffectedByFog(ee);W&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),d.terrain&&N.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");let we=d.getOrCreateProgram("circle",{config:fe,defines:he,overrideFog:pe}),ye=ae.layoutVertexBuffer,ge=ae.globeExtVertexBuffer,Me=ae.indexBuffer,Be=N.projection.createInversionMatrix(N,ee.canonical),qe={programConfiguration:fe,program:we,layoutVertexBuffer:ye,globeExtVertexBuffer:ge,indexBuffer:Me,uniformValues:i.cU(d,ee,le,Be,Z,a),tile:le};if(M){let ze=ae.segments.get();for(let Je of ze)X.push({segments:new i.b1([Je]),sortKey:Je.sortKey,state:qe})}else X.push({segments:ae.segments,sortKey:0,state:qe})}M&&X.sort((oe,ee)=>oe.sortKey-ee.sortKey);let ne={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(let oe of X){let{programConfiguration:ee,program:le,layoutVertexBuffer:ae,globeExtVertexBuffer:fe,indexBuffer:he,uniformValues:pe,tile:we}=oe.state,ye=oe.segments;d.terrain&&d.terrain.setupElevationDraw(we,le,ne),d.uploadCommonUniforms(O,le,we.tileID.toUnwrapped()),le.draw(d,L.TRIANGLES,z,j,q,kt.disabled,pe,a.id,ae,he,ye,a.paint,N.zoom,ee,[fe])}},heatmap:function(d,t,a,f){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let g=d.context,v=g.gl,b=qt.disabled,M=new mn([v.ONE,v.ONE,v.ONE,v.ONE],i.bz.transparent,[!0,!0,!0,!0]);(function(j,q,W,Z){let X=j.gl,ne=q.width*Z,oe=q.height*Z;j.activeTexture.set(X.TEXTURE1),j.viewport.set([0,0,ne,oe]);let ee=W.heatmapFbo;if(!ee||ee&&(ee.width!==ne||ee.height!==oe)){ee&&ee.destroy();let le=X.createTexture();X.bindTexture(X.TEXTURE_2D,le),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ee=W.heatmapFbo=j.createFramebuffer(ne,oe,!0,null),function(ae,fe,he,pe,we,ye){let ge=ae.gl;ge.texImage2D(ge.TEXTURE_2D,0,ae.extRenderToTextureHalfFloat?ge.RGBA16F:ge.RGBA,we,ye,0,ge.RGBA,ae.extRenderToTextureHalfFloat?ge.HALF_FLOAT:ge.UNSIGNED_BYTE,null),pe.colorAttachment.set(he)}(j,0,le,ee,ne,oe)}else X.bindTexture(X.TEXTURE_2D,ee.colorAttachment.get()),j.bindFramebuffer.set(ee.framebuffer)})(g,d,a,d.transform.projection.name==="globe"?.5:.25),g.clear({color:i.bz.transparent});let A=d.transform,O=A.projection.name==="globe",L=O?["PROJECTION_GLOBE_VIEW"]:[],N=O?kt.frontCCW:kt.disabled,z=[i.am(A.center.lng),i.at(A.center.lat)];for(let j=0;j<f.length;j++){let q=f[j];if(t.hasRenderableParent(q))continue;let W=t.getTile(q),Z=W.getBucket(a);if(!Z||Z.projection.name!==A.projection.name)continue;let X=d.isTileAffectedByFog(q),ne=Z.programConfigurations.get(a.id),oe=d.getOrCreateProgram("heatmap",{config:ne,defines:L,overrideFog:X}),{zoom:ee}=d.transform;d.terrain&&d.terrain.setupElevationDraw(W,oe),d.uploadCommonUniforms(g,oe,q.toUnwrapped());let le=A.projection.createInversionMatrix(A,q.canonical);oe.draw(d,v.TRIANGLES,Dt.disabled,b,M,N,ax(d,q,W,le,z,ee,a.paint.get("heatmap-intensity")),a.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,a.paint,d.transform.zoom,ne,O?[Z.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,v){let b=g.context,M=b.gl,A=v.heatmapFbo;if(!A)return;b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(M.TEXTURE1);let O=v.colorRampTexture;O||(O=v.colorRampTexture=new i.T(b,v.colorRamp,M.RGBA8)),O.bind(M.LINEAR,M.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,M.TRIANGLES,Dt.disabled,qt.disabled,g.colorModeForRenderPass(),kt.disabled,((L,N,z,j)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(d,a))},line:function(d,t,a,f){if(d.renderPass!=="translucent")return;let g=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;let b=a.paint.get("line-emissive-strength"),M=a.paint.get("line-occlusion-opacity"),A=d.context,O=A.gl,L=a.layout.get("line-z-offset"),N=!L.isConstant()||!!L.constantOr(0),z=N?new Dt(d.depthOcclusion?O.GREATER:O.LEQUAL,Dt.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,Dt.ReadOnly),j=d.colorModeForDrapableLayerRenderPass(b),q=d.terrain&&d.terrain.renderingToTexture,W=q?1:i.q.devicePixelRatio,Z=a.paint.get("line-dasharray"),X=Z.constantOr(1),ne=a.layout.get("line-cap"),oe=Z.constantOr(null),ee=ne.constantOr(null),le=a.paint.get("line-pattern"),ae=le.constantOr(1),fe=le.constantOr(null),he=a.paint.get("line-opacity").constantOr(1),pe=!ae&&he!==1||d.depthOcclusion&&M>0&&M<1,we=a.paint.get("line-gradient"),ye=ae?"linePattern":"line",ge=i.cV(a),Me;if(q&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(pe=!1),M!==0&&d.depthOcclusion){let qe=a.paint._values["line-opacity"];qe&&qe.value&&qe.value.kind==="constant"?Me=qe.value:i.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}if(N&&(d.forceTerrainMode=!0),!N&&M!==0&&d.terrain&&!q)return void i.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Be=pe&&N?d.stencilModeFor3D():qt.disabled;for(let qe of f){let ze=t.getTile(qe);if(ae&&!ze.patternsLoaded())continue;let Je=ze.getBucket(a);if(!Je)continue;d.prepareDrawTile();let Se=Je.programConfigurations.get(a.id),Ge=d.isTileAffectedByFog(qe),Ue=d.getOrCreateProgram(ye,{config:Se,defines:N?[...ge,"ELEVATED"]:ge,overrideFog:Ge});if(fe&&ze.imageAtlas){let rt=ze.imageAtlas.patternPositions[fe.toString()];rt&&Se.setConstantPatternPositions(rt)}if(!ae&&oe&&ee&&ze.lineAtlas){let rt=ze.lineAtlas.getDash(oe,ee);rt&&Se.setConstantPatternPositions(rt)}let[et,nt]=a.paint.get("line-trim-offset");(ee==="round"||ee==="square")&&et!==nt&&(et===0&&(et-=1),nt===1&&(nt+=1));let He=q?qe.projMatrix:null,Ye=ae?i.cW(d,ze,a,He,W,[et,nt]):i.cX(d,ze,a,He,Je.lineClipsArray.length,W,[et,nt]);if(we){let rt=Je.gradients[a.id],ft=rt.texture;if(a.gradientVersion!==rt.version){let Ot=256;if(a.stepInterpolant){let _t=t.getSource().maxzoom,Mt=qe.canonical.z===_t?Math.ceil(1<<d.transform.maxZoom-qe.canonical.z):1;Ot=i.ap(i.cY(Je.maxLineLength/i.ab*1024*Mt),256,A.maxTextureSize)}rt.gradient=i.cZ({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:rt.gradient||void 0,clips:Je.lineClipsArray}),rt.texture?rt.texture.update(rt.gradient):rt.texture=new i.T(A,rt.gradient,O.RGBA8),rt.version=a.gradientVersion,ft=rt.texture}A.activeTexture.set(O.TEXTURE1),ft.bind(a.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}X&&(A.activeTexture.set(O.TEXTURE0),ze.lineAtlasTexture&&ze.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),Se.updatePaintBuffers()),ae&&(A.activeTexture.set(O.TEXTURE0),ze.imageAtlasTexture&&ze.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Se.updatePaintBuffers()),N&&d.terrain.setupElevationDraw(ze,Ue),d.uploadCommonUniforms(A,Ue,qe.toUnwrapped());let Et=rt=>{Me!=null&&(Me.value=he*M),Ue.draw(d,O.TRIANGLES,z,rt,j,kt.disabled,Ye,a.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,a.paint,d.transform.zoom,Se,[Je.layoutVertexBuffer2,Je.patternVertexBuffer,Je.zOffsetVertexBuffer]),Me!=null&&(Me.value=he)};if(pe&&!N){let rt=d.stencilModeForClipping(qe).ref;rt===0&&q&&A.clear({stencil:0});let ft={func:O.EQUAL,mask:255};Ye.u_alpha_discard_threshold=.8,Et(new qt(ft,rt,255,O.KEEP,O.KEEP,O.INVERT)),Ye.u_alpha_discard_threshold=0,Et(new qt(ft,rt,255,O.KEEP,O.KEEP,O.KEEP))}else pe&&N&&(Ye.u_alpha_discard_threshold=.001),Et(N?Be:d.stencilModeForClipping(qe))}pe&&(d.resetStencilClippingMasks(),q&&A.clear({stencil:0})),M===0||d.depthOcclusion||q||d.layersWithOcclusionOpacity.push(d.currentLayer),N&&(d.forceTerrainMode=!1)},fill:function(d,t,a,f){let g=a.paint.get("fill-color"),v=a.paint.get("fill-opacity"),b=a.is3D(),M=new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D);if(v.constantOr(1)===0)return;let A=a.paint.get("fill-emissive-strength"),O=d.colorModeForDrapableLayerRenderPass(A),L=a.paint.get("fill-pattern"),N=d.opaquePassEnabledForLayer()&&!L.constantOr(1)&&g.constantOr(i.bz.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===N){let z=b?M:d.depthModeForSublayer(1,d.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Uh(d,t,a,f,z,O,!1)}if(!b&&d.renderPass==="translucent"&&a.paint.get("fill-antialias")){let z=b?M:d.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Uh(d,t,a,f,z,O,!0)}},"fill-extrusion":function(d,t,a,f){let g=a.paint.get("fill-extrusion-opacity"),v=d.context,b=v.gl,M=d.terrain,A=M&&M.renderingToTexture;if(g===0)return;let O=d.conflationActive&&d.style.isLayerClipped(a,t.getSource()),L=d.style.order.indexOf(a.fqid);if(O&&function(N,z,j,q,W){for(let Z of q){let X=z.getTile(Z).getBucket(j);X&&(X.updateReplacement(Z,N.replacementSource,W),X.uploadCentroid(N.context))}}(d,t,a,f,L),M||O)for(let N of f){let z=t.getTile(N).getBucket(a);z&&Js(d.context,t,N,z,a,M,O)}if(d.renderPass==="shadow"&&d.shadowRenderer){let N=d.shadowRenderer;if(M&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.a4)return;let z=N.getShadowPassDepthMode(),j=N.getShadowPassColorMode();jl(d,t,a,f,z,qt.disabled,j,O)}else if(d.renderPass==="translucent"){let N=!a.paint.get("fill-extrusion-pattern").constantOr(1),z=a.paint.get("fill-extrusion-color").constantOr(i.bz.white);if(!A&&z.a!==0){let j=new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D);g===1&&N?jl(d,t,a,f,j,qt.disabled,mn.unblended,O):(jl(d,t,a,f,j,qt.disabled,mn.disabled,O),jl(d,t,a,f,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),O),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&N&&(!M&&d.transform.projection.name!=="globe"||A)){let j=a.paint.get("fill-extrusion-opacity"),q=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=a.paint.get("fill-extrusion-flood-light-intensity"),X=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),ne=q>0&&W>0,oe=Z>0,ee=(ae,fe,he)=>(1-he)*ae+he*fe,le=ae=>{let fe=d.depthModeForSublayer(1,Dt.ReadOnly,b.LEQUAL,!0),he=a.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=ee(.1,3,he),we=d._showOverdrawInspector;if(!we){let ye=new qt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),ge=new mn([b.ONE,b.ONE,b.ONE,b.ONE],i.bz.transparent,[!1,!1,!1,!0],b.MIN);Ji(d,t,a,f,fe,ye,ge,kt.disabled,ae,"sdf",j,q,W,Z,X,pe,O,!1)}{let ye=we?qt.disabled:new qt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),ge=we?d.colorModeForRenderPass():new mn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],i.bz.transparent,[!0,!0,!0,!0]);Ji(d,t,a,f,fe,ye,ge,kt.disabled,ae,"color",j,q,W,Z,X,pe,O,!1)}};if(A){let ae=(fe,he,pe)=>{let we=d.depthModeForSublayer(1,Dt.ReadOnly,b.LEQUAL,!1),ye=a.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=ee(.1,3,ye);{let Me=new mn([b.ONE,b.ONE,b.ONE,b.ONE],i.bz.transparent,[!1,!1,!1,!0]);Ji(d,t,a,f,we,qt.disabled,Me,kt.disabled,fe,"clear",j,q,W,Z,X,ge,O,he)}{let Me=new qt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Be=new mn([b.ONE,b.ONE,b.ONE,b.ONE],i.bz.transparent,[!1,!1,!1,!0],b.MIN);Ji(d,t,a,f,we,Me,Be,kt.disabled,fe,"sdf",j,q,W,Z,X,ge,O,he)}{let Me=fe?b.ZERO:b.ONE_MINUS_DST_ALPHA,Be=new qt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),qe=new mn([Me,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],i.bz.transparent,[!0,!0,!0,!0]);Ji(d,t,a,f,we,Be,qe,kt.disabled,fe,"color",j,q,W,Z,X,ge,O,he)}{let Me=new mn([b.ONE,b.ONE,b.ONE,fe?b.ZERO:b.ONE],i.bz.transparent,[!1,!1,!1,!0],fe?b.FUNC_ADD:b.MAX);Ji(d,t,a,f,we,qt.disabled,Me,kt.disabled,fe,"clear",j,q,W,Z,X,ge,O,he,pe)}};if(ne||oe){let fe;if(d.prepareDrawTile(),M){let he=M.drapeBufferSize[0],pe=M.drapeBufferSize[1];fe=M.framebufferCopyTexture,fe&&(!fe||fe.size[0]===he&&fe.size[1]===pe)||(fe&&fe.destroy(),fe=M.framebufferCopyTexture=new i.T(v,new i.r({width:he,height:pe}),b.RGBA8)),fe.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,he,pe,0)}ne&&ae(!0,!1,fe),oe&&ae(!1,!0,fe)}}else ne&&le(!0),oe&&le(!1),(ne||oe)&&d.resetStencilClippingMasks()}}},hillshade:function(d,t,a,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let g=d.context,v=d.terrain&&d.terrain.renderingToTexture,[b,M]=d.renderPass!=="translucent"||v?[{},f]:d.stencilConfigForOverlap(f);for(let A of M){let O=t.getTile(A);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")nu(d,O,a);else if(d.renderPass==="translucent"){let L=d.depthModeForSublayer(0,Dt.ReadOnly),N=a.paint.get("hillshade-emissive-strength"),z=d.colorModeForDrapableLayerRenderPass(N),j=v&&d.terrain?d.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];Eh(d,A,O,a,L,j,z)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,a,f,g,v){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let b=d.transform.projection.name==="globe",M=a.paint.get("raster-elevation")!==0,A=M&&b;if(d.renderElevatedRasterBackface&&!A)return;let O=d.context,L=O.gl,N=t.getSource(),z=function(ae,fe,he,pe){let we=fe.paint.get("raster-color"),ye=ae.type==="raster-array",ge=[],Me=fe.paint.get("raster-resampling"),Be=fe.paint.get("raster-color-mix"),qe=fe.paint.get("raster-color-range"),ze=[Be[0],Be[1],Be[2],0],Je=Be[3],Se=Me==="nearest"?pe.NEAREST:pe.LINEAR;if(ye&&(ge.push("RASTER_ARRAY"),we||ge.push("RASTER_COLOR"),Me==="linear"&&ge.push("RASTER_ARRAY_LINEAR"),Se=pe.NEAREST,!qe&&ae.rasterLayers)){let Ge=ae.rasterLayers.find(({id:Ue})=>Ue===fe.sourceLayer);Ge&&Ge.fields&&Ge.fields.range&&(qe=Ge.fields.range)}if(qe=qe||[0,1],we){ge.push("RASTER_COLOR"),he.activeTexture.set(pe.TEXTURE2),fe.updateColorRamp(qe);let Ge=fe.colorRampTexture;Ge||(Ge=fe.colorRampTexture=new i.T(he,fe.colorRamp,pe.RGBA8)),Ge.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}return{mix:ze,range:qe,offset:Je,defines:ge,resampling:Se}}(N,a,O,L);if(N instanceof i.aD&&!f.length&&!b)return;let j=a.paint.get("raster-emissive-strength"),q=d.colorModeForDrapableLayerRenderPass(j),W=d.terrain&&d.terrain.renderingToTexture,Z=!d.options.moving,X=a.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(N instanceof i.aD&&!f.length&&(N.onNorthPole||N.onSouthPole)){let ae=M?d.stencilModeFor3D():qt.disabled;return void Vr(!!N.onNorthPole,null,d,t,a,j,z,kt.disabled,ae)}if(!f.length)return;let[ne,oe]=N instanceof i.aD||W?[{},f]:d.stencilConfigForOverlap(f),ee=oe[oe.length-1].overscaledZ;A&&z.defines.push("PROJECTION_GLOBE_VIEW"),M&&z.defines.push("RENDER_CUTOFF");let le=(ae,fe,he)=>{for(let pe of ae){let we=pe.toUnwrapped(),ye=t.getTile(pe);if(W&&(!ye||!ye.hasData()))continue;O.activeTexture.set(L.TEXTURE0);let ge=$h(ye,N,a,z);if(!ge||!ge.texture)continue;let{texture:Me,mix:Be,offset:qe,tileSize:ze,buffer:Je}=ge,Se,Ge;W?(Se=Dt.disabled,Ge=pe.projMatrix):M?(Se=new Dt(L.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D),Ge=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(we,Z)):(Se=d.depthModeForSublayer(pe.overscaledZ-ee,a.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,L.LESS),Ge=d.transform.calculateProjMatrix(we,Z));let Ue=d.terrain&&W?d.terrain.stencilModeForRTTOverlap(pe):ne[pe.overscaledZ],et=v?0:a.paint.get("raster-fade-duration");ye.registerFadeDuration(et);let nt=t.findLoadedParent(pe,0),He=Ph(ye,nt,t,d.transform,et),Ye,Et;d.terrain&&d.terrain.prepareDrawTile(),O.activeTexture.set(L.TEXTURE0),Me.bind(X,L.CLAMP_TO_EDGE),O.activeTexture.set(L.TEXTURE1),nt?(nt.texture&&nt.texture.bind(X,L.CLAMP_TO_EDGE),Ye=Math.pow(2,nt.tileID.overscaledZ-ye.tileID.overscaledZ),Et=[ye.tileID.canonical.x*Ye%1,ye.tileID.canonical.y*Ye%1]):Me.bind(X,L.CLAMP_TO_EDGE),Me.useMipmap&&O.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let rt=d.transform,ft,Ot=M?vi(rt):[0,0,0,0],_t,Mt,ln,rn,jn,Yn=0;if(A&&N instanceof i.aD&&N.coordinates.length>3)_t=Float32Array.from(i.b5(i.cC(new i.bP(0,0,0)))),Mt=Float32Array.from(rt.globeMatrix),ln=Float32Array.from(i.cy(rt)),rn=[i.am(rt.center.lng),i.at(rt.center.lat)],ft=N.elevatedGlobePerspectiveTransform,jn=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let gn=i.cz(pe.canonical);Yn=i.cA(gn.getCenter().lat),_t=Float32Array.from(i.b5(i.cC(pe.canonical))),Mt=Float32Array.from(rt.globeMatrix),ln=Float32Array.from(i.cy(rt)),rn=[i.am(rt.center.lng),i.at(rt.center.lat)],ft=[0,0],jn=Float32Array.from(i.cB(pe.canonical,gn,Yn,rt.worldSize/rt._pixelsPerMercatorPixel))}else ft=N instanceof i.aD?N.perspectiveTransform:[0,0],_t=new Float32Array(16),Mt=new Float32Array(9),ln=new Float32Array(16),rn=[0,0],jn=new Float32Array(9);let oi=cu(Ge,_t,Mt,ln,jn,Et||[0,0],i.a9(d.transform.zoom),rn,Ot,Ye||1,He,a,ft,M?a.paint.get("raster-elevation"):0,2,Be,qe,z.range,ze,Je,j),ho=d.isTileAffectedByFog(pe),Mi=d.getOrCreateProgram("raster",{defines:z.defines,overrideFog:ho});if(d.uploadCommonUniforms(O,Mi,we),N instanceof i.aD){let gn=N.elevatedGlobeVertexBuffer,qn=N.elevatedGlobeIndexBuffer;if(W||!b)N.boundsBuffer&&N.boundsSegments&&Mi.draw(d,L.TRIANGLES,Se,qt.disabled,q,kt.disabled,oi,a.id,N.boundsBuffer,d.quadTriangleIndexBuffer,N.boundsSegments);else if(gn&&qn){let hi=rt.zoom<=i.c2?N.elevatedGlobeSegments:N.getSegmentsForLongitude(rt.center.lng);hi&&Mi.draw(d,L.TRIANGLES,Se,qt.disabled,q,fe,oi,a.id,gn,qn,hi)}}else if(A){Se=new Dt(L.LEQUAL,Dt.ReadOnly,d.depthRangeFor3D);let gn=d.globeSharedBuffers;if(gn){let[qn,hi,$n]=gn.getGridBuffers(Yn,!1);Mi.draw(d,L.TRIANGLES,Se,he||Ue,d.colorModeForRenderPass(),fe,oi,a.id,qn,hi,$n)}}else{let{tileBoundsBuffer:gn,tileBoundsIndexBuffer:qn,tileBoundsSegments:hi}=d.getTileBoundsBuffers(ye);Mi.draw(d,L.TRIANGLES,Se,Ue,q,kt.disabled,oi,a.id,gn,qn,hi)}}if(!(N instanceof i.aD)&&A)for(let pe of ae){let we=pe.canonical.y===(1<<pe.canonical.z)-1;pe.canonical.y===0&&Vr(!0,pe,d,t,a,j,z,fe,he||qt.disabled),we&&Vr(!1,pe,d,t,a,j,z,fe===kt.frontCW?kt.backCW:kt.frontCW,he||qt.disabled)}};A?le(oe,d.renderElevatedRasterBackface?kt.backCW:kt.frontCW,d.stencilModeFor3D()):le(oe,kt.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,a,f,g,v){d.renderPass==="offscreen"&&function(b,M,A,O){if(!O.length)return;let L=b.context,N=L.gl,z=M.getSource();if(!(z instanceof gl))return;let j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),q=A.particlePositionRGBAImage;if(!q||q.width!==j){let oe=function(ee){let le=ee*ee,ae=new Uint8Array(4*le),fe=function(pe){return pe|=0,pe=Math.imul(2747636419^pe,2654435769),pe=Math.imul(pe^pe>>>16,2654435769),((pe=Math.imul(pe^pe>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let pe=0;pe<le;pe++){let we=he*(fe(2*pe+0)+qo),ye=he*(fe(2*pe+1)+qo),ge=255*we%1,Me=255*ye%1,Be=ge,qe=ye-Me/255,ze=Me;ae[4*pe+0]=255*(we-ge/255),ae[4*pe+1]=255*Be,ae[4*pe+2]=255*qe,ae[4*pe+3]=255*ze}return ae}(j);q=A.particlePositionRGBAImage=new i.r({width:j,height:j},oe)}let W=A.particleFramebuffer;W?W.width!==j&&(W.destroy(),W=A.particleFramebuffer=L.createFramebuffer(j,j,!0,null)):W=A.particleFramebuffer=L.createFramebuffer(j,j,!0,null);let Z=[];for(let oe of O){let ee=M.getTile(oe);if(!(ee instanceof ah))continue;let le=t_(ee,z,A);if(!le)continue;let ae=[ee.tileSize,ee.tileSize],fe=A.tileFramebuffer;fe||(fe=A.tileFramebuffer=L.createFramebuffer(ae[0],ae[1],!0,null));let he=ee.rasterParticleState;he||(he=ee.rasterParticleState=new e_(L,oe,ae,q));let pe=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==j&&he.updateParticleTexture(oe,q);let we=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=we;let ye=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=ye,Z.push([oe,le,he,pe])}if(Z.length===0)return;let X=i.q.now(),ne=A.previousDrawTimestamp?.001*(X-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=X,A.hasColorMap()){L.activeTexture.set(N.TEXTURE0+2);let oe=A.colorRampTexture;oe||(oe=A.colorRampTexture=new i.T(L,A.colorRamp,N.RGBA8)),oe.bind(N.LINEAR,N.CLAMP_TO_EDGE)}L.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(oe,ee,le){let ae=oe.context,fe=ae.gl,he=ee.tileFramebuffer;ae.activeTexture.set(fe.TEXTURE0);let pe={u_texture:0,u_opacity:1.05*(ye=ee.paint.get("raster-particle-fade-opacity-factor"))/(ye+.05)},we=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ye;for(let ge of le){let[,,Me,Be]=ge;he.colorAttachment.set(Me.targetColorTexture.texture),ae.viewport.set([0,0,he.width,he.height]),ae.clear({color:i.bz.transparent}),Be&&(Me.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),we.draw(oe,fe.TRIANGLES,Dt.disabled,qt.disabled,mn.alphaBlended,kt.disabled,pe,ee.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(b,A,Z),function(oe,ee,le,ae){let fe=oe.context,he=fe.gl,pe=le.tileFramebuffer,we=oe.transform.projection.name==="globe",ye=le.paint.get("raster-particle-max-speed");for(let ge of ae){let[Me,Be,qe]=ge;fe.activeTexture.set(he.TEXTURE0+0),Be.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),pe.colorAttachment.set(qe.targetColorTexture.texture);let ze=oe.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});fe.activeTexture.set(he.TEXTURE0+1);let Je=Be.scalarData?[]:[0,1,2,3].map(Ue=>i.c$[Ue](Me));Je.push(Me);let Se=Me.canonical.x,Ge=Me.canonical.y;for(let Ue of Je){let et=ee.getTile(we?Ue.wrapped():Ue);if(!et)continue;let nt=et.rasterParticleState;if(!nt)continue;let He=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-Me.wrap),Ye=Ue.canonical.y;nt.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);let Et=kh(1,nt.particleTexture0.size[0],[He-Se,Ye-Ge],0,Be.texture.size,2,ye,Be.textureOffset,Be.scale,Be.offset);ze.draw(oe,he.POINTS,Dt.disabled,qt.disabled,mn.alphaBlended,kt.disabled,Et,le.id,nt.particleIndexBuffer,void 0,nt.particleSegment)}}}(b,M,A,Z),L.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(oe,ee,le,ae){let fe=oe.context,he=fe.gl,pe=ee.paint.get("raster-particle-max-speed"),we=ae*ee.paint.get("raster-particle-speed-factor")*.15,ye=function(Me){return Math.pow(Me,6)}(.01+1*ee.paint.get("raster-particle-reset-rate-factor")),ge=ee.particleFramebuffer;fe.viewport.set([0,0,ge.width,ge.height]);for(let Me of le){let[,Be,qe]=Me;fe.activeTexture.set(he.TEXTURE0+0),Be.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),fe.activeTexture.set(he.TEXTURE0+1);let ze=qe.particleTexture0;ze.bind(he.NEAREST,he.CLAMP_TO_EDGE);let Je=Nh(1,ze.size[0],0,Be.texture.size,pe,we,ye,Be.textureOffset,Be.scale,Be.offset);ge.colorAttachment.set(qe.particleTexture1.texture),fe.clear({color:i.bz.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(oe,he.TRIANGLES,Dt.disabled,qt.disabled,mn.unblended,kt.disabled,Je,ee.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(b,A,Z,ne)}(d,t,a,f),d.renderPass==="translucent"&&(function(b,M,A,O,L){let N=b.context,z=N.gl,j=M.getSource().tileSize,q=5*(1-i.a7(i.bU,i.bU+1,b.transform.zoom))*j+A.paint.get("raster-particle-elevation"),W=!b.options.moving,Z=b.transform.projection.name==="globe";if(!O.length)return;let[X,ne]=b.stencilConfigForOverlap(O),oe=[];Z&&oe.push("PROJECTION_GLOBE_VIEW");let ee=b.stencilModeFor3D();for(let le of ne){let ae=le.toUnwrapped(),fe=M.getTile(le);if(!fe.rasterParticleState)continue;let he=fe.rasterParticleState,pe=100;fe.registerFadeDuration(pe);let we=M.findLoadedParent(le,0),ye=Ph(fe,we,M,b.transform,pe),ge,Me;b.terrain&&b.terrain.prepareDrawTile(),N.activeTexture.set(z.TEXTURE0),he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),we&&we.rasterParticleState?(we.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ge=Math.pow(2,we.tileID.overscaledZ-fe.tileID.overscaledZ),Me=[fe.tileID.canonical.x*ge%1,fe.tileID.canonical.y*ge%1]):he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let Be=Z?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ae,W),qe=b.transform,ze=n_(qe),Je=i.cz(le.canonical),Se=i.cA(Je.getCenter().lat),Ge,Ue,et,nt,He;Z?(Ge=Float32Array.from(i.b5(i.cC(le.canonical))),Ue=Float32Array.from(qe.globeMatrix),et=Float32Array.from(i.cy(qe)),nt=[i.am(qe.center.lng),i.at(qe.center.lat)],He=Float32Array.from(i.cB(le.canonical,Je,Se,qe.worldSize/qe._pixelsPerMercatorPixel))):(Ge=new Float32Array(16),Ue=new Float32Array(9),et=new Float32Array(16),nt=[0,0],He=new Float32Array(9));let Ye=Yg(Be,Ge,Ue,et,He,Me||[0,0],i.a9(b.transform.zoom),nt,ze,ge||1,ye,q),Et=b.isTileAffectedByFog(le),rt=b.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:Et});if(b.uploadCommonUniforms(N,rt,ae),Z){let ft=new Dt(z.LEQUAL,Dt.ReadOnly,b.depthRangeFor3D),Ot=0,_t=b.globeSharedBuffers;if(_t){let[Mt,ln,rn]=_t.getGridBuffers(Se,Ot!==0);rt.draw(b,z.TRIANGLES,ft,ee,mn.alphaBlended,b.renderElevatedRasterBackface?kt.frontCCW:kt.backCCW,Ye,A.id,Mt,ln,rn)}}else{let ft=b.depthModeForSublayer(0,Dt.ReadOnly),Ot=X[le.overscaledZ],{tileBoundsBuffer:_t,tileBoundsIndexBuffer:Mt,tileBoundsSegments:ln}=b.getTileBoundsBuffers(fe);rt.draw(b,z.TRIANGLES,ft,Ot,mn.alphaBlended,kt.disabled,Ye,A.id,_t,Mt,ln)}}b.resetStencilClippingMasks()}(d,t,a,f),d.style.map.triggerRepaint())},background:function(d,t,a,f){let g=a.paint.get("background-color"),v=a.paint.get("background-opacity"),b=a.paint.get("background-emissive-strength"),M=a.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;let A=d.context,O=A.gl,L=d.transform,N=L.tileSize,z=a.paint.get("background-pattern"),j;if(z!==void 0&&(z===null||(j=d.imageManager.getPattern(z.toString(),a.scope,d.style.getLut(a.scope)),!j)))return;let q=!z&&g.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==q)return;let W=qt.disabled,Z=d.depthModeForSublayer(0,q==="opaque"?Dt.ReadWrite:Dt.ReadOnly),X=d.colorModeForDrapableLayerRenderPass(b),ne=z?"backgroundPattern":"background",oe,ee=f;if(ee||(oe=d.getBackgroundTiles(),ee=Object.values(oe).map(le=>le.tileID)),z&&(A.activeTexture.set(O.TEXTURE0),d.imageManager.bind(d.context,a.scope)),M){let le=d.getOrCreateProgram(ne,{overrideFog:!1,overrideRtt:!0}),ae=new Float32Array(i.a6.mat4.identity([])),fe=new i.aA(0,0,0,0,0),he=z?ka(ae,b,v,d,0,a.scope,j,M,{tileID:fe,tileSize:N}):Kg(ae,b,v,g.toRenderColor(a.lut));le.draw(d,O.TRIANGLES,Z,W,X,kt.disabled,he,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(let le of ee){let ae=d.isTileAffectedByFog(le),fe=d.getOrCreateProgram(ne,{overrideFog:ae}),he=le.toUnwrapped(),pe=f?le.projMatrix:d.transform.calculateProjMatrix(he);d.prepareDrawTile();let we=t?t.getTile(le):oe?oe[le.key]:new $o(le,N,L.zoom,d),ye=z?ka(pe,b,v,d,0,a.scope,j,M,{tileID:le,tileSize:N}):Kg(pe,b,v,g.toRenderColor(a.lut));d.uploadCommonUniforms(A,fe,he);let{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Me,tileBoundsSegments:Be}=d.getTileBoundsBuffers(we);fe.draw(d,O.TRIANGLES,Z,W,X,kt.disabled,ye,a.id,ge,Me,Be)}},sky:function(d,t,a){let f=d._atmosphere?i.a9(d.transform.zoom):1,g=a.paint.get("sky-opacity")*f;if(g===0)return;let v=d.context,b=a.paint.get("sky-type"),M=new Dt(v.gl.LEQUAL,Dt.ReadOnly,[0,1]),A=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(O,L,N,z){let j=O.context,q=j.gl,W=L.skyboxFbo;if(!W){W=L.skyboxFbo=j.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new hp(j),L.skyboxTexture=j.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let oe=0;oe<6;++oe)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(W.framebuffer),j.viewport.set([0,0,32,32]);let Z=L.getCenter(O,!0),X=O.getOrCreateProgram("skyboxCapture"),ne=new Float64Array(16);i.a6.mat4.identity(ne),i.a6.mat4.rotateY(ne,ne,.5*-Math.PI),za(O,L,X,ne,Z,0),i.a6.mat4.identity(ne),i.a6.mat4.rotateY(ne,ne,.5*Math.PI),za(O,L,X,ne,Z,1),i.a6.mat4.identity(ne),i.a6.mat4.rotateX(ne,ne,.5*-Math.PI),za(O,L,X,ne,Z,2),i.a6.mat4.identity(ne),i.a6.mat4.rotateX(ne,ne,.5*Math.PI),za(O,L,X,ne,Z,3),i.a6.mat4.identity(ne),za(O,L,X,ne,Z,4),i.a6.mat4.identity(ne),i.a6.mat4.rotateY(ne,ne,Math.PI),za(O,L,X,ne,Z,5),j.viewport.set([0,0,O.width,O.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(O,L,N,z,j){let q=O.context,W=q.gl,Z=O.transform,X=O.getOrCreateProgram("skybox");q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,L.skyboxTexture);let ne=((oe,ee,le,ae,fe)=>({u_matrix:oe,u_sun_direction:ee,u_cubemap:0,u_opacity:ae,u_temporal_offset:fe}))(Z.skyboxMatrix,L.getCenter(O,!1),0,z,j);O.uploadCommonUniforms(q,X),X.draw(O,W.TRIANGLES,N,qt.disabled,O.colorModeForRenderPass(),kt.backCW,ne,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,a,M,g,A):b==="gradient"&&d.renderPass==="sky"&&function(O,L,N,z,j){let q=O.context,W=q.gl,Z=O.transform,X=O.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new hp(q)),q.activeTexture.set(W.TEXTURE0);let ne=L.colorRampTexture;ne||(ne=L.colorRampTexture=new i.T(q,L.colorRamp,W.RGBA8)),ne.bind(W.LINEAR,W.CLAMP_TO_EDGE);let oe=((ee,le,ae,fe,he)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:le,u_radius:i.bB(ae),u_opacity:fe,u_temporal_offset:he}))(Z.skyboxMatrix,L.getCenter(O,!1),L.paint.get("sky-gradient-radius"),z,j);O.uploadCommonUniforms(q,X),X.draw(O,W.TRIANGLES,N,qt.disabled,O.colorModeForRenderPass(),kt.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,a,M,g,A)},debug:function(d,t,a,f,g,v){for(let b=0;b<a.length;b++)if(g){let O=new i.bz(f.r*.8,f.g*.8,f.b*.8,1);Ao(d,t,a[b],f,-1,-1,v),Ao(d,t,a[b],f,-1,1,v),Ao(d,t,a[b],f,1,1,v),Ao(d,t,a[b],f,1,-1,v),Ao(d,t,a[b],O,0,0,v)}else Ao(d,t,a[b],f,0,0,v)},custom:function(d,t,a,f){let g=d.context,v=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(t)){if(d.renderPass==="offscreen"){let b=v.prerender;if(b){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let M=d.transform.pointMerc;b.call(v,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.a9(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else b.call(v,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let M=v.renderToTile;if(M){let A=f[0].canonical,O=new i.a5(A.x+f[0].wrap*(1<<A.z),A.y,A.z);g.setDepthMode(Dt.disabled),g.setStencilMode(qt.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),M.call(v,g.gl,O),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(qt.disabled);let b=v.renderingMode==="3d"?new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Dt.ReadOnly);if(g.setDepthMode(b),d.transform.projection.name==="globe"){let M=d.transform.pointMerc;v.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.a9(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else v.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,a,f){if(d.renderPass==="opaque")return;let g=a.paint.get("model-opacity");if(g===0)return;let v=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!v||d.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof i.a4))return;let b=d.shadowRenderer,M=a.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,M||(b.enabled=!1));let A=()=>{b&&(b.useNormalOffset=!0,M||(b.enabled=!0))},O=t.getSource();if(d.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(X,ne,oe,ee,le){let ae=X.transform;if(ae.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${ae.projection.name} projection is not yet implemented`);let fe=ae.getFreeCameraOptions().position;if(!X.modelManager)return;let he=X.modelManager;oe.modelManager=he;let pe=X.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=oe._unevaluatedLayout._values["model-id"],ye=St({},oe.layout.get("model-id").parameters),ge=X.style.order.indexOf(oe.fqid);for(let Me of ee){let Be=ne.getTile(Me).getBucket(oe);if(!Be||Be.projection.name!==ae.projection.name)continue;let qe=Be.getModelUris();qe&&!Be.modelsRequested&&(he.addModelsFromBucket(qe,le),Be.modelsRequested=!0);let ze=px(Me,ae);ye.zoom=ze;let Je=we.possiblyEvaluate(ye);if(r_(X,Be,Me),Ro.shadowUniformsInitialized=!1,Ro.useSingleShadowCascade=!!pe&&pe.getMaxCascadeForTile(Me.toUnwrapped())===0,X.renderPass==="shadow"&&pe){if(X.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Ue=ae.calculatePosMatrix(Me.toUnwrapped(),ae.worldSize);if(Ro.tileMatrix.set(Ue),Ro.shadowTileMatrix=Float32Array.from(pe.calculateShadowPassMatrixFromMatrix(Ue)),Ro.aabb.min.fill(0),Ro.aabb.max[0]=Ro.aabb.max[1]=i.ab,Ro.aabb.max[2]=0,gu(Be,Ro,X,oe.scope))continue}let Se=1<<Me.canonical.z,Ge=[((fe.x-Me.wrap)*Se-Me.canonical.x)*i.ab,(fe.y*Se-Me.canonical.y)*i.ab,fe.z*Se*i.ab];X.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&X.style.isLayerClipped(oe,ne.getSource())&&Be.updateReplacement(Me,X.replacementSource,ge,le)&&(Be.uploaded=!1,Be.upload(X.context));for(let Ue in Be.instancesPerModel){let et=Be.instancesPerModel[Ue];et.features.length>0&&(Ue=Je.evaluate(et.features[0].feature,{}));let nt=he.getModel(Ue,le);if(nt&&nt.uploaded)for(let He of nt.nodes)yr(X,oe,He,et,Ge,Me,Ro)}}}(d,t,a,f,O.type==="vector"?a.scope:""),void A();if(!O.loaded())return;if(O.type==="batched-model")return function(X,ne,oe,ee){oe.resetLayerRenderingStats(X);let le=X.context,ae=X.transform,fe=X.style.fog,he=X.shadowRenderer;if(ae.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${ae.projection.name} projection is not yet implemented`);let pe=X.transform.getFreeCameraOptions().position,we=i.a6.vec3.scale([],[pe.x,pe.y,pe.z],X.transform.worldSize),ye=i.a6.vec3.negate([],we),ge=i.a6.mat4.identity([]),Me=i.de(ae.center.lat,ae.zoom),Be=i.a6.mat4.fromScaling([],[1,1,1/Me]);i.a6.mat4.translate(ge,ge,ye);let qe=oe.paint.get("model-opacity"),ze=new Dt(le.gl.LEQUAL,Dt.ReadWrite,X.depthRangeFor3D),Je=new Dt(le.gl.LEQUAL,Dt.ReadOnly,X.depthRangeFor3D),Se=new i.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ge=X.renderPass==="shadow",Ue=Ge&&he?he.getCurrentCascadeFrustum():ae.getFrustum(ae.scaleZoom(ae.worldSize)),et=oe.paint.get("model-front-cutoff"),nt=et[2]<1,He=ms(X,oe.paint.get("model-cutoff-fade-range")),Ye=oe.getLayerRenderingStats();(function(Et,rt,ft,Ot){let _t=Et.terrain?Et.terrain.exaggeration():0,Mt=Et.transform.zoom;for(let ln of Ot){let rn=rt.getTile(ln).getBucket(ft);rn&&(Et.conflationActive&&rn.updateReplacement(ln,Et.replacementSource),rn.evaluateScale(Et,ft),Et.terrain&&_t>0&&rn.elevationUpdate(Et.terrain,_t,ln,ft.source),rn.needsReEvaluation(Et,Mt,ft)&&rn.evaluate(ft))}})(X,ne,oe,ee),function(){let Et,rt,ft;nt?(Et=ee.length-1,rt=-1,ft=-1):(Et=0,rt=ee.length,ft=1);let Ot=new Float64Array(16),_t=i.a6.vec3.create(),Mt=new i.P(0,0);for(let ln=Et;ln!==rt;ln+=ft){let rn=ee[ln],jn=ne.getTile(rn).getBucket(oe);if(!jn||!jn.uploaded)continue;let Yn=!1;he&&(Yn=he.getMaxCascadeForTile(rn.toUnwrapped())===0);let oi=ae.calculatePosMatrix(rn.toUnwrapped(),ae.worldSize),ho=jn.modelTraits;!Ge&&nt&&(i.a6.mat4.invert(Ot,oi),i.a6.vec3.transformMat4(_t,we,Ot),Mt.x=_t[0],Mt.y=_t[1]);let Mi=[];for(let gn of jn.getNodesInfo()){if(gn.hiddenByReplacement||!gn.node.meshes)continue;let qn=gn.node,hi=0;X.terrain&&qn.elevation&&(hi=qn.elevation*X.terrain.exaggeration());let $n=(()=>{let ti=gn.aabb;return Se.min=[...ti.min],Se.max=[...ti.max],Se.min[2]+=hi,Se.max[2]+=hi,i.a6.vec3.transformMat4(Se.min,Se.min,oi),i.a6.vec3.transformMat4(Se.max,Se.max,oi),Se})(),on=gn.evaluatedScale;if(on[0]<=1&&on[1]<=1&&on[2]<=1&&$n.intersects(Ue)===0)continue;if(!Ge&&nt){let ti=.16666666666666666;gn.cameraCollisionOpacity=we[0]>$n.min[0]&&we[0]<$n.max[0]&&we[1]>$n.min[1]&&we[1]<$n.max[1]&&we[2]*Me<$n.max[2]&&qn.footprint&&i.bu(Mt,qn.footprint)?Math.max(gn.cameraCollisionOpacity-ti,0):Math.min(1,gn.cameraCollisionOpacity+ti)}let Mn=[...oi],kn=qn.anchor?qn.anchor[0]:0,bi=qn.anchor?qn.anchor[1]:0;i.a6.mat4.translate(Mn,Mn,[kn*(on[0]-1),bi*(on[1]-1),hi]),i.a6.vec3.exactEquals(on,i.dh)||i.a6.mat4.scale(Mn,Mn,on);let Si=i.a6.mat4.multiply([],Mn,qn.matrix),wn=i.a6.mat4.multiply([],ae.expandedFarZProjMatrix,Si),$i=i.a6.mat4.multiply([],ae.expandedFarZProjMatrix,Mn),Zi=i.a6.vec4.transformMat4([],[kn,bi,hi,1],wn)[2];qn.hidden=!1;let Gi=qe;Ge||(nt&&(Gi*=gn.cameraCollisionOpacity,Gi*=Dn(Mn,ae,gn.aabb,et)),Gi*=ai(He,Zi)),Gi!==0?Mi.push({nodeInfo:gn,depth:Zi,opacity:Gi,wvpForNode:wn,wvpForTile:$i,nodeModelMatrix:Si,tileModelMatrix:Mn}):qn.hidden=!0}Ge||Mi.sort((gn,qn)=>!nt||gn.opacity===1&&qn.opacity===1?gn.depth<qn.depth?-1:1:gn.opacity===1?-1:qn.opacity===1?1:gn.depth>qn.depth?-1:1);for(let gn of Mi){let qn=gn.nodeInfo,hi=qn.node,$n=i.a6.mat4.multiply([],Be,gn.tileModelMatrix);i.a6.mat4.multiply($n,ge,$n);let on=i.a6.mat4.invert([],$n);i.a6.mat4.transpose(on,on),i.a6.mat4.scale(on,on,mx),$n=i.a6.mat4.multiply($n,$n,hi.matrix);let Mn=X.renderPass==="light-beam",kn=ho&i.dj.HasMapboxMeshFeatures,bi=kn?0:qn.evaluatedRMEA[0][2];for(let Si=0;Si<hi.meshes.length;++Si){let wn=hi.meshes[Si],$i=Si===hi.lightMeshIndex,Zi=gn.wvpForNode;if($i){if(!Mn&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}Zi=gn.wvpForTile}else if(Mn)continue;let Gi={defines:[]},ti=[];if(Wh(Gi.defines,ti,wn,X,oe.lut),kn||Gi.defines.push("DIFFUSE_SHADED"),Yn&&Gi.defines.push("SHADOWS_SINGLE_CASCADE"),Ye&&(Ge?Ye.numRenderedVerticesInShadowPass+=wn.vertexArray.length:Ye.numRenderedVerticesInTransparentPass+=wn.vertexArray.length),Ge){Hl(wn,gn.nodeModelMatrix,X,oe);continue}let Ar=null;if(fe){let bs=qh(gn.nodeModelMatrix,X.transform);if(Ar=new Float32Array(bs),ae.projection.name!=="globe"){let ra=wn.aabb.min,Yo=wn.aabb.max,[Kl,Jl]=fe.getOpacityForBounds(bs,ra[0],ra[1],Yo[0],Yo[1]);Gi.overrideFog=Kl>=ht||Jl>=ht}}let Pr=wn.material,fo;Pr.occlusionTexture&&Pr.occlusionTexture.offsetScale&&(fo=Pr.occlusionTexture.offsetScale,Gi.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ge&&he&&(he.useNormalOffset=!!wn.normalBuffer);let eo=X.getOrCreateProgram("model",Gi);!Ge&&he&&he.setupShadowsFromMatrix(gn.tileModelMatrix,eo,he.useNormalOffset),X.uploadCommonUniforms(le,eo,null,Ar);let jr=Pr.pbrMetallicRoughness;jr.metallicFactor=.9,jr.roughnessFactor=.5;let po=mt(new Float32Array(Zi),new Float32Array($n),new Float32Array(on),new Float32Array(hi.matrix),X,gn.opacity,jr.baseColorFactor.toRenderColor(null),Pr.emissiveFactor,jr.metallicFactor,jr.roughnessFactor,Pr,bi,oe,[0,0,0],fo);!$i&&(qn.hasTranslucentParts||gn.opacity<1)&&eo.draw(X,le.gl.TRIANGLES,ze,qt.disabled,mn.disabled,kt.backCCW,po,oe.id,wn.vertexBuffer,wn.indexBuffer,wn.segments,oe.paint,X.transform.zoom,void 0,ti),eo.draw(X,le.gl.TRIANGLES,$i?Je:ze,qt.disabled,$i||gn.opacity<1||qn.hasTranslucentParts?mn.alphaBlended:mn.unblended,kt.backCCW,po,oe.id,wn.vertexBuffer,wn.indexBuffer,wn.segments,oe.paint,X.transform.zoom,void 0,ti)}}}}()}(d,t,a,f),void A();if(O.type!=="model")return;let L=O.getModels(),N=[],z=d.transform.getFreeCameraOptions().position,j=i.a6.vec3.scale([],[z.x,z.y,z.z],d.transform.worldSize);i.a6.vec3.negate(j,j);let q=[],W=[],Z=0;for(let X of L){let ne=a.paint.get("model-rotation").constantOr(null),oe=a.paint.get("model-scale").constantOr(null),ee=a.paint.get("model-translation").constantOr(null);X.computeModelMatrix(d,ne,oe,ee,!0,!0,!1);let le=i.a6.mat4.identity([]),ae=i.de(X.position.lat,d.transform.zoom),fe=i.a6.mat4.fromScaling([],[1,1,1/ae]);i.a6.mat4.translate(le,le,j),N.push({zScaleMatrix:fe,negCameraPosMatrix:le});for(let he of X.nodes)mu(d.transform,he,X.matrix,d.transform.expandedFarZProjMatrix,Z,q,W);Z++}if(q.sort((X,ne)=>ne.depth-X.depth),d.renderPass!=="shadow"){if(g===1)for(let X of W)pu(X,d,a,N[X.modelIndex],qt.disabled,d.colorModeForRenderPass());else{for(let X of W)pu(X,d,a,N[X.modelIndex],qt.disabled,mn.disabled);for(let X of W)pu(X,d,a,N[X.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let X of q)pu(X,d,a,N[X.modelIndex],qt.disabled,d.colorModeForRenderPass());A()}else{for(let X of W)Hl(X.mesh,X.nodeModelMatrix,d,a);for(let X of q)Hl(X.mesh,X.nodeModelMatrix,d,a);A()}}},Xh={model:function(d,t,a){let f=t.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;let g=f.getModels();for(let v of g)v.upload(a.context)},raster:function(d,t,a){let f=t.getSource();if(!(f instanceof gl&&f.loaded()))return;let g=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=d.paint.get("raster-array-band")||f.getInitialBand(g);if(v==null)return;let b=t.getIds().map(M=>t.getTileByID(M));for(let M of b)M.updateNeeded(g,v)&&f.prepareTile(M,g,v)},"raster-particle":function(d,t,a){let f=t.getSource();if(!(f instanceof gl&&f.loaded()))return;let g=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=d.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(v==null)return;let b=t.getIds().map(M=>t.getTileByID(M));for(let M of b)M.updateNeeded(g,v)&&f.prepareTile(M,g,v)}};class dp{constructor(t,a,f,g){this.context=new lx(t,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let M of v)this._debugParams.enabledLayers[M]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let M of v)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new Zh(g),this.setup(),this.numSublayers=Nr.maxUnderzooming+Nr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new bg(this),this._wireframeDebugCache=new Qs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let b=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,b,t.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(t,a){let f=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yf(this,t));let g=this._terrain;this.transform.elevation=f?g:null,g.update(t,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){let a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,g]=a.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);let v=f+.78*(g-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Yf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*i.q.devicePixelRatio,this.height=a*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let t=this.context,a=new i.a_;a.emplaceBack(0,0),a.emplaceBack(i.ab,0),a.emplaceBack(0,i.ab),a.emplaceBack(i.ab,i.ab),this.tileExtentBuffer=t.createVertexBuffer(a,i.b0.members),this.tileExtentSegments=i.b1.simpleSegment(0,0,4,2);let f=new i.a_;f.emplaceBack(0,0),f.emplaceBack(i.ab,0),f.emplaceBack(0,i.ab),f.emplaceBack(i.ab,i.ab),this.debugBuffer=t.createVertexBuffer(f,i.b0.members),this.debugSegments=i.b1.simpleSegment(0,0,4,5);let g=new i.a_;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,i.b0.members),this.viewportSegments=i.b1.simpleSegment(0,0,4,2);let v=new i.aN;v.emplaceBack(0,0,0,0),v.emplaceBack(i.ab,0,i.ab,0),v.emplaceBack(0,i.ab,0,i.ab),v.emplaceBack(i.ab,i.ab,i.ab,i.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(v,i.b3.members),this.mercatorBoundsSegments=i.b1.simpleSegment(0,0,4,2);let b=new i.aO;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);let M=new i.a$;for(let O of[0,1,3,2,0])M.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new i.T(t,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.a6.mat4.create();let A=this.context.gl;this.stencilClearMode=new qt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Dt.disabled,this.stencilClearMode,mn.disabled,kt.disabled,au(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,f){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(let A of f)if(this._tileClippingMaskIDs[A.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=a.id;let g=this.context,v=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(mn.disabled),g.setDepthMode(Dt.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let M of f){let A=a.getTile(M),O=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:z}=this.getTileBoundsBuffers(A);b.draw(this,v.TRIANGLES,Dt.disabled,new qt({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),mn.disabled,kt.disabled,au(M.projMatrix),"$clipping",L,N,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,a=this.context.gl;return new qt({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let a=this.context.gl;return new qt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){let a=this.context.gl,f=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),g=f[f.length-1].overscaledZ,v=f[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let b={};for(let M=0;M<v;M++)b[M+g]=new qt({func:a.GEQUAL,mask:255},M+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[b,f]}return[{[g]:qt.disabled},f]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new mn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}colorModeForDrapableLayerRenderPass(t){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new mn([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new i.bz(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,f,g=!1){if(this.depthOcclusion)return new Dt(this.context.gl.GREATER,Dt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Dt.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(f||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new Bh(this.context,a,f,!1,"texture"),this.depthTexture=new i.T(this.context,{width:a,height:f,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,f,0,0,a,f,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){let f=i.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;let g=this.style._mergedLayers,v=this.style.order.filter(ye=>{let ge=g[ye];return!(ge.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ge.type]}),b=!1,M=!1;for(let ye of v){let ge=g[ye];ge.type==="circle"&&(b=!0),ge.type==="symbol"&&(ge.hasInitialOcclusionOpacityProperties?M=!0:b=!0)}let A=v.map(ye=>g[ye]),O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let L=0,N=!1;for(let ye in O){let ge=O[ye];ge.used&&(ge.prepare(this.context),ge.getSource().usedInConflation&&++L)}let z=!1;for(let ye of A)ye.isHidden(this.transform.zoom)||(ye.type==="clip"&&(z=!0),this.prepareLayer(ye));let j={},q={},W={},Z={},X={};for(let ye in O){let ge=O[ye];j[ye]=ge.getVisibleCoordinates(),q[ye]=j[ye].slice().reverse(),W[ye]=ge.getVisibleCoordinates(!0).reverse(),Z[ye]=ge.getShadowCasterCoordinates(),X[ye]=ge.sortCoordinatesByDistance(j[ye])}let ne=ye=>{let ge=this.style.getLayerSourceCache(ye);return ge&&ge.used?ge.getSource():null};if(L||z||this._clippingActiveLastFrame){let ye=[],ge=[],Me=0;for(let Be of A)this.isSourceForClippingOrConflation(Be,ne(Be))&&(ye.push(Be),ge.push(Me)),Me++;if(ye&&(z||ye.length>1)||this._clippingActiveLastFrame){z=!1;let Be=[];for(let qe=0;qe<ye.length;qe++){let ze=ye[qe],Je=ge[qe],Se=this.style.getLayerSourceCache(ze);if(!Se||!Se.used||!Se.getSource().usedInConflation&&ze.type!=="clip")continue;let Ge=i.dn,Ue=i.bs.None,et=[],nt=!0;if(ze.type==="clip"){Ge=Je;for(let He of ze.layout.get("clip-layer-types"))Ue|=He==="model"?i.bs.Model:He==="symbol"?i.bs.Symbol:i.bs.FillExtrusion;for(let He of ze.layout.get("clip-layer-scope"))et.push(He);ze.isHidden(this.transform.zoom)?nt=!1:z=!0}nt&&Be.push({layer:ze.fqid,cache:Se,order:Ge,clipMask:Ue,clipScope:et})}this.replacementSource.setSources(Be),N=!0}}this._clippingActiveLastFrame=z,N||this.replacementSource.clear(),this.conflationActive=N,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ye=0;ye<A.length;ye++){let ge=A[ye],Me=ge.cutoffRange();if(this.longestCutoffRange=Math.max(Me,this.longestCutoffRange),Me>0){let Be=ne(ge);Be&&(this.minCutoffZoom=Math.max(Be.minzoom,this.minCutoffZoom)),ge.minzoom&&(this.minCutoffZoom=Math.max(ge.minzoom,this.minCutoffZoom))}ge.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ye),this._lastOcclusionLayer=ye)}let oe=this.style&&this.style.fog;oe?(this._fogVisible=oe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=oe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(W),this.opaquePassCutoff=0);let ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(let ye in O)for(let ge of j[ye]){let Me={min:0,max:0};this.terrain&&(Me=this.terrain.getMinMaxForTile(ge)||Me),ee.addShadowReceiver(ge.toUnwrapped(),Me.min,Me.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Hh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!cs.has(this.context.gl))return;this.renderPass="offscreen";for(let ye of A){let ge=t.getLayerSourceCache(ye);if(!ye.hasOffscreenPass()||ye.isHidden(this.transform.zoom))continue;let Me=ge?q[ge.id]:void 0;(ye.type==="custom"||ye.type==="raster"||ye.type==="raster-particle"||ye.isSky()||Me&&Me.length)&&this.renderLayer(this,ge,ye,Me)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let le=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ae=(()=>{if(a.showOverdrawInspector)return i.bz.black;let ye=this.style.fog;if(ye&&this.transform.projection.supportsFog){let ge=this.style.getLut(ye.scope);if(!le){let Me=ye.properties.get("color").toRenderColor(ge).toArray01();return new i.bz(...Me)}if(le){let Me=ye.properties.get("space-color").toRenderColor(ge).toArray01();return new i.bz(...Me)}}return i.bz.transparent})();if(this.context.clear({color:ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&le&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){let ye=A[this.currentLayer],ge=t.getLayerSourceCache(ye);if(ye.isSky())continue;let Me=ge?(ye.is3D()?X:q)[ge.id]:void 0;this._renderTileClippingMasks(ye,ge,Me),this.renderLayer(this,ge,ye,Me)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&le&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){let ye=A[this.currentLayer],ge=t.getLayerSourceCache(ye);ye.isSky()&&this.renderLayer(this,ge,ye,ge?q[ge.id]:void 0)}function fe(ye,ge){let Me;return ge&&(Me=(ye.type==="symbol"?W:ye.is3D()?X:q)[ge.id]),Me}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){let ye=A[this.currentLayer];if(ye.type==="raster"||ye.type==="raster-particle"){let ge=t.getLayerSourceCache(ye);this.renderLayer(this,ge,ye,fe(ye,ge))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let he=0;ee&&(he=ee.getShadowCastingLayerCount());let pe=!1,we=-1;for(let ye=0;ye<v.length;++ye){let ge=A[ye];ge.isHidden(this.transform.zoom)||ge.is3D()&&(we=ye)}for(M&&we===-1&&(b=!0);this.currentLayer<v.length;){let ye=A[this.currentLayer],ge=t.getLayerSourceCache(ye);if(ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ye)){if(ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(b&&!pe&&this.terrain&&!this.transform.isOrthographic&&(pe=!0,this.blitDepth()),M&&we!==-1&&this.currentLayer===we+1&&!this.transform.isOrthographic&&this.blitDepth(),ye.is3D()||this.terrain||this._renderTileClippingMasks(ye,ge,ge?j[ge.id]:void 0),this.renderLayer(this,ge,ye,fe(ye,ge)),!this.terrain&&ee&&he>0&&ye.hasShadowPass()&&--he==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Me=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Me;this.currentLayer++){let Be=A[this.currentLayer];if(!Be.hasLightBeamPass())continue;let qe=t.getLayerSourceCache(Be);this.renderLayer(this,qe,Be,qe?q[qe.id]:void 0)}this.currentLayer=Me,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Me=this.currentLayer;this.depthOcclusion=!0;for(let Be of this.layersWithOcclusionOpacity){this.currentLayer=Be;let qe=A[this.currentLayer],ze=t.getLayerSourceCache(qe),Je=ze?q[ze.id]:void 0;qe.is3D()||this.terrain||this._renderTileClippingMasks(qe,ze,ze?j[ze.id]:void 0),this.renderLayer(this,ze,qe,Je)}this.depthOcclusion=!1,this.currentLayer=Me,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ye=null;A.forEach(ge=>{let Me=t.getLayerSourceCache(ge);Me&&!ge.isHidden(this.transform.zoom)&&Me.getVisibleCoordinates().length&&(!ye||ye.getSource().maxzoom<Me.getSource().maxzoom)&&(ye=Me)}),ye&&this.options.showTileBoundaries&&ea.debug(this,ye,ye.getVisibleCoordinates(),i.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ea.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ye){let ge=ye.transform.padding;ui(ye,ye.transform.height-(ge.top||0),3,hx),ui(ye,ge.bottom||0,3,Ul),Re(ye,ge.left||0,3,$l),Re(ye,ye.transform.width-(ge.right||0),3,it);let Me=ye.transform.centerPoint;(function(Be,qe,ze,Je){fu(Be,qe-1,ze-10,2,20,Je),fu(Be,qe-10,ze-1,20,2,Je)})(ye,Me.x,ye.transform.height-Me.y,Tt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),N||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(t.type);if(Xh[t.type]&&(f||this.terrain&&t.type==="custom")){let g=this.style.getLayerSourceCache(t);Xh[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,a,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(f.type)&&(!t.terrain||f.type!=="custom")||f.type==="clip"||ea[f.type](t,a,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,f=this.context.gl,g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(t.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let a={};for(let f in t){let g=t[f],v=this.context.extTimerQuery,b=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),a[f]=b}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,f=this.context.gl,g=0;for(let v of t)g+=a.getQueryParameter(v,f.QUERY_RESULT)/1e6,a.deleteQueryEXT(v);return g}translatePosMatrix(t,a,f,g,v){if(!f[0]&&!f[1])return t;let b=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){let O=Math.sin(b),L=Math.cos(b);f=[f[0]*L-f[1]*O,f[0]*O+f[1]*L]}let M=[v?f[0]:i.ak(a,f[0],this.transform.zoom),v?f[1]:i.ak(a,f[1],this.transform.zoom),0],A=new Float32Array(16);return i.a6.mat4.translate(A,t,M),A}saveTileTexture(t){let a=t.size[0],f=this._tileTextures[a];f?f.push(t):this._tileTextures[a]=[t]}getTileTexture(t){let a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,f){let g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||v.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?v.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):v.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||v.push("FOG","FOG_DITHERING"),g&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,a){this.cache=this.cache||{};let f=a&&a.defines||[],g=a&&a.config,v=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(f),b=Ys.cacheKey(Zs[t],t,v,g);return this.cache[b]||(this.cache[b]=new Ys(this.context,t,Zs[t],g,Jg[t],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){let f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){let v=((b,M,A)=>{let O=b.properties.get("direction"),L=b.properties.get("color").toRenderColor(A.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),z=M.properties.get("color").toRenderColor(A.getLut(M.scope)).toArray01(),j=M.properties.get("intensity"),q=[O.x,O.y,O.z],W=i.cH(z,j),Z=i.cH(L,N);return{u_lighting_ambient_color:W,u_lighting_directional_dir:q,u_lighting_directional_color:Z,u_ground_radiance:Kf(q,Z,W)}})(f,g,this.style);a.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,a,f,g,v){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let M=b.getOpacity(this.transform.pitch),A=((O,L,N,z,j,q,W,Z,X,ne,oe,ee)=>{let le=O.transform,ae=L.properties.get("color").toRenderColor(O.style.getLut(L.scope)).toArray01();ae[3]=z;let fe=O.frameCounter/1e3%1,[he,pe]=L.properties.get("vertical-range");return{u_fog_matrix:N?le.calculateFogTileMatrix(N):ee||O.identityMat,u_fog_range:L.getFovAdjustedRange(le._fov),u_fog_color:ae,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,pe),pe],u_fog_temporal_offset:fe,u_frustum_tl:j,u_frustum_tr:q,u_frustum_br:W,u_frustum_bl:Z,u_globe_pos:X,u_globe_radius:ne,u_viewport:oe,u_globe_transition:i.a9(le.zoom),u_is_globe:+(le.projection.name==="globe")}})(this,b,f,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],g);a.setFogUniformValues(t,A)}v&&a.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let g of f)a[g.key]=t[g.key]||new $o(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=ht||a[1]>=ht}setupDepthForOcclusion(t,a,f){let g=this.context,v=g.gl,b=!!f;var M;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE0),b||a.setTerrainUniformValues(g,f)}}function _s(d,t){let a=!1,f=null,g=()=>{f=null,a&&(d(),f=setTimeout(g,t),a=!1)};return()=>(a=!0,f||g(),f)}class ta{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_s(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let a=ys(t);if(this._hashName){let f=this._hashName,g=!1,v=location.hash.slice(1).split("&").map(b=>{let M=b.split("=")[0];return M===f?(g=!0,`${M}=${a}`):b}).filter(b=>b);return g||v.push(`${f}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){let f=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ys(d,t){let a=d.getCenter(),f=Math.round(100*d.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),b=Math.round(a.lng*v)/v,M=Math.round(a.lat*v)/v,A=d.getBearing(),O=d.getPitch(),L=t?`/${b}/${M}/${f}`:`${f}/${M}/${b}`;return(A||O)&&(L+="/"+Math.round(10*A)/10),O&&(L+=`/${Math.round(O)}`),L}let Ba={linearity:.3,easing:i.dp(0,0,.3,1)},Yh=i.l({deceleration:2500,maxSpeed:1400},Ba),fp=i.l({deceleration:20,maxSpeed:1400},Ba),pp=i.l({deceleration:1e3,maxSpeed:360},Ba),mp=i.l({deceleration:1e3,maxSpeed:90},Ba);class na{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,a=i.q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){let v=Va(a.pan.mag(),f,i.l({},Yh,t||{}));g.offset=a.pan.mult(v.amount/a.pan.mag()),g.center=this._map.transform.center,ql(g,v)}if(a.zoom){let v=Va(a.zoom,f,fp);g.zoom=this._map.transform.zoom+v.amount,ql(g,v)}if(a.bearing){let v=Va(a.bearing,f,pp);g.bearing=this._map.transform.bearing+i.ap(v.amount,-179,179),ql(g,v)}if(a.pitch){let v=Va(a.pitch,f,mp);g.pitch=this._map.transform.pitch+v.amount,ql(g,v)}if(g.zoom||g.bearing){let v=a.pinchAround===void 0?a.around:a.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function ql(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Va(d,t,a){let{maxSpeed:f,linearity:g,deceleration:v}=a,b=i.ap(d*g/(t/1e3),-f,f),M=Math.abs(b)/(v*g);return{easing:a.easing,duration:1e3*M,amount:b*(M/2)}}class Sr extends i.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,f,g={}){let v=zi(a.getCanvasContainer(),f),b=a.unproject(v);super(t,i.l({point:v,lngLat:b,originalEvent:f},g)),this._defaultPrevented=!1,this.target=a}}class Wl extends i.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,f){let g=t==="touchend"?f.changedTouches:f.touches,v=Er(a.getCanvasContainer(),g),b=v.map(A=>a.unproject(A)),M=v.reduce((A,O,L,N)=>A.add(O.div(N.length)),new i.P(0,0));super(t,{points:v,point:M,lngLats:b,lngLat:a.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class rr extends i.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class gp{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new rr(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Sr(t.type,this._map,t))}mouseup(t){this._map.fire(new Sr(t.type,this._map,t))}preclick(t){let a=i.l({},t);a.type="preclick",this._map.fire(new Sr(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Sr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Sr(t.type,this._map,t))}mouseover(t){this._map.fire(new Sr(t.type,this._map,t))}mouseout(t){this._map.fire(new Sr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Wl(t.type,this._map,t))}touchmove(t){this._map.fire(new Wl(t.type,this._map,t))}touchend(t){this._map.fire(new Wl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Wl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _p{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Sr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Sr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(an(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;let f=a,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let b=Math.min(g.x,f.x),M=Math.max(g.x,f.x),A=Math.min(g.y,f.y),O=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=M-b+"px",this._box.style.height=O-A+"px")})}mouseupWindow(t,a){if(!this._active)return;let f=this._startPos,g=a;if(f&&t.button===0){if(this.reset(),At(),f.x!==g.x||f.y!==g.y)return this._map.fire(new i.x("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Zn(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new i.x(t,{originalEvent:a}))}}function vs(d,t){let a={};for(let f=0;f<d.length;f++)a[d[f].identifier]=t[f];return a}class yp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){let v=new i.P(0,0);for(let b of g)v._add(b);return v.div(g.length)}(a),this.touches=vs(f,a)))}touchmove(t,a,f){if(this.aborted||!this.centroid)return;let g=vs(f,a);for(let v in this.touches){let b=g[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class _u{constructor(t){this.singleTap=new yp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,f){this.singleTap.touchstart(t,a,f)}touchmove(t,a,f){this.singleTap.touchmove(t,a,f)}touchend(t,a,f){let g=this.singleTap.touchend(t,a,f);if(g){let v=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(v&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class vp{constructor(){this._zoomIn=new _u({numTouches:1,numTaps:2}),this._zoomOut=new _u({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,f){this._zoomIn.touchstart(t,a,f),this._zoomOut.touchstart(t,a,f)}touchmove(t,a,f){this._zoomIn.touchmove(t,a,f),this._zoomOut.touchmove(t,a,f)}touchend(t,a,f){let g=this._zoomIn.touchend(t,a,f),v=this._zoomOut.touchend(t,a,f);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let yu={0:1,2:2};class vu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;let f=Ft(t);this._correctButton(t,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(t,a){let f=this._lastPoint;if(f){if(t.preventDefault(),this._eventButton!=null&&function(g,v){let b=yu[v];return g.buttons===void 0||(g.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(t){this._lastPoint&&Ft(t)===this._eventButton&&(this._moved&&At(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kh extends vu{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Jh extends vu{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){let f=.8*(a.x-t.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(t){t.preventDefault()}}class Qh extends vu{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){let f=-.5*(a.y-t.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(t){t.preventDefault()}}class s_{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),i.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,a,f){return this._calculateTransform(t,a,f)}touchmove(t,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,f)}}touchend(t,a,f){this._calculateTransform(t,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,f){f.length>0&&(this._active=!0);let g=vs(f,a),v=new i.P(0,0),b=new i.P(0,0),M=0;for(let O in g){let L=g[O],N=this._touches[O];N&&(v._add(L),b._add(L.sub(N)),M++,g[O]=L)}if(this._touches=g,M<this._minTouches||!b.mag())return;let A=b.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ed{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,f){return{}}touchstart(t,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,f){let g=this._firstTwoTouches;if(!g)return;t.preventDefault();let[v,b]=g,M=xu(f,a,v),A=xu(f,a,b);if(!M||!A)return;let O=this._aroundCenter?null:M.add(A).div(2);return this._move([M,A],O,t)}touchend(t,a,f){if(!this._firstTwoTouches)return;let[g,v]=this._firstTwoTouches,b=xu(f,a,g),M=xu(f,a,v);b&&M||(this._active&&At(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xu(d,t,a){for(let f=0;f<d.length;f++)if(d[f].identifier===a)return t[f]}function xp(d,t){return Math.log(d/t)/Math.LN2}class a_ extends ed{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){let f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xp(this._distance,f),pinchAround:a}}}function bp(d,t){return 180*d.angleWith(t)/Math.PI}class l_ extends ed{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){let f=this._vector;if(this._vector=t[0].sub(t[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bp(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let g=bp(t,f);return Math.abs(g)<a}}function td(d){return Math.abs(d.y)>Math.abs(d.x)}class c_ extends ed{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,td(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,f){let g=this._lastPoints;if(!g)return;let v=t[0].sub(g[0]),b=t[1].sub(g[1]);return this._map._cooperativeGestures&&!i.dq()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(t,a,f){if(this._valid!==void 0)return this._valid;let g=t.mag()>=2,v=a.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let b=t.y>0==a.y>0;return td(t)&&td(a)&&b}}let u_={panStep:100,bearingStep:15,pitchStep:10};class h_{constructor(){let t=u_;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,f=0,g=0,v=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:M=>{let A=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:d_,zoom:a?Math.round(A)+a*(t.shiftKey?2:1):A,bearing:M.getBearing()+f*this._bearingStep,pitch:M.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function d_(d){return d*(2-d)}let wp=4.000244140625,gx=1/450;class _x{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gx,i.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,f=i.q.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%wp==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=zi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>wp?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&L!==0&&(L=1/L);let N=a(),z=Math.pow(2,N),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*L))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,v=this._easing,b,M=!1;if(this._type==="wheel"&&g&&v){let O=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),L=v(O);b=i.aa(g,f,L),O<1?this._frameId||(this._frameId=!0):M=!0}else b=f,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-a();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=i.dr;if(this._prevEase){let f=this._prevEase,g=(i.q.now()-f.start)/f.duration,v=f.easing(g+.01)-f.easing(g),b=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-b*b);a=i.dp(b,M,.25,1)}return this._prevEase={start:i.q.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class xi{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class f_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(t.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yx{constructor(){this._tap=new _u({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,f){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(t,a,f))}touchmove(t,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let g=a[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,f)}touchend(t,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(t,a,f)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vx{constructor(t,a,f){this._el=t,this._mousePan=a,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bu{constructor(t,a,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class p_{constructor(t,a,f,g){this._el=t,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Xl=d=>d.zoom||d.drag||d.pitch||d.rotate;class nd extends i.x{}class xs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){let f=i.a6.vec3.sub([],a,t);this.radius=i.a6.vec3.length(f[2]<0?i.a6.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(t){i.a6.vec3.div(t,t,this.constants),i.a6.vec3.normalize(t,t),i.a6.vec3.mul(t,t,this.constants);let a=i.a6.vec3.scale([],t,this.radius);if(a[2]>0){let f=i.a6.vec3.scale([],[0,0,1],i.a6.vec3.dot(a,[0,0,1])),g=i.a6.vec3.scale([],i.a6.vec3.normalize([],[a[0],a[1],0]),this.radius),v=i.a6.vec3.add([],a,i.a6.vec3.scale([],i.a6.vec3.sub([],i.a6.vec3.add([],g,f),a),2));a[0]=v[0],a[1]=v[1]}return a}}function ja(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class vr{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new na(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),i.aJ(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,v,b]of this._listeners){let M=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,M,b)}}destroy(){for(let[t,a,f]of this._listeners){let g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,g,f)}}_addDefaultHandlers(t){let a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new gp(a,t));let g=a.boxZoom=new Zl(a,t);this._add("boxZoom",g);let v=new vp,b=new f_;a.doubleClickZoom=new xi(b,v),this._add("tapZoom",v),this._add("clickZoom",b);let M=new yx;this._add("tapDragZoom",M);let A=a.touchPitch=new c_(a);this._add("touchPitch",A);let O=new Jh(t),L=new Qh(t);a.dragRotate=new bu(t,O,L),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let N=new Kh(t),z=new s_(a,t);a.dragPan=new vx(f,N,z),this._add("mousePan",N),this._add("touchPan",z,["touchZoom","touchRotate"]);let j=new l_,q=new a_;a.touchZoomRotate=new p_(f,q,j,M),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _p(a));let W=a.scrollZoom=new _x(a,this);this._add("scrollZoom",W,["mousePan"]);let Z=a.keyboard=new h_;this._add("keyboard",Z);for(let X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&a[X].enable(t[X])}_add(t,a,f){this._handlers.push({handlerName:t,handler:a,allowed:f}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,f){for(let g in t)if(g!==f&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let a=[];for(let f of t)this._el.contains(f.target)&&a.push(f);return a}handleEvent(t,a){this._updatingCamera=!0;let f=t.type==="renderFrame",g=f?void 0:t,v={needsRenderFrame:!1},b={},M={},A=t.touches?this._getMapTouches(t.touches):void 0,O=A?Er(this._el,A):f?void 0:zi(this._el,t);for(let{handlerName:z,handler:j,allowed:q}of this._handlers){if(!j.isEnabled())continue;let W;this._blockedByActive(M,q,z)?j.reset():j[a||t.type]&&(W=j[a||t.type](t,O,A),this.mergeHandlerResult(v,b,W,z,g),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||j.isActive())&&(M[z]=j)}let L={};for(let z in this._previousActiveHandlers)M[z]||(L[z]=g);this._previousActiveHandlers=M,(Object.keys(L).length||ja(v))&&(this._changes.push([v,b,L]),this._triggerRenderFrame()),(Object.keys(M).length||ja(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(t,a,f,g,v){if(!f)return;i.l(t,f);let b={handlerName:g,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(a.zoom=b),f.panDelta!==void 0&&(a.drag=b),f.pitchDelta!==void 0&&(a.pitch=b),f.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){let t={},a={},f={};for(let[g,v,b]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),i.l(a,v),i.l(f,b);this._updateMapTransform(t,a,f),this._changes=[]}_updateMapTransform(t,a,f){let g=this._map,v=g.transform,b=ne=>[ne.x,ne.y,ne.z];if((ne=>{let oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!ja(t)){let ne=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ne!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!ja(t))return void this._fireEvents(a,f,!0);let{panDelta:M,zoomDelta:A,bearingDelta:O,pitchDelta:L,around:N,aroundCoord:z,pinchAround:j}=t;v._isCameraConstrained&&(A>0&&(A=0),v._isCameraConstrained=!1),j!==void 0&&(N=j),(A||(ne=>a[ne]&&!this._eventsInProgress[ne])("drag"))&&N&&(this._dragOrigin=b(v.pointCoordinate3D(N)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),N=N||g.transform.centerPoint,O&&(v.bearing+=O),L&&(v.pitch+=L),v._updateCameraState();let q=[0,0,0];if(M)if(v.projection.name==="mercator"){let ne=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N).dir),oe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N.sub(M)).dir);q[0]=oe[0]-ne[0],q[1]=oe[1]-ne[1]}else{let ne=v.pointCoordinate(N);if(v.projection.name==="globe"){M=M.rotate(-v.angle);let oe=v._pixelsPerMercatorPixel/v.worldSize;q[0]=-M.x*i.ds(i.aM(ne.y))*oe,q[1]=-M.y*i.ds(v.center.lat)*oe}else{let oe=v.pointCoordinate(N.sub(M));ne&&oe&&(q[0]=oe.x-ne.x,q[1]=oe.y-ne.y)}}let W=v.zoom,Z=[0,0,0];if(A){let ne=b(z||v.pointCoordinate3D(N)),oe={dir:i.a6.vec3.normalize([],i.a6.vec3.sub([],ne,v._camera.position))};if(oe.dir[2]<0){let ee=v.zoomDeltaToMovement(ne,A);i.a6.vec3.scale(Z,oe.dir,ee)}}let X=i.a6.vec3.add(q,q,Z);v._translateCameraConstrained(X),A&&Math.abs(v.zoom-W)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,f,!0)}_fireEvents(t,a,f){let g=Xl(this._eventsInProgress),v=Xl(t),b={};for(let L in t){let{originalEvent:N}=t[L];this._eventsInProgress[L]||(b[`${L}start`]=N),this._eventsInProgress[L]=t[L]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(let L in b)this._fireEvent(L,b[L]);v&&this._fireEvent("move",v.originalEvent);for(let L in t){let{originalEvent:N}=t[L];this._fireEvent(L,N)}let M={},A;for(let L in this._eventsInProgress){let{handlerName:N,originalEvent:z}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],A=a[N]||z,M[`${L}end`]=A)}for(let L in M)this._fireEvent(L,M[L]);let O=Xl(this._eventsInProgress);if(f&&(g||v)&&!O){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new i.x("moveend",{originalEvent:A})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new i.x(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new nd("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Wo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Tp extends i.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,i.aJ(["_renderFrameCallback"],this)}getCenter(){return new i.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,f){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,i.l({offset:t},a),f)}panTo(t,a,f){return this.easeTo(i.l({center:t},a),f)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,f){return this.easeTo(i.l({zoom:t},a),f)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,f){return this.easeTo(i.l({bearing:t},a),f)}resetNorth(t,a){return this.rotateTo(0,i.l({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=i.as.convert(t);let f=a&&a.bearing||0,g=a&&a.pitch||0,v=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,v,b,f,g,a)}_extendPadding(t){let a={top:0,right:0,bottom:0,left:0};return t==null?i.l({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:i.l({},a,t)}_extendCameraOptions(t){return(t=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){let f=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return f/g>t.aspect?f/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,f,g,v,b){let M=t.clone(),A=this._extendCameraOptions(b);M.bearing=g,M.pitch=v;let O=i.bK.convert(a),L=i.bK.convert(f),N=.5*(O.lat+L.lat),z=.5*(O.lng+L.lng),j=i.dt(N,z),q=i.a6.vec3.normalize([],j),W=i.a6.vec3.normalize([],i.a6.vec3.cross([],q,[0,1,0])),Z=i.a6.vec3.cross([],W,q),X=[W[0],W[1],W[2],0,Z[0],Z[1],Z[2],0,q[0],q[1],q[2],0,0,0,0,1],ne=[j,i.dt(O.lat,O.lng),i.dt(L.lat,O.lng),i.dt(L.lat,L.lng),i.dt(O.lat,L.lng),i.dt(N,O.lng),i.dt(N,L.lng),i.dt(O.lat,z),i.dt(L.lat,z)],oe=i.c9.fromPoints(ne.map(Ue=>[i.a6.vec3.dot(W,Ue),i.a6.vec3.dot(Z,Ue),i.a6.vec3.dot(q,Ue)])),ee=i.a6.vec3.transformMat4([],oe.center,X);i.a6.vec3.squaredLength(ee)===0&&i.a6.vec3.set(ee,0,0,1),i.a6.vec3.normalize(ee,ee),i.a6.vec3.scale(ee,ee,i.aq),M.center=i.du(ee);let le=M.getWorldToCameraMatrix(),ae=i.a6.mat4.invert(new Float64Array(16),le);oe=i.c9.applyTransform(oe,i.a6.mat4.multiply([],le,X));let fe=this._extendAABB(oe,M,A,g);if(!fe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=fe,i.a6.vec3.transformMat4(ee,ee,le);let he=.5*(oe.max[2]-oe.min[2]),pe=this._minimumAABBFrustumDistance(M,oe),we=i.a6.vec3.scale([],[0,0,1],he),ye=i.a6.vec3.add(we,ee,we),ge=pe+(M.pitch===0?0:i.a6.vec3.distance(ee,ye)),Me=M.globeCenterInViewSpace,Be=i.a6.vec3.sub([],ee,[Me[0],Me[1],Me[2]]);i.a6.vec3.normalize(Be,Be),i.a6.vec3.scale(Be,Be,ge);let qe=i.a6.vec3.add([],ee,Be);i.a6.vec3.transformMat4(qe,qe,ae);let ze=i.dw/i.aq,Je=i.a6.vec3.length(qe),Se=i.bD(Math.max(Je*ze-i.dw,Number.EPSILON),0),Ge=Math.min(M.zoomFromMercatorZAdjusted(Se),A.maxZoom);return Ge>.5*(i.c2+i.bU)?(M.setProjection({name:"mercator"}),M.zoom=Ge,this._cameraForBounds(M,a,f,g,v,b)):{center:M.center,zoom:Ge,bearing:g,pitch:v}}_extendAABB(t,a,f,g){let v=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),M=b,A=v,O=v,L=b,N=a.width-(A+O),z=a.height-(M+L),j=i.a6.vec3.sub([],t.max,t.min),q=Math.min(N/j[0],z/j[1]),W=Math.min(a.scaleZoom(a.scale*q),f.maxZoom);if(isNaN(W))return null;let Z=a.scale/a.zoomScale(W),X=new i.c9([t.min[0]-A*Z,t.min[1]-L*Z,t.min[2]],[t.max[0]+O*Z,t.max[1]+M*Z,t.max[2]]),ne=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new i.P(f.offset.x,f.offset.y):i.P.convert(f.offset)).rotate(-i.bB(g));return X.center[0]-=ne.x*Z,X.center[1]+=ne.y*Z,X}queryTerrainElevation(t,a){let f=this.transform.elevation;return f?(a=i.l({},{exaggerated:!0},a),f.getAtPoint(i.a5.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,f,g,v,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,f,g,v,b);let M=t.clone(),A=this._extendCameraOptions(b);M.bearing=g,M.pitch=v;let O=i.bK.convert(a),L=i.bK.convert(f),N=new i.bK(O.lng,L.lat),z=new i.bK(L.lng,O.lat),j=M.project(O),q=M.project(L),W=this.queryTerrainElevation(O),Z=this.queryTerrainElevation(L),X=this.queryTerrainElevation(N),ne=this.queryTerrainElevation(z),oe=[[j.x,j.y,Math.min(W||0,Z||0,X||0,ne||0)],[q.x,q.y,Math.max(W||0,Z||0,X||0,ne||0)]],ee=i.c9.fromPoints(oe),le=M.getWorldToCameraMatrix(),ae=i.a6.mat4.invert(new Float64Array(16),le);ee=i.c9.applyTransform(ee,le);let fe=this._extendAABB(ee,M,A,g);if(!fe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=fe;let he=.5*i.a6.vec3.sub([],ee.max,ee.min)[2],pe=this._minimumAABBFrustumDistance(M,ee),we=[0,0,1,0];i.a6.vec4.transformMat4(we,we,le),i.a6.vec4.normalize(we,we);let ye=i.a6.vec3.scale([],we,pe+he),ge=i.a6.vec3.add([],ee.center,ye);i.a6.vec3.transformMat4(ee.center,ee.center,ae),i.a6.vec3.transformMat4(ge,ge,ae);let Me=M.unproject(new i.P(ee.center[0],ee.center[1])),Be=i.dv(M.projection,Me),qe=Math.pow(2,Be),ze=Math.min(M._zoomFromMercatorZ(ge[2]*M.pixelsPerMeter*qe/M.worldSize),A.maxZoom);return M.mercatorFromTransition&&ze<.5*(i.c2+i.bU)?(M.setProjection({name:"globe"}),M.zoom=ze,this._cameraForBounds(M,a,f,g,v,b)):{center:Me,zoom:ze,bearing:g,pitch:v}}fitBounds(t,a,f){let g=this.cameraForBounds(t,a);return this._fitInternal(g,a,f)}fitScreenCoordinates(t,a,f,g,v){let b=i.P.convert(t),M=i.P.convert(a),A=new i.P(Math.min(b.x,M.x),Math.min(b.y,M.y)),O=new i.P(Math.max(b.x,M.x),Math.max(b.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,M))return this;let L=this.transform.pointLocation3D(A),N=this.transform.pointLocation3D(O),z=this.transform.pointLocation3D(new i.P(A.x,O.y)),j=this.transform.pointLocation3D(new i.P(O.x,A.y)),q=[Math.min(L.lng,N.lng,z.lng,j.lng),Math.min(L.lat,N.lat,z.lat,j.lat)],W=[Math.max(L.lng,N.lng,z.lng,j.lng),Math.max(L.lat,N.lat,z.lat,j.lat)],Z=g&&g.pitch?g.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,q,W,f,Z,g);return this._fitInternal(X,g,v)}_fitInternal(t,a,f){return t?(a=i.l(t,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(t,a){this.stop();let f=t.preloadOnly?this.transform.clone():this.transform,g=!1,v=!1,b=!1;"zoom"in t&&f.zoom!==+t.zoom&&(g=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=i.bK.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(v=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(b=!0,f.pitch=+t.pitch);let M=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!f.isPaddingEqual(M))if(t.retainPadding===!1){let A=f.clone();A.padding=M,f.setLocationAtPoint(f.center,A.centerPoint)}else f.padding=M;return t.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.x("movestart",a)).fire(new i.x("move",a)),g&&this.fire(new i.x("zoomstart",a)).fire(new i.x("zoom",a)).fire(new i.x("zoomend",a)),v&&this.fire(new i.x("rotatestart",a)).fire(new i.x("rotate",a)).fire(new i.x("rotateend",a)),b&&this.fire(new i.x("pitchstart",a)).fire(new i.x("pitch",a)).fire(new i.x("pitchend",a)),this.fire(new i.x("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Wo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){let f=this.transform;if(!f.projection.supportsFreeCamera)return i.w(Wo),this;this.stop();let g=f.zoom,v=f.pitch,b=f.bearing;f.setFreeCameraOptions(t);let M=g!==f.zoom,A=v!==f.pitch,O=b!==f.bearing;return this.fire(new i.x("movestart",a)).fire(new i.x("move",a)),M&&this.fire(new i.x("zoomstart",a)).fire(new i.x("zoom",a)).fire(new i.x("zoomend",a)),O&&this.fire(new i.x("rotatestart",a)).fire(new i.x("rotate",a)).fire(new i.x("rotateend",a)),A&&this.fire(new i.x("pitchstart",a)).fire(new i.x("pitch",a)).fire(new i.x("pitchend",a)),this.fire(new i.x("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=i.l({offset:[0,0],duration:500,easing:i.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),A="zoom"in t?+t.zoom:g,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,L="pitch"in t?+t.pitch:b,N=this._extendPadding(t.padding),z=i.P.convert(t.offset),j,q,W;if(f.projection.name==="globe"){let we=i.a5.fromLngLat(f.center),ye=z.rotate(-f.angle);we.x+=ye.x/f.worldSize,we.y+=ye.y/f.worldSize;let ge=we.toLngLat(),Me=i.bK.convert(t.center||ge);this._normalizeCenter(Me),j=f.centerPoint.add(ye),q=new i.P(we.x,we.y).mult(f.worldSize),W=new i.P(i.am(Me.lng),i.at(Me.lat)).mult(f.worldSize).sub(q)}else{j=f.centerPoint.add(z);let we=f.pointLocation(j),ye=i.bK.convert(t.center||we);this._normalizeCenter(ye),q=f.project(we),W=f.project(ye).sub(q)}let Z=f.zoomScale(A-g),X,ne;t.around&&(X=i.bK.convert(t.around),ne=f.locationPoint(X));let oe=this._zooming||A!==g,ee=this._rotating||v!==O,le=this._pitching||L!==b,ae=!f.isPaddingEqual(N),fe=t.retainPadding===!1?f.clone():f,he=we=>ye=>{if(oe&&(we.zoom=i.aa(g,A,ye)),ee&&(we.bearing=i.aa(v,O,ye)),le&&(we.pitch=i.aa(b,L,ye)),ae&&(fe.interpolatePadding(M,N,ye),j=fe.centerPoint.add(z)),X)we.setLocationAtPoint(X,ne);else{let ge=we.zoomScale(we.zoom-g),Me=A>g?Math.min(2,Z):Math.max(.5,Z),Be=Math.pow(Me,1-ye),qe=we.unproject(q.add(W.mult(ye*Be)).mult(ge));we.setLocationAtPoint(we.renderWorldCopies?qe.wrap():qe,j)}return t.preloadOnly||this._fireMoveEvents(a),we};if(t.preloadOnly){let we=this._emulate(he,t.duration,f);return this._preloadTiles(we),this}let pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ee,this._pitching=le,this._padding=ae,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,pe),this._ease(he(f),we=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,we)},t),this}_prepareEase(t,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new i.x("movestart",t)),this._zooming&&!f.zooming&&this.fire(new i.x("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new i.x("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new i.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.x("move",t)),this._zooming&&this.fire(new i.x("zoom",t)),this._rotating&&this.fire(new i.x("rotate",t)),this._pitching&&this.fire(new i.x("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.x("zoomend",t)),g&&this.fire(new i.x("rotateend",t)),v&&this.fire(new i.x("pitchend",t)),this.fire(new i.x("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){let Ue=i.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ue,a)}this.stop(),t=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dr},t);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),A="zoom"in t?i.ap(+t.zoom,f.minZoom,f.maxZoom):g,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,L="pitch"in t?+t.pitch:b,N=this._extendPadding(t.padding),z=f.zoomScale(A-g),j=i.P.convert(t.offset),q=f.centerPoint.add(j),W=f.pointLocation(q),Z=i.bK.convert(t.center||W);this._normalizeCenter(Z);let X=f.project(W),ne=f.project(Z).sub(X),oe=t.curve,ee=Math.max(f.width,f.height),le=ee/z,ae=ne.mag();if("minZoom"in t){let Ue=i.ap(Math.min(t.minZoom,g,A),f.minZoom,f.maxZoom),et=ee/f.zoomScale(Ue-g);oe=Math.sqrt(et/ae*2)}let fe=oe*oe;function he(Ue){let et=(le*le-ee*ee+(Ue?-1:1)*fe*fe*ae*ae)/(2*(Ue?le:ee)*fe*ae);return Math.log(Math.sqrt(et*et+1)-et)}function pe(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function we(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}let ye=he(0),ge=function(Ue){return we(ye)/we(ye+oe*Ue)},Me=function(Ue){return ee*((we(ye)*(pe(et=ye+oe*Ue)/we(et))-pe(ye))/fe)/ae;var et},Be=(he(1)-ye)/oe;if(Math.abs(ae)<1e-6||!isFinite(Be)){if(Math.abs(ee-le)<1e-6)return this.easeTo(t,a);let Ue=le<ee?-1:1;Be=Math.abs(Math.log(le/ee))/oe,Me=function(){return 0},ge=function(et){return Math.exp(Ue*oe*et)}}t.duration="duration"in t?+t.duration:1e3*Be/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let qe=v!==O,ze=L!==b,Je=!f.isPaddingEqual(N),Se=t.retainPadding===!1?f.clone():f,Ge=Ue=>et=>{let nt=et*Be,He=1/ge(nt);Ue.zoom=et===1?A:g+Ue.scaleZoom(He),qe&&(Ue.bearing=i.aa(v,O,et)),ze&&(Ue.pitch=i.aa(b,L,et)),Je&&(Se.interpolatePadding(M,N,et),q=Se.centerPoint.add(j));let Ye=et===1?Z:Ue.unproject(X.add(ne.mult(Me(nt))).mult(He));return Ue.setLocationAtPoint(Ue.renderWorldCopies?Ye.wrap():Ye,q),Ue._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Ue};if(t.preloadOnly){let Ue=this._emulate(Ge,t.duration,f);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=qe,this._pitching=ze,this._padding=Je,this._prepareEase(a,!1),this._ease(Ge(f),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!t){let f=this.handlers;f&&f.stop(!1)}return this}_ease(t,a,f){f.animate===!1||f.duration===0?(t(1),a()):(this._easeStart=i.q.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=i.bA(t,-180,180);let f=Math.abs(t-a);return Math.abs(t-360-a)<f&&(t-=360),Math.abs(t+360-a)<f&&(t+=360),t}_normalizeCenter(t){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let f=t.lng-a.center.lng;t.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,f){let g=Math.ceil(15*a/1e3),v=[],b=t(f.clone());for(let M=0;M<=g;M++){let A=b(M/g);v.push(A.clone())}return v}_preloadTiles(t,a){}}class id{constructor(t={}){this.options=t,i.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let a=this.options&&this.options.compact,f=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ze("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let g=Ze("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",f),this._innerContainer=Ze("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){let f=a.reduce((g,v,b)=>(v.value&&(g+=`${v.key}=${v.value}${b<a.length-1?"&":""}`),g),"?");t.href=`${i.e.FEEDBACK_URL}/${f}#${ys(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let a=this._map.style._mergedSourceCaches;for(let g in a){let v=a[g];if(v.used){let b=v.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((g,v)=>g.length-v.length),t=t.filter((g,v)=>{for(let b=v+1;b<t.length;b++)if(t[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ep{constructor(){i.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ze("div","mapboxgl-ctrl");let a=Ze("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let a in t){let f=t[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class m_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){let a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(let g of f)if(g.id===t)return void(g.cancelled=!0)}run(t=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let f of a)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class wu{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let a=i.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,f){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+f}}let xx={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class bx{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ip{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let{type:f,filter:g}=a;if(g){let b=i.M(g,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(b.result==="error")throw new Error(b.value.map(M=>`${M.key}: ${M.message}`).join(", "));this.filters.set(t,b.value)}let v=this.interactionsByType.get(f)||new Map;v.size===0&&(this.map.on(f,this.handleType),this.interactionsByType.set(f,v)),v.set(t,a),this.typeById.set(t,f)}remove(t){let a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);let f=this.interactionsByType.get(a);f&&(f.delete(t),f.size===0&&this.map.off(a,this.handleType))}handleType(t){let a=t.features||this.map.queryRenderedFeatures(t.point);if(!a)return;let f=this.interactionsByType.get(t.type),g={zoom:0};for(let[v,b]of f){let M=this.filters.get(v),{handler:A,layers:O}=b;for(let L of a)if((!O||O.includes(L.layer.id))&&(!M||M.evaluate(g,L))&&A({id:v,feature:L,interaction:b})!==!1)break}}}let Cp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Tu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yl{constructor(t,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Jh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,f&&(this.mousePitch=new Qh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),an()}move(t,a){let f=this.map,g=this.mouseRotate.mousemoveWindow(t,a),v=g&&g.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){let b=this.mousePitch.mousemoveWindow(t,a),M=b&&b.pitchDelta;M&&f.setPitch(f.getPitch()+M)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Zn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(i.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),zi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,zi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Er(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Er(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zo(d,t,a){if(d=new i.bK(d.lng,d.lat),t){let f=new i.bK(d.lng-360,d.lat),g=new i.bK(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),b=a.locationPoint(d).distSqr(t),M=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint(f).distSqr(t)<b&&(M||Math.abs(f.lng-a.center.lng)<v)?d=f:a.locationPoint(g).distSqr(t)<b&&(M||Math.abs(g.lng-a.center.lng)<v)&&(d=g)}for(;Math.abs(d.lng-a.center.lng)>180;){let f=a.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}let Qr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xo extends i.E{constructor(t,a){if(super(),(t instanceof HTMLElement||a)&&(t=i.l({element:t},a)),i.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ze("div");let v=41,b=27,M=yt("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),A=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},M));yt("stop",{offset:"10%","stop-opacity":.4},A),yt("stop",{offset:"100%","stop-opacity":.05},A),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=i.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let f=this._element.classList;for(let v in Qr)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=t&&t.className?t.className.trim().split(/\s+/):[];f.add(...g),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.bK.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let a=t.code,f=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(t){let a=t.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,a=this._pos;if(!t||!a)return!1;let f=t.unproject(a),g=t.getFreeCameraOptions();if(!g.position)return!1;let v=g.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();let f=t.unproject(a),g;t._showingGlobe()&&i.dz(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(f),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Qr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let t=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!t||f!=="map")return"";if(!a._showingGlobe()){let A=a.getPitch();return A?`rotateX(${A}deg)`:""}let g=i.c0(i.dA(a.transform,this._lngLat)),v=t.sub(i.dB(a.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";let M=g/b;return`rotateX(${-v.y*M}deg) rotateY(${v.x*M}deg)`}_calculateZTransform(){let t=this._pos,a=this._map;if(!a||!t)return"";let f=0,g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){let v=a.project(new i.bK(this._lngLat.lng,this._lngLat.lat+.001)),b=a.project(new i.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=i.c0(Math.atan2(b.y,b.x))-90}else f=-a.getBearing();else if(g==="horizon"){let v=i.a7(4,6,a.getZoom()),b=i.dB(a.transform);b.y+=v*a.transform.height;let M=t.sub(b),A=i.c0(Math.atan2(M.y,M.x));f=(A>90?A-270:A+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Zo(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let a=this._map;if(!a)return;let f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){let v=this._clickTolerance||a._clickTolerance;if(t.point.dist(f)<v)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.x("dragstart"))),this.fire(new i.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.x("dragend")),this._state="inactive"}_addDragHandler(t){let a=this._map,f=this._pos;a&&f&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(f),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Ua={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ia={maxWidth:100,unit:"metric"},wx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Tx={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ex=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function g_(d=new i.P(0,0),t="bottom"){if(typeof d=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new i.P(0,d);case"top-left":return new i.P(a,a);case"top-right":return new i.P(-a,a);case"bottom":return new i.P(0,-d);case"bottom-left":return new i.P(a,-a);case"bottom-right":return new i.P(-a,-a);case"left":return new i.P(d,0);case"right":return new i.P(-d,0)}return new i.P(0,0)}return d instanceof i.P||Array.isArray(d)?i.P.convert(d):i.P.convert(d[t]||[0,0])}return{version:P,supported:Xe.supported,setRTLTextPlugin:i.dC,getRTLTextPluginStatus:i.dD,Map:class extends Tp{constructor(d){$.mark(V.create);let t=d;if((d=i.l({},Cp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.dx(window)&&(d.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gh(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new m_,this._domRenderTaskQueue=new m_,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aP(),this._locale=i.l({},xx,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new wu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new ih(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?St({},d.contextCreateOptions):{},typeof d.container=="string"){let a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),i.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new bx),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new vr(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||i.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new ta(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let a=d.bounds;a&&(this.resize(),this.fitBounds(a,i.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new id({customAttribution:d.customAttribution})),this._logoControl=new Ep,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new i.x(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new i.x(`${a.dataType}dataloading`,a))}),this._interactions=new Ip(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=d.onAdd(this);this._controls.push(d);let f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new i.x("movestart",d)).fire(new i.x("move",d)),this.fire(new i.x("resize",d)),t&&this.fire(new i.x("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.as.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.x("zoomstart")).fire(new i.x("zoom")).fire(new i.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.x("zoomstart")).fire(new i.x("zoom")).fire(new i.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.x("pitchstart")).fire(new i.x("pitch")).fire(new i.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.x("pitchstart")).fire(new i.x("pitch")).fire(new i.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){let t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,t=d.projection.name,a;t==="globe"&&d.zoom>=i.bU?(d.setMercatorFromTransition(),a=!0):t==="mercator"&&d.zoom<i.bU&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=i.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(i.bK.convert(d))}unproject(d){return this.transform.pointLocation3D(i.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,a){if(d==="mouseenter"||d==="mouseover"){let f=!1,g=b=>{let M=t.filter(O=>this.getLayer(O)),A=M.length?this.queryRenderedFeatures(b.point,{layers:M}):[];A.length?f||(f=!0,a.call(this,new Sr(d,this,b.originalEvent,{features:A}))):f=!1},v=()=>{f=!1};return{layers:new Set(t),listener:a,delegates:{mousemove:g,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let f=!1,g=b=>{let M=t.filter(A=>this.getLayer(A));(M.length?this.queryRenderedFeatures(b.point,{layers:M}):[]).length?f=!0:f&&(f=!1,a.call(this,new Sr(d,this,b.originalEvent)))},v=b=>{f&&(f=!1,a.call(this,new Sr(d,this,b.originalEvent)))};return{layers:new Set(t),listener:a,delegates:{mousemove:g,mouseout:v}}}{let f=g=>{let v=t.filter(M=>this.getLayer(M)),b=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];b.length&&(g.features=b,a.call(this,g),delete g.features)};return{layers:new Set(t),listener:a,delegates:{[d]:f}}}}on(d,t,a){if(typeof t=="function"||a===void 0)return super.on(d,t);if(Array.isArray(t)||(t=[t]),t){for(let g of t)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(d,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(let g in f.delegates)this.on(g,f.delegates[g]);return this}once(d,t,a){if(typeof t=="function"||a===void 0)return super.once(d,t);if(Array.isArray(t)||(t=[t]),t){for(let g of t)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(d,t,a);for(let g in f.delegates)this.once(g,f.delegates[g]);return this}off(d,t,a){if(typeof t=="function"||a===void 0)return super.off(d,t);let f=new Set(Array.isArray(t)?t:[t]);for(let b of f)if(!this._isValidId(b))return this;let g=(b,M)=>{if(b.size!==M.size)return!1;for(let A of b)if(!M.has(A))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(b=>{for(let M=0;M<b.length;M++){let A=b[M];if(A.listener===a&&g(A.layers,f)){for(let O in A.delegates)this.off(O,A.delegates[O]);return b.splice(M,1),this}}})(v),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(t!==void 0||d===void 0||d instanceof i.P||Array.isArray(d)||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(let a of t.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(d,t,this.transform)}querySourceFeatures(d,t){return this._isValidId(d)?this.style.querySourceFeatures(d,t):[]}isPointOnSurface(d){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,t){return t=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(a,f)=>{a?(i.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(d,t)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){let t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){let a=i.l({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new Kr(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new i.t(new Error("IDs can't be empty."))),!1):!i.cn(d)||(this.fire(new i.t(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:a=1,sdf:f=!1,stretchX:g,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:M,height:A,data:O}=i.q.getImageData(t);this.style.addImage(d,{data:new i.r({width:M,height:A},O),pixelRatio:a,stretchX:g,stretchY:v,content:b,sdf:f,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new i.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:M,height:A}=t,O=t;this.style.addImage(d,{data:new i.r({width:M,height:A},new Uint8Array(O.data)),pixelRatio:a,stretchX:g,stretchY:v,content:b,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();let a=this.style.getImage(d);if(!a)return void this.fire(new i.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.q.getImageData(t):t,{width:g,height:v,data:b}=f;if(g===void 0||v===void 0)return void this.fire(new i.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||v!==a.data.height)return void this.fire(new i.t(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let M=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);a.data.replace(b,M),this.style.updateImage(d,a)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new i.t(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){i.o(this._requestManager.transformRequest(d,i.R.Image),(a,f)=>{t(a,f instanceof HTMLImageElement?i.q.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new i.t(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){let t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;let t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,a),this._update(!0)):this}setFilter(d,t,a={}){return this._isValidId(d)?(this.style.setFilter(d,t,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,a,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,a,f),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,a,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,a,f),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,a){return this.style.setConfigProperty(d,t,a),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bK.convert(d),this.transform):0}setFeatureState(d,t){return this._isValidId(d.source)?(this.style.setFeatureState(d,t),this._update()):this}removeFeatureState(d,t){return this._isValidId(d.source)?(this.style.removeFeatureState(d,t),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,a,f,g,v=this._container;for(;v&&(!f||!g);){let b=window.getComputedStyle(v).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),v=v.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ze("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Ze("div","mapboxgl-canvas-container",d);this._canvas=Ze("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=Ze("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{f[g]=Ze("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){let a=i.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let d=i.l({},Xe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?($s(t,!0),this.painter=new dp(t,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(t)):this.fire(new i.t(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.x("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new i.x("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new i.x("renderstart")),++this._frameId;let a=this.painter.context.extTimerQuery,f=i.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let O=this.transform.zoom,L=this.transform.pitch,N=i.q.now(),z=new i.a3(O,{now:N,fadeDuration:v,pitch:L,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);let M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource);if(M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(V.load),this.fire(new i.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let O=i.q.now()-f;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let L=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new i.x("gpu-timing-frame",{cpuTime:O,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let O=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(O);this.fire(new i.x("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(O);this.fire(new i.x("gpu-timing-deferred-render",{gpuTime:L}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{let O=this.idle();if(O&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new i.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new i.x("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,$.mark(V.fullLoad),this._performanceMetricsCollection&&zc(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){let a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let g=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;let b=Math.abs(g-v);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){be(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Us||d.status===401)){let t=this.painter.context.gl;$s(t,!1),this._logoControl instanceof Ep&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Nc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&lo(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let a=this.painter.context.gl,f=a.createFramebuffer();function g(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);let b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(g(d),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(d,t,a){let f=a[1]-a[0],g=d.length/4;for(let v=0;v<t.length;v++){let b=t[v],M=0;for(let A=0;A<b.length;A+=4)b[A]===d[A]&&b[A+1]===d[A+1]&&b[A+2]===d[A+2]&&b[A+3]===d[A+3]&&(M+=1);f+=(a[v+2]-a[v+1])*(1-M/g)}return f}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),cs.delete(this.painter.context.gl),Ta.remove(),Xt.remove(),this._removed=!0,this.fire(new i.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.q.frame(t=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(d){let t=this.style?this.style.getSourceCaches():[];return i.bf(t,(a,f)=>a._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){i.dy(d,t)}get version(){return P}},NavigationControl:class{constructor(d={}){this.options=i.l({},Tu,d),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(i.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=Ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let t=d.getZoom(),a=t===d.getMaxZoom(),f=t===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yl(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){let a=Ze("button",d,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(d,t){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends i.E{constructor(d={}){super();let t=navigator.geolocation;this.options=i.l({geolocation:t},Ua,d),i.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_s(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){let t=this._map.getMaxBounds(),a=d.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.x("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.x("geolocate",d)),this._finish()}}_updateCamera(d){let t=new i.bK(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,f=this._map.getBearing(),g=i.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),g,{geolocateSource:!0})}_updateMarker(d){if(d){let t=new i.bK(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,t=i.bD(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.x("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Ze("button","mapboxgl-ctrl-geolocate",this._container),Ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ze("div","mapboxgl-user-location"),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.x("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:id,ScaleControl:class{constructor(d={}){this.options=i.l({},ia,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,f=t._containerWidth/2-d/2,g=t.unproject([f,a]),v=t.unproject([f+d,a]),b=g.distanceTo(v);if(this.options.unit==="imperial"){let M=3.2808*b;M>5280?this._setScale(d,M/5280,"mile"):this._setScale(d,M,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,t,a){this._map._requestDomTask(()=>{let f=function(v){let b=Math.pow(10,`${Math.floor(v)}`.length-1),M=v/b;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){let O=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*O)/O}(M),b*M}(t),g=f/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${wx[a]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:i.w("Full screen control 'container' must be a DOM element.")),i.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=Ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ze("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(d){super(),this.options=i.l(Object.create(Tx),d),i.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.x("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.bK.convert(d),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let t=document.createDocumentFragment(),a=document.createElement("body"),f;for(a.innerHTML=d;f=a.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ze("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){let a=this._closeButton=Ze("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let t=this._map,a=this._container,f=this._pos;if(!t||!a||!f)return"bottom";let g=a.offsetWidth,v=a.offsetHeight,b=f.x<g/2,M=f.x>t.transform.width-g/2;if(f.y+d<v)return b?"top-left":M?"top-right":"top";if(f.y>t.transform.height-v){if(b)return"bottom-left";if(M)return"bottom-right"}return b?"left":M?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){let t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=Ze("div","mapboxgl-popup",t.getContainer()),this._tip=Ze("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zo(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){let g=this._pos=this._trackPointer&&d instanceof i.P?d:t.project(this._lngLat),v=g_(this.options.offset),b=this._anchor=this._getAnchor(v.y),M=g_(this.options.offset,b),A=g.add(M).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Qr[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){let g=i.dz(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(Ex);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Xo,Style:Kr,LngLat:i.bK,LngLatBounds:i.as,Point:i.P,MercatorCoordinate:i.a5,FreeCameraOptions:Ws,Evented:i.E,config:i.e,prewarm:i.dE,clearPrewarmedResources:i.dF,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(d){i.e.ACCESS_TOKEN=d},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(d){i.e.API_URL=d},get workerCount(){return i.dG.workerCount},set workerCount(d){i.dG.workerCount=d},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.dH(d)},get workerUrl(){return i.dI.workerUrl},set workerUrl(d){i.dI.workerUrl=d},get workerClass(){return i.dI.workerClass},set workerClass(d){i.dI.workerClass=d},get workerParams(){return i.dI.workerParams},set workerParams(d){i.dI.workerParams=d},get dracoUrl(){return i.dJ()},set dracoUrl(d){i.dK(d)},get meshoptUrl(){return i.dL()},set meshoptUrl(d){i.dM(d)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var _=o;return _})});var yM=null;var j1=1,vM=Symbol("SIGNAL");function li(n){let s=yM;return yM=n,s}var xM={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function vk(n){if(!(G1(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===j1)){if(!n.producerMustRecompute(n)&&!U1(n)){n.dirty=!1,n.lastCleanEpoch=j1;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=j1}}function bM(n){return n&&(n.nextProducerIndex=0),li(n)}function wM(n,s){if(li(s),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(G1(n))for(let o=n.nextProducerIndex;o<n.producerNode.length;o++)$1(n.producerNode[o],n.producerIndexOfThis[o]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function U1(n){ay(n);for(let s=0;s<n.producerNode.length;s++){let o=n.producerNode[s],u=n.producerLastReadVersion[s];if(u!==o.version||(vk(o),u!==o.version))return!0}return!1}function TM(n){if(ay(n),G1(n))for(let s=0;s<n.producerNode.length;s++)$1(n.producerNode[s],n.producerIndexOfThis[s]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function $1(n,s){if(xk(n),ay(n),n.liveConsumerNode.length===1)for(let u=0;u<n.producerNode.length;u++)$1(n.producerNode[u],n.producerIndexOfThis[u]);let o=n.liveConsumerNode.length-1;if(n.liveConsumerNode[s]=n.liveConsumerNode[o],n.liveConsumerIndexOfThis[s]=n.liveConsumerIndexOfThis[o],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,s<n.liveConsumerNode.length){let u=n.liveConsumerIndexOfThis[s],_=n.liveConsumerNode[s];ay(_),_.producerIndexOfThis[u]=s}}function G1(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function ay(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function xk(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function bk(){throw new Error}var wk=bk;function EM(n){wk=n}function Pn(n){return typeof n=="function"}function yd(n){let o=n(u=>{Error.call(u),u.stack=new Error().stack});return o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o}var ly=yd(n=>function(o){n(this),this.message=o?`${o.length} errors occurred during unsubscription:
${o.map((u,_)=>`${_+1}) ${u.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=o});function sm(n,s){if(n){let o=n.indexOf(s);0<=o&&n.splice(o,1)}}var dr=class n{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:o}=this;if(o)if(this._parentage=null,Array.isArray(o))for(let i of o)i.remove(this);else o.remove(this);let{initialTeardown:u}=this;if(Pn(u))try{u()}catch(i){s=i instanceof ly?i.errors:[i]}let{_finalizers:_}=this;if(_){this._finalizers=null;for(let i of _)try{IM(i)}catch(P){s=s??[],P instanceof ly?s=[...s,...P.errors]:s.push(P)}}if(s)throw new ly(s)}}add(s){var o;if(s&&s!==this)if(this.closed)IM(s);else{if(s instanceof n){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(o=this._finalizers)!==null&&o!==void 0?o:[]).push(s)}}_hasParent(s){let{_parentage:o}=this;return o===s||Array.isArray(o)&&o.includes(s)}_addParent(s){let{_parentage:o}=this;this._parentage=Array.isArray(o)?(o.push(s),o):o?[o,s]:s}_removeParent(s){let{_parentage:o}=this;o===s?this._parentage=null:Array.isArray(o)&&sm(o,s)}remove(s){let{_finalizers:o}=this;o&&sm(o,s),s instanceof n&&s._removeParent(this)}};dr.EMPTY=(()=>{let n=new dr;return n.closed=!0,n})();var H1=dr.EMPTY;function cy(n){return n instanceof dr||n&&"closed"in n&&Pn(n.remove)&&Pn(n.add)&&Pn(n.unsubscribe)}function IM(n){Pn(n)?n():n.unsubscribe()}var Ms={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var vd={setTimeout(n,s,...o){let{delegate:u}=vd;return u?.setTimeout?u.setTimeout(n,s,...o):setTimeout(n,s,...o)},clearTimeout(n){let{delegate:s}=vd;return(s?.clearTimeout||clearTimeout)(n)},delegate:void 0};function uy(n){vd.setTimeout(()=>{let{onUnhandledError:s}=Ms;if(s)s(n);else throw n})}function am(){}var CM=q1("C",void 0,void 0);function DM(n){return q1("E",void 0,n)}function MM(n){return q1("N",n,void 0)}function q1(n,s,o){return{kind:n,value:s,error:o}}var Ou=null;function xd(n){if(Ms.useDeprecatedSynchronousErrorHandling){let s=!Ou;if(s&&(Ou={errorThrown:!1,error:null}),n(),s){let{errorThrown:o,error:u}=Ou;if(Ou=null,o)throw u}}else n()}function SM(n){Ms.useDeprecatedSynchronousErrorHandling&&Ou&&(Ou.errorThrown=!0,Ou.error=n)}var Lu=class extends dr{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,cy(s)&&s.add(this)):this.destination=Ik}static create(s,o,u){return new qa(s,o,u)}next(s){this.isStopped?Z1(MM(s),this):this._next(s)}error(s){this.isStopped?Z1(DM(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?Z1(CM,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Tk=Function.prototype.bind;function W1(n,s){return Tk.call(n,s)}var X1=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:o}=this;if(o.next)try{o.next(s)}catch(u){hy(u)}}error(s){let{partialObserver:o}=this;if(o.error)try{o.error(s)}catch(u){hy(u)}else hy(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(o){hy(o)}}},qa=class extends Lu{constructor(s,o,u){super();let _;if(Pn(s)||!s)_={next:s??void 0,error:o??void 0,complete:u??void 0};else{let i;this&&Ms.useDeprecatedNextContext?(i=Object.create(s),i.unsubscribe=()=>this.unsubscribe(),_={next:s.next&&W1(s.next,i),error:s.error&&W1(s.error,i),complete:s.complete&&W1(s.complete,i)}):_=s}this.destination=new X1(_)}};function hy(n){Ms.useDeprecatedSynchronousErrorHandling?SM(n):uy(n)}function Ek(n){throw n}function Z1(n,s){let{onStoppedNotification:o}=Ms;o&&vd.setTimeout(()=>o(n,s))}var Ik={closed:!0,next:am,error:Ek,complete:am};var bd=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Fo(n){return n}function Y1(...n){return K1(n)}function K1(n){return n.length===0?Fo:n.length===1?n[0]:function(o){return n.reduce((u,_)=>_(u),o)}}var ci=(()=>{class n{constructor(o){o&&(this._subscribe=o)}lift(o){let u=new n;return u.source=this,u.operator=o,u}subscribe(o,u,_){let i=Dk(o)?o:new qa(o,u,_);return xd(()=>{let{operator:P,source:V}=this;i.add(P?P.call(i,V):V?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(o){try{return this._subscribe(o)}catch(u){o.error(u)}}forEach(o,u){return u=AM(u),new u((_,i)=>{let P=new qa({next:V=>{try{o(V)}catch($){i($),P.unsubscribe()}},error:i,complete:_});this.subscribe(P)})}_subscribe(o){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(o)}[bd](){return this}pipe(...o){return K1(o)(this)}toPromise(o){return o=AM(o),new o((u,_)=>{let i;this.subscribe(P=>i=P,P=>_(P),()=>u(i))})}}return n.create=s=>new n(s),n})();function AM(n){var s;return(s=n??Ms.Promise)!==null&&s!==void 0?s:Promise}function Ck(n){return n&&Pn(n.next)&&Pn(n.error)&&Pn(n.complete)}function Dk(n){return n&&n instanceof Lu||Ck(n)&&cy(n)}function J1(n){return Pn(n?.lift)}function Qn(n){return s=>{if(J1(s))return s.lift(function(o){try{return n(o,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function ei(n,s,o,u,_){return new Q1(n,s,o,u,_)}var Q1=class extends Lu{constructor(s,o,u,_,i,P){super(s),this.onFinalize=i,this.shouldUnsubscribe=P,this._next=o?function(V){try{o(V)}catch($){s.error($)}}:super._next,this._error=_?function(V){try{_(V)}catch($){s.error($)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(V){s.error(V)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:o}=this;super.unsubscribe(),!o&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function wd(){return Qn((n,s)=>{let o=null;n._refCount++;let u=ei(s,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){o=null;return}let _=n._connection,i=o;o=null,_&&(!i||_===i)&&_.unsubscribe(),s.unsubscribe()});n.subscribe(u),u.closed||(o=n.connect())})}var Td=class extends ci{constructor(s,o){super(),this.source=s,this.subjectFactory=o,this._subject=null,this._refCount=0,this._connection=null,J1(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new dr;let o=this.getSubject();s.add(this.source.subscribe(ei(o,void 0,()=>{this._teardown(),o.complete()},u=>{this._teardown(),o.error(u)},()=>this._teardown()))),s.closed&&(this._connection=null,s=dr.EMPTY)}return s}refCount(){return wd()(this)}};var PM=yd(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var or=(()=>{class n extends ci{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(o){let u=new dy(this,this);return u.operator=o,u}_throwIfClosed(){if(this.closed)throw new PM}next(o){xd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let u of this.currentObservers)u.next(o)}})}error(o){xd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=o;let{observers:u}=this;for(;u.length;)u.shift().error(o)}})}complete(){xd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:o}=this;for(;o.length;)o.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var o;return((o=this.observers)===null||o===void 0?void 0:o.length)>0}_trySubscribe(o){return this._throwIfClosed(),super._trySubscribe(o)}_subscribe(o){return this._throwIfClosed(),this._checkFinalizedStatuses(o),this._innerSubscribe(o)}_innerSubscribe(o){let{hasError:u,isStopped:_,observers:i}=this;return u||_?H1:(this.currentObservers=null,i.push(o),new dr(()=>{this.currentObservers=null,sm(i,o)}))}_checkFinalizedStatuses(o){let{hasError:u,thrownError:_,isStopped:i}=this;u?o.error(_):i&&o.complete()}asObservable(){let o=new ci;return o.source=this,o}}return n.create=(s,o)=>new dy(s,o),n})(),dy=class extends or{constructor(s,o){super(),this.destination=s,this.source=o}next(s){var o,u;(u=(o=this.destination)===null||o===void 0?void 0:o.next)===null||u===void 0||u.call(o,s)}error(s){var o,u;(u=(o=this.destination)===null||o===void 0?void 0:o.error)===null||u===void 0||u.call(o,s)}complete(){var s,o;(o=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||o===void 0||o.call(s)}_subscribe(s){var o,u;return(u=(o=this.source)===null||o===void 0?void 0:o.subscribe(s))!==null&&u!==void 0?u:H1}};var fr=class extends or{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let o=super._subscribe(s);return!o.closed&&s.next(this._value),o}getValue(){let{hasError:s,thrownError:o,_value:u}=this;if(s)throw o;return this._throwIfClosed(),u}next(s){super.next(this._value=s)}};var eb={now(){return(eb.delegate||Date).now()},delegate:void 0};var fy=class extends or{constructor(s=1/0,o=1/0,u=eb){super(),this._bufferSize=s,this._windowTime=o,this._timestampProvider=u,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=o===1/0,this._bufferSize=Math.max(1,s),this._windowTime=Math.max(1,o)}next(s){let{isStopped:o,_buffer:u,_infiniteTimeWindow:_,_timestampProvider:i,_windowTime:P}=this;o||(u.push(s),!_&&u.push(i.now()+P)),this._trimBuffer(),super.next(s)}_subscribe(s){this._throwIfClosed(),this._trimBuffer();let o=this._innerSubscribe(s),{_infiniteTimeWindow:u,_buffer:_}=this,i=_.slice();for(let P=0;P<i.length&&!s.closed;P+=u?1:2)s.next(i[P]);return this._checkFinalizedStatuses(s),o}_trimBuffer(){let{_bufferSize:s,_timestampProvider:o,_buffer:u,_infiniteTimeWindow:_}=this,i=(_?1:2)*s;if(s<1/0&&i<u.length&&u.splice(0,u.length-i),!_){let P=o.now(),V=0;for(let $=1;$<u.length&&u[$]<=P;$+=2)V=$;V&&u.splice(0,V+1)}}};var ko=new ci(n=>n.complete());function RM(n){return n&&Pn(n.schedule)}function OM(n){return n[n.length-1]}function py(n){return Pn(OM(n))?n.pop():void 0}function uc(n){return RM(OM(n))?n.pop():void 0}function FM(n,s,o,u){function _(i){return i instanceof o?i:new o(function(P){P(i)})}return new(o||(o=Promise))(function(i,P){function V(xe){try{re(u.next(xe))}catch(Pe){P(Pe)}}function $(xe){try{re(u.throw(xe))}catch(Pe){P(Pe)}}function re(xe){xe.done?i(xe.value):_(xe.value).then(V,$)}re((u=u.apply(n,s||[])).next())})}function LM(n){var s=typeof Symbol=="function"&&Symbol.iterator,o=s&&n[s],u=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&u>=n.length&&(n=void 0),{value:n&&n[u++],done:!n}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fu(n){return this instanceof Fu?(this.v=n,this):new Fu(n)}function kM(n,s,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=o.apply(n,s||[]),_,i=[];return _=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),V("next"),V("throw"),V("return",P),_[Symbol.asyncIterator]=function(){return this},_;function P(Ze){return function(yt){return Promise.resolve(yt).then(Ze,Pe)}}function V(Ze,yt){u[Ze]&&(_[Ze]=function(lt){return new Promise(function(Ut,un){i.push([Ze,lt,Ut,un])>1||$(Ze,lt)})},yt&&(_[Ze]=yt(_[Ze])))}function $(Ze,yt){try{re(u[Ze](yt))}catch(lt){Xe(i[0][3],lt)}}function re(Ze){Ze.value instanceof Fu?Promise.resolve(Ze.value.v).then(xe,Pe):Xe(i[0][2],Ze)}function xe(Ze){$("next",Ze)}function Pe(Ze){$("throw",Ze)}function Xe(Ze,yt){Ze(yt),i.shift(),i.length&&$(i[0][0],i[0][1])}}function NM(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n[Symbol.asyncIterator],o;return s?s.call(n):(n=typeof LM=="function"?LM(n):n[Symbol.iterator](),o={},u("next"),u("throw"),u("return"),o[Symbol.asyncIterator]=function(){return this},o);function u(i){o[i]=n[i]&&function(P){return new Promise(function(V,$){P=n[i](P),_(V,$,P.done,P.value)})}}function _(i,P,V,$){Promise.resolve($).then(function(re){i({value:re,done:V})},P)}}var my=n=>n&&typeof n.length=="number"&&typeof n!="function";function gy(n){return Pn(n?.then)}function _y(n){return Pn(n[bd])}function yy(n){return Symbol.asyncIterator&&Pn(n?.[Symbol.asyncIterator])}function vy(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Mk(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var xy=Mk();function by(n){return Pn(n?.[xy])}function wy(n){return kM(this,arguments,function*(){let o=n.getReader();try{for(;;){let{value:u,done:_}=yield Fu(o.read());if(_)return yield Fu(void 0);yield yield Fu(u)}}finally{o.releaseLock()}})}function Ty(n){return Pn(n?.getReader)}function qi(n){if(n instanceof ci)return n;if(n!=null){if(_y(n))return Sk(n);if(my(n))return Ak(n);if(gy(n))return Pk(n);if(yy(n))return zM(n);if(by(n))return Rk(n);if(Ty(n))return Ok(n)}throw vy(n)}function Sk(n){return new ci(s=>{let o=n[bd]();if(Pn(o.subscribe))return o.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ak(n){return new ci(s=>{for(let o=0;o<n.length&&!s.closed;o++)s.next(n[o]);s.complete()})}function Pk(n){return new ci(s=>{n.then(o=>{s.closed||(s.next(o),s.complete())},o=>s.error(o)).then(null,uy)})}function Rk(n){return new ci(s=>{for(let o of n)if(s.next(o),s.closed)return;s.complete()})}function zM(n){return new ci(s=>{Lk(n,s).catch(o=>s.error(o))})}function Ok(n){return zM(wy(n))}function Lk(n,s){var o,u,_,i;return FM(this,void 0,void 0,function*(){try{for(o=NM(n);u=yield o.next(),!u.done;){let P=u.value;if(s.next(P),s.closed)return}}catch(P){_={error:P}}finally{try{u&&!u.done&&(i=o.return)&&(yield i.call(o))}finally{if(_)throw _.error}}s.complete()})}function _o(n,s,o,u=0,_=!1){let i=s.schedule(function(){o(),_?n.add(this.schedule(null,u)):this.unsubscribe()},u);if(n.add(i),!_)return i}function Ey(n,s=0){return Qn((o,u)=>{o.subscribe(ei(u,_=>_o(u,n,()=>u.next(_),s),()=>_o(u,n,()=>u.complete(),s),_=>_o(u,n,()=>u.error(_),s)))})}function Iy(n,s=0){return Qn((o,u)=>{u.add(n.schedule(()=>o.subscribe(u),s))})}function BM(n,s){return qi(n).pipe(Iy(s),Ey(s))}function VM(n,s){return qi(n).pipe(Iy(s),Ey(s))}function jM(n,s){return new ci(o=>{let u=0;return s.schedule(function(){u===n.length?o.complete():(o.next(n[u++]),o.closed||this.schedule())})})}function UM(n,s){return new ci(o=>{let u;return _o(o,s,()=>{u=n[xy](),_o(o,s,()=>{let _,i;try{({value:_,done:i}=u.next())}catch(P){o.error(P);return}i?o.complete():o.next(_)},0,!0)}),()=>Pn(u?.return)&&u.return()})}function Cy(n,s){if(!n)throw new Error("Iterable cannot be null");return new ci(o=>{_o(o,s,()=>{let u=n[Symbol.asyncIterator]();_o(o,s,()=>{u.next().then(_=>{_.done?o.complete():o.next(_.value)})},0,!0)})})}function $M(n,s){return Cy(wy(n),s)}function GM(n,s){if(n!=null){if(_y(n))return BM(n,s);if(my(n))return jM(n,s);if(gy(n))return VM(n,s);if(yy(n))return Cy(n,s);if(by(n))return UM(n,s);if(Ty(n))return $M(n,s)}throw vy(n)}function Ai(n,s){return s?GM(n,s):qi(n)}function fn(...n){let s=uc(n);return Ai(n,s)}function Ed(n,s){let o=Pn(n)?n:()=>n,u=_=>_.error(o());return new ci(s?_=>s.schedule(u,0,_):u)}function Wa(n){return!!n&&(n instanceof ci||Pn(n.lift)&&Pn(n.subscribe))}var Za=yd(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function yn(n,s){return Qn((o,u)=>{let _=0;o.subscribe(ei(u,i=>{u.next(n.call(s,i,_++))}))})}var{isArray:Fk}=Array;function kk(n,s){return Fk(s)?n(...s):n(s)}function Dy(n){return yn(s=>kk(n,s))}var{isArray:Nk}=Array,{getPrototypeOf:zk,prototype:Bk,keys:Vk}=Object;function My(n){if(n.length===1){let s=n[0];if(Nk(s))return{args:s,keys:null};if(jk(s)){let o=Vk(s);return{args:o.map(u=>s[u]),keys:o}}}return{args:n,keys:null}}function jk(n){return n&&typeof n=="object"&&zk(n)===Bk}function Sy(n,s){return n.reduce((o,u,_)=>(o[u]=s[_],o),{})}function lm(...n){let s=uc(n),o=py(n),{args:u,keys:_}=My(n);if(u.length===0)return Ai([],s);let i=new ci(Uk(u,s,_?P=>Sy(_,P):Fo));return o?i.pipe(Dy(o)):i}function Uk(n,s,o=Fo){return u=>{HM(s,()=>{let{length:_}=n,i=new Array(_),P=_,V=_;for(let $=0;$<_;$++)HM(s,()=>{let re=Ai(n[$],s),xe=!1;re.subscribe(ei(u,Pe=>{i[$]=Pe,xe||(xe=!0,V--),V||u.next(o(i.slice()))},()=>{--P||u.complete()}))},u)},u)}}function HM(n,s,o){n?_o(o,n,s):s()}function qM(n,s,o,u,_,i,P,V){let $=[],re=0,xe=0,Pe=!1,Xe=()=>{Pe&&!$.length&&!re&&s.complete()},Ze=lt=>re<u?yt(lt):$.push(lt),yt=lt=>{i&&s.next(lt),re++;let Ut=!1;qi(o(lt,xe++)).subscribe(ei(s,un=>{_?.(un),i?Ze(un):s.next(un)},()=>{Ut=!0},void 0,()=>{if(Ut)try{for(re--;$.length&&re<u;){let un=$.shift();P?_o(s,P,()=>yt(un)):yt(un)}Xe()}catch(un){s.error(un)}}))};return n.subscribe(ei(s,Ze,()=>{Pe=!0,Xe()})),()=>{V?.()}}function sr(n,s,o=1/0){return Pn(s)?sr((u,_)=>yn((i,P)=>s(u,i,_,P))(qi(n(u,_))),o):(typeof s=="number"&&(o=s),Qn((u,_)=>qM(u,_,n,o)))}function hc(n=1/0){return sr(Fo,n)}function WM(){return hc(1)}function Xa(...n){return WM()(Ai(n,uc(n)))}function ku(n){return new ci(s=>{qi(n()).subscribe(s)})}function cm(...n){let s=py(n),{args:o,keys:u}=My(n),_=new ci(i=>{let{length:P}=o;if(!P){i.complete();return}let V=new Array(P),$=P,re=P;for(let xe=0;xe<P;xe++){let Pe=!1;qi(o[xe]).subscribe(ei(i,Xe=>{Pe||(Pe=!0,re--),V[xe]=Xe},()=>$--,void 0,()=>{(!$||!Pe)&&(re||i.next(u?Sy(u,V):V),i.complete())}))}});return s?_.pipe(Dy(s)):_}function yo(n,s){return Qn((o,u)=>{let _=0;o.subscribe(ei(u,i=>n.call(s,i,_++)&&u.next(i)))})}function dc(n){return Qn((s,o)=>{let u=null,_=!1,i;u=s.subscribe(ei(o,void 0,void 0,P=>{i=qi(n(P,dc(n)(s))),u?(u.unsubscribe(),u=null,i.subscribe(o)):_=!0})),_&&(u.unsubscribe(),u=null,i.subscribe(o))})}function ZM(n,s,o,u,_){return(i,P)=>{let V=o,$=s,re=0;i.subscribe(ei(P,xe=>{let Pe=re++;$=V?n($,xe,Pe):(V=!0,xe),u&&P.next($)},_&&(()=>{V&&P.next($),P.complete()})))}}function Ss(n,s){return Pn(s)?sr(n,s,1):sr(n,1)}function fc(n){return Qn((s,o)=>{let u=!1;s.subscribe(ei(o,_=>{u=!0,o.next(_)},()=>{u||o.next(n),o.complete()}))})}function vo(n){return n<=0?()=>ko:Qn((s,o)=>{let u=0;s.subscribe(ei(o,_=>{++u<=n&&(o.next(_),n<=u&&o.complete())}))})}function tb(n){return yn(()=>n)}function Ay(n=$k){return Qn((s,o)=>{let u=!1;s.subscribe(ei(o,_=>{u=!0,o.next(_)},()=>u?o.complete():o.error(n())))})}function $k(){return new Za}function pc(n){return Qn((s,o)=>{try{s.subscribe(o)}finally{o.add(n)}})}function la(n,s){let o=arguments.length>=2;return u=>u.pipe(n?yo((_,i)=>n(_,i,u)):Fo,vo(1),o?fc(s):Ay(()=>new Za))}function Id(n){return n<=0?()=>ko:Qn((s,o)=>{let u=[];s.subscribe(ei(o,_=>{u.push(_),n<u.length&&u.shift()},()=>{for(let _ of u)o.next(_);o.complete()},void 0,()=>{u=null}))})}function nb(n,s){let o=arguments.length>=2;return u=>u.pipe(n?yo((_,i)=>n(_,i,u)):Fo,Id(1),o?fc(s):Ay(()=>new Za))}function ib(n,s){return Qn(ZM(n,s,arguments.length>=2,!0))}function XM(n={}){let{connector:s=()=>new or,resetOnError:o=!0,resetOnComplete:u=!0,resetOnRefCountZero:_=!0}=n;return i=>{let P,V,$,re=0,xe=!1,Pe=!1,Xe=()=>{V?.unsubscribe(),V=void 0},Ze=()=>{Xe(),P=$=void 0,xe=Pe=!1},yt=()=>{let lt=P;Ze(),lt?.unsubscribe()};return Qn((lt,Ut)=>{re++,!Pe&&!xe&&Xe();let un=$=$??s();Ut.add(()=>{re--,re===0&&!Pe&&!xe&&(V=rb(yt,_))}),un.subscribe(Ut),!P&&re>0&&(P=new qa({next:an=>un.next(an),error:an=>{Pe=!0,Xe(),V=rb(Ze,o,an),un.error(an)},complete:()=>{xe=!0,Xe(),V=rb(Ze,u),un.complete()}}),qi(lt).subscribe(P))})(i)}}function rb(n,s,...o){if(s===!0){n();return}if(s===!1)return;let u=new qa({next:()=>{u.unsubscribe(),n()}});return qi(s(...o)).subscribe(u)}function Py(n,s,o){let u,_=!1;return n&&typeof n=="object"?{bufferSize:u=1/0,windowTime:s=1/0,refCount:_=!1,scheduler:o}=n:u=n??1/0,XM({connector:()=>new fy(u,s,o),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:_})}function ob(...n){let s=uc(n);return Qn((o,u)=>{(s?Xa(n,o,s):Xa(n,o)).subscribe(u)})}function Or(n,s){return Qn((o,u)=>{let _=null,i=0,P=!1,V=()=>P&&!_&&u.complete();o.subscribe(ei(u,$=>{_?.unsubscribe();let re=0,xe=i++;qi(n($,xe)).subscribe(_=ei(u,Pe=>u.next(s?s($,Pe,xe,re++):Pe),()=>{_=null,V()}))},()=>{P=!0,V()}))})}function sb(n){return Qn((s,o)=>{qi(n).subscribe(ei(o,()=>o.complete(),am)),!o.closed&&s.subscribe(o)})}function er(n,s,o){let u=Pn(n)||s||o?{next:n,error:s,complete:o}:n;return u?Qn((_,i)=>{var P;(P=u.subscribe)===null||P===void 0||P.call(u);let V=!0;_.subscribe(ei(i,$=>{var re;(re=u.next)===null||re===void 0||re.call(u,$),i.next($)},()=>{var $;V=!1,($=u.complete)===null||$===void 0||$.call(u),i.complete()},$=>{var re;V=!1,(re=u.error)===null||re===void 0||re.call(u,$),i.error($)},()=>{var $,re;V&&(($=u.unsubscribe)===null||$===void 0||$.call(u)),(re=u.finalize)===null||re===void 0||re.call(u)}))}):Fo}var kS="https://g.co/ng/security#xss",cn=class extends Error{constructor(s,o){super(f0(s,o)),this.code=s}};function f0(n,s){return`${`NG0${Math.abs(n)}`}${s?": "+s:""}`}function Tm(n){return{toString:n}.toString()}var Ry="__parameters__";function Gk(n){return function(...o){if(n){let u=n(...o);for(let _ in u)this[_]=u[_]}}}function NS(n,s,o){return Tm(()=>{let u=Gk(s);function _(...i){if(this instanceof _)return u.apply(this,i),this;let P=new _(...i);return V.annotation=P,V;function V($,re,xe){let Pe=$.hasOwnProperty(Ry)?$[Ry]:Object.defineProperty($,Ry,{value:[]})[Ry];for(;Pe.length<=xe;)Pe.push(null);return(Pe[xe]=Pe[xe]||[]).push(P),$}}return o&&(_.prototype=Object.create(o.prototype)),_.prototype.ngMetadataName=n,_.annotationCls=_,_})}var No=globalThis;function Ci(n){for(let s in n)if(n[s]===Ci)return s;throw Error("Could not find renamed property on target object.")}function Hk(n,s){for(let o in s)s.hasOwnProperty(o)&&!n.hasOwnProperty(o)&&(n[o]=s[o])}function io(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(io).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let s=n.toString();if(s==null)return""+s;let o=s.indexOf(`
`);return o===-1?s:s.substring(0,o)}function YM(n,s){return n==null||n===""?s===null?"":s:s==null||s===""?n:n+" "+s}var qk=Ci({__forward_ref__:Ci});function bc(n){return n.__forward_ref__=bc,n.toString=function(){return io(this())},n}function no(n){return zS(n)?n():n}function zS(n){return typeof n=="function"&&n.hasOwnProperty(qk)&&n.__forward_ref__===bc}function Wt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ts(n){return{providers:n.providers||[],imports:n.imports||[]}}function p0(n){return KM(n,VS)||KM(n,jS)}function BS(n){return p0(n)!==null}function KM(n,s){return n.hasOwnProperty(s)?n[s]:null}function Wk(n){let s=n&&(n[VS]||n[jS]);return s||null}function JM(n){return n&&(n.hasOwnProperty(QM)||n.hasOwnProperty(Zk))?n[QM]:null}var VS=Ci({\u0275prov:Ci}),QM=Ci({\u0275inj:Ci}),jS=Ci({ngInjectableDef:Ci}),Zk=Ci({ngInjectorDef:Ci}),en=class{constructor(s,o){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof o=="number"?this.__NG_ELEMENT_ID__=o:o!==void 0&&(this.\u0275prov=Wt({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function US(n){return n&&!!n.\u0275providers}var Xk=Ci({\u0275cmp:Ci}),Yk=Ci({\u0275dir:Ci}),Kk=Ci({\u0275pipe:Ci}),Jk=Ci({\u0275mod:Ci}),$y=Ci({\u0275fac:Ci}),um=Ci({__NG_ELEMENT_ID__:Ci}),eS=Ci({__NG_ENV_ID__:Ci});function Rd(n){return typeof n=="string"?n:n==null?"":String(n)}function Qk(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Rd(n)}function e3(n,s){let o=s?`. Dependency path: ${s.join(" > ")} > ${n}`:"";throw new cn(-200,n)}function xw(n,s){throw new cn(-201,!1)}var Wn=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Wn||{}),Eb;function $S(){return Eb}function xo(n){let s=Eb;return Eb=n,s}function GS(n,s,o){let u=p0(n);if(u&&u.providedIn=="root")return u.value===void 0?u.value=u.factory():u.value;if(o&Wn.Optional)return null;if(s!==void 0)return s;xw(n,"Injector")}var t3={},hm=t3,Ib="__NG_DI_FLAG__",Gy="ngTempTokenPath",n3="ngTokenPath",i3=/\n/gm,r3="\u0275",tS="__source",Ad;function o3(){return Ad}function mc(n){let s=Ad;return Ad=n,s}function s3(n,s=Wn.Default){if(Ad===void 0)throw new cn(-203,!1);return Ad===null?GS(n,void 0,s):Ad.get(n,s&Wn.Optional?null:void 0,s)}function Zt(n,s=Wn.Default){return($S()||s3)(no(n),s)}function Ct(n,s=Wn.Default){return Zt(n,m0(s))}function m0(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Cb(n){let s=[];for(let o=0;o<n.length;o++){let u=no(n[o]);if(Array.isArray(u)){if(u.length===0)throw new cn(900,!1);let _,i=Wn.Default;for(let P=0;P<u.length;P++){let V=u[P],$=a3(V);typeof $=="number"?$===-1?_=V.token:i|=$:_=V}s.push(Zt(_,i))}else s.push(Zt(u))}return s}function HS(n,s){return n[Ib]=s,n.prototype[Ib]=s,n}function a3(n){return n[Ib]}function l3(n,s,o,u){let _=n[Gy];throw s[tS]&&_.unshift(s[tS]),n.message=c3(`
`+n.message,_,o,u),n[n3]=_,n[Gy]=null,n}function c3(n,s,o,u=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==r3?n.slice(2):n;let _=io(s);if(Array.isArray(s))_=s.map(io).join(" -> ");else if(typeof s=="object"){let i=[];for(let P in s)if(s.hasOwnProperty(P)){let V=s[P];i.push(P+":"+(typeof V=="string"?JSON.stringify(V):io(V)))}_=`{${i.join(", ")}}`}return`${o}${u?"("+u+")":""}[${_}]: ${n.replace(i3,`
  `)}`}var g0=HS(NS("Optional"),8);var bw=HS(NS("SkipSelf"),4);function Vu(n,s){let o=n.hasOwnProperty($y);return o?n[$y]:null}function u3(n,s,o){if(n.length!==s.length)return!1;for(let u=0;u<n.length;u++){let _=n[u],i=s[u];if(o&&(_=o(_),i=o(i)),i!==_)return!1}return!0}function h3(n){return n.flat(Number.POSITIVE_INFINITY)}function ww(n,s){n.forEach(o=>Array.isArray(o)?ww(o,s):s(o))}function qS(n,s,o){s>=n.length?n.push(o):n.splice(s,0,o)}function Hy(n,s){return s>=n.length-1?n.pop():n.splice(s,1)[0]}function d3(n,s,o,u){let _=n.length;if(_==s)n.push(o,u);else if(_===1)n.push(u,n[0]),n[0]=o;else{for(_--,n.push(n[_-1],n[_]);_>s;){let i=_-2;n[_]=n[i],_--}n[s]=o,n[s+1]=u}}function f3(n,s,o){let u=Em(n,s);return u>=0?n[u|1]=o:(u=~u,d3(n,u,s,o)),u}function ab(n,s){let o=Em(n,s);if(o>=0)return n[o|1]}function Em(n,s){return p3(n,s,1)}function p3(n,s,o){let u=0,_=n.length>>o;for(;_!==u;){let i=u+(_-u>>1),P=n[i<<o];if(s===P)return i<<o;P>s?_=i:u=i+1}return~(_<<o)}var Od={},es=[],Ld=new en(""),WS=new en("",-1),ZS=new en(""),qy=class{get(s,o=hm){if(o===hm){let u=new Error(`NullInjectorError: No provider for ${io(s)}!`);throw u.name="NullInjectorError",u}return o}},XS=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(XS||{}),ha=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(ha||{}),Lr=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(Lr||{});function m3(n,s,o){let u=n.length;for(;;){let _=n.indexOf(s,o);if(_===-1)return _;if(_===0||n.charCodeAt(_-1)<=32){let i=s.length;if(_+i===u||n.charCodeAt(_+i)<=32)return _}o=_+1}}function Db(n,s,o){let u=0;for(;u<o.length;){let _=o[u];if(typeof _=="number"){if(_!==0)break;u++;let i=o[u++],P=o[u++],V=o[u++];n.setAttribute(s,P,V,i)}else{let i=_,P=o[++u];g3(i)?n.setProperty(s,i,P):n.setAttribute(s,i,P),u++}}return u}function YS(n){return n===3||n===4||n===6}function g3(n){return n.charCodeAt(0)===64}function dm(n,s){if(!(s===null||s.length===0))if(n===null||n.length===0)n=s.slice();else{let o=-1;for(let u=0;u<s.length;u++){let _=s[u];typeof _=="number"?o=_:o===0||(o===-1||o===2?nS(n,o,_,null,s[++u]):nS(n,o,_,null,null))}}return n}function nS(n,s,o,u,_){let i=0,P=n.length;if(s===-1)P=-1;else for(;i<n.length;){let V=n[i++];if(typeof V=="number"){if(V===s){P=-1;break}else if(V>s){P=i-1;break}}}for(;i<n.length;){let V=n[i];if(typeof V=="number")break;if(V===o){if(u===null){_!==null&&(n[i+1]=_);return}else if(u===n[i+1]){n[i+2]=_;return}}i++,u!==null&&i++,_!==null&&i++}P!==-1&&(n.splice(P,0,s),i=P+1),n.splice(i++,0,o),u!==null&&n.splice(i++,0,u),_!==null&&n.splice(i++,0,_)}var KS="ng-template";function _3(n,s,o,u){let _=0;if(u){for(;_<s.length&&typeof s[_]=="string";_+=2)if(s[_]==="class"&&m3(s[_+1].toLowerCase(),o,0)!==-1)return!0}else if(Tw(n))return!1;if(_=s.indexOf(1,_),_>-1){let i;for(;++_<s.length&&typeof(i=s[_])=="string";)if(i.toLowerCase()===o)return!0}return!1}function Tw(n){return n.type===4&&n.value!==KS}function y3(n,s,o){let u=n.type===4&&!o?KS:n.value;return s===u}function v3(n,s,o){let u=4,_=n.attrs,i=_!==null?w3(_):0,P=!1;for(let V=0;V<s.length;V++){let $=s[V];if(typeof $=="number"){if(!P&&!As(u)&&!As($))return!1;if(P&&As($))continue;P=!1,u=$|u&1;continue}if(!P)if(u&4){if(u=2|u&1,$!==""&&!y3(n,$,o)||$===""&&s.length===1){if(As(u))return!1;P=!0}}else if(u&8){if(_===null||!_3(n,_,$,o)){if(As(u))return!1;P=!0}}else{let re=s[++V],xe=x3($,_,Tw(n),o);if(xe===-1){if(As(u))return!1;P=!0;continue}if(re!==""){let Pe;if(xe>i?Pe="":Pe=_[xe+1].toLowerCase(),u&2&&re!==Pe){if(As(u))return!1;P=!0}}}}return As(u)||P}function As(n){return(n&1)===0}function x3(n,s,o,u){if(s===null)return-1;let _=0;if(u||!o){let i=!1;for(;_<s.length;){let P=s[_];if(P===n)return _;if(P===3||P===6)i=!0;else if(P===1||P===2){let V=s[++_];for(;typeof V=="string";)V=s[++_];continue}else{if(P===4)break;if(P===0){_+=4;continue}}_+=i?1:2}return-1}else return T3(s,n)}function b3(n,s,o=!1){for(let u=0;u<s.length;u++)if(v3(n,s[u],o))return!0;return!1}function w3(n){for(let s=0;s<n.length;s++){let o=n[s];if(YS(o))return s}return n.length}function T3(n,s){let o=n.indexOf(4);if(o>-1)for(o++;o<n.length;){let u=n[o];if(typeof u=="number")return-1;if(u===s)return o;o++}return-1}function iS(n,s){return n?":not("+s.trim()+")":s}function E3(n){let s=n[0],o=1,u=2,_="",i=!1;for(;o<n.length;){let P=n[o];if(typeof P=="string")if(u&2){let V=n[++o];_+="["+P+(V.length>0?'="'+V+'"':"")+"]"}else u&8?_+="."+P:u&4&&(_+=" "+P);else _!==""&&!As(P)&&(s+=iS(i,_),_=""),u=P,i=i||!As(u);o++}return _!==""&&(s+=iS(i,_)),s}function I3(n){return n.map(E3).join(",")}function C3(n){let s=[],o=[],u=1,_=2;for(;u<n.length;){let i=n[u];if(typeof i=="string")_===2?i!==""&&s.push(i,n[++u]):_===8&&o.push(i);else{if(!As(_))break;_=i}u++}return{attrs:s,classes:o}}function Pi(n){return Tm(()=>{let s=nA(n),o=yi(St({},s),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===XS.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||ha.Emulated,styles:n.styles||es,_:null,schemas:n.schemas||null,tView:null,id:""});iA(o);let u=n.dependencies;return o.directiveDefs=oS(u,!1),o.pipeDefs=oS(u,!0),o.id=S3(o),o})}function D3(n){return _c(n)||JS(n)}function M3(n){return n!==null}function ns(n){return Tm(()=>({type:n.type,bootstrap:n.bootstrap||es,declarations:n.declarations||es,imports:n.imports||es,exports:n.exports||es,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function rS(n,s){if(n==null)return Od;let o={};for(let u in n)if(n.hasOwnProperty(u)){let _=n[u],i,P,V=Lr.None;Array.isArray(_)?(V=_[0],i=_[1],P=_[2]??i):(i=_,P=_),s?(o[i]=V!==Lr.None?[u,V]:u,s[i]=P):o[i]=u}return o}function Xi(n){return Tm(()=>{let s=nA(n);return iA(s),s})}function Im(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone===!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function _c(n){return n[Xk]||null}function JS(n){return n[Yk]||null}function QS(n){return n[Kk]||null}function eA(n){let s=_c(n)||JS(n)||QS(n);return s!==null?s.standalone:!1}function tA(n,s){let o=n[Jk]||null;if(!o&&s===!0)throw new Error(`Type ${io(n)} does not have '\u0275mod' property.`);return o}function nA(n){let s={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:n.inputs||Od,exportAs:n.exportAs||null,standalone:n.standalone===!0,signals:n.signals===!0,selectors:n.selectors||es,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:rS(n.inputs,s),outputs:rS(n.outputs),debugInfo:null}}function iA(n){n.features?.forEach(s=>s(n))}function oS(n,s){if(!n)return null;let o=s?QS:D3;return()=>(typeof n=="function"?n():n).map(u=>o(u)).filter(M3)}function S3(n){let s=0,o=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(let _ of o)s=Math.imul(31,s)+_.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function Xu(n){return{\u0275providers:n}}function Ew(...n){return{\u0275providers:rA(!0,n),\u0275fromNgModule:!0}}function rA(n,...s){let o=[],u=new Set,_,i=P=>{o.push(P)};return ww(s,P=>{let V=P;Mb(V,i,[],u)&&(_||=[],_.push(V))}),_!==void 0&&oA(_,i),o}function oA(n,s){for(let o=0;o<n.length;o++){let{ngModule:u,providers:_}=n[o];Iw(_,i=>{s(i,u)})}}function Mb(n,s,o,u){if(n=no(n),!n)return!1;let _=null,i=JM(n),P=!i&&_c(n);if(!i&&!P){let $=n.ngModule;if(i=JM($),i)_=$;else return!1}else{if(P&&!P.standalone)return!1;_=n}let V=u.has(_);if(P){if(V)return!1;if(u.add(_),P.dependencies){let $=typeof P.dependencies=="function"?P.dependencies():P.dependencies;for(let re of $)Mb(re,s,o,u)}}else if(i){if(i.imports!=null&&!V){u.add(_);let re;try{ww(i.imports,xe=>{Mb(xe,s,o,u)&&(re||=[],re.push(xe))})}finally{}re!==void 0&&oA(re,s)}if(!V){let re=Vu(_)||(()=>new _);s({provide:_,useFactory:re,deps:es},_),s({provide:ZS,useValue:_,multi:!0},_),s({provide:Ld,useValue:()=>Zt(_),multi:!0},_)}let $=i.providers;if($!=null&&!V){let re=n;Iw($,xe=>{s(xe,re)})}}else return!1;return _!==n&&n.providers!==void 0}function Iw(n,s){for(let o of n)US(o)&&(o=o.\u0275providers),Array.isArray(o)?Iw(o,s):s(o)}var A3=Ci({provide:String,useValue:Ci});function sA(n){return n!==null&&typeof n=="object"&&A3 in n}function P3(n){return!!(n&&n.useExisting)}function R3(n){return!!(n&&n.useFactory)}function Fd(n){return typeof n=="function"}function O3(n){return!!n.useClass}var _0=new en(""),Ny={},L3={},lb;function Cw(){return lb===void 0&&(lb=new qy),lb}var $r=class{},fm=class extends $r{get destroyed(){return this._destroyed}constructor(s,o,u,_){super(),this.parent=o,this.source=u,this.scopes=_,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ab(s,P=>this.processProvider(P)),this.records.set(WS,Cd(void 0,this)),_.has("environment")&&this.records.set($r,Cd(void 0,this));let i=this.records.get(_0);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(ZS,es,Wn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let s=li(null);try{for(let u of this._ngOnDestroyHooks)u.ngOnDestroy();let o=this._onDestroyHooks;this._onDestroyHooks=[];for(let u of o)u()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),li(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();let o=mc(this),u=xo(void 0),_;try{return s()}finally{mc(o),xo(u)}}get(s,o=hm,u=Wn.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(eS))return s[eS](this);u=m0(u);let _,i=mc(this),P=xo(void 0);try{if(!(u&Wn.SkipSelf)){let $=this.records.get(s);if($===void 0){let re=B3(s)&&p0(s);re&&this.injectableDefInScope(re)?$=Cd(Sb(s),Ny):$=null,this.records.set(s,$)}if($!=null)return this.hydrate(s,$)}let V=u&Wn.Self?Cw():this.parent;return o=u&Wn.Optional&&o===hm?null:o,V.get(s,o)}catch(V){if(V.name==="NullInjectorError"){if((V[Gy]=V[Gy]||[]).unshift(io(s)),i)throw V;return l3(V,s,"R3InjectorError",this.source)}else throw V}finally{xo(P),mc(i)}}resolveInjectorInitializers(){let s=li(null),o=mc(this),u=xo(void 0),_;try{let i=this.get(Ld,es,Wn.Self);for(let P of i)P()}finally{mc(o),xo(u),li(s)}}toString(){let s=[],o=this.records;for(let u of o.keys())s.push(io(u));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new cn(205,!1)}processProvider(s){s=no(s);let o=Fd(s)?s:no(s&&s.provide),u=k3(s);if(!Fd(s)&&s.multi===!0){let _=this.records.get(o);_||(_=Cd(void 0,Ny,!0),_.factory=()=>Cb(_.multi),this.records.set(o,_)),o=s,_.multi.push(s)}this.records.set(o,u)}hydrate(s,o){let u=li(null);try{return o.value===Ny&&(o.value=L3,o.value=o.factory()),typeof o.value=="object"&&o.value&&z3(o.value)&&this._ngOnDestroyHooks.add(o.value),o.value}finally{li(u)}}injectableDefInScope(s){if(!s.providedIn)return!1;let o=no(s.providedIn);return typeof o=="string"?o==="any"||this.scopes.has(o):this.injectorDefTypes.has(o)}removeOnDestroy(s){let o=this._onDestroyHooks.indexOf(s);o!==-1&&this._onDestroyHooks.splice(o,1)}};function Sb(n){let s=p0(n),o=s!==null?s.factory:Vu(n);if(o!==null)return o;if(n instanceof en)throw new cn(204,!1);if(n instanceof Function)return F3(n);throw new cn(204,!1)}function F3(n){if(n.length>0)throw new cn(204,!1);let o=Wk(n);return o!==null?()=>o.factory(n):()=>new n}function k3(n){if(sA(n))return Cd(void 0,n.useValue);{let s=aA(n);return Cd(s,Ny)}}function aA(n,s,o){let u;if(Fd(n)){let _=no(n);return Vu(_)||Sb(_)}else if(sA(n))u=()=>no(n.useValue);else if(R3(n))u=()=>n.useFactory(...Cb(n.deps||[]));else if(P3(n))u=()=>Zt(no(n.useExisting));else{let _=no(n&&(n.useClass||n.provide));if(N3(n))u=()=>new _(...Cb(n.deps));else return Vu(_)||Sb(_)}return u}function Cd(n,s,o=!1){return{factory:n,value:s,multi:o?[]:void 0}}function N3(n){return!!n.deps}function z3(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function B3(n){return typeof n=="function"||typeof n=="object"&&n instanceof en}function Ab(n,s){for(let o of n)Array.isArray(o)?Ab(o,s):o&&US(o)?Ab(o.\u0275providers,s):s(o)}function Ls(n,s){n instanceof fm&&n.assertNotDestroyed();let o,u=mc(n),_=xo(void 0);try{return s()}finally{mc(u),xo(_)}}function lA(){return $S()!==void 0||o3()!=null}function V3(n){if(!lA())throw new cn(-203,!1)}function j3(n){return typeof n=="function"}var Qa=0,Rn=1,En=2,Fr=3,Ps=4,Fs=5,pm=6,mm=7,ro=8,kd=9,Rs=10,pr=11,gm=12,sS=13,jd=14,Os=15,Cm=16,Dd=17,Ya=18,y0=19,cA=20,gc=21,cb=22,ju=23,bo=25,uA=1;var Uu=7,Wy=8,Nd=9,Ur=10,Dw=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(Dw||{});function zu(n){return Array.isArray(n)&&typeof n[uA]=="object"}function el(n){return Array.isArray(n)&&n[uA]===!0}function Mw(n){return(n.flags&4)!==0}function v0(n){return n.componentOffset>-1}function x0(n){return(n.flags&1)===1}function yc(n){return!!n.template}function U3(n){return(n[En]&512)!==0}var Pb=class{constructor(s,o,u){this.previousValue=s,this.currentValue=o,this.firstChange=u}isFirstChange(){return this.firstChange}};function hA(n,s,o,u){s!==null?s.applyValueToInputSignal(s,u):n[o]=u}function tl(){return dA}function dA(n){return n.type.prototype.ngOnChanges&&(n.setInput=G3),$3}tl.ngInherit=!0;function $3(){let n=pA(this),s=n?.current;if(s){let o=n.previous;if(o===Od)n.previous=s;else for(let u in s)o[u]=s[u];n.current=null,this.ngOnChanges(s)}}function G3(n,s,o,u,_){let i=this.declaredInputs[u],P=pA(n)||H3(n,{previous:Od,current:null}),V=P.current||(P.current={}),$=P.previous,re=$[i];V[i]=new Pb(re&&re.currentValue,o,$===Od),hA(n,s,_,o)}var fA="__ngSimpleChanges__";function pA(n){return n[fA]||null}function H3(n,s){return n[fA]=s}var aS=null;var ca=function(n,s,o){aS?.(n,s,o)},q3="svg",W3="math",Z3=!1;function X3(){return Z3}function da(n){for(;Array.isArray(n);)n=n[Qa];return n}function mA(n,s){return da(s[n])}function is(n,s){return da(s[n.index])}function Sw(n,s){return n.data[s]}function Aw(n,s){return n[s]}function wc(n,s){let o=s[n];return zu(o)?o:o[Qa]}function Y3(n){return(n[En]&4)===4}function Pw(n){return(n[En]&128)===128}function K3(n){return el(n[Fr])}function zd(n,s){return s==null?null:n[s]}function gA(n){n[Dd]=0}function J3(n){n[En]&1024||(n[En]|=1024,Pw(n)&&_m(n))}function Q3(n,s){for(;n>0;)s=s[jd],n--;return s}function Rw(n){return!!(n[En]&9216||n[ju]?.dirty)}function Rb(n){n[Rs].changeDetectionScheduler?.notify(1),Rw(n)?_m(n):n[En]&64&&(X3()?(n[En]|=1024,_m(n)):n[Rs].changeDetectionScheduler?.notify())}function _m(n){n[Rs].changeDetectionScheduler?.notify();let s=ym(n);for(;s!==null&&!(s[En]&8192||(s[En]|=8192,!Pw(s)));)s=ym(s)}function _A(n,s){if((n[En]&256)===256)throw new cn(911,!1);n[gc]===null&&(n[gc]=[]),n[gc].push(s)}function eN(n,s){if(n[gc]===null)return;let o=n[gc].indexOf(s);o!==-1&&n[gc].splice(o,1)}function ym(n){let s=n[Fr];return el(s)?s[Fr]:s}var Gn={lFrame:IA(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function tN(){return Gn.lFrame.elementDepthCount}function nN(){Gn.lFrame.elementDepthCount++}function iN(){Gn.lFrame.elementDepthCount--}function yA(){return Gn.bindingsEnabled}function rN(){return Gn.skipHydrationRootTNode!==null}function oN(n){return Gn.skipHydrationRootTNode===n}function sN(){Gn.skipHydrationRootTNode=null}function Hn(){return Gn.lFrame.lView}function xr(){return Gn.lFrame.tView}function Ud(n){return Gn.lFrame.contextLView=n,n[ro]}function $d(n){return Gn.lFrame.contextLView=null,n}function oo(){let n=vA();for(;n!==null&&n.type===64;)n=n.parent;return n}function vA(){return Gn.lFrame.currentTNode}function aN(){let n=Gn.lFrame,s=n.currentTNode;return n.isParent?s:s.parent}function Yu(n,s){let o=Gn.lFrame;o.currentTNode=n,o.isParent=s}function Ow(){return Gn.lFrame.isParent}function xA(){Gn.lFrame.isParent=!1}function Gd(){let n=Gn.lFrame,s=n.bindingRootIndex;return s===-1&&(s=n.bindingRootIndex=n.tView.bindingStartIndex),s}function lN(){return Gn.lFrame.bindingIndex}function cN(n){return Gn.lFrame.bindingIndex=n}function b0(){return Gn.lFrame.bindingIndex++}function bA(n){let s=Gn.lFrame,o=s.bindingIndex;return s.bindingIndex=s.bindingIndex+n,o}function uN(){return Gn.lFrame.inI18n}function hN(n,s){let o=Gn.lFrame;o.bindingIndex=o.bindingRootIndex=n,Ob(s)}function dN(){return Gn.lFrame.currentDirectiveIndex}function Ob(n){Gn.lFrame.currentDirectiveIndex=n}function fN(n){let s=Gn.lFrame.currentDirectiveIndex;return s===-1?null:n[s]}function wA(){return Gn.lFrame.currentQueryIndex}function Lw(n){Gn.lFrame.currentQueryIndex=n}function pN(n){let s=n[Rn];return s.type===2?s.declTNode:s.type===1?n[Fs]:null}function TA(n,s,o){if(o&Wn.SkipSelf){let _=s,i=n;for(;_=_.parent,_===null&&!(o&Wn.Host);)if(_=pN(i),_===null||(i=i[jd],_.type&10))break;if(_===null)return!1;s=_,n=i}let u=Gn.lFrame=EA();return u.currentTNode=s,u.lView=n,!0}function Fw(n){let s=EA(),o=n[Rn];Gn.lFrame=s,s.currentTNode=o.firstChild,s.lView=n,s.tView=o,s.contextLView=n,s.bindingIndex=o.bindingStartIndex,s.inI18n=!1}function EA(){let n=Gn.lFrame,s=n===null?null:n.child;return s===null?IA(n):s}function IA(n){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=s),s}function CA(){let n=Gn.lFrame;return Gn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var DA=CA;function kw(){let n=CA();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function mN(n){return(Gn.lFrame.contextLView=Q3(n,Gn.lFrame.contextLView))[ro]}function Tc(){return Gn.lFrame.selectedIndex}function $u(n){Gn.lFrame.selectedIndex=n}function Nw(){let n=Gn.lFrame;return Sw(n.tView,n.selectedIndex)}function gN(){return Gn.lFrame.currentNamespace}var MA=!0;function w0(){return MA}function T0(n){MA=n}function _N(n,s,o){let{ngOnChanges:u,ngOnInit:_,ngDoCheck:i}=s.type.prototype;if(u){let P=dA(s);(o.preOrderHooks??=[]).push(n,P),(o.preOrderCheckHooks??=[]).push(n,P)}_&&(o.preOrderHooks??=[]).push(0-n,_),i&&((o.preOrderHooks??=[]).push(n,i),(o.preOrderCheckHooks??=[]).push(n,i))}function E0(n,s){for(let o=s.directiveStart,u=s.directiveEnd;o<u;o++){let i=n.data[o].type.prototype,{ngAfterContentInit:P,ngAfterContentChecked:V,ngAfterViewInit:$,ngAfterViewChecked:re,ngOnDestroy:xe}=i;P&&(n.contentHooks??=[]).push(-o,P),V&&((n.contentHooks??=[]).push(o,V),(n.contentCheckHooks??=[]).push(o,V)),$&&(n.viewHooks??=[]).push(-o,$),re&&((n.viewHooks??=[]).push(o,re),(n.viewCheckHooks??=[]).push(o,re)),xe!=null&&(n.destroyHooks??=[]).push(o,xe)}}function zy(n,s,o){SA(n,s,3,o)}function By(n,s,o,u){(n[En]&3)===o&&SA(n,s,o,u)}function ub(n,s){let o=n[En];(o&3)===s&&(o&=16383,o+=1,n[En]=o)}function SA(n,s,o,u){let _=u!==void 0?n[Dd]&65535:0,i=u??-1,P=s.length-1,V=0;for(let $=_;$<P;$++)if(typeof s[$+1]=="number"){if(V=s[$],u!=null&&V>=u)break}else s[$]<0&&(n[Dd]+=65536),(V<i||i==-1)&&(yN(n,o,s,$),n[Dd]=(n[Dd]&4294901760)+$+2),$++}function lS(n,s){ca(4,n,s);let o=li(null);try{s.call(n)}finally{li(o),ca(5,n,s)}}function yN(n,s,o,u){let _=o[u]<0,i=o[u+1],P=_?-o[u]:o[u],V=n[P];_?n[En]>>14<n[Dd]>>16&&(n[En]&3)===s&&(n[En]+=16384,lS(V,i)):lS(V,i)}var Pd=-1,Gu=class{constructor(s,o,u){this.factory=s,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=u}};function vN(n){return n instanceof Gu}function xN(n){return(n.flags&8)!==0}function bN(n){return(n.flags&16)!==0}function AA(n){return n!==Pd}function Zy(n){return n&32767}function wN(n){return n>>16}function Xy(n,s){let o=wN(n),u=s;for(;o>0;)u=u[jd],o--;return u}var Lb=!0;function Yy(n){let s=Lb;return Lb=n,s}var TN=256,PA=TN-1,RA=5,EN=0,ua={};function IN(n,s,o){let u;typeof o=="string"?u=o.charCodeAt(0)||0:o.hasOwnProperty(um)&&(u=o[um]),u==null&&(u=o[um]=EN++);let _=u&PA,i=1<<_;s.data[n+(_>>RA)]|=i}function Ky(n,s){let o=OA(n,s);if(o!==-1)return o;let u=s[Rn];u.firstCreatePass&&(n.injectorIndex=s.length,hb(u.data,n),hb(s,null),hb(u.blueprint,null));let _=zw(n,s),i=n.injectorIndex;if(AA(_)){let P=Zy(_),V=Xy(_,s),$=V[Rn].data;for(let re=0;re<8;re++)s[i+re]=V[P+re]|$[P+re]}return s[i+8]=_,i}function hb(n,s){n.push(0,0,0,0,0,0,0,0,s)}function OA(n,s){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||s[n.injectorIndex+8]===null?-1:n.injectorIndex}function zw(n,s){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let o=0,u=null,_=s;for(;_!==null;){if(u=zA(_),u===null)return Pd;if(o++,_=_[jd],u.injectorIndex!==-1)return u.injectorIndex|o<<16}return Pd}function Fb(n,s,o){IN(n,s,o)}function CN(n,s){if(s==="class")return n.classes;if(s==="style")return n.styles;let o=n.attrs;if(o){let u=o.length,_=0;for(;_<u;){let i=o[_];if(YS(i))break;if(i===0)_=_+2;else if(typeof i=="number")for(_++;_<u&&typeof o[_]=="string";)_++;else{if(i===s)return o[_+1];_=_+2}}}return null}function LA(n,s,o){if(o&Wn.Optional||n!==void 0)return n;xw(s,"NodeInjector")}function FA(n,s,o,u){if(o&Wn.Optional&&u===void 0&&(u=null),!(o&(Wn.Self|Wn.Host))){let _=n[kd],i=xo(void 0);try{return _?_.get(s,u,o&Wn.Optional):GS(s,u,o&Wn.Optional)}finally{xo(i)}}return LA(u,s,o)}function kA(n,s,o,u=Wn.Default,_){if(n!==null){if(s[En]&2048&&!(u&Wn.Self)){let P=AN(n,s,o,u,ua);if(P!==ua)return P}let i=NA(n,s,o,u,ua);if(i!==ua)return i}return FA(s,o,u,_)}function NA(n,s,o,u,_){let i=MN(o);if(typeof i=="function"){if(!TA(s,n,u))return u&Wn.Host?LA(_,o,u):FA(s,o,u,_);try{let P;if(P=i(u),P==null&&!(u&Wn.Optional))xw(o);else return P}finally{DA()}}else if(typeof i=="number"){let P=null,V=OA(n,s),$=Pd,re=u&Wn.Host?s[Os][Fs]:null;for((V===-1||u&Wn.SkipSelf)&&($=V===-1?zw(n,s):s[V+8],$===Pd||!uS(u,!1)?V=-1:(P=s[Rn],V=Zy($),s=Xy($,s)));V!==-1;){let xe=s[Rn];if(cS(i,V,xe.data)){let Pe=DN(V,s,o,P,u,re);if(Pe!==ua)return Pe}$=s[V+8],$!==Pd&&uS(u,s[Rn].data[V+8]===re)&&cS(i,V,s)?(P=xe,V=Zy($),s=Xy($,s)):V=-1}}return _}function DN(n,s,o,u,_,i){let P=s[Rn],V=P.data[n+8],$=u==null?v0(V)&&Lb:u!=P&&(V.type&3)!==0,re=_&Wn.Host&&i===V,xe=Vy(V,P,o,$,re);return xe!==null?Hu(s,P,xe,V):ua}function Vy(n,s,o,u,_){let i=n.providerIndexes,P=s.data,V=i&1048575,$=n.directiveStart,re=n.directiveEnd,xe=i>>20,Pe=u?V:V+xe,Xe=_?V+xe:re;for(let Ze=Pe;Ze<Xe;Ze++){let yt=P[Ze];if(Ze<$&&o===yt||Ze>=$&&yt.type===o)return Ze}if(_){let Ze=P[$];if(Ze&&yc(Ze)&&Ze.type===o)return $}return null}function Hu(n,s,o,u){let _=n[o],i=s.data;if(vN(_)){let P=_;P.resolving&&e3(Qk(i[o]));let V=Yy(P.canSeeViewProviders);P.resolving=!0;let $,re=P.injectImpl?xo(P.injectImpl):null,xe=TA(n,u,Wn.Default);try{_=n[o]=P.factory(void 0,i,n,u),s.firstCreatePass&&o>=u.directiveStart&&_N(o,i[o],s)}finally{re!==null&&xo(re),Yy(V),P.resolving=!1,DA()}}return _}function MN(n){if(typeof n=="string")return n.charCodeAt(0)||0;let s=n.hasOwnProperty(um)?n[um]:void 0;return typeof s=="number"?s>=0?s&PA:SN:s}function cS(n,s,o){let u=1<<n;return!!(o[s+(n>>RA)]&u)}function uS(n,s){return!(n&Wn.Self)&&!(n&Wn.Host&&s)}var Bu=class{constructor(s,o){this._tNode=s,this._lView=o}get(s,o,u){return kA(this._tNode,this._lView,s,m0(u),o)}};function SN(){return new Bu(oo(),Hn())}function ks(n){return Tm(()=>{let s=n.prototype.constructor,o=s[$y]||kb(s),u=Object.prototype,_=Object.getPrototypeOf(n.prototype).constructor;for(;_&&_!==u;){let i=_[$y]||kb(_);if(i&&i!==o)return i;_=Object.getPrototypeOf(_)}return i=>new i})}function kb(n){return zS(n)?()=>{let s=kb(no(n));return s&&s()}:Vu(n)}function AN(n,s,o,u,_){let i=n,P=s;for(;i!==null&&P!==null&&P[En]&2048&&!(P[En]&512);){let V=NA(i,P,o,u|Wn.Self,ua);if(V!==ua)return V;let $=i.parent;if(!$){let re=P[cA];if(re){let xe=re.get(o,ua,u);if(xe!==ua)return xe}$=zA(P),P=P[jd]}i=$}return _}function zA(n){let s=n[Rn],o=s.type;return o===2?s.declTNode:o===1?n[Fs]:null}function Bw(n){return CN(oo(),n)}function hS(n,s=null,o=null,u){let _=BA(n,s,o,u);return _.resolveInjectorInitializers(),_}function BA(n,s=null,o=null,u,_=new Set){let i=[o||es,Ew(n)];return u=u||(typeof n=="object"?void 0:io(n)),new fm(i,s||Cw(),u||null,_)}var nl=(()=>{class n{static{this.THROW_IF_NOT_FOUND=hm}static{this.NULL=new qy}static create(o,u){if(Array.isArray(o))return hS({name:""},u,o,"");{let _=o.name??"";return hS({name:_},o.parent,o.providers,_)}}static{this.\u0275prov=Wt({token:n,providedIn:"any",factory:()=>Zt(WS)})}static{this.__NG_ELEMENT_ID__=-1}}return n})();var PN="ngOriginalError";function db(n){return n[PN]}var fa=class{constructor(){this._console=console}handleError(s){let o=this._findOriginalError(s);this._console.error("ERROR",s),o&&this._console.error("ORIGINAL ERROR",o)}_findOriginalError(s){let o=s&&db(s);for(;o&&db(o);)o=db(o);return o||null}},VA=new en("",{providedIn:"root",factory:()=>Ct(fa).handleError.bind(void 0)}),Vw=(()=>{class n{static{this.__NG_ELEMENT_ID__=RN}static{this.__NG_ENV_ID__=o=>o}}return n})(),Nb=class extends Vw{constructor(s){super(),this._lView=s}onDestroy(s){return _A(this._lView,s),()=>eN(this._lView,s)}};function RN(){return new Nb(Hn())}function ON(){return Hd(oo(),Hn())}function Hd(n,s){return new Gr(is(n,s))}var Gr=(()=>{class n{constructor(o){this.nativeElement=o}static{this.__NG_ELEMENT_ID__=ON}}return n})();function LN(n){return n instanceof Gr?n.nativeElement:n}var zb=class extends or{constructor(s=!1){super(),this.destroyRef=void 0,this.__isAsync=s,lA()&&(this.destroyRef=Ct(Vw,{optional:!0})??void 0)}emit(s){let o=li(null);try{super.next(s)}finally{li(o)}}subscribe(s,o,u){let _=s,i=o||(()=>null),P=u;if(s&&typeof s=="object"){let $=s;_=$.next?.bind($),i=$.error?.bind($),P=$.complete?.bind($)}this.__isAsync&&(i=fb(i),_&&(_=fb(_)),P&&(P=fb(P)));let V=super.subscribe({next:_,error:i,complete:P});return s instanceof dr&&s.add(V),V}};function fb(n){return s=>{setTimeout(n,void 0,s)}}var Ii=zb;function FN(){return this._results[Symbol.iterator]()}var Bb=class n{get changes(){return this._changes??=new Ii}constructor(s=!1){this._emitDistinctChangesOnly=s,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let o=n.prototype;o[Symbol.iterator]||(o[Symbol.iterator]=FN)}get(s){return this._results[s]}map(s){return this._results.map(s)}filter(s){return this._results.filter(s)}find(s){return this._results.find(s)}reduce(s,o){return this._results.reduce(s,o)}forEach(s){this._results.forEach(s)}some(s){return this._results.some(s)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(s,o){this.dirty=!1;let u=h3(s);(this._changesDetected=!u3(this._results,u,o))&&(this._results=u,this.length=u.length,this.last=u[this.length-1],this.first=u[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(s){this._onDirty=s}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function jA(n){return(n.flags&128)===128}var UA=new Map,kN=0;function NN(){return kN++}function zN(n){UA.set(n[y0],n)}function BN(n){UA.delete(n[y0])}var dS="__ngContext__";function vc(n,s){zu(s)?(n[dS]=s[y0],zN(s)):n[dS]=s}function $A(n){return HA(n[gm])}function GA(n){return HA(n[Ps])}function HA(n){for(;n!==null&&!el(n);)n=n[Ps];return n}var Vb;function qA(n){Vb=n}function VN(){if(Vb!==void 0)return Vb;if(typeof document<"u")return document;throw new cn(210,!1)}var jw=new en("",{providedIn:"root",factory:()=>jN}),jN="ng",Uw=new en(""),ma=new en("",{providedIn:"platform",factory:()=>"unknown"});var $w=new en("",{providedIn:"root",factory:()=>VN().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var UN="h",$N="b";var GN=()=>null;function Gw(n,s,o=!1){return GN(n,s,o)}var WA=!1,HN=new en("",{providedIn:"root",factory:()=>WA});var Oy;function qN(){if(Oy===void 0&&(Oy=null,No.trustedTypes))try{Oy=No.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Oy}function WN(n){return qN()?.createScriptURL(n)||n}var Ly;function ZN(){if(Ly===void 0&&(Ly=null,No.trustedTypes))try{Ly=No.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Ly}function fS(n){return ZN()?.createScriptURL(n)||n}var Jy=class{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${kS})`}};function Dm(n){return n instanceof Jy?n.changingThisBreaksApplicationSecurity:n}function Hw(n,s){let o=XN(n);if(o!=null&&o!==s){if(o==="ResourceURL"&&s==="URL")return!0;throw new Error(`Required a safe ${s}, got a ${o} (see ${kS})`)}return o===s}function XN(n){return n instanceof Jy&&n.getTypeName()||null}var YN=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function ZA(n){return n=String(n),n.match(YN)?n:"unsafe:"+n}var I0=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(I0||{});function Mm(n){let s=KA();return s?s.sanitize(I0.URL,n)||"":Hw(n,"URL")?Dm(n):ZA(Rd(n))}function KN(n){let s=KA();if(s)return fS(s.sanitize(I0.RESOURCE_URL,n)||"");if(Hw(n,"ResourceURL"))return fS(Dm(n));throw new cn(904,!1)}function XA(n){return WN(n[0])}function JN(n,s){return s==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||s==="href"&&(n==="base"||n==="link")?KN:Mm}function YA(n,s,o){return JN(s,o)(n)}function KA(){let n=Hn();return n&&n[Rs].sanitizer}var QN=/^>|^->|<!--|-->|--!>|<!-$/g,ez=/(<|>)/g,tz="\u200B$1\u200B";function nz(n){return n.replace(QN,s=>s.replace(ez,tz))}function JA(n){return n instanceof Function?n():n}function iz(n){return(n??Ct(nl)).get(ma)==="browser"}var Ka=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Ka||{}),rz;function qw(n,s){return rz(n,s)}function Md(n,s,o,u,_){if(u!=null){let i,P=!1;el(u)?i=u:zu(u)&&(P=!0,u=u[Qa]);let V=da(u);n===0&&o!==null?_==null?n2(s,o,V):Qy(s,o,V,_||null,!0):n===1&&o!==null?Qy(s,o,V,_||null,!0):n===2?wz(s,V,P):n===3&&s.destroyNode(V),i!=null&&Ez(s,n,i,o,_)}}function oz(n,s){return n.createText(s)}function sz(n,s,o){n.setValue(s,o)}function az(n,s){return n.createComment(nz(s))}function QA(n,s,o){return n.createElement(s,o)}function lz(n,s){e2(n,s),s[Qa]=null,s[Fs]=null}function cz(n,s,o,u,_,i){u[Qa]=_,u[Fs]=s,M0(n,u,o,1,_,i)}function e2(n,s){s[Rs].changeDetectionScheduler?.notify(1),M0(n,s,s[pr],2,null,null)}function uz(n){let s=n[gm];if(!s)return pb(n[Rn],n);for(;s;){let o=null;if(zu(s))o=s[gm];else{let u=s[Ur];u&&(o=u)}if(!o){for(;s&&!s[Ps]&&s!==n;)zu(s)&&pb(s[Rn],s),s=s[Fr];s===null&&(s=n),zu(s)&&pb(s[Rn],s),o=s&&s[Ps]}s=o}}function hz(n,s,o,u){let _=Ur+u,i=o.length;u>0&&(o[_-1][Ps]=s),u<i-Ur?(s[Ps]=o[_],qS(o,Ur+u,s)):(o.push(s),s[Ps]=null),s[Fr]=o;let P=s[Cm];P!==null&&o!==P&&dz(P,s);let V=s[Ya];V!==null&&V.insertView(n),Rb(s),s[En]|=128}function dz(n,s){let o=n[Nd],_=s[Fr][Fr][Os];s[Os]!==_&&(n[En]|=Dw.HasTransplantedViews),o===null?n[Nd]=[s]:o.push(s)}function t2(n,s){let o=n[Nd],u=o.indexOf(s);o.splice(u,1)}function vm(n,s){if(n.length<=Ur)return;let o=Ur+s,u=n[o];if(u){let _=u[Cm];_!==null&&_!==n&&t2(_,u),s>0&&(n[o-1][Ps]=u[Ps]);let i=Hy(n,Ur+s);lz(u[Rn],u);let P=i[Ya];P!==null&&P.detachView(i[Rn]),u[Fr]=null,u[Ps]=null,u[En]&=-129}return u}function C0(n,s){if(!(s[En]&256)){let o=s[pr];o.destroyNode&&M0(n,s,o,3,null,null),uz(s)}}function pb(n,s){if(s[En]&256)return;let o=li(null);try{s[En]&=-129,s[En]|=256,s[ju]&&TM(s[ju]),pz(n,s),fz(n,s),s[Rn].type===1&&s[pr].destroy();let u=s[Cm];if(u!==null&&el(s[Fr])){u!==s[Fr]&&t2(u,s);let _=s[Ya];_!==null&&_.detachView(n)}BN(s)}finally{li(o)}}function fz(n,s){let o=n.cleanup,u=s[mm];if(o!==null)for(let i=0;i<o.length-1;i+=2)if(typeof o[i]=="string"){let P=o[i+3];P>=0?u[P]():u[-P].unsubscribe(),i+=2}else{let P=u[o[i+1]];o[i].call(P)}u!==null&&(s[mm]=null);let _=s[gc];if(_!==null){s[gc]=null;for(let i=0;i<_.length;i++){let P=_[i];P()}}}function pz(n,s){let o;if(n!=null&&(o=n.destroyHooks)!=null)for(let u=0;u<o.length;u+=2){let _=s[o[u]];if(!(_ instanceof Gu)){let i=o[u+1];if(Array.isArray(i))for(let P=0;P<i.length;P+=2){let V=_[i[P]],$=i[P+1];ca(4,V,$);try{$.call(V)}finally{ca(5,V,$)}}else{ca(4,_,i);try{i.call(_)}finally{ca(5,_,i)}}}}}function mz(n,s,o){return gz(n,s.parent,o)}function gz(n,s,o){let u=s;for(;u!==null&&u.type&40;)s=u,u=s.parent;if(u===null)return o[Qa];{let{componentOffset:_}=u;if(_>-1){let{encapsulation:i}=n.data[u.directiveStart+_];if(i===ha.None||i===ha.Emulated)return null}return is(u,o)}}function Qy(n,s,o,u,_){n.insertBefore(s,o,u,_)}function n2(n,s,o){n.appendChild(s,o)}function pS(n,s,o,u,_){u!==null?Qy(n,s,o,u,_):n2(n,s,o)}function _z(n,s,o,u){n.removeChild(s,o,u)}function Ww(n,s){return n.parentNode(s)}function yz(n,s){return n.nextSibling(s)}function vz(n,s,o){return bz(n,s,o)}function xz(n,s,o){return n.type&40?is(n,o):null}var bz=xz,mS;function D0(n,s,o,u){let _=mz(n,u,s),i=s[pr],P=u.parent||s[Fs],V=vz(P,u,s);if(_!=null)if(Array.isArray(o))for(let $=0;$<o.length;$++)pS(i,_,o[$],V,!1);else pS(i,_,o,V,!1);mS!==void 0&&mS(i,u,s,o,_)}function jy(n,s){if(s!==null){let o=s.type;if(o&3)return is(s,n);if(o&4)return jb(-1,n[s.index]);if(o&8){let u=s.child;if(u!==null)return jy(n,u);{let _=n[s.index];return el(_)?jb(-1,_):da(_)}}else{if(o&32)return qw(s,n)()||da(n[s.index]);{let u=i2(n,s);if(u!==null){if(Array.isArray(u))return u[0];let _=ym(n[Os]);return jy(_,u)}else return jy(n,s.next)}}}return null}function i2(n,s){if(s!==null){let u=n[Os][Fs],_=s.projection;return u.projection[_]}return null}function jb(n,s){let o=Ur+n+1;if(o<s.length){let u=s[o],_=u[Rn].firstChild;if(_!==null)return jy(u,_)}return s[Uu]}function wz(n,s,o){let u=Ww(n,s);u&&_z(n,u,s,o)}function Zw(n,s,o,u,_,i,P){for(;o!=null;){let V=u[o.index],$=o.type;if(P&&s===0&&(V&&vc(da(V),u),o.flags|=2),(o.flags&32)!==32)if($&8)Zw(n,s,o.child,u,_,i,!1),Md(s,n,_,V,i);else if($&32){let re=qw(o,u),xe;for(;xe=re();)Md(s,n,_,xe,i);Md(s,n,_,V,i)}else $&16?Tz(n,s,u,o,_,i):Md(s,n,_,V,i);o=P?o.projectionNext:o.next}}function M0(n,s,o,u,_,i){Zw(o,u,n.firstChild,s,_,i,!1)}function Tz(n,s,o,u,_,i){let P=o[Os],$=P[Fs].projection[u.projection];if(Array.isArray($))for(let re=0;re<$.length;re++){let xe=$[re];Md(s,n,_,xe,i)}else{let re=$,xe=P[Fr];jA(u)&&(re.flags|=128),Zw(n,s,re,xe,_,i,!0)}}function Ez(n,s,o,u,_){let i=o[Uu],P=da(o);i!==P&&Md(s,n,u,i,_);for(let V=Ur;V<o.length;V++){let $=o[V];M0($[Rn],$,n,s,u,i)}}function Iz(n,s,o,u,_){if(s)_?n.addClass(o,u):n.removeClass(o,u);else{let i=u.indexOf("-")===-1?void 0:Ka.DashCase;_==null?n.removeStyle(o,u,i):(typeof _=="string"&&_.endsWith("!important")&&(_=_.slice(0,-10),i|=Ka.Important),n.setStyle(o,u,_,i))}}function Cz(n,s,o){n.setAttribute(s,"style",o)}function r2(n,s,o){o===""?n.removeAttribute(s,"class"):n.setAttribute(s,"class",o)}function o2(n,s,o){let{mergedAttrs:u,classes:_,styles:i}=o;u!==null&&Db(n,s,u),_!==null&&r2(n,s,_),i!==null&&Cz(n,s,i)}var Ns={};function xt(n=1){s2(xr(),Hn(),Tc()+n,!1)}function s2(n,s,o,u){if(!u)if((s[En]&3)===3){let i=n.preOrderCheckHooks;i!==null&&zy(s,i,o)}else{let i=n.preOrderHooks;i!==null&&By(s,i,0,o)}$u(o)}function Yt(n,s=Wn.Default){let o=Hn();if(o===null)return Zt(n,s);let u=oo();return kA(u,o,no(n),s)}function a2(){let n="invalid";throw new Error(n)}function l2(n,s,o,u,_,i){let P=li(null);try{let V=null;_&Lr.SignalBased&&(V=s[u][vM]),V!==null&&V.transformFn!==void 0&&(i=V.transformFn(i)),_&Lr.HasDecoratorInputTransform&&(i=n.inputTransforms[u].call(s,i)),n.setInput!==null?n.setInput(s,V,i,o,u):hA(s,V,u,i)}finally{li(P)}}function Dz(n,s){let o=n.hostBindingOpCodes;if(o!==null)try{for(let u=0;u<o.length;u++){let _=o[u];if(_<0)$u(~_);else{let i=_,P=o[++u],V=o[++u];hN(P,i);let $=s[i];V(2,$)}}}finally{$u(-1)}}function S0(n,s,o,u,_,i,P,V,$,re,xe){let Pe=s.blueprint.slice();return Pe[Qa]=_,Pe[En]=u|4|128|8|64,(re!==null||n&&n[En]&2048)&&(Pe[En]|=2048),gA(Pe),Pe[Fr]=Pe[jd]=n,Pe[ro]=o,Pe[Rs]=P||n&&n[Rs],Pe[pr]=V||n&&n[pr],Pe[kd]=$||n&&n[kd]||null,Pe[Fs]=i,Pe[y0]=NN(),Pe[pm]=xe,Pe[cA]=re,Pe[Os]=s.type==2?n[Os]:Pe,Pe}function Sm(n,s,o,u,_){let i=n.data[s];if(i===null)i=Mz(n,s,o,u,_),uN()&&(i.flags|=32);else if(i.type&64){i.type=o,i.value=u,i.attrs=_;let P=aN();i.injectorIndex=P===null?-1:P.injectorIndex}return Yu(i,!0),i}function Mz(n,s,o,u,_){let i=vA(),P=Ow(),V=P?i:i&&i.parent,$=n.data[s]=Lz(n,V,o,s,u,_);return n.firstChild===null&&(n.firstChild=$),i!==null&&(P?i.child==null&&$.parent!==null&&(i.child=$):i.next===null&&(i.next=$,$.prev=i)),$}function c2(n,s,o,u){if(o===0)return-1;let _=s.length;for(let i=0;i<o;i++)s.push(u),n.blueprint.push(u),n.data.push(null);return _}function u2(n,s,o,u,_){let i=Tc(),P=u&2;try{$u(-1),P&&s.length>bo&&s2(n,s,bo,!1),ca(P?2:0,_),o(u,_)}finally{$u(i),ca(P?3:1,_)}}function Xw(n,s,o){if(Mw(s)){let u=li(null);try{let _=s.directiveStart,i=s.directiveEnd;for(let P=_;P<i;P++){let V=n.data[P];if(V.contentQueries){let $=o[P];V.contentQueries(1,$,P)}}}finally{li(u)}}}function Yw(n,s,o){yA()&&(Vz(n,s,o,is(o,s)),(o.flags&64)===64&&p2(n,s,o))}function Kw(n,s,o=is){let u=s.localNames;if(u!==null){let _=s.index+1;for(let i=0;i<u.length;i+=2){let P=u[i+1],V=P===-1?o(s,n):n[P];n[_++]=V}}}function h2(n){let s=n.tView;return s===null||s.incompleteFirstPass?n.tView=Jw(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):s}function Jw(n,s,o,u,_,i,P,V,$,re,xe){let Pe=bo+u,Xe=Pe+_,Ze=Sz(Pe,Xe),yt=typeof re=="function"?re():re;return Ze[Rn]={type:n,blueprint:Ze,template:o,queries:null,viewQuery:V,declTNode:s,data:Ze.slice().fill(null,Pe),bindingStartIndex:Pe,expandoStartIndex:Xe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof P=="function"?P():P,firstChild:null,schemas:$,consts:yt,incompleteFirstPass:!1,ssrId:xe}}function Sz(n,s){let o=[];for(let u=0;u<s;u++)o.push(u<n?null:Ns);return o}function Az(n,s,o,u){let i=u.get(HN,WA)||o===ha.ShadowDom,P=n.selectRootElement(s,i);return Pz(P),P}function Pz(n){Rz(n)}var Rz=()=>null;function Oz(n,s,o,u){let _=_2(s);_.push(o),n.firstCreatePass&&y2(n).push(u,_.length-1)}function Lz(n,s,o,u,_,i){let P=s?s.injectorIndex:-1,V=0;return rN()&&(V|=128),{type:o,index:u,insertBeforeIndex:null,injectorIndex:P,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:V,providerIndexes:0,value:_,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function gS(n,s,o,u,_){for(let i in s){if(!s.hasOwnProperty(i))continue;let P=s[i];if(P===void 0)continue;u??={};let V,$=Lr.None;Array.isArray(P)?(V=P[0],$=P[1]):V=P;let re=i;if(_!==null){if(!_.hasOwnProperty(i))continue;re=_[i]}n===0?_S(u,o,re,V,$):_S(u,o,re,V)}return u}function _S(n,s,o,u,_){let i;n.hasOwnProperty(o)?(i=n[o]).push(s,u):i=n[o]=[s,u],_!==void 0&&i.push(_)}function Fz(n,s,o){let u=s.directiveStart,_=s.directiveEnd,i=n.data,P=s.attrs,V=[],$=null,re=null;for(let xe=u;xe<_;xe++){let Pe=i[xe],Xe=o?o.get(Pe):null,Ze=Xe?Xe.inputs:null,yt=Xe?Xe.outputs:null;$=gS(0,Pe.inputs,xe,$,Ze),re=gS(1,Pe.outputs,xe,re,yt);let lt=$!==null&&P!==null&&!Tw(s)?Kz($,xe,P):null;V.push(lt)}$!==null&&($.hasOwnProperty("class")&&(s.flags|=8),$.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=V,s.inputs=$,s.outputs=re}function kz(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function d2(n,s,o,u,_,i,P,V){let $=is(s,o),re=s.inputs,xe;!V&&re!=null&&(xe=re[u])?(eT(n,o,xe,u,_),v0(s)&&Nz(o,s.index)):s.type&3?(u=kz(u),_=P!=null?P(_,s.value||"",u):_,i.setProperty($,u,_)):s.type&12}function Nz(n,s){let o=wc(s,n);o[En]&16||(o[En]|=64)}function Qw(n,s,o,u){if(yA()){let _=u===null?null:{"":-1},i=Uz(n,o),P,V;i===null?P=V=null:[P,V]=i,P!==null&&f2(n,s,o,P,_,V),_&&$z(o,u,_)}o.mergedAttrs=dm(o.mergedAttrs,o.attrs)}function f2(n,s,o,u,_,i){for(let re=0;re<u.length;re++)Fb(Ky(o,s),n,u[re].type);Hz(o,n.data.length,u.length);for(let re=0;re<u.length;re++){let xe=u[re];xe.providersResolver&&xe.providersResolver(xe)}let P=!1,V=!1,$=c2(n,s,u.length,null);for(let re=0;re<u.length;re++){let xe=u[re];o.mergedAttrs=dm(o.mergedAttrs,xe.hostAttrs),qz(n,o,s,$,xe),Gz($,xe,_),xe.contentQueries!==null&&(o.flags|=4),(xe.hostBindings!==null||xe.hostAttrs!==null||xe.hostVars!==0)&&(o.flags|=64);let Pe=xe.type.prototype;!P&&(Pe.ngOnChanges||Pe.ngOnInit||Pe.ngDoCheck)&&((n.preOrderHooks??=[]).push(o.index),P=!0),!V&&(Pe.ngOnChanges||Pe.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(o.index),V=!0),$++}Fz(n,o,i)}function zz(n,s,o,u,_){let i=_.hostBindings;if(i){let P=n.hostBindingOpCodes;P===null&&(P=n.hostBindingOpCodes=[]);let V=~s.index;Bz(P)!=V&&P.push(V),P.push(o,u,i)}}function Bz(n){let s=n.length;for(;s>0;){let o=n[--s];if(typeof o=="number"&&o<0)return o}return 0}function Vz(n,s,o,u){let _=o.directiveStart,i=o.directiveEnd;v0(o)&&Wz(s,o,n.data[_+o.componentOffset]),n.firstCreatePass||Ky(o,s),vc(u,s);let P=o.initialInputs;for(let V=_;V<i;V++){let $=n.data[V],re=Hu(s,n,V,o);if(vc(re,s),P!==null&&Yz(s,V-_,re,$,o,P),yc($)){let xe=wc(o.index,s);xe[ro]=Hu(s,n,V,o)}}}function p2(n,s,o){let u=o.directiveStart,_=o.directiveEnd,i=o.index,P=dN();try{$u(i);for(let V=u;V<_;V++){let $=n.data[V],re=s[V];Ob(V),($.hostBindings!==null||$.hostVars!==0||$.hostAttrs!==null)&&jz($,re)}}finally{$u(-1),Ob(P)}}function jz(n,s){n.hostBindings!==null&&n.hostBindings(1,s)}function Uz(n,s){let o=n.directiveRegistry,u=null,_=null;if(o)for(let i=0;i<o.length;i++){let P=o[i];if(b3(s,P.selectors,!1))if(u||(u=[]),yc(P))if(P.findHostDirectiveDefs!==null){let V=[];_=_||new Map,P.findHostDirectiveDefs(P,V,_),u.unshift(...V,P);let $=V.length;Ub(n,s,$)}else u.unshift(P),Ub(n,s,0);else _=_||new Map,P.findHostDirectiveDefs?.(P,u,_),u.push(P)}return u===null?null:[u,_]}function Ub(n,s,o){s.componentOffset=o,(n.components??=[]).push(s.index)}function $z(n,s,o){if(s){let u=n.localNames=[];for(let _=0;_<s.length;_+=2){let i=o[s[_+1]];if(i==null)throw new cn(-301,!1);u.push(s[_],i)}}}function Gz(n,s,o){if(o){if(s.exportAs)for(let u=0;u<s.exportAs.length;u++)o[s.exportAs[u]]=n;yc(s)&&(o[""]=n)}}function Hz(n,s,o){n.flags|=1,n.directiveStart=s,n.directiveEnd=s+o,n.providerIndexes=s}function qz(n,s,o,u,_){n.data[u]=_;let i=_.factory||(_.factory=Vu(_.type,!0)),P=new Gu(i,yc(_),Yt);n.blueprint[u]=P,o[u]=P,zz(n,s,u,c2(n,o,_.hostVars,Ns),_)}function Wz(n,s,o){let u=is(s,n),_=h2(o),i=n[Rs].rendererFactory,P=16;o.signals?P=4096:o.onPush&&(P=64);let V=A0(n,S0(n,_,null,P,u,s,null,i.createRenderer(u,o),null,null,null));n[s.index]=V}function Zz(n,s,o,u,_,i){let P=is(n,s);Xz(s[pr],P,i,n.value,o,u,_)}function Xz(n,s,o,u,_,i,P){if(i==null)n.removeAttribute(s,_,o);else{let V=P==null?Rd(i):P(i,u||"",_);n.setAttribute(s,_,V,o)}}function Yz(n,s,o,u,_,i){let P=i[s];if(P!==null)for(let V=0;V<P.length;){let $=P[V++],re=P[V++],xe=P[V++],Pe=P[V++];l2(u,o,$,re,xe,Pe)}}function Kz(n,s,o){let u=null,_=0;for(;_<o.length;){let i=o[_];if(i===0){_+=4;continue}else if(i===5){_+=2;continue}if(typeof i=="number")break;if(n.hasOwnProperty(i)){u===null&&(u=[]);let P=n[i];for(let V=0;V<P.length;V+=3)if(P[V]===s){u.push(i,P[V+1],P[V+2],o[_+1]);break}}_+=2}return u}function m2(n,s,o,u){return[n,!0,0,s,null,u,null,o,null,null]}function g2(n,s){let o=n.contentQueries;if(o!==null){let u=li(null);try{for(let _=0;_<o.length;_+=2){let i=o[_],P=o[_+1];if(P!==-1){let V=n.data[P];Lw(i),V.contentQueries(2,s[P],P)}}}finally{li(u)}}}function A0(n,s){return n[gm]?n[sS][Ps]=s:n[gm]=s,n[sS]=s,s}function $b(n,s,o){Lw(0);let u=li(null);try{s(n,o)}finally{li(u)}}function _2(n){return n[mm]||(n[mm]=[])}function y2(n){return n.cleanup||(n.cleanup=[])}function v2(n,s){let o=n[kd],u=o?o.get(fa,null):null;u&&u.handleError(s)}function eT(n,s,o,u,_){for(let i=0;i<o.length;){let P=o[i++],V=o[i++],$=o[i++],re=s[P],xe=n.data[P];l2(xe,re,u,V,$,_)}}function x2(n,s,o){let u=mA(s,n);sz(n[pr],u,o)}function Jz(n,s){let o=wc(s,n),u=o[Rn];Qz(u,o);let _=o[Qa];_!==null&&o[pm]===null&&(o[pm]=Gw(_,o[kd])),tT(u,o,o[ro])}function Qz(n,s){for(let o=s.length;o<n.blueprint.length;o++)s.push(n.blueprint[o])}function tT(n,s,o){Fw(s);try{let u=n.viewQuery;u!==null&&$b(1,u,o);let _=n.template;_!==null&&u2(n,s,_,1,o),n.firstCreatePass&&(n.firstCreatePass=!1),s[Ya]?.finishViewCreation(n),n.staticContentQueries&&g2(n,s),n.staticViewQueries&&$b(2,n.viewQuery,o);let i=n.components;i!==null&&eB(s,i)}catch(u){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),u}finally{s[En]&=-5,kw()}}function eB(n,s){for(let o=0;o<s.length;o++)Jz(n,s[o])}function nT(n,s,o,u){let _=li(null);try{let i=s.tView,V=n[En]&4096?4096:16,$=S0(n,i,o,V,null,s,null,null,u?.injector??null,u?.embeddedViewInjector??null,u?.dehydratedView??null),re=n[s.index];$[Cm]=re;let xe=n[Ya];return xe!==null&&($[Ya]=xe.createEmbeddedView(i)),tT(i,$,o),$}finally{li(_)}}function tB(n,s){let o=Ur+s;if(o<n.length)return n[o]}function e0(n,s){return!s||s.firstChild===null||jA(n)}function iT(n,s,o,u=!0){let _=s[Rn];if(hz(_,s,n,o),u){let P=jb(o,n),V=s[pr],$=Ww(V,n[Uu]);$!==null&&cz(_,n[Fs],V,s,$,P)}let i=s[pm];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function nB(n,s){let o=vm(n,s);return o!==void 0&&C0(o[Rn],o),o}function t0(n,s,o,u,_=!1){for(;o!==null;){let i=s[o.index];i!==null&&u.push(da(i)),el(i)&&iB(i,u);let P=o.type;if(P&8)t0(n,s,o.child,u);else if(P&32){let V=qw(o,s),$;for(;$=V();)u.push($)}else if(P&16){let V=i2(s,o);if(Array.isArray(V))u.push(...V);else{let $=ym(s[Os]);t0($[Rn],$,V,u,!0)}}o=_?o.projectionNext:o.next}return u}function iB(n,s){for(let o=Ur;o<n.length;o++){let u=n[o],_=u[Rn].firstChild;_!==null&&t0(u[Rn],u,_,s)}n[Uu]!==n[Qa]&&s.push(n[Uu])}var b2=[];function rB(n){return n[ju]??oB(n)}function oB(n){let s=b2.pop()??Object.create(aB);return s.lView=n,s}function sB(n){n.lView[ju]!==n&&(n.lView=null,b2.push(n))}var aB=yi(St({},xM),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{_m(n.lView)},consumerOnSignalRead(){this.lView[ju]=this}}),w2=100;function T2(n,s=!0,o=0){let u=n[Rs],_=u.rendererFactory,i=!1;i||_.begin?.();try{lB(n,o)}catch(P){throw s&&v2(n,P),P}finally{i||(_.end?.(),u.inlineEffectRunner?.flush())}}function lB(n,s){Gb(n,s);let o=0;for(;Rw(n);){if(o===w2)throw new cn(103,!1);o++,Gb(n,1)}}function cB(n,s,o,u){let _=s[En];if((_&256)===256)return;let i=!1;!i&&s[Rs].inlineEffectRunner?.flush(),Fw(s);let P=null,V=null;!i&&uB(n)&&(V=rB(s),P=bM(V));try{gA(s),cN(n.bindingStartIndex),o!==null&&u2(n,s,o,2,u);let $=(_&3)===3;if(!i)if($){let Pe=n.preOrderCheckHooks;Pe!==null&&zy(s,Pe,null)}else{let Pe=n.preOrderHooks;Pe!==null&&By(s,Pe,0,null),ub(s,0)}if(hB(s),E2(s,0),n.contentQueries!==null&&g2(n,s),!i)if($){let Pe=n.contentCheckHooks;Pe!==null&&zy(s,Pe)}else{let Pe=n.contentHooks;Pe!==null&&By(s,Pe,1),ub(s,1)}Dz(n,s);let re=n.components;re!==null&&C2(s,re,0);let xe=n.viewQuery;if(xe!==null&&$b(2,xe,u),!i)if($){let Pe=n.viewCheckHooks;Pe!==null&&zy(s,Pe)}else{let Pe=n.viewHooks;Pe!==null&&By(s,Pe,2),ub(s,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),s[cb]){for(let Pe of s[cb])Pe();s[cb]=null}i||(s[En]&=-73)}catch($){throw _m(s),$}finally{V!==null&&(wM(V,P),sB(V)),kw()}}function uB(n){return n.type!==2}function E2(n,s){for(let o=$A(n);o!==null;o=GA(o))for(let u=Ur;u<o.length;u++){let _=o[u];I2(_,s)}}function hB(n){for(let s=$A(n);s!==null;s=GA(s)){if(!(s[En]&Dw.HasTransplantedViews))continue;let o=s[Nd];for(let u=0;u<o.length;u++){let _=o[u],i=_[Fr];J3(_)}}}function dB(n,s,o){let u=wc(s,n);I2(u,o)}function I2(n,s){Pw(n)&&Gb(n,s)}function Gb(n,s){let u=n[Rn],_=n[En],i=n[ju],P=!!(s===0&&_&16);if(P||=!!(_&64&&s===0),P||=!!(_&1024),P||=!!(i?.dirty&&U1(i)),i&&(i.dirty=!1),n[En]&=-9217,P)cB(u,n,u.template,n[ro]);else if(_&8192){E2(n,1);let V=u.components;V!==null&&C2(n,V,1)}}function C2(n,s,o){for(let u=0;u<s.length;u++)dB(n,s[u],o)}function rT(n){for(n[Rs].changeDetectionScheduler?.notify();n;){n[En]|=64;let s=ym(n);if(U3(n)&&!s)return n;n=s}return null}var qu=class{get rootNodes(){let s=this._lView,o=s[Rn];return t0(o,s,o.firstChild,[])}constructor(s,o,u=!0){this._lView=s,this._cdRefInjectingView=o,this.notifyErrorHandler=u,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ro]}set context(s){this._lView[ro]=s}get destroyed(){return(this._lView[En]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[Fr];if(el(s)){let o=s[Wy],u=o?o.indexOf(this):-1;u>-1&&(vm(s,u),Hy(o,u))}this._attachedToViewContainer=!1}C0(this._lView[Rn],this._lView)}onDestroy(s){_A(this._lView,s)}markForCheck(){rT(this._cdRefInjectingView||this._lView)}detach(){this._lView[En]&=-129}reattach(){Rb(this._lView),this._lView[En]|=128}detectChanges(){this._lView[En]|=1024,T2(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new cn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,e2(this._lView[Rn],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new cn(902,!1);this._appRef=s,Rb(this._lView)}},Wu=(()=>{class n{static{this.__NG_ELEMENT_ID__=mB}}return n})(),fB=Wu,pB=class extends fB{constructor(s,o,u){super(),this._declarationLView=s,this._declarationTContainer=o,this.elementRef=u}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,o){return this.createEmbeddedViewImpl(s,o)}createEmbeddedViewImpl(s,o,u){let _=nT(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:o,dehydratedView:u});return new qu(_)}};function mB(){return oT(oo(),Hn())}function oT(n,s){return n.type&4?new pB(s,n,Hd(n,s)):null}var Y7=new RegExp(`^(\\d+)*(${$N}|${UN})*(.*)`);var gB=()=>null;function n0(n,s){return gB(n,s)}var i0=class{},Hb=class{},r0=class{};function _B(n){let s=Error(`No component factory found for ${io(n)}.`);return s[yB]=n,s}var yB="ngComponent";var qb=class{resolveComponentFactory(s){throw _B(s)}},P0=(()=>{class n{static{this.NULL=new qb}}return n})(),xm=class{},zs=(()=>{class n{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>vB()}}return n})();function vB(){let n=Hn(),s=oo(),o=wc(s.index,n);return(zu(o)?o:n)[pr]}var xB=(()=>{class n{static{this.\u0275prov=Wt({token:n,providedIn:"root",factory:()=>null})}}return n})(),mb={};var yS=new Set;function Am(n){yS.has(n)||(yS.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function vS(...n){}function bB(){let n=typeof No.requestAnimationFrame=="function",s=No[n?"requestAnimationFrame":"setTimeout"],o=No[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&s&&o){let u=s[Zone.__symbol__("OriginalDelegate")];u&&(s=u);let _=o[Zone.__symbol__("OriginalDelegate")];_&&(o=_)}return{nativeRequestAnimationFrame:s,nativeCancelAnimationFrame:o}}var ji=class n{constructor({enableLongStackTrace:s=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ii(!1),this.onMicrotaskEmpty=new Ii(!1),this.onStable=new Ii(!1),this.onError=new Ii(!1),typeof Zone>"u")throw new cn(908,!1);Zone.assertZonePatched();let _=this;_._nesting=0,_._outer=_._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(_._inner=_._inner.fork(new Zone.TaskTrackingZoneSpec)),s&&Zone.longStackTraceZoneSpec&&(_._inner=_._inner.fork(Zone.longStackTraceZoneSpec)),_.shouldCoalesceEventChangeDetection=!u&&o,_.shouldCoalesceRunChangeDetection=u,_.lastRequestAnimationFrameId=-1,_.nativeRequestAnimationFrame=bB().nativeRequestAnimationFrame,EB(_)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new cn(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new cn(909,!1)}run(s,o,u){return this._inner.run(s,o,u)}runTask(s,o,u,_){let i=this._inner,P=i.scheduleEventTask("NgZoneEvent: "+_,s,wB,vS,vS);try{return i.runTask(P,o,u)}finally{i.cancelTask(P)}}runGuarded(s,o,u){return this._inner.runGuarded(s,o,u)}runOutsideAngular(s){return this._outer.run(s)}},wB={};function sT(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function TB(n){n.isCheckStableRunning||n.lastRequestAnimationFrameId!==-1||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(No,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Wb(n),n.isCheckStableRunning=!0,sT(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Wb(n))}function EB(n){let s=()=>{TB(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,u,_,i,P,V)=>{if(IB(V))return o.invokeTask(_,i,P,V);try{return xS(n),o.invokeTask(_,i,P,V)}finally{(n.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&s(),bS(n)}},onInvoke:(o,u,_,i,P,V,$)=>{try{return xS(n),o.invoke(_,i,P,V,$)}finally{n.shouldCoalesceRunChangeDetection&&s(),bS(n)}},onHasTask:(o,u,_,i)=>{o.hasTask(_,i),u===_&&(i.change=="microTask"?(n._hasPendingMicrotasks=i.microTask,Wb(n),sT(n)):i.change=="macroTask"&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:(o,u,_,i)=>(o.handleError(_,i),n.runOutsideAngular(()=>n.onError.emit(i)),!1)})}function Wb(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.lastRequestAnimationFrameId!==-1?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function xS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function bS(n){n._nesting--,sT(n)}function IB(n){return!Array.isArray(n)||n.length!==1?!1:n[0].data?.__ignore_ng_zone__===!0}var Sd=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(Sd||{}),CB={destroy(){}};function R0(n,s){!s&&V3(R0);let o=s?.injector??Ct(nl);if(!iz(o))return CB;Am("NgAfterNextRender");let u=o.get(aT),_=u.handler??=new Xb,i=s?.phase??Sd.MixedReadWrite,P=()=>{_.unregister($),V()},V=o.get(Vw).onDestroy(P),$=Ls(o,()=>new Zb(i,()=>{P(),n()}));return _.register($),{destroy:P}}var Zb=class{constructor(s,o){this.phase=s,this.callbackFn=o,this.zone=Ct(ji),this.errorHandler=Ct(fa,{optional:!0}),Ct(i0,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(s){this.errorHandler?.handleError(s)}}},Xb=class{constructor(){this.executingCallbacks=!1,this.buckets={[Sd.EarlyRead]:new Set,[Sd.Write]:new Set,[Sd.MixedReadWrite]:new Set,[Sd.Read]:new Set},this.deferredCallbacks=new Set}register(s){(this.executingCallbacks?this.deferredCallbacks:this.buckets[s.phase]).add(s)}unregister(s){this.buckets[s.phase].delete(s),this.deferredCallbacks.delete(s)}execute(){this.executingCallbacks=!0;for(let s of Object.values(this.buckets))for(let o of s)o.invoke();this.executingCallbacks=!1;for(let s of this.deferredCallbacks)this.buckets[s.phase].add(s);this.deferredCallbacks.clear()}destroy(){for(let s of Object.values(this.buckets))s.clear();this.deferredCallbacks.clear()}},aT=(()=>{class n{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let o=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let u of o)u()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static{this.\u0275prov=Wt({token:n,providedIn:"root",factory:()=>new n})}}return n})();function o0(n,s,o){let u=o?n.styles:null,_=o?n.classes:null,i=0;if(s!==null)for(let P=0;P<s.length;P++){let V=s[P];if(typeof V=="number")i=V;else if(i==1)_=YM(_,V);else if(i==2){let $=V,re=s[++P];u=YM(u,$+": "+re+";")}}o?n.styles=u:n.stylesWithoutHost=u,o?n.classes=_:n.classesWithoutHost=_}var s0=class extends P0{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let o=_c(s);return new Bd(o,this.ngModule)}};function wS(n){let s=[];for(let o in n){if(!n.hasOwnProperty(o))continue;let u=n[o];u!==void 0&&s.push({propName:Array.isArray(u)?u[0]:u,templateName:o})}return s}function DB(n){let s=n.toLowerCase();return s==="svg"?q3:s==="math"?W3:null}var Yb=class{constructor(s,o){this.injector=s,this.parentInjector=o}get(s,o,u){u=m0(u);let _=this.injector.get(s,mb,u);return _!==mb||o===mb?_:this.parentInjector.get(s,o,u)}},Bd=class extends r0{get inputs(){let s=this.componentDef,o=s.inputTransforms,u=wS(s.inputs);if(o!==null)for(let _ of u)o.hasOwnProperty(_.propName)&&(_.transform=o[_.propName]);return u}get outputs(){return wS(this.componentDef.outputs)}constructor(s,o){super(),this.componentDef=s,this.ngModule=o,this.componentType=s.type,this.selector=I3(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!o}create(s,o,u,_){let i=li(null);try{_=_||this.ngModule;let P=_ instanceof $r?_:_?.injector;P&&this.componentDef.getStandaloneInjector!==null&&(P=this.componentDef.getStandaloneInjector(P)||P);let V=P?new Yb(s,P):s,$=V.get(xm,null);if($===null)throw new cn(407,!1);let re=V.get(xB,null),xe=V.get(aT,null),Pe=V.get(i0,null),Xe={rendererFactory:$,sanitizer:re,inlineEffectRunner:null,afterRenderEventManager:xe,changeDetectionScheduler:Pe},Ze=$.createRenderer(null,this.componentDef),yt=this.componentDef.selectors[0][0]||"div",lt=u?Az(Ze,u,this.componentDef.encapsulation,V):QA(Ze,yt,DB(yt)),Ut=512;this.componentDef.signals?Ut|=4096:this.componentDef.onPush||(Ut|=16);let un=null;lt!==null&&(un=Gw(lt,V,!0));let an=Jw(0,null,null,1,0,null,null,null,null,null,null),Zn=S0(null,an,null,Ut,null,null,Xe,Ze,V,null,un);Fw(Zn);let Li,At;try{let zi=this.componentDef,Er,Ft=null;zi.findHostDirectiveDefs?(Er=[],Ft=new Map,zi.findHostDirectiveDefs(zi,Er,Ft),Er.push(zi)):Er=[zi];let Bt=MB(Zn,lt),as=SB(Bt,lt,zi,Er,Zn,Xe,Ze);At=Sw(an,bo),lt&&RB(Ze,zi,lt,u),o!==void 0&&OB(At,this.ngContentSelectors,o),Li=PB(as,zi,Er,Ft,Zn,[LB]),tT(an,Zn,null)}finally{kw()}return new Kb(this.componentType,Li,Hd(At,Zn),Zn,At)}finally{li(i)}}},Kb=class extends Hb{constructor(s,o,u,_,i){super(),this.location=u,this._rootLView=_,this._tNode=i,this.previousInputValues=null,this.instance=o,this.hostView=this.changeDetectorRef=new qu(_,void 0,!1),this.componentType=s}setInput(s,o){let u=this._tNode.inputs,_;if(u!==null&&(_=u[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),o))return;let i=this._rootLView;eT(i[Rn],i,_,s,o),this.previousInputValues.set(s,o);let P=wc(this._tNode.index,i);rT(P)}}get injector(){return new Bu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function MB(n,s){let o=n[Rn],u=bo;return n[u]=s,Sm(o,u,2,"#host",null)}function SB(n,s,o,u,_,i,P){let V=_[Rn];AB(u,n,s,P);let $=null;s!==null&&($=Gw(s,_[kd]));let re=i.rendererFactory.createRenderer(s,o),xe=16;o.signals?xe=4096:o.onPush&&(xe=64);let Pe=S0(_,h2(o),null,xe,_[n.index],n,i,re,null,null,$);return V.firstCreatePass&&Ub(V,n,u.length-1),A0(_,Pe),_[n.index]=Pe}function AB(n,s,o,u){for(let _ of n)s.mergedAttrs=dm(s.mergedAttrs,_.hostAttrs);s.mergedAttrs!==null&&(o0(s,s.mergedAttrs,!0),o!==null&&o2(u,o,s))}function PB(n,s,o,u,_,i){let P=oo(),V=_[Rn],$=is(P,_);f2(V,_,P,o,null,u);for(let xe=0;xe<o.length;xe++){let Pe=P.directiveStart+xe,Xe=Hu(_,V,Pe,P);vc(Xe,_)}p2(V,_,P),$&&vc($,_);let re=Hu(_,V,P.directiveStart+P.componentOffset,P);if(n[ro]=_[ro]=re,i!==null)for(let xe of i)xe(re,s);return Xw(V,P,_),re}function RB(n,s,o,u){if(u)Db(n,o,["ng-version","17.3.12"]);else{let{attrs:_,classes:i}=C3(s.selectors[0]);_&&Db(n,o,_),i&&i.length>0&&r2(n,o,i.join(" "))}}function OB(n,s,o){let u=n.projection=[];for(let _=0;_<s.length;_++){let i=o[_];u.push(i!=null?Array.from(i):null)}}function LB(){let n=oo();E0(Hn()[Rn],n)}var Ec=(()=>{class n{static{this.__NG_ELEMENT_ID__=FB}}return n})();function FB(){let n=oo();return M2(n,Hn())}var kB=Ec,D2=class extends kB{constructor(s,o,u){super(),this._lContainer=s,this._hostTNode=o,this._hostLView=u}get element(){return Hd(this._hostTNode,this._hostLView)}get injector(){return new Bu(this._hostTNode,this._hostLView)}get parentInjector(){let s=zw(this._hostTNode,this._hostLView);if(AA(s)){let o=Xy(s,this._hostLView),u=Zy(s),_=o[Rn].data[u+8];return new Bu(_,o)}else return new Bu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let o=TS(this._lContainer);return o!==null&&o[s]||null}get length(){return this._lContainer.length-Ur}createEmbeddedView(s,o,u){let _,i;typeof u=="number"?_=u:u!=null&&(_=u.index,i=u.injector);let P=n0(this._lContainer,s.ssrId),V=s.createEmbeddedViewImpl(o||{},i,P);return this.insertImpl(V,_,e0(this._hostTNode,P)),V}createComponent(s,o,u,_,i){let P=s&&!j3(s),V;if(P)V=o;else{let yt=o||{};V=yt.index,u=yt.injector,_=yt.projectableNodes,i=yt.environmentInjector||yt.ngModuleRef}let $=P?s:new Bd(_c(s)),re=u||this.parentInjector;if(!i&&$.ngModule==null){let lt=(P?re:this.parentInjector).get($r,null);lt&&(i=lt)}let xe=_c($.componentType??{}),Pe=n0(this._lContainer,xe?.id??null),Xe=Pe?.firstChild??null,Ze=$.create(re,_,Xe,i);return this.insertImpl(Ze.hostView,V,e0(this._hostTNode,Pe)),Ze}insert(s,o){return this.insertImpl(s,o,!0)}insertImpl(s,o,u){let _=s._lView;if(K3(_)){let V=this.indexOf(s);if(V!==-1)this.detach(V);else{let $=_[Fr],re=new D2($,$[Fs],$[Fr]);re.detach(re.indexOf(s))}}let i=this._adjustIndex(o),P=this._lContainer;return iT(P,_,i,u),s.attachToViewContainerRef(),qS(gb(P),i,s),s}move(s,o){return this.insert(s,o)}indexOf(s){let o=TS(this._lContainer);return o!==null?o.indexOf(s):-1}remove(s){let o=this._adjustIndex(s,-1),u=vm(this._lContainer,o);u&&(Hy(gb(this._lContainer),o),C0(u[Rn],u))}detach(s){let o=this._adjustIndex(s,-1),u=vm(this._lContainer,o);return u&&Hy(gb(this._lContainer),o)!=null?new qu(u):null}_adjustIndex(s,o=0){return s??this.length+o}};function TS(n){return n[Wy]}function gb(n){return n[Wy]||(n[Wy]=[])}function M2(n,s){let o,u=s[n.index];return el(u)?o=u:(o=m2(u,s,null,n),s[n.index]=o,A0(s,o)),zB(o,s,n,u),new D2(o,n,s)}function NB(n,s){let o=n[pr],u=o.createComment(""),_=is(s,n),i=Ww(o,_);return Qy(o,i,u,yz(o,_),!1),u}var zB=jB,BB=()=>!1;function VB(n,s,o){return BB(n,s,o)}function jB(n,s,o,u){if(n[Uu])return;let _;o.type&8?_=da(u):_=NB(s,o),n[Uu]=_}var Jb=class n{constructor(s){this.queryList=s,this.matches=null}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},Qb=class n{constructor(s=[]){this.queries=s}createEmbeddedView(s){let o=s.queries;if(o!==null){let u=s.contentQueries!==null?s.contentQueries[0]:o.length,_=[];for(let i=0;i<u;i++){let P=o.getByIndex(i),V=this.queries[P.indexInDeclarationView];_.push(V.clone())}return new n(_)}return null}insertView(s){this.dirtyQueriesWithMatches(s)}detachView(s){this.dirtyQueriesWithMatches(s)}finishViewCreation(s){this.dirtyQueriesWithMatches(s)}dirtyQueriesWithMatches(s){for(let o=0;o<this.queries.length;o++)lT(s,o).matches!==null&&this.queries[o].setDirty()}},a0=class{constructor(s,o,u=null){this.flags=o,this.read=u,typeof s=="string"?this.predicate=XB(s):this.predicate=s}},ew=class n{constructor(s=[]){this.queries=s}elementStart(s,o){for(let u=0;u<this.queries.length;u++)this.queries[u].elementStart(s,o)}elementEnd(s){for(let o=0;o<this.queries.length;o++)this.queries[o].elementEnd(s)}embeddedTView(s){let o=null;for(let u=0;u<this.length;u++){let _=o!==null?o.length:0,i=this.getByIndex(u).embeddedTView(s,_);i&&(i.indexInDeclarationView=u,o!==null?o.push(i):o=[i])}return o!==null?new n(o):null}template(s,o){for(let u=0;u<this.queries.length;u++)this.queries[u].template(s,o)}getByIndex(s){return this.queries[s]}get length(){return this.queries.length}track(s){this.queries.push(s)}},tw=class n{constructor(s,o=-1){this.metadata=s,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=o}elementStart(s,o){this.isApplyingToNode(o)&&this.matchTNode(s,o)}elementEnd(s){this._declarationNodeIndex===s.index&&(this._appliesToNextNode=!1)}template(s,o){this.elementStart(s,o)}embeddedTView(s,o){return this.isApplyingToNode(s)?(this.crossesNgTemplate=!0,this.addMatch(-s.index,o),new n(this.metadata)):null}isApplyingToNode(s){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let o=this._declarationNodeIndex,u=s.parent;for(;u!==null&&u.type&8&&u.index!==o;)u=u.parent;return o===(u!==null?u.index:-1)}return this._appliesToNextNode}matchTNode(s,o){let u=this.metadata.predicate;if(Array.isArray(u))for(let _=0;_<u.length;_++){let i=u[_];this.matchTNodeWithReadOption(s,o,UB(o,i)),this.matchTNodeWithReadOption(s,o,Vy(o,s,i,!1,!1))}else u===Wu?o.type&4&&this.matchTNodeWithReadOption(s,o,-1):this.matchTNodeWithReadOption(s,o,Vy(o,s,u,!1,!1))}matchTNodeWithReadOption(s,o,u){if(u!==null){let _=this.metadata.read;if(_!==null)if(_===Gr||_===Ec||_===Wu&&o.type&4)this.addMatch(o.index,-2);else{let i=Vy(o,s,_,!1,!1);i!==null&&this.addMatch(o.index,i)}else this.addMatch(o.index,u)}}addMatch(s,o){this.matches===null?this.matches=[s,o]:this.matches.push(s,o)}};function UB(n,s){let o=n.localNames;if(o!==null){for(let u=0;u<o.length;u+=2)if(o[u]===s)return o[u+1]}return null}function $B(n,s){return n.type&11?Hd(n,s):n.type&4?oT(n,s):null}function GB(n,s,o,u){return o===-1?$B(s,n):o===-2?HB(n,s,u):Hu(n,n[Rn],o,s)}function HB(n,s,o){if(o===Gr)return Hd(s,n);if(o===Wu)return oT(s,n);if(o===Ec)return M2(s,n)}function S2(n,s,o,u){let _=s[Ya].queries[u];if(_.matches===null){let i=n.data,P=o.matches,V=[];for(let $=0;P!==null&&$<P.length;$+=2){let re=P[$];if(re<0)V.push(null);else{let xe=i[re];V.push(GB(s,xe,P[$+1],o.metadata.read))}}_.matches=V}return _.matches}function nw(n,s,o,u){let _=n.queries.getByIndex(o),i=_.matches;if(i!==null){let P=S2(n,s,_,o);for(let V=0;V<i.length;V+=2){let $=i[V];if($>0)u.push(P[V/2]);else{let re=i[V+1],xe=s[-$];for(let Pe=Ur;Pe<xe.length;Pe++){let Xe=xe[Pe];Xe[Cm]===Xe[Fr]&&nw(Xe[Rn],Xe,re,u)}if(xe[Nd]!==null){let Pe=xe[Nd];for(let Xe=0;Xe<Pe.length;Xe++){let Ze=Pe[Xe];nw(Ze[Rn],Ze,re,u)}}}}}return u}function qB(n,s){return n[Ya].queries[s].queryList}function A2(n,s,o){let u=new Bb((o&4)===4);return Oz(n,s,u,u.destroy),(s[Ya]??=new Qb).queries.push(new Jb(u))-1}function WB(n,s,o){let u=xr();return u.firstCreatePass&&(P2(u,new a0(n,s,o),-1),(s&2)===2&&(u.staticViewQueries=!0)),A2(u,Hn(),s)}function ZB(n,s,o,u){let _=xr();if(_.firstCreatePass){let i=oo();P2(_,new a0(s,o,u),i.index),YB(_,n),(o&2)===2&&(_.staticContentQueries=!0)}return A2(_,Hn(),o)}function XB(n){return n.split(",").map(s=>s.trim())}function P2(n,s,o){n.queries===null&&(n.queries=new ew),n.queries.track(new tw(s,o))}function YB(n,s){let o=n.contentQueries||(n.contentQueries=[]),u=o.length?o[o.length-1]:-1;s!==u&&o.push(n.queries.length-1,s)}function lT(n,s){return n.queries.getByIndex(s)}function KB(n,s){let o=n[Rn],u=lT(o,s);return u.crossesNgTemplate?nw(o,n,s,[]):S2(o,n,u,s)}function JB(n){return Object.getPrototypeOf(n.prototype).constructor}function ga(n){let s=JB(n.type),o=!0,u=[n];for(;s;){let _;if(yc(n))_=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new cn(903,!1);_=s.\u0275dir}if(_){if(o){u.push(_);let P=n;P.inputs=Fy(n.inputs),P.inputTransforms=Fy(n.inputTransforms),P.declaredInputs=Fy(n.declaredInputs),P.outputs=Fy(n.outputs);let V=_.hostBindings;V&&i4(n,V);let $=_.viewQuery,re=_.contentQueries;if($&&t4(n,$),re&&n4(n,re),QB(n,_),Hk(n.outputs,_.outputs),yc(_)&&_.data.animation){let xe=n.data;xe.animation=(xe.animation||[]).concat(_.data.animation)}}let i=_.features;if(i)for(let P=0;P<i.length;P++){let V=i[P];V&&V.ngInherit&&V(n),V===ga&&(o=!1)}}s=Object.getPrototypeOf(s)}e4(u)}function QB(n,s){for(let o in s.inputs){if(!s.inputs.hasOwnProperty(o)||n.inputs.hasOwnProperty(o))continue;let u=s.inputs[o];if(u!==void 0&&(n.inputs[o]=u,n.declaredInputs[o]=s.declaredInputs[o],s.inputTransforms!==null)){let _=Array.isArray(u)?u[0]:u;if(!s.inputTransforms.hasOwnProperty(_))continue;n.inputTransforms??={},n.inputTransforms[_]=s.inputTransforms[_]}}}function e4(n){let s=0,o=null;for(let u=n.length-1;u>=0;u--){let _=n[u];_.hostVars=s+=_.hostVars,_.hostAttrs=dm(_.hostAttrs,o=dm(o,_.hostAttrs))}}function Fy(n){return n===Od?{}:n===es?[]:n}function t4(n,s){let o=n.viewQuery;o?n.viewQuery=(u,_)=>{s(u,_),o(u,_)}:n.viewQuery=s}function n4(n,s){let o=n.contentQueries;o?n.contentQueries=(u,_,i)=>{s(u,_,i),o(u,_,i)}:n.contentQueries=s}function i4(n,s){let o=n.hostBindings;o?n.hostBindings=(u,_)=>{s(u,_),o(u,_)}:n.hostBindings=s}function cT(n){let s=n.inputConfig,o={};for(let u in s)if(s.hasOwnProperty(u)){let _=s[u];Array.isArray(_)&&_[3]&&(o[u]=_[3])}n.inputTransforms=o}var xc=class{},bm=class{};var iw=class extends xc{constructor(s,o,u){super(),this._parent=o,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new s0(this);let _=tA(s);this._bootstrapComponents=JA(_.bootstrap),this._r3Injector=BA(s,o,[{provide:xc,useValue:this},{provide:P0,useValue:this.componentFactoryResolver},...u],io(s),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(s)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},rw=class extends bm{constructor(s){super(),this.moduleType=s}create(s){return new iw(this.moduleType,s,[])}};var l0=class extends xc{constructor(s){super(),this.componentFactoryResolver=new s0(this),this.instance=null;let o=new fm([...s.providers,{provide:xc,useValue:this},{provide:P0,useValue:this.componentFactoryResolver}],s.parent||Cw(),s.debugName,new Set(["environment"]));this.injector=o,s.runEnvironmentInitializers&&o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function O0(n,s,o=null){return new l0({providers:n,parent:s,debugName:o,runEnvironmentInitializers:!0}).injector}var Ku=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new fr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let o=this.taskId++;return this.pendingTasks.add(o),o}remove(o){this.pendingTasks.delete(o),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function R2(n){return o4(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function r4(n,s){if(Array.isArray(n))for(let o=0;o<n.length;o++)s(n[o]);else{let o=n[Symbol.iterator](),u;for(;!(u=o.next()).done;)s(u.value)}}function o4(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function L0(n,s,o){return n[s]=o}function s4(n,s){return n[s]}function Ja(n,s,o){let u=n[s];return Object.is(u,o)?!1:(n[s]=o,!0)}function uT(n,s,o,u){let _=Ja(n,s,o);return Ja(n,s+1,u)||_}function a4(n,s,o,u,_){let i=uT(n,s,o,u);return Ja(n,s+2,_)||i}function l4(n){return(n.flags&32)===32}function c4(n,s,o,u,_,i,P,V,$){let re=s.consts,xe=Sm(s,n,4,P||null,zd(re,V));Qw(s,o,xe,zd(re,$)),E0(s,xe);let Pe=xe.tView=Jw(2,xe,u,_,i,s.directiveRegistry,s.pipeRegistry,null,s.schemas,re,null);return s.queries!==null&&(s.queries.template(s,xe),Pe.queries=s.queries.embeddedTView(xe)),xe}function pa(n,s,o,u,_,i,P,V){let $=Hn(),re=xr(),xe=n+bo,Pe=re.firstCreatePass?c4(xe,re,$,s,o,u,_,i,P):re.data[xe];Yu(Pe,!1);let Xe=u4(re,$,Pe,n);w0()&&D0(re,$,Xe,Pe),vc(Xe,$);let Ze=m2(Xe,$,Xe,Pe);return $[xe]=Ze,A0($,Ze),VB(Ze,Pe,$),x0(Pe)&&Yw(re,$,Pe),P!=null&&Kw($,Pe,V),pa}var u4=h4;function h4(n,s,o,u){return T0(!0),s[pr].createComment("")}function F0(n,s,o,u){let _=Hn(),i=b0();if(Ja(_,i,s)){let P=xr(),V=Nw();Zz(V,_,n,s,o,u)}return F0}function O2(n,s,o,u){return Ja(n,b0(),o)?s+Rd(o)+u:Ns}function d4(n,s,o,u,_,i){let P=lN(),V=uT(n,P,o,_);return bA(2),V?s+Rd(o)+u+Rd(_)+i:Ns}function ky(n,s){return n<<17|s<<2}function Zu(n){return n>>17&32767}function f4(n){return(n&2)==2}function p4(n,s){return n&131071|s<<17}function ow(n){return n|2}function Vd(n){return(n&131068)>>2}function _b(n,s){return n&-131069|s<<2}function m4(n){return(n&1)===1}function sw(n){return n|1}function g4(n,s,o,u,_,i){let P=i?s.classBindings:s.styleBindings,V=Zu(P),$=Vd(P);n[u]=o;let re=!1,xe;if(Array.isArray(o)){let Pe=o;xe=Pe[1],(xe===null||Em(Pe,xe)>0)&&(re=!0)}else xe=o;if(_)if($!==0){let Xe=Zu(n[V+1]);n[u+1]=ky(Xe,V),Xe!==0&&(n[Xe+1]=_b(n[Xe+1],u)),n[V+1]=p4(n[V+1],u)}else n[u+1]=ky(V,0),V!==0&&(n[V+1]=_b(n[V+1],u)),V=u;else n[u+1]=ky($,0),V===0?V=u:n[$+1]=_b(n[$+1],u),$=u;re&&(n[u+1]=ow(n[u+1])),ES(n,xe,u,!0),ES(n,xe,u,!1),_4(s,xe,n,u,i),P=ky(V,$),i?s.classBindings=P:s.styleBindings=P}function _4(n,s,o,u,_){let i=_?n.residualClasses:n.residualStyles;i!=null&&typeof s=="string"&&Em(i,s)>=0&&(o[u+1]=sw(o[u+1]))}function ES(n,s,o,u){let _=n[o+1],i=s===null,P=u?Zu(_):Vd(_),V=!1;for(;P!==0&&(V===!1||i);){let $=n[P],re=n[P+1];y4($,s)&&(V=!0,n[P+1]=u?sw(re):ow(re)),P=u?Zu(re):Vd(re)}V&&(n[o+1]=u?ow(_):sw(_))}function y4(n,s){return n===null||s==null||(Array.isArray(n)?n[1]:n)===s?!0:Array.isArray(n)&&typeof s=="string"?Em(n,s)>=0:!1}function ri(n,s,o){let u=Hn(),_=b0();if(Ja(u,_,s)){let i=xr(),P=Nw();d2(i,P,u,n,s,u[pr],o,!1)}return ri}function IS(n,s,o,u,_){let i=s.inputs,P=_?"class":"style";eT(n,o,i[P],P,u)}function qd(n,s){return v4(n,s,null,!0),qd}function v4(n,s,o,u){let _=Hn(),i=xr(),P=bA(2);if(i.firstUpdatePass&&b4(i,n,P,u),s!==Ns&&Ja(_,P,s)){let V=i.data[Tc()];C4(i,V,_,_[pr],n,_[P+1]=D4(s,o),u,P)}}function x4(n,s){return s>=n.expandoStartIndex}function b4(n,s,o,u){let _=n.data;if(_[o+1]===null){let i=_[Tc()],P=x4(n,o);M4(i,u)&&s===null&&!P&&(s=!1),s=w4(_,i,s,u),g4(_,i,s,o,P,u)}}function w4(n,s,o,u){let _=fN(n),i=u?s.residualClasses:s.residualStyles;if(_===null)(u?s.classBindings:s.styleBindings)===0&&(o=yb(null,n,s,o,u),o=wm(o,s.attrs,u),i=null);else{let P=s.directiveStylingLast;if(P===-1||n[P]!==_)if(o=yb(_,n,s,o,u),i===null){let $=T4(n,s,u);$!==void 0&&Array.isArray($)&&($=yb(null,n,s,$[1],u),$=wm($,s.attrs,u),E4(n,s,u,$))}else i=I4(n,s,u)}return i!==void 0&&(u?s.residualClasses=i:s.residualStyles=i),o}function T4(n,s,o){let u=o?s.classBindings:s.styleBindings;if(Vd(u)!==0)return n[Zu(u)]}function E4(n,s,o,u){let _=o?s.classBindings:s.styleBindings;n[Zu(_)]=u}function I4(n,s,o){let u,_=s.directiveEnd;for(let i=1+s.directiveStylingLast;i<_;i++){let P=n[i].hostAttrs;u=wm(u,P,o)}return wm(u,s.attrs,o)}function yb(n,s,o,u,_){let i=null,P=o.directiveEnd,V=o.directiveStylingLast;for(V===-1?V=o.directiveStart:V++;V<P&&(i=s[V],u=wm(u,i.hostAttrs,_),i!==n);)V++;return n!==null&&(o.directiveStylingLast=V),u}function wm(n,s,o){let u=o?1:2,_=-1;if(s!==null)for(let i=0;i<s.length;i++){let P=s[i];typeof P=="number"?_=P:_===u&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),f3(n,P,o?!0:s[++i]))}return n===void 0?null:n}function C4(n,s,o,u,_,i,P,V){if(!(s.type&3))return;let $=n.data,re=$[V+1],xe=m4(re)?CS($,s,o,_,Vd(re),P):void 0;if(!c0(xe)){c0(i)||f4(re)&&(i=CS($,null,o,_,V,P));let Pe=mA(Tc(),o);Iz(u,P,Pe,_,i)}}function CS(n,s,o,u,_,i){let P=s===null,V;for(;_>0;){let $=n[_],re=Array.isArray($),xe=re?$[1]:$,Pe=xe===null,Xe=o[_+1];Xe===Ns&&(Xe=Pe?es:void 0);let Ze=Pe?ab(Xe,u):xe===u?Xe:void 0;if(re&&!c0(Ze)&&(Ze=ab($,u)),c0(Ze)&&(V=Ze,P))return V;let yt=n[_+1];_=P?Zu(yt):Vd(yt)}if(s!==null){let $=i?s.residualClasses:s.residualStyles;$!=null&&(V=ab($,u))}return V}function c0(n){return n!==void 0}function D4(n,s){return n==null||n===""||(typeof s=="string"?n=n+s:typeof n=="object"&&(n=io(Dm(n)))),n}function M4(n,s){return(n.flags&(s?8:16))!==0}var aw=class{destroy(s){}updateValue(s,o){}swap(s,o){let u=Math.min(s,o),_=Math.max(s,o),i=this.detach(_);if(_-u>1){let P=this.detach(u);this.attach(u,i),this.attach(_,P)}else this.attach(u,i)}move(s,o){this.attach(o,this.detach(s))}};function vb(n,s,o,u,_){return n===o&&Object.is(s,u)?1:Object.is(_(n,s),_(o,u))?-1:0}function S4(n,s,o){let u,_,i=0,P=n.length-1;if(Array.isArray(s)){let V=s.length-1;for(;i<=P&&i<=V;){let $=n.at(i),re=s[i],xe=vb(i,$,i,re,o);if(xe!==0){xe<0&&n.updateValue(i,re),i++;continue}let Pe=n.at(P),Xe=s[V],Ze=vb(P,Pe,V,Xe,o);if(Ze!==0){Ze<0&&n.updateValue(P,Xe),P--,V--;continue}let yt=o(i,$),lt=o(P,Pe),Ut=o(i,re);if(Object.is(Ut,lt)){let un=o(V,Xe);Object.is(un,yt)?(n.swap(i,P),n.updateValue(P,Xe),V--,P--):n.move(P,i),n.updateValue(i,re),i++;continue}if(u??=new u0,_??=MS(n,i,P,o),lw(n,u,i,Ut))n.updateValue(i,re),i++,P++;else if(_.has(Ut))u.set(yt,n.detach(i)),P--;else{let un=n.create(i,s[i]);n.attach(i,un),i++,P++}}for(;i<=V;)DS(n,u,o,i,s[i]),i++}else if(s!=null){let V=s[Symbol.iterator](),$=V.next();for(;!$.done&&i<=P;){let re=n.at(i),xe=$.value,Pe=vb(i,re,i,xe,o);if(Pe!==0)Pe<0&&n.updateValue(i,xe),i++,$=V.next();else{u??=new u0,_??=MS(n,i,P,o);let Xe=o(i,xe);if(lw(n,u,i,Xe))n.updateValue(i,xe),i++,P++,$=V.next();else if(!_.has(Xe))n.attach(i,n.create(i,xe)),i++,P++,$=V.next();else{let Ze=o(i,re);u.set(Ze,n.detach(i)),P--}}}for(;!$.done;)DS(n,u,o,n.length,$.value),$=V.next()}for(;i<=P;)n.destroy(n.detach(P--));u?.forEach(V=>{n.destroy(V)})}function lw(n,s,o,u){return s!==void 0&&s.has(u)?(n.attach(o,s.get(u)),s.delete(u),!0):!1}function DS(n,s,o,u,_){if(lw(n,s,u,o(u,_)))n.updateValue(u,_);else{let i=n.create(u,_);n.attach(u,i)}}function MS(n,s,o,u){let _=new Set;for(let i=s;i<=o;i++)_.add(u(i,n.at(i)));return _}var u0=class{constructor(){this.kvMap=new Map,this._vMap=void 0}has(s){return this.kvMap.has(s)}delete(s){if(!this.has(s))return!1;let o=this.kvMap.get(s);return this._vMap!==void 0&&this._vMap.has(o)?(this.kvMap.set(s,this._vMap.get(o)),this._vMap.delete(o)):this.kvMap.delete(s),!0}get(s){return this.kvMap.get(s)}set(s,o){if(this.kvMap.has(s)){let u=this.kvMap.get(s);this._vMap===void 0&&(this._vMap=new Map);let _=this._vMap;for(;_.has(u);)u=_.get(u);_.set(u,o)}else this.kvMap.set(s,o)}forEach(s){for(let[o,u]of this.kvMap)if(s(u,o),this._vMap!==void 0){let _=this._vMap;for(;_.has(u);)u=_.get(u),s(u,o)}}};var cw=class{constructor(s,o,u){this.lContainer=s,this.$implicit=o,this.$index=u}get $count(){return this.lContainer.length-Ur}};function Wd(n,s){return s}var uw=class{constructor(s,o,u){this.hasEmptyBlock=s,this.trackByFn=o,this.liveCollection=u}};function Zd(n,s,o,u,_,i,P,V,$,re,xe,Pe,Xe){Am("NgControlFlow");let Ze=$!==void 0,yt=Hn(),lt=V?P.bind(yt[Os][ro]):P,Ut=new uw(Ze,lt);yt[bo+n]=Ut,pa(n+1,s,o,u,_,i),Ze&&pa(n+2,$,re,xe,Pe,Xe)}var hw=class extends aw{constructor(s,o,u){super(),this.lContainer=s,this.hostLView=o,this.templateTNode=u,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Ur}at(s){return this.getLView(s)[ro].$implicit}attach(s,o){let u=o[pm];this.needsIndexUpdate||=s!==this.length,iT(this.lContainer,o,s,e0(this.templateTNode,u))}detach(s){return this.needsIndexUpdate||=s!==this.length-1,A4(this.lContainer,s)}create(s,o){let u=n0(this.lContainer,this.templateTNode.tView.ssrId);return nT(this.hostLView,this.templateTNode,new cw(this.lContainer,o,s),{dehydratedView:u})}destroy(s){C0(s[Rn],s)}updateValue(s,o){this.getLView(s)[ro].$implicit=o}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let s=0;s<this.length;s++)this.getLView(s)[ro].$index=s}getLView(s){return P4(this.lContainer,s)}};function Xd(n){let s=li(null),o=Tc();try{let u=Hn(),_=u[Rn],i=u[o];if(i.liveCollection===void 0){let V=o+1,$=SS(u,V),re=AS(_,V);i.liveCollection=new hw($,u,re)}else i.liveCollection.reset();let P=i.liveCollection;if(S4(P,n,i.trackByFn),P.updateIndexes(),i.hasEmptyBlock){let V=b0(),$=P.length===0;if(Ja(u,V,$)){let re=o+2,xe=SS(u,re);if($){let Pe=AS(_,re),Xe=n0(xe,Pe.tView.ssrId),Ze=nT(u,Pe,void 0,{dehydratedView:Xe});iT(xe,Ze,0,e0(Pe,Xe))}else nB(xe,0)}}}finally{li(s)}}function SS(n,s){return n[s]}function A4(n,s){return vm(n,s)}function P4(n,s){return tB(n,s)}function AS(n,s){return Sw(n,s)}function R4(n,s,o,u,_,i){let P=s.consts,V=zd(P,_),$=Sm(s,n,2,u,V);return Qw(s,o,$,zd(P,i)),$.attrs!==null&&o0($,$.attrs,!1),$.mergedAttrs!==null&&o0($,$.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,$),$}function wt(n,s,o,u){let _=Hn(),i=xr(),P=bo+n,V=_[pr],$=i.firstCreatePass?R4(P,i,_,s,o,u):i.data[P],re=O4(i,_,$,V,s,n);_[P]=re;let xe=x0($);return Yu($,!0),o2(V,re,$),!l4($)&&w0()&&D0(i,_,re,$),tN()===0&&vc(re,_),nN(),xe&&(Yw(i,_,$),Xw(i,$,_)),u!==null&&Kw(_,$),wt}function vt(){let n=oo();Ow()?xA():(n=n.parent,Yu(n,!1));let s=n;oN(s)&&sN(),iN();let o=xr();return o.firstCreatePass&&(E0(o,n),Mw(n)&&o.queries.elementEnd(n)),s.classesWithoutHost!=null&&xN(s)&&IS(o,s,Hn(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&bN(s)&&IS(o,s,Hn(),s.stylesWithoutHost,!1),vt}function Sn(n,s,o,u){return wt(n,s,o,u),vt(),Sn}var O4=(n,s,o,u,_,i)=>(T0(!0),QA(u,_,gN()));function L4(n,s,o,u,_){let i=s.consts,P=zd(i,u),V=Sm(s,n,8,"ng-container",P);P!==null&&o0(V,P,!0);let $=zd(i,_);return Qw(s,o,V,$),s.queries!==null&&s.queries.elementStart(s,V),V}function hT(n,s,o){let u=Hn(),_=xr(),i=n+bo,P=_.firstCreatePass?L4(i,_,u,s,o):_.data[i];Yu(P,!0);let V=F4(_,u,P,n);return u[i]=V,w0()&&D0(_,u,V,P),vc(V,u),x0(P)&&(Yw(_,u,P),Xw(_,P,u)),o!=null&&Kw(u,P),hT}function dT(){let n=oo(),s=xr();return Ow()?xA():(n=n.parent,Yu(n,!1)),s.firstCreatePass&&(E0(s,n),Mw(n)&&s.queries.elementEnd(n)),dT}var F4=(n,s,o,u)=>(T0(!0),az(s[pr],""));function Yd(){return Hn()}var Nu=void 0;function k4(n){let s=n,o=Math.floor(Math.abs(n)),u=n.toString().replace(/^[^.]*\.?/,"").length;return o===1&&u===0?1:5}var N4=["en",[["a","p"],["AM","PM"],Nu],[["AM","PM"],Nu,Nu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Nu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Nu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Nu,"{1} 'at' {0}",Nu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",k4],xb={};function rs(n){let s=z4(n),o=PS(s);if(o)return o;let u=s.split("-")[0];if(o=PS(u),o)return o;if(u==="en")return N4;throw new cn(701,!1)}function PS(n){return n in xb||(xb[n]=No.ng&&No.ng.common&&No.ng.common.locales&&No.ng.common.locales[n]),xb[n]}var tr=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(tr||{});function z4(n){return n.toLowerCase().replace(/_/g,"-")}var h0="en-US";var B4=h0;function V4(n){typeof n=="string"&&(B4=n.toLowerCase().replace(/_/g,"-"))}function br(n,s,o,u){let _=Hn(),i=xr(),P=oo();return U4(i,_,_[pr],P,n,s,u),br}function j4(n,s,o,u){let _=n.cleanup;if(_!=null)for(let i=0;i<_.length-1;i+=2){let P=_[i];if(P===o&&_[i+1]===u){let V=s[mm],$=_[i+2];return V.length>$?V[$]:null}typeof P=="string"&&(i+=2)}return null}function U4(n,s,o,u,_,i,P){let V=x0(u),re=n.firstCreatePass&&y2(n),xe=s[ro],Pe=_2(s),Xe=!0;if(u.type&3||P){let lt=is(u,s),Ut=P?P(lt):lt,un=Pe.length,an=P?Li=>P(da(Li[u.index])):u.index,Zn=null;if(!P&&V&&(Zn=j4(n,s,_,u.index)),Zn!==null){let Li=Zn.__ngLastListenerFn__||Zn;Li.__ngNextListenerFn__=i,Zn.__ngLastListenerFn__=i,Xe=!1}else{i=OS(u,s,xe,i,!1);let Li=o.listen(Ut,_,i);Pe.push(i,Li),re&&re.push(_,an,un,un+1)}}else i=OS(u,s,xe,i,!1);let Ze=u.outputs,yt;if(Xe&&Ze!==null&&(yt=Ze[_])){let lt=yt.length;if(lt)for(let Ut=0;Ut<lt;Ut+=2){let un=yt[Ut],an=yt[Ut+1],At=s[un][an].subscribe(i),zi=Pe.length;Pe.push(i,At),re&&re.push(_,u.index,zi,-(zi+1))}}}function RS(n,s,o,u){let _=li(null);try{return ca(6,s,o),o(u)!==!1}catch(i){return v2(n,i),!1}finally{ca(7,s,o),li(_)}}function OS(n,s,o,u,_){return function i(P){if(P===Function)return u;let V=n.componentOffset>-1?wc(n.index,s):s;rT(V);let $=RS(s,o,u,P),re=i.__ngNextListenerFn__;for(;re;)$=RS(s,o,re,P)&&$,re=re.__ngNextListenerFn__;return _&&$===!1&&P.preventDefault(),$}}function Ic(n=1){return mN(n)}function fT(n,s,o){return L2(n,"",s,"",o),fT}function L2(n,s,o,u,_){let i=Hn(),P=O2(i,s,o,u);if(P!==Ns){let V=xr(),$=Nw();d2(V,$,i,n,P,i[pr],_,!1)}return L2}function F2(n,s,o,u){ZB(n,s,o,u)}function k2(n,s,o){WB(n,s,o)}function k0(n){let s=Hn(),o=xr(),u=wA();Lw(u+1);let _=lT(o,u);if(n.dirty&&Y3(s)===((_.metadata.flags&2)===2)){if(_.matches===null)n.reset([]);else{let i=KB(s,u);n.reset(i,LN),n.notifyOnChanges()}return!0}return!1}function N0(){return qB(Hn(),wA())}function $4(n,s,o,u){o>=n.data.length&&(n.data[o]=null,n.blueprint[o]=null),s[o]=u}function Rt(n,s=""){let o=Hn(),u=xr(),_=n+bo,i=u.firstCreatePass?Sm(u,_,1,s,null):u.data[_],P=G4(u,o,i,s,n);o[_]=P,w0()&&D0(u,o,P,i),Yu(i,!1)}var G4=(n,s,o,u,_)=>(T0(!0),oz(s[pr],u));function Jn(n){return zn("",n,""),Jn}function zn(n,s,o){let u=Hn(),_=O2(u,n,s,o);return _!==Ns&&x2(u,Tc(),_),zn}function pT(n,s,o,u,_){let i=Hn(),P=d4(i,n,s,o,u,_);return P!==Ns&&x2(i,Tc(),P),pT}function H4(n,s,o){let u=xr();if(u.firstCreatePass){let _=yc(n);dw(o,u.data,u.blueprint,_,!0),dw(s,u.data,u.blueprint,_,!1)}}function dw(n,s,o,u,_){if(n=no(n),Array.isArray(n))for(let i=0;i<n.length;i++)dw(n[i],s,o,u,_);else{let i=xr(),P=Hn(),V=oo(),$=Fd(n)?n:no(n.provide),re=aA(n),xe=V.providerIndexes&1048575,Pe=V.directiveStart,Xe=V.providerIndexes>>20;if(Fd(n)||!n.multi){let Ze=new Gu(re,_,Yt),yt=wb($,s,_?xe:xe+Xe,Pe);yt===-1?(Fb(Ky(V,P),i,$),bb(i,n,s.length),s.push($),V.directiveStart++,V.directiveEnd++,_&&(V.providerIndexes+=1048576),o.push(Ze),P.push(Ze)):(o[yt]=Ze,P[yt]=Ze)}else{let Ze=wb($,s,xe+Xe,Pe),yt=wb($,s,xe,xe+Xe),lt=Ze>=0&&o[Ze],Ut=yt>=0&&o[yt];if(_&&!Ut||!_&&!lt){Fb(Ky(V,P),i,$);let un=Z4(_?W4:q4,o.length,_,u,re);!_&&Ut&&(o[yt].providerFactory=un),bb(i,n,s.length,0),s.push($),V.directiveStart++,V.directiveEnd++,_&&(V.providerIndexes+=1048576),o.push(un),P.push(un)}else{let un=N2(o[_?yt:Ze],re,!_&&u);bb(i,n,Ze>-1?Ze:yt,un)}!_&&u&&Ut&&o[yt].componentProviders++}}}function bb(n,s,o,u){let _=Fd(s),i=O3(s);if(_||i){let $=(i?no(s.useClass):s).prototype.ngOnDestroy;if($){let re=n.destroyHooks||(n.destroyHooks=[]);if(!_&&s.multi){let xe=re.indexOf(o);xe===-1?re.push(o,[u,$]):re[xe+1].push(u,$)}else re.push(o,$)}}}function N2(n,s,o){return o&&n.componentProviders++,n.multi.push(s)-1}function wb(n,s,o,u){for(let _=o;_<u;_++)if(s[_]===n)return _;return-1}function q4(n,s,o,u){return fw(this.multi,[])}function W4(n,s,o,u){let _=this.multi,i;if(this.providerFactory){let P=this.providerFactory.componentProviders,V=Hu(o,o[Rn],this.providerFactory.index,u);i=V.slice(0,P),fw(_,i);for(let $=P;$<V.length;$++)i.push(V[$])}else i=[],fw(_,i);return i}function fw(n,s){for(let o=0;o<n.length;o++){let u=n[o];s.push(u())}return s}function Z4(n,s,o,u,_){let i=new Gu(n,o,Yt);return i.multi=[],i.index=s,i.componentProviders=0,N2(i,_,u&&!o),i}function Kd(n,s=[]){return o=>{o.providersResolver=(u,_)=>H4(u,_?_(n):n,s)}}var X4=(()=>{class n{constructor(o){this._injector=o,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(o){if(!o.standalone)return null;if(!this.cachedInjectors.has(o)){let u=rA(!1,o.type),_=u.length>0?O0([u],this._injector,`Standalone[${o.type.name}]`):null;this.cachedInjectors.set(o,_)}return this.cachedInjectors.get(o)}ngOnDestroy(){try{for(let o of this.cachedInjectors.values())o!==null&&o.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Wt({token:n,providedIn:"environment",factory:()=>new n(Zt($r))})}}return n})();function Ri(n){Am("NgStandalone"),n.getStandaloneInjector=s=>s.get(X4).getOrCreateStandaloneInjector(n)}function mT(n,s,o){let u=Gd()+n,_=Hn();return _[u]===Ns?L0(_,u,o?s.call(o):s()):s4(_,u)}function z0(n,s,o,u){return B2(Hn(),Gd(),n,s,o,u)}function z2(n,s,o,u,_){return V2(Hn(),Gd(),n,s,o,u,_)}function gT(n,s){let o=n[s];return o===Ns?void 0:o}function B2(n,s,o,u,_,i){let P=s+o;return Ja(n,P,_)?L0(n,P+1,i?u.call(i,_):u(_)):gT(n,P+1)}function V2(n,s,o,u,_,i,P){let V=s+o;return uT(n,V,_,i)?L0(n,V+2,P?u.call(P,_,i):u(_,i)):gT(n,V+2)}function Y4(n,s,o,u,_,i,P,V){let $=s+o;return a4(n,$,_,i,P)?L0(n,$+3,V?u.call(V,_,i,P):u(_,i,P)):gT(n,$+3)}function Lt(n,s){let o=xr(),u,_=n+bo;o.firstCreatePass?(u=K4(s,o.pipeRegistry),o.data[_]=u,u.onDestroy&&(o.destroyHooks??=[]).push(_,u.onDestroy)):u=o.data[_];let i=u.factory||(u.factory=Vu(u.type,!0)),P,V=xo(Yt);try{let $=Yy(!1),re=i();return Yy($),$4(o,Hn(),_,re),re}finally{xo(V)}}function K4(n,s){if(s)for(let o=s.length-1;o>=0;o--){let u=s[o];if(n===u.name)return u}}function zt(n,s,o){let u=n+bo,_=Hn(),i=Aw(_,u);return yT(_,u)?B2(_,Gd(),s,i.transform,o,i):i.transform(o)}function _T(n,s,o,u){let _=n+bo,i=Hn(),P=Aw(i,_);return yT(i,_)?V2(i,Gd(),s,P.transform,o,u,P):P.transform(o,u)}function j2(n,s,o,u,_){let i=n+bo,P=Hn(),V=Aw(P,i);return yT(P,i)?Y4(P,Gd(),s,V.transform,o,u,_,V):V.transform(o,u,_)}function yT(n,s){return n[Rn].data[s].pure}var B0=(()=>{class n{log(o){console.log(o)}warn(o){console.warn(o)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();var U2=new en("");function Ju(n){return!!n&&typeof n.then=="function"}function $2(n){return!!n&&typeof n.subscribe=="function"}var V0=new en(""),G2=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((o,u)=>{this.resolve=o,this.reject=u}),this.appInits=Ct(V0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let o=[];for(let _ of this.appInits){let i=_();if(Ju(i))o.push(i);else if($2(i)){let P=new Promise((V,$)=>{i.subscribe({complete:V,error:$})});o.push(P)}}let u=()=>{this.done=!0,this.resolve()};Promise.all(o).then(()=>{u()}).catch(_=>{this.reject(_)}),o.length===0&&u(),this.initialized=!0}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Pm=new en("");function J4(){EM(()=>{throw new cn(600,!1)})}function Q4(n){return n.isBoundToModule}function eV(n,s,o){try{let u=o();return Ju(u)?u.catch(_=>{throw s.runOutsideAngular(()=>n.handleError(_)),_}):u}catch(u){throw s.runOutsideAngular(()=>n.handleError(u)),u}}var Jd=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ct(VA),this.afterRenderEffectManager=Ct(aT),this.externalTestViews=new Set,this.beforeRender=new or,this.afterTick=new or,this.componentTypes=[],this.components=[],this.isStable=Ct(Ku).hasPendingTasks.pipe(yn(o=>!o)),this._injector=Ct($r)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(o,u){let _=o instanceof r0;if(!this._injector.get(G2).done){let Xe=!_&&eA(o),Ze=!1;throw new cn(405,Ze)}let P;_?P=o:P=this._injector.get(P0).resolveComponentFactory(o),this.componentTypes.push(P.componentType);let V=Q4(P)?void 0:this._injector.get(xc),$=u||P.selector,re=P.create(nl.NULL,[],$,V),xe=re.location.nativeElement,Pe=re.injector.get(U2,null);return Pe?.registerApplication(xe),re.onDestroy(()=>{this.detachView(re.hostView),Tb(this.components,re),Pe?.unregisterApplication(xe)}),this._loadComponent(re),re}tick(){this._tick(!0)}_tick(o){if(this._runningTick)throw new cn(101,!1);let u=li(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(o)}catch(_){this.internalErrorHandler(_)}finally{this.afterTick.next(),this._runningTick=!1,li(u)}}detectChangesInAttachedViews(o){let u=0,_=this.afterRenderEffectManager;for(;;){if(u===w2)throw new cn(103,!1);if(o){let i=u===0;this.beforeRender.next(i);for(let{_lView:P,notifyErrorHandler:V}of this._views)tV(P,i,V)}if(u++,_.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:i})=>pw(i))&&(_.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:i})=>pw(i))))break}}attachView(o){let u=o;this._views.push(u),u.attachToAppRef(this)}detachView(o){let u=o;Tb(this._views,u),u.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o);let u=this._injector.get(Pm,[]);[...this._bootstrapListeners,...u].forEach(_=>_(o))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(o=>o()),this._views.slice().forEach(o=>o.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(o){return this._destroyListeners.push(o),()=>Tb(this._destroyListeners,o)}destroy(){if(this._destroyed)throw new cn(406,!1);let o=this._injector;o.destroy&&!o.destroyed&&o.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Tb(n,s){let o=n.indexOf(s);o>-1&&n.splice(o,1)}function tV(n,s,o){!s&&!pw(n)||nV(n,o,s)}function pw(n){return Rw(n)}function nV(n,s,o){let u;o?(u=0,n[En]|=1024):n[En]&64?u=0:u=1,T2(n,s,u)}var mw=class{constructor(s,o){this.ngModuleFactory=s,this.componentFactories=o}},j0=(()=>{class n{compileModuleSync(o){return new rw(o)}compileModuleAsync(o){return Promise.resolve(this.compileModuleSync(o))}compileModuleAndAllComponentsSync(o){let u=this.compileModuleSync(o),_=tA(o),i=JA(_.declarations).reduce((P,V)=>{let $=_c(V);return $&&P.push(new Bd($)),P},[]);return new mw(u,i)}compileModuleAndAllComponentsAsync(o){return Promise.resolve(this.compileModuleAndAllComponentsSync(o))}clearCache(){}clearCacheFor(o){}getModuleId(o){}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var iV=(()=>{class n{constructor(){this.zone=Ct(ji),this.applicationRef=Ct(Jd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function rV(n){return[{provide:ji,useFactory:n},{provide:Ld,multi:!0,useFactory:()=>{let s=Ct(iV,{optional:!0});return()=>s.initialize()}},{provide:Ld,multi:!0,useFactory:()=>{let s=Ct(lV);return()=>{s.initialize()}}},{provide:VA,useFactory:oV}]}function oV(){let n=Ct(ji),s=Ct(fa);return o=>n.runOutsideAngular(()=>s.handleError(o))}function sV(n){let s=rV(()=>new ji(aV(n)));return Xu([[],s])}function aV(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var lV=(()=>{class n{constructor(){this.subscription=new dr,this.initialized=!1,this.zone=Ct(ji),this.pendingTasks=Ct(Ku)}initialize(){if(this.initialized)return;this.initialized=!0;let o=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(o=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ji.assertNotInAngularZone(),queueMicrotask(()=>{o!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(o),o=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ji.assertInAngularZone(),o??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function cV(){return typeof $localize<"u"&&$localize.locale||h0}var U0=new en("",{providedIn:"root",factory:()=>Ct(U0,Wn.Optional|Wn.SkipSelf)||cV()});var H2=new en("");var Uy=null;function uV(n=[],s){return nl.create({name:s,providers:[{provide:_0,useValue:"platform"},{provide:H2,useValue:new Set([()=>Uy=null])},...n]})}function hV(n=[]){if(Uy)return Uy;let s=uV(n);return Uy=s,J4(),dV(s),s}function dV(n){n.get(Uw,null)?.forEach(o=>o())}var Bs=(()=>{class n{static{this.__NG_ELEMENT_ID__=fV}}return n})();function fV(n){return pV(oo(),Hn(),(n&16)===16)}function pV(n,s,o){if(v0(n)&&!o){let u=wc(n.index,s);return new qu(u,u)}else if(n.type&47){let u=s[Os];return new qu(u,s)}return null}var gw=class{constructor(){}supports(s){return R2(s)}create(s){return new _w(s)}},mV=(n,s)=>s,_w=class{constructor(s){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=s||mV}forEachItem(s){let o;for(o=this._itHead;o!==null;o=o._next)s(o)}forEachOperation(s){let o=this._itHead,u=this._removalsHead,_=0,i=null;for(;o||u;){let P=!u||o&&o.currentIndex<LS(u,_,i)?o:u,V=LS(P,_,i),$=P.currentIndex;if(P===u)_--,u=u._nextRemoved;else if(o=o._next,P.previousIndex==null)_++;else{i||(i=[]);let re=V-_,xe=$-_;if(re!=xe){for(let Xe=0;Xe<re;Xe++){let Ze=Xe<i.length?i[Xe]:i[Xe]=0,yt=Ze+Xe;xe<=yt&&yt<re&&(i[Xe]=Ze+1)}let Pe=P.previousIndex;i[Pe]=xe-re}}V!==$&&s(P,V,$)}}forEachPreviousItem(s){let o;for(o=this._previousItHead;o!==null;o=o._nextPrevious)s(o)}forEachAddedItem(s){let o;for(o=this._additionsHead;o!==null;o=o._nextAdded)s(o)}forEachMovedItem(s){let o;for(o=this._movesHead;o!==null;o=o._nextMoved)s(o)}forEachRemovedItem(s){let o;for(o=this._removalsHead;o!==null;o=o._nextRemoved)s(o)}forEachIdentityChange(s){let o;for(o=this._identityChangesHead;o!==null;o=o._nextIdentityChange)s(o)}diff(s){if(s==null&&(s=[]),!R2(s))throw new cn(900,!1);return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let o=this._itHead,u=!1,_,i,P;if(Array.isArray(s)){this.length=s.length;for(let V=0;V<this.length;V++)i=s[V],P=this._trackByFn(V,i),o===null||!Object.is(o.trackById,P)?(o=this._mismatch(o,i,P,V),u=!0):(u&&(o=this._verifyReinsertion(o,i,P,V)),Object.is(o.item,i)||this._addIdentityChange(o,i)),o=o._next}else _=0,r4(s,V=>{P=this._trackByFn(_,V),o===null||!Object.is(o.trackById,P)?(o=this._mismatch(o,V,P,_),u=!0):(u&&(o=this._verifyReinsertion(o,V,P,_)),Object.is(o.item,V)||this._addIdentityChange(o,V)),o=o._next,_++}),this.length=_;return this._truncate(o),this.collection=s,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let s;for(s=this._previousItHead=this._itHead;s!==null;s=s._next)s._nextPrevious=s._next;for(s=this._additionsHead;s!==null;s=s._nextAdded)s.previousIndex=s.currentIndex;for(this._additionsHead=this._additionsTail=null,s=this._movesHead;s!==null;s=s._nextMoved)s.previousIndex=s.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(s,o,u,_){let i;return s===null?i=this._itTail:(i=s._prev,this._remove(s)),s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(u,null),s!==null?(Object.is(s.item,o)||this._addIdentityChange(s,o),this._reinsertAfter(s,i,_)):(s=this._linkedRecords===null?null:this._linkedRecords.get(u,_),s!==null?(Object.is(s.item,o)||this._addIdentityChange(s,o),this._moveAfter(s,i,_)):s=this._addAfter(new yw(o,u),i,_)),s}_verifyReinsertion(s,o,u,_){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(u,null);return i!==null?s=this._reinsertAfter(i,s._prev,_):s.currentIndex!=_&&(s.currentIndex=_,this._addToMoves(s,_)),s}_truncate(s){for(;s!==null;){let o=s._next;this._addToRemovals(this._unlink(s)),s=o}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(s,o,u){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(s);let _=s._prevRemoved,i=s._nextRemoved;return _===null?this._removalsHead=i:_._nextRemoved=i,i===null?this._removalsTail=_:i._prevRemoved=_,this._insertAfter(s,o,u),this._addToMoves(s,u),s}_moveAfter(s,o,u){return this._unlink(s),this._insertAfter(s,o,u),this._addToMoves(s,u),s}_addAfter(s,o,u){return this._insertAfter(s,o,u),this._additionsTail===null?this._additionsTail=this._additionsHead=s:this._additionsTail=this._additionsTail._nextAdded=s,s}_insertAfter(s,o,u){let _=o===null?this._itHead:o._next;return s._next=_,s._prev=o,_===null?this._itTail=s:_._prev=s,o===null?this._itHead=s:o._next=s,this._linkedRecords===null&&(this._linkedRecords=new d0),this._linkedRecords.put(s),s.currentIndex=u,s}_remove(s){return this._addToRemovals(this._unlink(s))}_unlink(s){this._linkedRecords!==null&&this._linkedRecords.remove(s);let o=s._prev,u=s._next;return o===null?this._itHead=u:o._next=u,u===null?this._itTail=o:u._prev=o,s}_addToMoves(s,o){return s.previousIndex===o||(this._movesTail===null?this._movesTail=this._movesHead=s:this._movesTail=this._movesTail._nextMoved=s),s}_addToRemovals(s){return this._unlinkedRecords===null&&(this._unlinkedRecords=new d0),this._unlinkedRecords.put(s),s.currentIndex=null,s._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=s,s._prevRemoved=null):(s._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=s),s}_addIdentityChange(s,o){return s.item=o,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=s:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=s,s}},yw=class{constructor(s,o){this.item=s,this.trackById=o,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},vw=class{constructor(){this._head=null,this._tail=null}add(s){this._head===null?(this._head=this._tail=s,s._nextDup=null,s._prevDup=null):(this._tail._nextDup=s,s._prevDup=this._tail,s._nextDup=null,this._tail=s)}get(s,o){let u;for(u=this._head;u!==null;u=u._nextDup)if((o===null||o<=u.currentIndex)&&Object.is(u.trackById,s))return u;return null}remove(s){let o=s._prevDup,u=s._nextDup;return o===null?this._head=u:o._nextDup=u,u===null?this._tail=o:u._prevDup=o,this._head===null}},d0=class{constructor(){this.map=new Map}put(s){let o=s.trackById,u=this.map.get(o);u||(u=new vw,this.map.set(o,u)),u.add(s)}get(s,o){let u=s,_=this.map.get(u);return _?_.get(s,o):null}remove(s){let o=s.trackById;return this.map.get(o).remove(s)&&this.map.delete(o),s}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function LS(n,s,o){let u=n.previousIndex;if(u===null)return u;let _=0;return o&&u<o.length&&(_=o[u]),u+s+_}function FS(){return new vT([new gw])}var vT=(()=>{class n{static{this.\u0275prov=Wt({token:n,providedIn:"root",factory:FS})}constructor(o){this.factories=o}static create(o,u){if(u!=null){let _=u.factories.slice();o=o.concat(_)}return new n(o)}static extend(o){return{provide:n,useFactory:u=>n.create(o,u||FS()),deps:[[n,new bw,new g0]]}}find(o){let u=this.factories.find(_=>_.supports(o));if(u!=null)return u;throw new cn(901,!1)}}return n})();function q2(n){try{let{rootComponent:s,appProviders:o,platformProviders:u}=n,_=hV(u),i=[sV(),...o||[]],V=new l0({providers:i,parent:_,debugName:"",runEnvironmentInitializers:!1}).injector,$=V.get(ji);return $.run(()=>{V.resolveInjectorInitializers();let re=V.get(fa,null),xe;$.runOutsideAngular(()=>{xe=$.onError.subscribe({next:Ze=>{re.handleError(Ze)}})});let Pe=()=>V.destroy(),Xe=_.get(H2);return Xe.add(Pe),V.onDestroy(()=>{xe.unsubscribe(),Xe.delete(Pe)}),eV(re,$,()=>{let Ze=V.get(G2);return Ze.runInitializers(),Ze.donePromise.then(()=>{let yt=V.get(U0,h0);V4(yt||h0);let lt=V.get(Jd);return s!==void 0&&lt.bootstrap(s),lt})})})}catch(s){return Promise.reject(s)}}function Qd(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function W2(n){let s=_c(n);if(!s)return null;let o=new Bd(s);return{get selector(){return o.selector},get type(){return o.componentType},get inputs(){return o.inputs},get outputs(){return o.outputs},get ngContentSelectors(){return o.ngContentSelectors},get isStandalone(){return s.standalone},get isSignal(){return s.signals}}}var eP=null;function sl(){return eP}function tP(n){eP??=n}var K0=class{};var Hr=new en(""),ST=(()=>{class n{historyGo(o){throw new Error("")}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(gV),providedIn:"platform"})}}return n})(),nP=new en(""),gV=(()=>{class n extends ST{constructor(){super(),this._doc=Ct(Hr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return sl().getBaseHref(this._doc)}onPopState(o){let u=sl().getGlobalEventTarget(this._doc,"window");return u.addEventListener("popstate",o,!1),()=>u.removeEventListener("popstate",o)}onHashChange(o){let u=sl().getGlobalEventTarget(this._doc,"window");return u.addEventListener("hashchange",o,!1),()=>u.removeEventListener("hashchange",o)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(o){this._location.pathname=o}pushState(o,u,_){this._history.pushState(o,u,_)}replaceState(o,u,_){this._history.replaceState(o,u,_)}forward(){this._history.forward()}back(){this._history.back()}historyGo(o=0){this._history.go(o)}getState(){return this._history.state}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>new n,providedIn:"platform"})}}return n})();function AT(n,s){if(n.length==0)return s;if(s.length==0)return n;let o=0;return n.endsWith("/")&&o++,s.startsWith("/")&&o++,o==2?n+s.substring(1):o==1?n+s:n+"/"+s}function Z2(n){let s=n.match(/#|\?|$/),o=s&&s.index||n.length,u=o-(n[o-1]==="/"?1:0);return n.slice(0,u)+n.slice(o)}function rl(n){return n&&n[0]!=="?"?"?"+n:n}var al=(()=>{class n{historyGo(o){throw new Error("")}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(PT),providedIn:"root"})}}return n})(),iP=new en(""),PT=(()=>{class n extends al{constructor(o,u){super(),this._platformLocation=o,this._removeListenerFns=[],this._baseHref=u??this._platformLocation.getBaseHrefFromDOM()??Ct(Hr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}prepareExternalUrl(o){return AT(this._baseHref,o)}path(o=!1){let u=this._platformLocation.pathname+rl(this._platformLocation.search),_=this._platformLocation.hash;return _&&o?`${u}${_}`:u}pushState(o,u,_,i){let P=this.prepareExternalUrl(_+rl(i));this._platformLocation.pushState(o,u,P)}replaceState(o,u,_,i){let P=this.prepareExternalUrl(_+rl(i));this._platformLocation.replaceState(o,u,P)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(o=0){this._platformLocation.historyGo?.(o)}static{this.\u0275fac=function(u){return new(u||n)(Zt(ST),Zt(iP,8))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),rP=(()=>{class n extends al{constructor(o,u){super(),this._platformLocation=o,this._baseHref="",this._removeListenerFns=[],u!=null&&(this._baseHref=u)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}path(o=!1){let u=this._platformLocation.hash??"#";return u.length>0?u.substring(1):u}prepareExternalUrl(o){let u=AT(this._baseHref,o);return u.length>0?"#"+u:u}pushState(o,u,_,i){let P=this.prepareExternalUrl(_+rl(i));P.length==0&&(P=this._platformLocation.pathname),this._platformLocation.pushState(o,u,P)}replaceState(o,u,_,i){let P=this.prepareExternalUrl(_+rl(i));P.length==0&&(P=this._platformLocation.pathname),this._platformLocation.replaceState(o,u,P)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(o=0){this._platformLocation.historyGo?.(o)}static{this.\u0275fac=function(u){return new(u||n)(Zt(ST),Zt(iP,8))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),tf=(()=>{class n{constructor(o){this._subject=new Ii,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=o;let u=this._locationStrategy.getBaseHref();this._basePath=vV(Z2(X2(u))),this._locationStrategy.onPopState(_=>{this._subject.emit({url:this.path(!0),pop:!0,state:_.state,type:_.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(o=!1){return this.normalize(this._locationStrategy.path(o))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(o,u=""){return this.path()==this.normalize(o+rl(u))}normalize(o){return n.stripTrailingSlash(yV(this._basePath,X2(o)))}prepareExternalUrl(o){return o&&o[0]!=="/"&&(o="/"+o),this._locationStrategy.prepareExternalUrl(o)}go(o,u="",_=null){this._locationStrategy.pushState(_,"",o,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+rl(u)),_)}replaceState(o,u="",_=null){this._locationStrategy.replaceState(_,"",o,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+rl(u)),_)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(o=0){this._locationStrategy.historyGo?.(o)}onUrlChange(o){return this._urlChangeListeners.push(o),this._urlChangeSubscription??=this.subscribe(u=>{this._notifyUrlChangeListeners(u.url,u.state)}),()=>{let u=this._urlChangeListeners.indexOf(o);this._urlChangeListeners.splice(u,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(o="",u){this._urlChangeListeners.forEach(_=>_(o,u))}subscribe(o,u,_){return this._subject.subscribe({next:o,error:u,complete:_})}static{this.normalizeQueryParams=rl}static{this.joinWithSlash=AT}static{this.stripTrailingSlash=Z2}static{this.\u0275fac=function(u){return new(u||n)(Zt(al))}}static{this.\u0275prov=Wt({token:n,factory:()=>_V(),providedIn:"root"})}}return n})();function _V(){return new tf(Zt(al))}function yV(n,s){if(!n||!s.startsWith(n))return s;let o=s.substring(n.length);return o===""||["/",";","?","#"].includes(o[0])?o:s}function X2(n){return n.replace(/\/index.html$/,"")}function vV(n){if(new RegExp("^(https?:)?//").test(n)){let[,o]=n.split(/\/\/[^\/]+/);return o}return n}var so=function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n}(so||{}),Di=function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n}(Di||{}),zo=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n}(zo||{}),Cc={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function xV(n){return rs(n)[tr.LocaleId]}function bV(n,s,o){let u=rs(n),_=[u[tr.DayPeriodsFormat],u[tr.DayPeriodsStandalone]],i=os(_,s);return os(i,o)}function wV(n,s,o){let u=rs(n),_=[u[tr.DaysFormat],u[tr.DaysStandalone]],i=os(_,s);return os(i,o)}function TV(n,s,o){let u=rs(n),_=[u[tr.MonthsFormat],u[tr.MonthsStandalone]],i=os(_,s);return os(i,o)}function EV(n,s){let u=rs(n)[tr.Eras];return os(u,s)}function $0(n,s){let o=rs(n);return os(o[tr.DateFormat],s)}function G0(n,s){let o=rs(n);return os(o[tr.TimeFormat],s)}function H0(n,s){let u=rs(n)[tr.DateTimeFormat];return os(u,s)}function Q0(n,s){let o=rs(n),u=o[tr.NumberSymbols][s];if(typeof u>"u"){if(s===Cc.CurrencyDecimal)return o[tr.NumberSymbols][Cc.Decimal];if(s===Cc.CurrencyGroup)return o[tr.NumberSymbols][Cc.Group]}return u}function oP(n){if(!n[tr.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[tr.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function IV(n){let s=rs(n);return oP(s),(s[tr.ExtraData][2]||[]).map(u=>typeof u=="string"?xT(u):[xT(u[0]),xT(u[1])])}function CV(n,s,o){let u=rs(n);oP(u);let _=[u[tr.ExtraData][0],u[tr.ExtraData][1]],i=os(_,s)||[];return os(i,o)||[]}function os(n,s){for(let o=s;o>-1;o--)if(typeof n[o]<"u")return n[o];throw new Error("Locale data API: locale data undefined")}function xT(n){let[s,o]=n.split(":");return{hours:+s,minutes:+o}}var DV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,q0={},MV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,ol=function(n){return n[n.Short=0]="Short",n[n.ShortGMT=1]="ShortGMT",n[n.Long=2]="Long",n[n.Extended=3]="Extended",n}(ol||{}),fi=function(n){return n[n.FullYear=0]="FullYear",n[n.Month=1]="Month",n[n.Date=2]="Date",n[n.Hours=3]="Hours",n[n.Minutes=4]="Minutes",n[n.Seconds=5]="Seconds",n[n.FractionalSeconds=6]="FractionalSeconds",n[n.Day=7]="Day",n}(fi||{}),di=function(n){return n[n.DayPeriods=0]="DayPeriods",n[n.Days=1]="Days",n[n.Months=2]="Months",n[n.Eras=3]="Eras",n}(di||{});function SV(n,s,o,u){let _=zV(n);s=il(o,s)||s;let P=[],V;for(;s;)if(V=MV.exec(s),V){P=P.concat(V.slice(1));let xe=P.pop();if(!xe)break;s=xe}else{P.push(s);break}let $=_.getTimezoneOffset();u&&($=aP(u,$),_=NV(_,u,!0));let re="";return P.forEach(xe=>{let Pe=FV(xe);re+=Pe?Pe(_,o,$):xe==="''"?"'":xe.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),re}function J0(n,s,o){let u=new Date(0);return u.setFullYear(n,s,o),u.setHours(0,0,0),u}function il(n,s){let o=xV(n);if(q0[o]??={},q0[o][s])return q0[o][s];let u="";switch(s){case"shortDate":u=$0(n,zo.Short);break;case"mediumDate":u=$0(n,zo.Medium);break;case"longDate":u=$0(n,zo.Long);break;case"fullDate":u=$0(n,zo.Full);break;case"shortTime":u=G0(n,zo.Short);break;case"mediumTime":u=G0(n,zo.Medium);break;case"longTime":u=G0(n,zo.Long);break;case"fullTime":u=G0(n,zo.Full);break;case"short":let _=il(n,"shortTime"),i=il(n,"shortDate");u=W0(H0(n,zo.Short),[_,i]);break;case"medium":let P=il(n,"mediumTime"),V=il(n,"mediumDate");u=W0(H0(n,zo.Medium),[P,V]);break;case"long":let $=il(n,"longTime"),re=il(n,"longDate");u=W0(H0(n,zo.Long),[$,re]);break;case"full":let xe=il(n,"fullTime"),Pe=il(n,"fullDate");u=W0(H0(n,zo.Full),[xe,Pe]);break}return u&&(q0[o][s]=u),u}function W0(n,s){return s&&(n=n.replace(/\{([^}]+)}/g,function(o,u){return s!=null&&u in s?s[u]:o})),n}function Vs(n,s,o="-",u,_){let i="";(n<0||_&&n<=0)&&(_?n=-n+1:(n=-n,i=o));let P=String(n);for(;P.length<s;)P="0"+P;return u&&(P=P.slice(P.length-s)),i+P}function AV(n,s){return Vs(n,3).substring(0,s)}function lr(n,s,o=0,u=!1,_=!1){return function(i,P){let V=PV(n,i);if((o>0||V>-o)&&(V+=o),n===fi.Hours)V===0&&o===-12&&(V=12);else if(n===fi.FractionalSeconds)return AV(V,s);let $=Q0(P,Cc.MinusSign);return Vs(V,s,$,u,_)}}function PV(n,s){switch(n){case fi.FullYear:return s.getFullYear();case fi.Month:return s.getMonth();case fi.Date:return s.getDate();case fi.Hours:return s.getHours();case fi.Minutes:return s.getMinutes();case fi.Seconds:return s.getSeconds();case fi.FractionalSeconds:return s.getMilliseconds();case fi.Day:return s.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}function Oi(n,s,o=so.Format,u=!1){return function(_,i){return RV(_,i,n,s,o,u)}}function RV(n,s,o,u,_,i){switch(o){case di.Months:return TV(s,_,u)[n.getMonth()];case di.Days:return wV(s,_,u)[n.getDay()];case di.DayPeriods:let P=n.getHours(),V=n.getMinutes();if(i){let re=IV(s),xe=CV(s,_,u),Pe=re.findIndex(Xe=>{if(Array.isArray(Xe)){let[Ze,yt]=Xe,lt=P>=Ze.hours&&V>=Ze.minutes,Ut=P<yt.hours||P===yt.hours&&V<yt.minutes;if(Ze.hours<yt.hours){if(lt&&Ut)return!0}else if(lt||Ut)return!0}else if(Xe.hours===P&&Xe.minutes===V)return!0;return!1});if(Pe!==-1)return xe[Pe]}return bV(s,_,u)[P<12?0:1];case di.Eras:return EV(s,u)[n.getFullYear()<=0?0:1];default:let $=o;throw new Error(`unexpected translation type ${$}`)}}function Z0(n){return function(s,o,u){let _=-1*u,i=Q0(o,Cc.MinusSign),P=_>0?Math.floor(_/60):Math.ceil(_/60);switch(n){case ol.Short:return(_>=0?"+":"")+Vs(P,2,i)+Vs(Math.abs(_%60),2,i);case ol.ShortGMT:return"GMT"+(_>=0?"+":"")+Vs(P,1,i);case ol.Long:return"GMT"+(_>=0?"+":"")+Vs(P,2,i)+":"+Vs(Math.abs(_%60),2,i);case ol.Extended:return u===0?"Z":(_>=0?"+":"")+Vs(P,2,i)+":"+Vs(Math.abs(_%60),2,i);default:throw new Error(`Unknown zone width "${n}"`)}}}var OV=0,Y0=4;function LV(n){let s=J0(n,OV,1).getDay();return J0(n,0,1+(s<=Y0?Y0:Y0+7)-s)}function sP(n){let s=n.getDay(),o=s===0?-3:Y0-s;return J0(n.getFullYear(),n.getMonth(),n.getDate()+o)}function bT(n,s=!1){return function(o,u){let _;if(s){let i=new Date(o.getFullYear(),o.getMonth(),1).getDay()-1,P=o.getDate();_=1+Math.floor((P+i)/7)}else{let i=sP(o),P=LV(i.getFullYear()),V=i.getTime()-P.getTime();_=1+Math.round(V/6048e5)}return Vs(_,n,Q0(u,Cc.MinusSign))}}function X0(n,s=!1){return function(o,u){let i=sP(o).getFullYear();return Vs(i,n,Q0(u,Cc.MinusSign),s)}}var wT={};function FV(n){if(wT[n])return wT[n];let s;switch(n){case"G":case"GG":case"GGG":s=Oi(di.Eras,Di.Abbreviated);break;case"GGGG":s=Oi(di.Eras,Di.Wide);break;case"GGGGG":s=Oi(di.Eras,Di.Narrow);break;case"y":s=lr(fi.FullYear,1,0,!1,!0);break;case"yy":s=lr(fi.FullYear,2,0,!0,!0);break;case"yyy":s=lr(fi.FullYear,3,0,!1,!0);break;case"yyyy":s=lr(fi.FullYear,4,0,!1,!0);break;case"Y":s=X0(1);break;case"YY":s=X0(2,!0);break;case"YYY":s=X0(3);break;case"YYYY":s=X0(4);break;case"M":case"L":s=lr(fi.Month,1,1);break;case"MM":case"LL":s=lr(fi.Month,2,1);break;case"MMM":s=Oi(di.Months,Di.Abbreviated);break;case"MMMM":s=Oi(di.Months,Di.Wide);break;case"MMMMM":s=Oi(di.Months,Di.Narrow);break;case"LLL":s=Oi(di.Months,Di.Abbreviated,so.Standalone);break;case"LLLL":s=Oi(di.Months,Di.Wide,so.Standalone);break;case"LLLLL":s=Oi(di.Months,Di.Narrow,so.Standalone);break;case"w":s=bT(1);break;case"ww":s=bT(2);break;case"W":s=bT(1,!0);break;case"d":s=lr(fi.Date,1);break;case"dd":s=lr(fi.Date,2);break;case"c":case"cc":s=lr(fi.Day,1);break;case"ccc":s=Oi(di.Days,Di.Abbreviated,so.Standalone);break;case"cccc":s=Oi(di.Days,Di.Wide,so.Standalone);break;case"ccccc":s=Oi(di.Days,Di.Narrow,so.Standalone);break;case"cccccc":s=Oi(di.Days,Di.Short,so.Standalone);break;case"E":case"EE":case"EEE":s=Oi(di.Days,Di.Abbreviated);break;case"EEEE":s=Oi(di.Days,Di.Wide);break;case"EEEEE":s=Oi(di.Days,Di.Narrow);break;case"EEEEEE":s=Oi(di.Days,Di.Short);break;case"a":case"aa":case"aaa":s=Oi(di.DayPeriods,Di.Abbreviated);break;case"aaaa":s=Oi(di.DayPeriods,Di.Wide);break;case"aaaaa":s=Oi(di.DayPeriods,Di.Narrow);break;case"b":case"bb":case"bbb":s=Oi(di.DayPeriods,Di.Abbreviated,so.Standalone,!0);break;case"bbbb":s=Oi(di.DayPeriods,Di.Wide,so.Standalone,!0);break;case"bbbbb":s=Oi(di.DayPeriods,Di.Narrow,so.Standalone,!0);break;case"B":case"BB":case"BBB":s=Oi(di.DayPeriods,Di.Abbreviated,so.Format,!0);break;case"BBBB":s=Oi(di.DayPeriods,Di.Wide,so.Format,!0);break;case"BBBBB":s=Oi(di.DayPeriods,Di.Narrow,so.Format,!0);break;case"h":s=lr(fi.Hours,1,-12);break;case"hh":s=lr(fi.Hours,2,-12);break;case"H":s=lr(fi.Hours,1);break;case"HH":s=lr(fi.Hours,2);break;case"m":s=lr(fi.Minutes,1);break;case"mm":s=lr(fi.Minutes,2);break;case"s":s=lr(fi.Seconds,1);break;case"ss":s=lr(fi.Seconds,2);break;case"S":s=lr(fi.FractionalSeconds,1);break;case"SS":s=lr(fi.FractionalSeconds,2);break;case"SSS":s=lr(fi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":s=Z0(ol.Short);break;case"ZZZZZ":s=Z0(ol.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":s=Z0(ol.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":s=Z0(ol.Long);break;default:return null}return wT[n]=s,s}function aP(n,s){n=n.replace(/:/g,"");let o=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(o)?s:o}function kV(n,s){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+s),n}function NV(n,s,o){let u=o?-1:1,_=n.getTimezoneOffset(),i=aP(s,_);return kV(n,u*(i-_))}function zV(n){if(Y2(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[_,i=1,P=1]=n.split("-").map(V=>+V);return J0(_,i-1,P)}let o=parseFloat(n);if(!isNaN(n-o))return new Date(o);let u;if(u=n.match(DV))return BV(u)}let s=new Date(n);if(!Y2(s))throw new Error(`Unable to convert "${n}" into a date`);return s}function BV(n){let s=new Date(0),o=0,u=0,_=n[8]?s.setUTCFullYear:s.setFullYear,i=n[8]?s.setUTCHours:s.setHours;n[9]&&(o=Number(n[9]+n[10]),u=Number(n[9]+n[11])),_.call(s,Number(n[1]),Number(n[2])-1,Number(n[3]));let P=Number(n[4]||0)-o,V=Number(n[5]||0)-u,$=Number(n[6]||0),re=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return i.call(s,P,V,$,re),s}function Y2(n){return n instanceof Date&&!isNaN(n.valueOf())}function ev(n,s){s=encodeURIComponent(s);for(let o of n.split(";")){let u=o.indexOf("="),[_,i]=u==-1?[o,""]:[o.slice(0,u),o.slice(u+1)];if(_.trim()===s)return decodeURIComponent(i)}return null}var TT=/\s+/,K2=[],nf=(()=>{class n{constructor(o,u){this._ngEl=o,this._renderer=u,this.initialClasses=K2,this.stateMap=new Map}set klass(o){this.initialClasses=o!=null?o.trim().split(TT):K2}set ngClass(o){this.rawClass=typeof o=="string"?o.trim().split(TT):o}ngDoCheck(){for(let u of this.initialClasses)this._updateState(u,!0);let o=this.rawClass;if(Array.isArray(o)||o instanceof Set)for(let u of o)this._updateState(u,!0);else if(o!=null)for(let u of Object.keys(o))this._updateState(u,!!o[u]);this._applyStateDiff()}_updateState(o,u){let _=this.stateMap.get(o);_!==void 0?(_.enabled!==u&&(_.changed=!0,_.enabled=u),_.touched=!0):this.stateMap.set(o,{enabled:u,changed:!0,touched:!0})}_applyStateDiff(){for(let o of this.stateMap){let u=o[0],_=o[1];_.changed?(this._toggleClass(u,_.enabled),_.changed=!1):_.touched||(_.enabled&&this._toggleClass(u,!1),this.stateMap.delete(u)),_.touched=!1}}_toggleClass(o,u){o=o.trim(),o.length>0&&o.split(TT).forEach(_=>{u?this._renderer.addClass(this._ngEl.nativeElement,_):this._renderer.removeClass(this._ngEl.nativeElement,_)})}static{this.\u0275fac=function(u){return new(u||n)(Yt(Gr),Yt(zs))}}static{this.\u0275dir=Xi({type:n,selectors:[["","ngClass",""]],inputs:{klass:[Lr.None,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return n})();var ET=class{constructor(s,o,u,_){this.$implicit=s,this.ngForOf=o,this.index=u,this.count=_}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},tv=(()=>{class n{set ngForOf(o){this._ngForOf=o,this._ngForOfDirty=!0}set ngForTrackBy(o){this._trackByFn=o}get ngForTrackBy(){return this._trackByFn}constructor(o,u,_){this._viewContainer=o,this._template=u,this._differs=_,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(o){o&&(this._template=o)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let o=this._ngForOf;if(!this._differ&&o)if(0)try{}catch{}else this._differ=this._differs.find(o).create(this.ngForTrackBy)}if(this._differ){let o=this._differ.diff(this._ngForOf);o&&this._applyChanges(o)}}_applyChanges(o){let u=this._viewContainer;o.forEachOperation((_,i,P)=>{if(_.previousIndex==null)u.createEmbeddedView(this._template,new ET(_.item,this._ngForOf,-1,-1),P===null?void 0:P);else if(P==null)u.remove(i===null?void 0:i);else if(i!==null){let V=u.get(i);u.move(V,P),J2(V,_)}});for(let _=0,i=u.length;_<i;_++){let V=u.get(_).context;V.index=_,V.count=i,V.ngForOf=this._ngForOf}o.forEachIdentityChange(_=>{let i=u.get(_.currentIndex);J2(i,_)})}static ngTemplateContextGuard(o,u){return!0}static{this.\u0275fac=function(u){return new(u||n)(Yt(Ec),Yt(Wu),Yt(vT))}}static{this.\u0275dir=Xi({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return n})();function J2(n,s){n.context.$implicit=s.item}var lP=(()=>{class n{constructor(o,u){this._viewContainer=o,this._context=new IT,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=u}set ngIf(o){this._context.$implicit=this._context.ngIf=o,this._updateView()}set ngIfThen(o){Q2("ngIfThen",o),this._thenTemplateRef=o,this._thenViewRef=null,this._updateView()}set ngIfElse(o){Q2("ngIfElse",o),this._elseTemplateRef=o,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(o,u){return!0}static{this.\u0275fac=function(u){return new(u||n)(Yt(Ec),Yt(Wu))}}static{this.\u0275dir=Xi({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return n})(),IT=class{constructor(){this.$implicit=null,this.ngIf=null}};function Q2(n,s){if(!!!(!s||s.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${io(s)}'.`)}function cP(n,s){return new cn(2100,!1)}var VV="mediumDate",jV=new en(""),UV=new en(""),nv=(()=>{class n{constructor(o,u,_){this.locale=o,this.defaultTimezone=u,this.defaultOptions=_}transform(o,u,_,i){if(o==null||o===""||o!==o)return null;try{let P=u??this.defaultOptions?.dateFormat??VV,V=_??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return SV(o,P,i||this.locale,V)}catch(P){throw cP(n,P.message)}}static{this.\u0275fac=function(u){return new(u||n)(Yt(U0,16),Yt(jV,24),Yt(UV,24))}}static{this.\u0275pipe=Im({name:"date",type:n,pure:!0,standalone:!0})}}return n})();var iv=(()=>{class n{transform(o,u,_){if(o==null)return null;if(!this.supports(o))throw cP(n,o);return o.slice(u,_)}supports(o){return typeof o=="string"||Array.isArray(o)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275pipe=Im({name:"slice",type:n,pure:!1,standalone:!0})}}return n})();var ao=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275mod=ns({type:n})}static{this.\u0275inj=ts({})}}return n})(),RT="browser",$V="server";function GV(n){return n===RT}function rv(n){return n===$V}var uP=(()=>{class n{static{this.\u0275prov=Wt({token:n,providedIn:"root",factory:()=>GV(Ct(ma))?new CT(Ct(Hr),window):new DT})}}return n})(),CT=class{constructor(s,o){this.document=s,this.window=o,this.offset=()=>[0,0]}setOffset(s){Array.isArray(s)?this.offset=()=>s:this.offset=s}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(s){this.window.scrollTo(s[0],s[1])}scrollToAnchor(s){let o=HV(this.document,s);o&&(this.scrollToElement(o),o.focus())}setHistoryScrollRestoration(s){this.window.history.scrollRestoration=s}scrollToElement(s){let o=s.getBoundingClientRect(),u=o.left+this.window.pageXOffset,_=o.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(u-i[0],_-i[1])}};function HV(n,s){let o=n.getElementById(s)||n.getElementsByName(s)[0];if(o)return o;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let u=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),_=u.currentNode;for(;_;){let i=_.shadowRoot;if(i){let P=i.getElementById(s)||i.querySelector(`[name="${s}"]`);if(P)return P}_=u.nextNode()}}return null}var DT=class{setOffset(s){}getScrollPosition(){return[0,0]}scrollToPosition(s){}scrollToAnchor(s){}setHistoryScrollRestoration(s){}},ef=class{};var Om=class{},sv=class{},eh=class n{constructor(s){this.normalizedNames=new Map,this.lazyUpdate=null,s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(o=>{let u=o.indexOf(":");if(u>0){let _=o.slice(0,u),i=_.toLowerCase(),P=o.slice(u+1).trim();this.maybeSetNormalizedName(_,i),this.headers.has(i)?this.headers.get(i).push(P):this.headers.set(i,[P])}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((o,u)=>{this.setHeaderEntries(u,o)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([o,u])=>{this.setHeaderEntries(o,u)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let o=this.headers.get(s.toLowerCase());return o&&o.length>0?o[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,o){return this.clone({name:s,value:o,op:"a"})}set(s,o){return this.clone({name:s,value:o,op:"s"})}delete(s,o){return this.clone({name:s,value:o,op:"d"})}maybeSetNormalizedName(s,o){this.normalizedNames.has(o)||this.normalizedNames.set(o,s)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(o=>{this.headers.set(o,s.headers.get(o)),this.normalizedNames.set(o,s.normalizedNames.get(o))})}clone(s){let o=new n;return o.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,o.lazyUpdate=(this.lazyUpdate||[]).concat([s]),o}applyUpdate(s){let o=s.name.toLowerCase();switch(s.op){case"a":case"s":let u=s.value;if(typeof u=="string"&&(u=[u]),u.length===0)return;this.maybeSetNormalizedName(s.name,o);let _=(s.op==="a"?this.headers.get(o):void 0)||[];_.push(...u),this.headers.set(o,_);break;case"d":let i=s.value;if(!i)this.headers.delete(o),this.normalizedNames.delete(o);else{let P=this.headers.get(o);if(!P)return;P=P.filter(V=>i.indexOf(V)===-1),P.length===0?(this.headers.delete(o),this.normalizedNames.delete(o)):this.headers.set(o,P)}break}}setHeaderEntries(s,o){let u=(Array.isArray(o)?o:[o]).map(i=>i.toString()),_=s.toLowerCase();this.headers.set(_,u),this.maybeSetNormalizedName(s,_)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(o=>s(this.normalizedNames.get(o),this.headers.get(o)))}};var LT=class{encodeKey(s){return hP(s)}encodeValue(s){return hP(s)}decodeKey(s){return decodeURIComponent(s)}decodeValue(s){return decodeURIComponent(s)}};function ZV(n,s){let o=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(_=>{let i=_.indexOf("="),[P,V]=i==-1?[s.decodeKey(_),""]:[s.decodeKey(_.slice(0,i)),s.decodeValue(_.slice(i+1))],$=o.get(P)||[];$.push(V),o.set(P,$)}),o}var XV=/%(\d[a-f0-9])/gi,YV={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function hP(n){return encodeURIComponent(n).replace(XV,(s,o)=>YV[o]??s)}function ov(n){return`${n}`}var _a=class n{constructor(s={}){if(this.updates=null,this.cloneFrom=null,this.encoder=s.encoder||new LT,s.fromString){if(s.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=ZV(s.fromString,this.encoder)}else s.fromObject?(this.map=new Map,Object.keys(s.fromObject).forEach(o=>{let u=s.fromObject[o],_=Array.isArray(u)?u.map(ov):[ov(u)];this.map.set(o,_)})):this.map=null}has(s){return this.init(),this.map.has(s)}get(s){this.init();let o=this.map.get(s);return o?o[0]:null}getAll(s){return this.init(),this.map.get(s)||null}keys(){return this.init(),Array.from(this.map.keys())}append(s,o){return this.clone({param:s,value:o,op:"a"})}appendAll(s){let o=[];return Object.keys(s).forEach(u=>{let _=s[u];Array.isArray(_)?_.forEach(i=>{o.push({param:u,value:i,op:"a"})}):o.push({param:u,value:_,op:"a"})}),this.clone(o)}set(s,o){return this.clone({param:s,value:o,op:"s"})}delete(s,o){return this.clone({param:s,value:o,op:"d"})}toString(){return this.init(),this.keys().map(s=>{let o=this.encoder.encodeKey(s);return this.map.get(s).map(u=>o+"="+this.encoder.encodeValue(u)).join("&")}).filter(s=>s!=="").join("&")}clone(s){let o=new n({encoder:this.encoder});return o.cloneFrom=this.cloneFrom||this,o.updates=(this.updates||[]).concat(s),o}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(s=>this.map.set(s,this.cloneFrom.map.get(s))),this.updates.forEach(s=>{switch(s.op){case"a":case"s":let o=(s.op==="a"?this.map.get(s.param):void 0)||[];o.push(ov(s.value)),this.map.set(s.param,o);break;case"d":if(s.value!==void 0){let u=this.map.get(s.param)||[],_=u.indexOf(ov(s.value));_!==-1&&u.splice(_,1),u.length>0?this.map.set(s.param,u):this.map.delete(s.param)}else{this.map.delete(s.param);break}}}),this.cloneFrom=this.updates=null)}};var FT=class{constructor(){this.map=new Map}set(s,o){return this.map.set(s,o),this}get(s){return this.map.has(s)||this.map.set(s,s.defaultValue()),this.map.get(s)}delete(s){return this.map.delete(s),this}has(s){return this.map.has(s)}keys(){return this.map.keys()}};function KV(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function dP(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function fP(n){return typeof Blob<"u"&&n instanceof Blob}function pP(n){return typeof FormData<"u"&&n instanceof FormData}function JV(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var Rm=class n{constructor(s,o,u,_){this.url=o,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=s.toUpperCase();let i;if(KV(this.method)||_?(this.body=u!==void 0?u:null,i=_):i=u,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new eh,this.context??=new FT,!this.params)this.params=new _a,this.urlWithParams=o;else{let P=this.params.toString();if(P.length===0)this.urlWithParams=o;else{let V=o.indexOf("?"),$=V===-1?"?":V<o.length-1?"&":"";this.urlWithParams=o+$+P}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||dP(this.body)||fP(this.body)||pP(this.body)||JV(this.body)?this.body:this.body instanceof _a?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||pP(this.body)?null:fP(this.body)?this.body.type||null:dP(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof _a?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(s={}){let o=s.method||this.method,u=s.url||this.url,_=s.responseType||this.responseType,i=s.transferCache??this.transferCache,P=s.body!==void 0?s.body:this.body,V=s.withCredentials??this.withCredentials,$=s.reportProgress??this.reportProgress,re=s.headers||this.headers,xe=s.params||this.params,Pe=s.context??this.context;return s.setHeaders!==void 0&&(re=Object.keys(s.setHeaders).reduce((Xe,Ze)=>Xe.set(Ze,s.setHeaders[Ze]),re)),s.setParams&&(xe=Object.keys(s.setParams).reduce((Xe,Ze)=>Xe.set(Ze,s.setParams[Ze]),xe)),new n(o,u,P,{params:xe,headers:re,context:Pe,reportProgress:$,responseType:_,withCredentials:V,transferCache:i})}},rf=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(rf||{}),Lm=class{constructor(s,o=cv.Ok,u="OK"){this.headers=s.headers||new eh,this.status=s.status!==void 0?s.status:o,this.statusText=s.statusText||u,this.url=s.url||null,this.ok=this.status>=200&&this.status<300}},kT=class n extends Lm{constructor(s={}){super(s),this.type=rf.ResponseHeader}clone(s={}){return new n({headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},av=class n extends Lm{constructor(s={}){super(s),this.type=rf.Response,this.body=s.body!==void 0?s.body:null}clone(s={}){return new n({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},lv=class extends Lm{constructor(s){super(s,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${s.url||"(unknown url)"}`:this.message=`Http failure response for ${s.url||"(unknown url)"}: ${s.status} ${s.statusText}`,this.error=s.error||null}},cv=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(cv||{});function OT(n,s){return{body:s,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var Fm=(()=>{class n{constructor(o){this.handler=o}request(o,u,_={}){let i;if(o instanceof Rm)i=o;else{let $;_.headers instanceof eh?$=_.headers:$=new eh(_.headers);let re;_.params&&(_.params instanceof _a?re=_.params:re=new _a({fromObject:_.params})),i=new Rm(o,u,_.body!==void 0?_.body:null,{headers:$,context:_.context,params:re,reportProgress:_.reportProgress,responseType:_.responseType||"json",withCredentials:_.withCredentials,transferCache:_.transferCache})}let P=fn(i).pipe(Ss($=>this.handler.handle($)));if(o instanceof Rm||_.observe==="events")return P;let V=P.pipe(yo($=>$ instanceof av));switch(_.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return V.pipe(yn($=>{if($.body!==null&&!($.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return $.body}));case"blob":return V.pipe(yn($=>{if($.body!==null&&!($.body instanceof Blob))throw new Error("Response is not a Blob.");return $.body}));case"text":return V.pipe(yn($=>{if($.body!==null&&typeof $.body!="string")throw new Error("Response is not a string.");return $.body}));case"json":default:return V.pipe(yn($=>$.body))}case"response":return V;default:throw new Error(`Unreachable: unhandled observe type ${_.observe}}`)}}delete(o,u={}){return this.request("DELETE",o,u)}get(o,u={}){return this.request("GET",o,u)}head(o,u={}){return this.request("HEAD",o,u)}jsonp(o,u){return this.request("JSONP",o,{params:new _a().append(u,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(o,u={}){return this.request("OPTIONS",o,u)}patch(o,u,_={}){return this.request("PATCH",o,OT(_,u))}post(o,u,_={}){return this.request("POST",o,OT(_,u))}put(o,u,_={}){return this.request("PUT",o,OT(_,u))}static{this.\u0275fac=function(u){return new(u||n)(Zt(Om))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();function yP(n,s){return s(n)}function QV(n,s){return(o,u)=>s.intercept(o,{handle:_=>n(_,u)})}function e5(n,s,o){return(u,_)=>Ls(o,()=>s(u,i=>n(i,_)))}var t5=new en(""),NT=new en(""),n5=new en(""),i5=new en("");function r5(){let n=null;return(s,o)=>{n===null&&(n=(Ct(t5,{optional:!0})??[]).reduceRight(QV,yP));let u=Ct(Ku),_=u.add();return n(s,o).pipe(pc(()=>u.remove(_)))}}var mP=(()=>{class n extends Om{constructor(o,u){super(),this.backend=o,this.injector=u,this.chain=null,this.pendingTasks=Ct(Ku);let _=Ct(i5,{optional:!0});this.backend=_??o}handle(o){if(this.chain===null){let _=Array.from(new Set([...this.injector.get(NT),...this.injector.get(n5,[])]));this.chain=_.reduceRight((i,P)=>e5(i,P,this.injector),yP)}let u=this.pendingTasks.add();return this.chain(o,_=>this.backend.handle(_)).pipe(pc(()=>this.pendingTasks.remove(u)))}static{this.\u0275fac=function(u){return new(u||n)(Zt(sv),Zt($r))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();var o5=/^\)\]\}',?\n/;function s5(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var gP=(()=>{class n{constructor(o){this.xhrFactory=o}handle(o){if(o.method==="JSONP")throw new cn(-2800,!1);let u=this.xhrFactory;return(u.\u0275loadImpl?Ai(u.\u0275loadImpl()):fn(null)).pipe(Or(()=>new ci(i=>{let P=u.build();if(P.open(o.method,o.urlWithParams),o.withCredentials&&(P.withCredentials=!0),o.headers.forEach((lt,Ut)=>P.setRequestHeader(lt,Ut.join(","))),o.headers.has("Accept")||P.setRequestHeader("Accept","application/json, text/plain, */*"),!o.headers.has("Content-Type")){let lt=o.detectContentTypeHeader();lt!==null&&P.setRequestHeader("Content-Type",lt)}if(o.responseType){let lt=o.responseType.toLowerCase();P.responseType=lt!=="json"?lt:"text"}let V=o.serializeBody(),$=null,re=()=>{if($!==null)return $;let lt=P.statusText||"OK",Ut=new eh(P.getAllResponseHeaders()),un=s5(P)||o.url;return $=new kT({headers:Ut,status:P.status,statusText:lt,url:un}),$},xe=()=>{let{headers:lt,status:Ut,statusText:un,url:an}=re(),Zn=null;Ut!==cv.NoContent&&(Zn=typeof P.response>"u"?P.responseText:P.response),Ut===0&&(Ut=Zn?cv.Ok:0);let Li=Ut>=200&&Ut<300;if(o.responseType==="json"&&typeof Zn=="string"){let At=Zn;Zn=Zn.replace(o5,"");try{Zn=Zn!==""?JSON.parse(Zn):null}catch(zi){Zn=At,Li&&(Li=!1,Zn={error:zi,text:Zn})}}Li?(i.next(new av({body:Zn,headers:lt,status:Ut,statusText:un,url:an||void 0})),i.complete()):i.error(new lv({error:Zn,headers:lt,status:Ut,statusText:un,url:an||void 0}))},Pe=lt=>{let{url:Ut}=re(),un=new lv({error:lt,status:P.status||0,statusText:P.statusText||"Unknown Error",url:Ut||void 0});i.error(un)},Xe=!1,Ze=lt=>{Xe||(i.next(re()),Xe=!0);let Ut={type:rf.DownloadProgress,loaded:lt.loaded};lt.lengthComputable&&(Ut.total=lt.total),o.responseType==="text"&&P.responseText&&(Ut.partialText=P.responseText),i.next(Ut)},yt=lt=>{let Ut={type:rf.UploadProgress,loaded:lt.loaded};lt.lengthComputable&&(Ut.total=lt.total),i.next(Ut)};return P.addEventListener("load",xe),P.addEventListener("error",Pe),P.addEventListener("timeout",Pe),P.addEventListener("abort",Pe),o.reportProgress&&(P.addEventListener("progress",Ze),V!==null&&P.upload&&P.upload.addEventListener("progress",yt)),P.send(V),i.next({type:rf.Sent}),()=>{P.removeEventListener("error",Pe),P.removeEventListener("abort",Pe),P.removeEventListener("load",xe),P.removeEventListener("timeout",Pe),o.reportProgress&&(P.removeEventListener("progress",Ze),V!==null&&P.upload&&P.upload.removeEventListener("progress",yt)),P.readyState!==P.DONE&&P.abort()}})))}static{this.\u0275fac=function(u){return new(u||n)(Zt(ef))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),vP=new en(""),a5="XSRF-TOKEN",l5=new en("",{providedIn:"root",factory:()=>a5}),c5="X-XSRF-TOKEN",u5=new en("",{providedIn:"root",factory:()=>c5}),uv=class{},h5=(()=>{class n{constructor(o,u,_){this.doc=o,this.platform=u,this.cookieName=_,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let o=this.doc.cookie||"";return o!==this.lastCookieString&&(this.parseCount++,this.lastToken=ev(o,this.cookieName),this.lastCookieString=o),this.lastToken}static{this.\u0275fac=function(u){return new(u||n)(Zt(Hr),Zt(ma),Zt(l5))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();function d5(n,s){let o=n.url.toLowerCase();if(!Ct(vP)||n.method==="GET"||n.method==="HEAD"||o.startsWith("http://")||o.startsWith("https://"))return s(n);let u=Ct(uv).getToken(),_=Ct(u5);return u!=null&&!n.headers.has(_)&&(n=n.clone({headers:n.headers.set(_,u)})),s(n)}var xP=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(xP||{});function f5(n,s){return{\u0275kind:n,\u0275providers:s}}function p5(...n){let s=[Fm,gP,mP,{provide:Om,useExisting:mP},{provide:sv,useExisting:gP},{provide:NT,useValue:d5,multi:!0},{provide:vP,useValue:!0},{provide:uv,useClass:h5}];for(let o of n)s.push(...o.\u0275providers);return Xu(s)}var _P=new en("");function m5(){return f5(xP.LegacyInterceptors,[{provide:_P,useFactory:r5},{provide:NT,useExisting:_P,multi:!0}])}var bP=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275mod=ns({type:n})}static{this.\u0275inj=ts({providers:[p5(m5())]})}}return n})();var VT=class extends K0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},jT=class n extends VT{static makeCurrent(){tP(new n)}onAndCancel(s,o,u){return s.addEventListener(o,u),()=>{s.removeEventListener(o,u)}}dispatchEvent(s,o){s.dispatchEvent(o)}remove(s){s.parentNode&&s.parentNode.removeChild(s)}createElement(s,o){return o=o||this.getDefaultDocument(),o.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,o){return o==="window"?window:o==="document"?s:o==="body"?s.body:null}getBaseHref(s){let o=_5();return o==null?null:y5(o)}resetBaseElement(){km=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return ev(document.cookie,s)}},km=null;function _5(){return km=km||document.querySelector("base"),km?km.getAttribute("href"):null}function y5(n){return new URL(n,document.baseURI).pathname}var v5=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),UT=new en(""),IP=(()=>{class n{constructor(o,u){this._zone=u,this._eventNameToPlugin=new Map,o.forEach(_=>{_.manager=this}),this._plugins=o.slice().reverse()}addEventListener(o,u,_){return this._findPluginFor(u).addEventListener(o,u,_)}getZone(){return this._zone}_findPluginFor(o){let u=this._eventNameToPlugin.get(o);if(u)return u;if(u=this._plugins.find(i=>i.supports(o)),!u)throw new cn(5101,!1);return this._eventNameToPlugin.set(o,u),u}static{this.\u0275fac=function(u){return new(u||n)(Zt(UT),Zt(ji))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),hv=class{constructor(s){this._doc=s}},zT="ng-app-id",CP=(()=>{class n{constructor(o,u,_,i={}){this.doc=o,this.appId=u,this.nonce=_,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=rv(i),this.resetHostNodes()}addStyles(o){for(let u of o)this.changeUsageCount(u,1)===1&&this.onStyleAdded(u)}removeStyles(o){for(let u of o)this.changeUsageCount(u,-1)<=0&&this.onStyleRemoved(u)}ngOnDestroy(){let o=this.styleNodesInDOM;o&&(o.forEach(u=>u.remove()),o.clear());for(let u of this.getAllStyles())this.onStyleRemoved(u);this.resetHostNodes()}addHost(o){this.hostNodes.add(o);for(let u of this.getAllStyles())this.addStyleToHost(o,u)}removeHost(o){this.hostNodes.delete(o)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(o){for(let u of this.hostNodes)this.addStyleToHost(u,o)}onStyleRemoved(o){let u=this.styleRef;u.get(o)?.elements?.forEach(_=>_.remove()),u.delete(o)}collectServerRenderedStyles(){let o=this.doc.head?.querySelectorAll(`style[${zT}="${this.appId}"]`);if(o?.length){let u=new Map;return o.forEach(_=>{_.textContent!=null&&u.set(_.textContent,_)}),u}return null}changeUsageCount(o,u){let _=this.styleRef;if(_.has(o)){let i=_.get(o);return i.usage+=u,i.usage}return _.set(o,{usage:u,elements:[]}),u}getStyleElement(o,u){let _=this.styleNodesInDOM,i=_?.get(u);if(i?.parentNode===o)return _.delete(u),i.removeAttribute(zT),i;{let P=this.doc.createElement("style");return this.nonce&&P.setAttribute("nonce",this.nonce),P.textContent=u,this.platformIsServer&&P.setAttribute(zT,this.appId),o.appendChild(P),P}}addStyleToHost(o,u){let _=this.getStyleElement(o,u),i=this.styleRef,P=i.get(u)?.elements;P?P.push(_):i.set(u,{elements:[_],usage:1})}resetHostNodes(){let o=this.hostNodes;o.clear(),o.add(this.doc.head)}static{this.\u0275fac=function(u){return new(u||n)(Zt(Hr),Zt(jw),Zt($w,8),Zt(ma))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),BT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},GT=/%COMP%/g,DP="%COMP%",x5=`_nghost-${DP}`,b5=`_ngcontent-${DP}`,w5=!0,T5=new en("",{providedIn:"root",factory:()=>w5});function E5(n){return b5.replace(GT,n)}function I5(n){return x5.replace(GT,n)}function MP(n,s){return s.map(o=>o.replace(GT,n))}var wP=(()=>{class n{constructor(o,u,_,i,P,V,$,re=null){this.eventManager=o,this.sharedStylesHost=u,this.appId=_,this.removeStylesOnCompDestroy=i,this.doc=P,this.platformId=V,this.ngZone=$,this.nonce=re,this.rendererByCompId=new Map,this.platformIsServer=rv(V),this.defaultRenderer=new Nm(o,P,$,this.platformIsServer)}createRenderer(o,u){if(!o||!u)return this.defaultRenderer;this.platformIsServer&&u.encapsulation===ha.ShadowDom&&(u=yi(St({},u),{encapsulation:ha.Emulated}));let _=this.getOrCreateRenderer(o,u);return _ instanceof dv?_.applyToHost(o):_ instanceof zm&&_.applyStyles(),_}getOrCreateRenderer(o,u){let _=this.rendererByCompId,i=_.get(u.id);if(!i){let P=this.doc,V=this.ngZone,$=this.eventManager,re=this.sharedStylesHost,xe=this.removeStylesOnCompDestroy,Pe=this.platformIsServer;switch(u.encapsulation){case ha.Emulated:i=new dv($,re,u,this.appId,xe,P,V,Pe);break;case ha.ShadowDom:return new $T($,re,o,u,P,V,this.nonce,Pe);default:i=new zm($,re,u,xe,P,V,Pe);break}_.set(u.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(u){return new(u||n)(Zt(IP),Zt(CP),Zt(jw),Zt(T5),Zt(Hr),Zt(ma),Zt(ji),Zt($w))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),Nm=class{constructor(s,o,u,_){this.eventManager=s,this.doc=o,this.ngZone=u,this.platformIsServer=_,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(s,o){return o?this.doc.createElementNS(BT[o]||o,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,o){(TP(s)?s.content:s).appendChild(o)}insertBefore(s,o,u){s&&(TP(s)?s.content:s).insertBefore(o,u)}removeChild(s,o){s&&s.removeChild(o)}selectRootElement(s,o){let u=typeof s=="string"?this.doc.querySelector(s):s;if(!u)throw new cn(-5104,!1);return o||(u.textContent=""),u}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,o,u,_){if(_){o=_+":"+o;let i=BT[_];i?s.setAttributeNS(i,o,u):s.setAttribute(o,u)}else s.setAttribute(o,u)}removeAttribute(s,o,u){if(u){let _=BT[u];_?s.removeAttributeNS(_,o):s.removeAttribute(`${u}:${o}`)}else s.removeAttribute(o)}addClass(s,o){s.classList.add(o)}removeClass(s,o){s.classList.remove(o)}setStyle(s,o,u,_){_&(Ka.DashCase|Ka.Important)?s.style.setProperty(o,u,_&Ka.Important?"important":""):s.style[o]=u}removeStyle(s,o,u){u&Ka.DashCase?s.style.removeProperty(o):s.style[o]=""}setProperty(s,o,u){s!=null&&(s[o]=u)}setValue(s,o){s.nodeValue=o}listen(s,o,u){if(typeof s=="string"&&(s=sl().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${o}`);return this.eventManager.addEventListener(s,o,this.decoratePreventDefault(u))}decoratePreventDefault(s){return o=>{if(o==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(o)):s(o))===!1&&o.preventDefault()}}};function TP(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var $T=class extends Nm{constructor(s,o,u,_,i,P,V,$){super(s,i,P,$),this.sharedStylesHost=o,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let re=MP(_.id,_.styles);for(let xe of re){let Pe=document.createElement("style");V&&Pe.setAttribute("nonce",V),Pe.textContent=xe,this.shadowRoot.appendChild(Pe)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,o){return super.appendChild(this.nodeOrShadowRoot(s),o)}insertBefore(s,o,u){return super.insertBefore(this.nodeOrShadowRoot(s),o,u)}removeChild(s,o){return super.removeChild(this.nodeOrShadowRoot(s),o)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},zm=class extends Nm{constructor(s,o,u,_,i,P,V,$){super(s,i,P,V),this.sharedStylesHost=o,this.removeStylesOnCompDestroy=_,this.styles=$?MP($,u.styles):u.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},dv=class extends zm{constructor(s,o,u,_,i,P,V,$){let re=_+"-"+u.id;super(s,o,u,i,P,V,$,re),this.contentAttr=E5(re),this.hostAttr=I5(re)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,o){let u=super.createElement(s,o);return super.setAttribute(u,this.contentAttr,""),u}},C5=(()=>{class n extends hv{constructor(o){super(o)}supports(o){return!0}addEventListener(o,u,_){return o.addEventListener(u,_,!1),()=>this.removeEventListener(o,u,_)}removeEventListener(o,u,_){return o.removeEventListener(u,_)}static{this.\u0275fac=function(u){return new(u||n)(Zt(Hr))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})(),EP=["alt","control","meta","shift"],D5={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},M5={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},S5=(()=>{class n extends hv{constructor(o){super(o)}supports(o){return n.parseEventName(o)!=null}addEventListener(o,u,_){let i=n.parseEventName(u),P=n.eventCallback(i.fullKey,_,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>sl().onAndCancel(o,i.domEventName,P))}static parseEventName(o){let u=o.toLowerCase().split("."),_=u.shift();if(u.length===0||!(_==="keydown"||_==="keyup"))return null;let i=n._normalizeKey(u.pop()),P="",V=u.indexOf("code");if(V>-1&&(u.splice(V,1),P="code."),EP.forEach(re=>{let xe=u.indexOf(re);xe>-1&&(u.splice(xe,1),P+=re+".")}),P+=i,u.length!=0||i.length===0)return null;let $={};return $.domEventName=_,$.fullKey=P,$}static matchEventFullKeyCode(o,u){let _=D5[o.key]||o.key,i="";return u.indexOf("code.")>-1&&(_=o.code,i="code."),_==null||!_?!1:(_=_.toLowerCase(),_===" "?_="space":_==="."&&(_="dot"),EP.forEach(P=>{if(P!==_){let V=M5[P];V(o)&&(i+=P+".")}}),i+=_,i===u)}static eventCallback(o,u,_){return i=>{n.matchEventFullKeyCode(i,o)&&_.runGuarded(()=>u(i))}}static _normalizeKey(o){return o==="esc"?"escape":o}static{this.\u0275fac=function(u){return new(u||n)(Zt(Hr))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();function SP(n,s){return q2(St({rootComponent:n},A5(s)))}function A5(n){return{appProviders:[...F5,...n?.providers??[]],platformProviders:L5}}function P5(){jT.makeCurrent()}function R5(){return new fa}function O5(){return qA(document),document}var L5=[{provide:ma,useValue:RT},{provide:Uw,useValue:P5,multi:!0},{provide:Hr,useFactory:O5,deps:[]}];var F5=[{provide:_0,useValue:"root"},{provide:fa,useFactory:R5,deps:[]},{provide:UT,useClass:C5,multi:!0,deps:[Hr,ji,ma]},{provide:UT,useClass:S5,multi:!0,deps:[Hr]},wP,CP,IP,{provide:xm,useExisting:wP},{provide:ef,useClass:v5,deps:[]},[]];var AP=(()=>{class n{constructor(o){this._doc=o}getTitle(){return this._doc.title}setTitle(o){this._doc.title=o||""}static{this.\u0275fac=function(u){return new(u||n)(Zt(Hr))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Bn="primary",eg=Symbol("RouteTitle"),XT=class{constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let o=this.params[s];return Array.isArray(o)?o[0]:o}return null}getAll(s){if(this.has(s)){let o=this.params[s];return Array.isArray(o)?o:[o]}return[]}get keys(){return Object.keys(this.params)}};function cf(n){return new XT(n)}function N5(n,s,o){let u=o.path.split("/");if(u.length>n.length||o.pathMatch==="full"&&(s.hasChildren()||u.length<n.length))return null;let _={};for(let i=0;i<u.length;i++){let P=u[i],V=n[i];if(P.startsWith(":"))_[P.substring(1)]=V;else if(P!==V.path)return null}return{consumed:n.slice(0,u.length),posParams:_}}function z5(n,s){if(n.length!==s.length)return!1;for(let o=0;o<n.length;++o)if(!ya(n[o],s[o]))return!1;return!0}function ya(n,s){let o=n?YT(n):void 0,u=s?YT(s):void 0;if(!o||!u||o.length!=u.length)return!1;let _;for(let i=0;i<o.length;i++)if(_=o[i],!BP(n[_],s[_]))return!1;return!0}function YT(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function BP(n,s){if(Array.isArray(n)&&Array.isArray(s)){if(n.length!==s.length)return!1;let o=[...n].sort(),u=[...s].sort();return o.every((_,i)=>u[i]===_)}else return n===s}function VP(n){return n.length>0?n[n.length-1]:null}function Pc(n){return Wa(n)?n:Ju(n)?Ai(Promise.resolve(n)):fn(n)}var B5={exact:UP,subset:$P},jP={exact:V5,subset:j5,ignored:()=>!0};function PP(n,s,o){return B5[o.paths](n.root,s.root,o.matrixParams)&&jP[o.queryParams](n.queryParams,s.queryParams)&&!(o.fragment==="exact"&&n.fragment!==s.fragment)}function V5(n,s){return ya(n,s)}function UP(n,s,o){if(!nh(n.segments,s.segments)||!mv(n.segments,s.segments,o)||n.numberOfChildren!==s.numberOfChildren)return!1;for(let u in s.children)if(!n.children[u]||!UP(n.children[u],s.children[u],o))return!1;return!0}function j5(n,s){return Object.keys(s).length<=Object.keys(n).length&&Object.keys(s).every(o=>BP(n[o],s[o]))}function $P(n,s,o){return GP(n,s,s.segments,o)}function GP(n,s,o,u){if(n.segments.length>o.length){let _=n.segments.slice(0,o.length);return!(!nh(_,o)||s.hasChildren()||!mv(_,o,u))}else if(n.segments.length===o.length){if(!nh(n.segments,o)||!mv(n.segments,o,u))return!1;for(let _ in s.children)if(!n.children[_]||!$P(n.children[_],s.children[_],u))return!1;return!0}else{let _=o.slice(0,n.segments.length),i=o.slice(n.segments.length);return!nh(n.segments,_)||!mv(n.segments,_,u)||!n.children[Bn]?!1:GP(n.children[Bn],s,i,u)}}function mv(n,s,o){return s.every((u,_)=>jP[o](n[_].parameters,u.parameters))}var Dc=class{constructor(s=new mi([],{}),o={},u=null){this.root=s,this.queryParams=o,this.fragment=u}get queryParamMap(){return this._queryParamMap??=cf(this.queryParams),this._queryParamMap}toString(){return G5.serialize(this)}},mi=class{constructor(s,o){this.segments=s,this.children=o,this.parent=null,Object.values(o).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return gv(this)}},th=class{constructor(s,o){this.path=s,this.parameters=o}get parameterMap(){return this._parameterMap??=cf(this.parameters),this._parameterMap}toString(){return qP(this)}};function U5(n,s){return nh(n,s)&&n.every((o,u)=>ya(o.parameters,s[u].parameters))}function nh(n,s){return n.length!==s.length?!1:n.every((o,u)=>o.path===s[u].path)}function $5(n,s){let o=[];return Object.entries(n.children).forEach(([u,_])=>{u===Bn&&(o=o.concat(s(_,u)))}),Object.entries(n.children).forEach(([u,_])=>{u!==Bn&&(o=o.concat(s(_,u)))}),o}var tg=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>new Hm,providedIn:"root"})}}return n})(),Hm=class{parse(s){let o=new JT(s);return new Dc(o.parseRootSegment(),o.parseQueryParams(),o.parseFragment())}serialize(s){let o=`/${Bm(s.root,!0)}`,u=W5(s.queryParams),_=typeof s.fragment=="string"?`#${H5(s.fragment)}`:"";return`${o}${u}${_}`}},G5=new Hm;function gv(n){return n.segments.map(s=>qP(s)).join("/")}function Bm(n,s){if(!n.hasChildren())return gv(n);if(s){let o=n.children[Bn]?Bm(n.children[Bn],!1):"",u=[];return Object.entries(n.children).forEach(([_,i])=>{_!==Bn&&u.push(`${_}:${Bm(i,!1)}`)}),u.length>0?`${o}(${u.join("//")})`:o}else{let o=$5(n,(u,_)=>_===Bn?[Bm(n.children[Bn],!1)]:[`${_}:${Bm(u,!1)}`]);return Object.keys(n.children).length===1&&n.children[Bn]!=null?`${gv(n)}/${o[0]}`:`${gv(n)}/(${o.join("//")})`}}function HP(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function fv(n){return HP(n).replace(/%3B/gi,";")}function H5(n){return encodeURI(n)}function KT(n){return HP(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function _v(n){return decodeURIComponent(n)}function RP(n){return _v(n.replace(/\+/g,"%20"))}function qP(n){return`${KT(n.path)}${q5(n.parameters)}`}function q5(n){return Object.entries(n).map(([s,o])=>`;${KT(s)}=${KT(o)}`).join("")}function W5(n){let s=Object.entries(n).map(([o,u])=>Array.isArray(u)?u.map(_=>`${fv(o)}=${fv(_)}`).join("&"):`${fv(o)}=${fv(u)}`).filter(o=>o);return s.length?`?${s.join("&")}`:""}var Z5=/^[^\/()?;#]+/;function HT(n){let s=n.match(Z5);return s?s[0]:""}var X5=/^[^\/()?;=#]+/;function Y5(n){let s=n.match(X5);return s?s[0]:""}var K5=/^[^=?&#]+/;function J5(n){let s=n.match(K5);return s?s[0]:""}var Q5=/^[^&#]+/;function ej(n){let s=n.match(Q5);return s?s[0]:""}var JT=class{constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new mi([],{}):new mi([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let o={};this.peekStartsWith("/(")&&(this.capture("/"),o=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(s.length>0||Object.keys(o).length>0)&&(u[Bn]=new mi(s,o)),u}parseSegment(){let s=HT(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new cn(4009,!1);return this.capture(s),new th(_v(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let o=Y5(this.remaining);if(!o)return;this.capture(o);let u="";if(this.consumeOptional("=")){let _=HT(this.remaining);_&&(u=_,this.capture(u))}s[_v(o)]=_v(u)}parseQueryParam(s){let o=J5(this.remaining);if(!o)return;this.capture(o);let u="";if(this.consumeOptional("=")){let P=ej(this.remaining);P&&(u=P,this.capture(u))}let _=RP(o),i=RP(u);if(s.hasOwnProperty(_)){let P=s[_];Array.isArray(P)||(P=[P],s[_]=P),P.push(i)}else s[_]=i}parseParens(s){let o={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=HT(this.remaining),_=this.remaining[u.length];if(_!=="/"&&_!==")"&&_!==";")throw new cn(4010,!1);let i;u.indexOf(":")>-1?(i=u.slice(0,u.indexOf(":")),this.capture(i),this.capture(":")):s&&(i=Bn);let P=this.parseChildren();o[i]=Object.keys(P).length===1?P[Bn]:new mi([],P),this.consumeOptional("//")}return o}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new cn(4011,!1)}};function WP(n){return n.segments.length>0?new mi([],{[Bn]:n}):n}function ZP(n){let s={};for(let[u,_]of Object.entries(n.children)){let i=ZP(_);if(u===Bn&&i.segments.length===0&&i.hasChildren())for(let[P,V]of Object.entries(i.children))s[P]=V;else(i.segments.length>0||i.hasChildren())&&(s[u]=i)}let o=new mi(n.segments,s);return tj(o)}function tj(n){if(n.numberOfChildren===1&&n.children[Bn]){let s=n.children[Bn];return new mi(n.segments.concat(s.segments),s.children)}return n}function uf(n){return n instanceof Dc}function nj(n,s,o=null,u=null){let _=XP(n);return YP(_,s,o,u)}function XP(n){let s;function o(i){let P={};for(let $ of i.children){let re=o($);P[$.outlet]=re}let V=new mi(i.url,P);return i===n&&(s=V),V}let u=o(n.root),_=WP(u);return s??_}function YP(n,s,o,u){let _=n;for(;_.parent;)_=_.parent;if(s.length===0)return qT(_,_,_,o,u);let i=ij(s);if(i.toRoot())return qT(_,_,new mi([],{}),o,u);let P=rj(i,_,n),V=P.processChildren?Um(P.segmentGroup,P.index,i.commands):JP(P.segmentGroup,P.index,i.commands);return qT(_,P.segmentGroup,V,o,u)}function yv(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function qm(n){return typeof n=="object"&&n!=null&&n.outlets}function qT(n,s,o,u,_){let i={};u&&Object.entries(u).forEach(([$,re])=>{i[$]=Array.isArray(re)?re.map(xe=>`${xe}`):`${re}`});let P;n===s?P=o:P=KP(n,s,o);let V=WP(ZP(P));return new Dc(V,i,_)}function KP(n,s,o){let u={};return Object.entries(n.children).forEach(([_,i])=>{i===s?u[_]=o:u[_]=KP(i,s,o)}),new mi(n.segments,u)}var vv=class{constructor(s,o,u){if(this.isAbsolute=s,this.numberOfDoubleDots=o,this.commands=u,s&&u.length>0&&yv(u[0]))throw new cn(4003,!1);let _=u.find(qm);if(_&&_!==VP(u))throw new cn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ij(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new vv(!0,0,n);let s=0,o=!1,u=n.reduce((_,i,P)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let V={};return Object.entries(i.outlets).forEach(([$,re])=>{V[$]=typeof re=="string"?re.split("/"):re}),[..._,{outlets:V}]}if(i.segmentPath)return[..._,i.segmentPath]}return typeof i!="string"?[..._,i]:P===0?(i.split("/").forEach((V,$)=>{$==0&&V==="."||($==0&&V===""?o=!0:V===".."?s++:V!=""&&_.push(V))}),_):[..._,i]},[]);return new vv(o,s,u)}var af=class{constructor(s,o,u){this.segmentGroup=s,this.processChildren=o,this.index=u}};function rj(n,s,o){if(n.isAbsolute)return new af(s,!0,0);if(!o)return new af(s,!1,NaN);if(o.parent===null)return new af(o,!0,0);let u=yv(n.commands[0])?0:1,_=o.segments.length-1+u;return oj(o,_,n.numberOfDoubleDots)}function oj(n,s,o){let u=n,_=s,i=o;for(;i>_;){if(i-=_,u=u.parent,!u)throw new cn(4005,!1);_=u.segments.length}return new af(u,!1,_-i)}function sj(n){return qm(n[0])?n[0].outlets:{[Bn]:n}}function JP(n,s,o){if(n??=new mi([],{}),n.segments.length===0&&n.hasChildren())return Um(n,s,o);let u=aj(n,s,o),_=o.slice(u.commandIndex);if(u.match&&u.pathIndex<n.segments.length){let i=new mi(n.segments.slice(0,u.pathIndex),{});return i.children[Bn]=new mi(n.segments.slice(u.pathIndex),n.children),Um(i,0,_)}else return u.match&&_.length===0?new mi(n.segments,{}):u.match&&!n.hasChildren()?QT(n,s,o):u.match?Um(n,0,_):QT(n,s,o)}function Um(n,s,o){if(o.length===0)return new mi(n.segments,{});{let u=sj(o),_={};if(Object.keys(u).some(i=>i!==Bn)&&n.children[Bn]&&n.numberOfChildren===1&&n.children[Bn].segments.length===0){let i=Um(n.children[Bn],s,o);return new mi(n.segments,i.children)}return Object.entries(u).forEach(([i,P])=>{typeof P=="string"&&(P=[P]),P!==null&&(_[i]=JP(n.children[i],s,P))}),Object.entries(n.children).forEach(([i,P])=>{u[i]===void 0&&(_[i]=P)}),new mi(n.segments,_)}}function aj(n,s,o){let u=0,_=s,i={match:!1,pathIndex:0,commandIndex:0};for(;_<n.segments.length;){if(u>=o.length)return i;let P=n.segments[_],V=o[u];if(qm(V))break;let $=`${V}`,re=u<o.length-1?o[u+1]:null;if(_>0&&$===void 0)break;if($&&re&&typeof re=="object"&&re.outlets===void 0){if(!LP($,re,P))return i;u+=2}else{if(!LP($,{},P))return i;u++}_++}return{match:!0,pathIndex:_,commandIndex:u}}function QT(n,s,o){let u=n.segments.slice(0,s),_=0;for(;_<o.length;){let i=o[_];if(qm(i)){let $=lj(i.outlets);return new mi(u,$)}if(_===0&&yv(o[0])){let $=n.segments[s];u.push(new th($.path,OP(o[0]))),_++;continue}let P=qm(i)?i.outlets[Bn]:`${i}`,V=_<o.length-1?o[_+1]:null;P&&V&&yv(V)?(u.push(new th(P,OP(V))),_+=2):(u.push(new th(P,{})),_++)}return new mi(u,{})}function lj(n){let s={};return Object.entries(n).forEach(([o,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(s[o]=QT(new mi([],{}),0,u))}),s}function OP(n){let s={};return Object.entries(n).forEach(([o,u])=>s[o]=`${u}`),s}function LP(n,s,o){return n==o.path&&ya(s,o.parameters)}var $m="imperative",wr=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(wr||{}),ss=class{constructor(s,o){this.id=s,this.url=o}},hf=class extends ss{constructor(s,o,u="imperative",_=null){super(s,o),this.type=wr.NavigationStart,this.navigationTrigger=u,this.restoredState=_}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},js=class extends ss{constructor(s,o,u){super(s,o),this.urlAfterRedirects=u,this.type=wr.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Vo=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Vo||{}),xv=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(xv||{}),Mc=class extends ss{constructor(s,o,u,_){super(s,o),this.reason=u,this.code=_,this.type=wr.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Sc=class extends ss{constructor(s,o,u,_){super(s,o),this.reason=u,this.code=_,this.type=wr.NavigationSkipped}},Wm=class extends ss{constructor(s,o,u,_){super(s,o),this.error=u,this.target=_,this.type=wr.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},bv=class extends ss{constructor(s,o,u,_){super(s,o),this.urlAfterRedirects=u,this.state=_,this.type=wr.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},eE=class extends ss{constructor(s,o,u,_){super(s,o),this.urlAfterRedirects=u,this.state=_,this.type=wr.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},tE=class extends ss{constructor(s,o,u,_,i){super(s,o),this.urlAfterRedirects=u,this.state=_,this.shouldActivate=i,this.type=wr.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},nE=class extends ss{constructor(s,o,u,_){super(s,o),this.urlAfterRedirects=u,this.state=_,this.type=wr.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iE=class extends ss{constructor(s,o,u,_){super(s,o),this.urlAfterRedirects=u,this.state=_,this.type=wr.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rE=class{constructor(s){this.route=s,this.type=wr.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},oE=class{constructor(s){this.route=s,this.type=wr.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},sE=class{constructor(s){this.snapshot=s,this.type=wr.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},aE=class{constructor(s){this.snapshot=s,this.type=wr.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lE=class{constructor(s){this.snapshot=s,this.type=wr.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cE=class{constructor(s){this.snapshot=s,this.type=wr.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},wv=class{constructor(s,o,u){this.routerEvent=s,this.position=o,this.anchor=u,this.type=wr.Scroll}toString(){let s=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${s}')`}},Zm=class{},Xm=class{constructor(s){this.url=s}};var uE=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ng,this.attachRef=null}},ng=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(o,u){let _=this.getOrCreateContext(o);_.outlet=u,this.contexts.set(o,_)}onChildOutletDestroyed(o){let u=this.getContext(o);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){let o=this.contexts;return this.contexts=new Map,o}onOutletReAttached(o){this.contexts=o}getOrCreateContext(o){let u=this.getContext(o);return u||(u=new uE,this.contexts.set(o,u)),u}getContext(o){return this.contexts.get(o)||null}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Tv=class{constructor(s){this._root=s}get root(){return this._root.value}parent(s){let o=this.pathFromRoot(s);return o.length>1?o[o.length-2]:null}children(s){let o=hE(s,this._root);return o?o.children.map(u=>u.value):[]}firstChild(s){let o=hE(s,this._root);return o&&o.children.length>0?o.children[0].value:null}siblings(s){let o=dE(s,this._root);return o.length<2?[]:o[o.length-2].children.map(_=>_.value).filter(_=>_!==s)}pathFromRoot(s){return dE(s,this._root).map(o=>o.value)}};function hE(n,s){if(n===s.value)return s;for(let o of s.children){let u=hE(n,o);if(u)return u}return null}function dE(n,s){if(n===s.value)return[s];for(let o of s.children){let u=dE(n,o);if(u.length)return u.unshift(s),u}return[]}var Bo=class{constructor(s,o){this.value=s,this.children=o}toString(){return`TreeNode(${this.value})`}};function sf(n){let s={};return n&&n.children.forEach(o=>s[o.value.outlet]=o),s}var Ev=class extends Tv{constructor(s,o){super(s),this.snapshot=o,wE(this,s)}toString(){return this.snapshot.toString()}};function QP(n){let s=cj(n),o=new fr([new th("",{})]),u=new fr({}),_=new fr({}),i=new fr({}),P=new fr(""),V=new Ac(o,u,i,P,_,Bn,n,s.root);return V.snapshot=s.root,new Ev(new Bo(V,[]),s)}function cj(n){let s={},o={},u={},_="",i=new Ym([],s,u,_,o,Bn,n,null,{});return new Iv("",new Bo(i,[]))}var Ac=class{constructor(s,o,u,_,i,P,V,$){this.urlSubject=s,this.paramsSubject=o,this.queryParamsSubject=u,this.fragmentSubject=_,this.dataSubject=i,this.outlet=P,this.component=V,this._futureSnapshot=$,this.title=this.dataSubject?.pipe(yn(re=>re[eg]))??fn(void 0),this.url=s,this.params=o,this.queryParams=u,this.fragment=_,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(yn(s=>cf(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(yn(s=>cf(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function bE(n,s,o="emptyOnly"){let u,{routeConfig:_}=n;return s!==null&&(o==="always"||_?.path===""||!s.component&&!s.routeConfig?.loadComponent)?u={params:St(St({},s.params),n.params),data:St(St({},s.data),n.data),resolve:St(St(St(St({},n.data),s.data),_?.data),n._resolvedData)}:u={params:St({},n.params),data:St({},n.data),resolve:St(St({},n.data),n._resolvedData??{})},_&&tR(_)&&(u.resolve[eg]=_.title),u}var Ym=class{get title(){return this.data?.[eg]}constructor(s,o,u,_,i,P,V,$,re){this.url=s,this.params=o,this.queryParams=u,this.fragment=_,this.data=i,this.outlet=P,this.component=V,this.routeConfig=$,this._resolve=re}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=cf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=cf(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(u=>u.toString()).join("/"),o=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${o}')`}},Iv=class extends Tv{constructor(s,o){super(o),this.url=s,wE(this,o)}toString(){return eR(this._root)}};function wE(n,s){s.value._routerState=n,s.children.forEach(o=>wE(n,o))}function eR(n){let s=n.children.length>0?` { ${n.children.map(eR).join(", ")} } `:"";return`${n.value}${s}`}function WT(n){if(n.snapshot){let s=n.snapshot,o=n._futureSnapshot;n.snapshot=o,ya(s.queryParams,o.queryParams)||n.queryParamsSubject.next(o.queryParams),s.fragment!==o.fragment&&n.fragmentSubject.next(o.fragment),ya(s.params,o.params)||n.paramsSubject.next(o.params),z5(s.url,o.url)||n.urlSubject.next(o.url),ya(s.data,o.data)||n.dataSubject.next(o.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function fE(n,s){let o=ya(n.params,s.params)&&U5(n.url,s.url),u=!n.parent!=!s.parent;return o&&!u&&(!n.parent||fE(n.parent,s.parent))}function tR(n){return typeof n.title=="string"||n.title===null}var TE=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Bn,this.activateEvents=new Ii,this.deactivateEvents=new Ii,this.attachEvents=new Ii,this.detachEvents=new Ii,this.parentContexts=Ct(ng),this.location=Ct(Ec),this.changeDetector=Ct(Bs),this.environmentInjector=Ct($r),this.inputBinder=Ct(Av,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(o){if(o.name){let{firstChange:u,previousValue:_}=o.name;if(u)return;this.isTrackedInParentContexts(_)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(_)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(o){return this.parentContexts.getContext(o)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let o=this.parentContexts.getContext(this.name);o?.route&&(o.attachRef?this.attach(o.attachRef,o.route):this.activateWith(o.route,o.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new cn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new cn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new cn(4012,!1);this.location.detach();let o=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(o.instance),o}attach(o,u){this.activated=o,this._activatedRoute=u,this.location.insert(o.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(o.instance)}deactivate(){if(this.activated){let o=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(o)}}activateWith(o,u){if(this.isActivated)throw new cn(4013,!1);this._activatedRoute=o;let _=this.location,P=o.snapshot.component,V=this.parentContexts.getOrCreateContext(this.name).children,$=new pE(o,V,_.injector);this.activated=_.createComponent(P,{index:_.length,injector:$,environmentInjector:u??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275dir=Xi({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[tl]})}}return n})(),pE=class n{__ngOutletInjector(s){return new n(this.route,this.childContexts,s)}constructor(s,o,u){this.route=s,this.childContexts=o,this.parent=u}get(s,o){return s===Ac?this.route:s===ng?this.childContexts:this.parent.get(s,o)}},Av=new en(""),FP=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(o){this.unsubscribeFromRouteData(o),this.subscribeToRouteData(o)}unsubscribeFromRouteData(o){this.outletDataSubscriptions.get(o)?.unsubscribe(),this.outletDataSubscriptions.delete(o)}subscribeToRouteData(o){let{activatedRoute:u}=o,_=lm([u.queryParams,u.params,u.data]).pipe(Or(([i,P,V],$)=>(V=St(St(St({},i),P),V),$===0?fn(V):Promise.resolve(V)))).subscribe(i=>{if(!o.isActivated||!o.activatedComponentRef||o.activatedRoute!==u||u.component===null){this.unsubscribeFromRouteData(o);return}let P=W2(u.component);if(!P){this.unsubscribeFromRouteData(o);return}for(let{templateName:V}of P.inputs)o.activatedComponentRef.setInput(V,i[V])});this.outletDataSubscriptions.set(o,_)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();function uj(n,s,o){let u=Km(n,s._root,o?o._root:void 0);return new Ev(u,s)}function Km(n,s,o){if(o&&n.shouldReuseRoute(s.value,o.value.snapshot)){let u=o.value;u._futureSnapshot=s.value;let _=hj(n,s,o);return new Bo(u,_)}else{if(n.shouldAttach(s.value)){let i=n.retrieve(s.value);if(i!==null){let P=i.route;return P.value._futureSnapshot=s.value,P.children=s.children.map(V=>Km(n,V)),P}}let u=dj(s.value),_=s.children.map(i=>Km(n,i));return new Bo(u,_)}}function hj(n,s,o){return s.children.map(u=>{for(let _ of o.children)if(n.shouldReuseRoute(u.value,_.value.snapshot))return Km(n,u,_);return Km(n,u)})}function dj(n){return new Ac(new fr(n.url),new fr(n.params),new fr(n.queryParams),new fr(n.fragment),new fr(n.data),n.outlet,n.component,n)}var nR="ngNavigationCancelingError";function iR(n,s){let{redirectTo:o,navigationBehaviorOptions:u}=uf(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,_=rR(!1,Vo.Redirect);return _.url=o,_.navigationBehaviorOptions=u,_}function rR(n,s){let o=new Error(`NavigationCancelingError: ${n||""}`);return o[nR]=!0,o.cancellationCode=s,o}function fj(n){return oR(n)&&uf(n.url)}function oR(n){return!!n&&n[nR]}var pj=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["ng-component"]],standalone:!0,features:[Ri],decls:1,vars:0,template:function(u,_){u&1&&Sn(0,"router-outlet")},dependencies:[TE],encapsulation:2})}}return n})();function mj(n,s){return n.providers&&!n._injector&&(n._injector=O0(n.providers,s,`Route: ${n.path}`)),n._injector??s}function EE(n){let s=n.children&&n.children.map(EE),o=s?yi(St({},n),{children:s}):St({},n);return!o.component&&!o.loadComponent&&(s||o.loadChildren)&&o.outlet&&o.outlet!==Bn&&(o.component=pj),o}function va(n){return n.outlet||Bn}function gj(n,s){let o=n.filter(u=>va(u)===s);return o.push(...n.filter(u=>va(u)!==s)),o}function ig(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let s=n.parent;s;s=s.parent){let o=s.routeConfig;if(o?._loadedInjector)return o._loadedInjector;if(o?._injector)return o._injector}return null}var _j=(n,s,o,u)=>yn(_=>(new mE(s,_.targetRouterState,_.currentRouterState,o,u).activate(n),_)),mE=class{constructor(s,o,u,_,i){this.routeReuseStrategy=s,this.futureState=o,this.currState=u,this.forwardEvent=_,this.inputBindingEnabled=i}activate(s){let o=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(o,u,s),WT(this.futureState.root),this.activateChildRoutes(o,u,s)}deactivateChildRoutes(s,o,u){let _=sf(o);s.children.forEach(i=>{let P=i.value.outlet;this.deactivateRoutes(i,_[P],u),delete _[P]}),Object.values(_).forEach(i=>{this.deactivateRouteAndItsChildren(i,u)})}deactivateRoutes(s,o,u){let _=s.value,i=o?o.value:null;if(_===i)if(_.component){let P=u.getContext(_.outlet);P&&this.deactivateChildRoutes(s,o,P.children)}else this.deactivateChildRoutes(s,o,u);else i&&this.deactivateRouteAndItsChildren(o,u)}deactivateRouteAndItsChildren(s,o){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,o):this.deactivateRouteAndOutlet(s,o)}detachAndStoreRouteSubtree(s,o){let u=o.getContext(s.value.outlet),_=u&&s.value.component?u.children:o,i=sf(s);for(let P of Object.values(i))this.deactivateRouteAndItsChildren(P,_);if(u&&u.outlet){let P=u.outlet.detach(),V=u.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:P,route:s,contexts:V})}}deactivateRouteAndOutlet(s,o){let u=o.getContext(s.value.outlet),_=u&&s.value.component?u.children:o,i=sf(s);for(let P of Object.values(i))this.deactivateRouteAndItsChildren(P,_);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(s,o,u){let _=sf(o);s.children.forEach(i=>{this.activateRoutes(i,_[i.value.outlet],u),this.forwardEvent(new cE(i.value.snapshot))}),s.children.length&&this.forwardEvent(new aE(s.value.snapshot))}activateRoutes(s,o,u){let _=s.value,i=o?o.value:null;if(WT(_),_===i)if(_.component){let P=u.getOrCreateContext(_.outlet);this.activateChildRoutes(s,o,P.children)}else this.activateChildRoutes(s,o,u);else if(_.component){let P=u.getOrCreateContext(_.outlet);if(this.routeReuseStrategy.shouldAttach(_.snapshot)){let V=this.routeReuseStrategy.retrieve(_.snapshot);this.routeReuseStrategy.store(_.snapshot,null),P.children.onOutletReAttached(V.contexts),P.attachRef=V.componentRef,P.route=V.route.value,P.outlet&&P.outlet.attach(V.componentRef,V.route.value),WT(V.route.value),this.activateChildRoutes(s,null,P.children)}else{let V=ig(_.snapshot);P.attachRef=null,P.route=_,P.injector=V,P.outlet&&P.outlet.activateWith(_,P.injector),this.activateChildRoutes(s,null,P.children)}}else this.activateChildRoutes(s,null,u)}},Cv=class{constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},lf=class{constructor(s,o){this.component=s,this.route=o}};function yj(n,s,o){let u=n._root,_=s?s._root:null;return Vm(u,_,o,[u.value])}function vj(n){let s=n.routeConfig?n.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:n,guards:s}}function ff(n,s){let o=Symbol(),u=s.get(n,o);return u===o?typeof n=="function"&&!BS(n)?n:s.get(n):u}function Vm(n,s,o,u,_={canDeactivateChecks:[],canActivateChecks:[]}){let i=sf(s);return n.children.forEach(P=>{xj(P,i[P.value.outlet],o,u.concat([P.value]),_),delete i[P.value.outlet]}),Object.entries(i).forEach(([P,V])=>Gm(V,o.getContext(P),_)),_}function xj(n,s,o,u,_={canDeactivateChecks:[],canActivateChecks:[]}){let i=n.value,P=s?s.value:null,V=o?o.getContext(n.value.outlet):null;if(P&&i.routeConfig===P.routeConfig){let $=bj(P,i,i.routeConfig.runGuardsAndResolvers);$?_.canActivateChecks.push(new Cv(u)):(i.data=P.data,i._resolvedData=P._resolvedData),i.component?Vm(n,s,V?V.children:null,u,_):Vm(n,s,o,u,_),$&&V&&V.outlet&&V.outlet.isActivated&&_.canDeactivateChecks.push(new lf(V.outlet.component,P))}else P&&Gm(s,V,_),_.canActivateChecks.push(new Cv(u)),i.component?Vm(n,null,V?V.children:null,u,_):Vm(n,null,o,u,_);return _}function bj(n,s,o){if(typeof o=="function")return o(n,s);switch(o){case"pathParamsChange":return!nh(n.url,s.url);case"pathParamsOrQueryParamsChange":return!nh(n.url,s.url)||!ya(n.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!fE(n,s)||!ya(n.queryParams,s.queryParams);case"paramsChange":default:return!fE(n,s)}}function Gm(n,s,o){let u=sf(n),_=n.value;Object.entries(u).forEach(([i,P])=>{_.component?s?Gm(P,s.children.getContext(i),o):Gm(P,null,o):Gm(P,s,o)}),_.component?s&&s.outlet&&s.outlet.isActivated?o.canDeactivateChecks.push(new lf(s.outlet.component,_)):o.canDeactivateChecks.push(new lf(null,_)):o.canDeactivateChecks.push(new lf(null,_))}function rg(n){return typeof n=="function"}function wj(n){return typeof n=="boolean"}function Tj(n){return n&&rg(n.canLoad)}function Ej(n){return n&&rg(n.canActivate)}function Ij(n){return n&&rg(n.canActivateChild)}function Cj(n){return n&&rg(n.canDeactivate)}function Dj(n){return n&&rg(n.canMatch)}function sR(n){return n instanceof Za||n?.name==="EmptyError"}var pv=Symbol("INITIAL_VALUE");function df(){return Or(n=>lm(n.map(s=>s.pipe(vo(1),ob(pv)))).pipe(yn(s=>{for(let o of s)if(o!==!0){if(o===pv)return pv;if(o===!1||o instanceof Dc)return o}return!0}),yo(s=>s!==pv),vo(1)))}function Mj(n,s){return sr(o=>{let{targetSnapshot:u,currentSnapshot:_,guards:{canActivateChecks:i,canDeactivateChecks:P}}=o;return P.length===0&&i.length===0?fn(yi(St({},o),{guardsResult:!0})):Sj(P,u,_,n).pipe(sr(V=>V&&wj(V)?Aj(u,i,n,s):fn(V)),yn(V=>yi(St({},o),{guardsResult:V})))})}function Sj(n,s,o,u){return Ai(n).pipe(sr(_=>Fj(_.component,_.route,o,s,u)),la(_=>_!==!0,!0))}function Aj(n,s,o,u){return Ai(s).pipe(Ss(_=>Xa(Rj(_.route.parent,u),Pj(_.route,u),Lj(n,_.path,o),Oj(n,_.route,o))),la(_=>_!==!0,!0))}function Pj(n,s){return n!==null&&s&&s(new lE(n)),fn(!0)}function Rj(n,s){return n!==null&&s&&s(new sE(n)),fn(!0)}function Oj(n,s,o){let u=s.routeConfig?s.routeConfig.canActivate:null;if(!u||u.length===0)return fn(!0);let _=u.map(i=>ku(()=>{let P=ig(s)??o,V=ff(i,P),$=Ej(V)?V.canActivate(s,n):Ls(P,()=>V(s,n));return Pc($).pipe(la())}));return fn(_).pipe(df())}function Lj(n,s,o){let u=s[s.length-1],i=s.slice(0,s.length-1).reverse().map(P=>vj(P)).filter(P=>P!==null).map(P=>ku(()=>{let V=P.guards.map($=>{let re=ig(P.node)??o,xe=ff($,re),Pe=Ij(xe)?xe.canActivateChild(u,n):Ls(re,()=>xe(u,n));return Pc(Pe).pipe(la())});return fn(V).pipe(df())}));return fn(i).pipe(df())}function Fj(n,s,o,u,_){let i=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!i||i.length===0)return fn(!0);let P=i.map(V=>{let $=ig(s)??_,re=ff(V,$),xe=Cj(re)?re.canDeactivate(n,s,o,u):Ls($,()=>re(n,s,o,u));return Pc(xe).pipe(la())});return fn(P).pipe(df())}function kj(n,s,o,u){let _=s.canLoad;if(_===void 0||_.length===0)return fn(!0);let i=_.map(P=>{let V=ff(P,n),$=Tj(V)?V.canLoad(s,o):Ls(n,()=>V(s,o));return Pc($)});return fn(i).pipe(df(),aR(u))}function aR(n){return Y1(er(s=>{if(uf(s))throw iR(n,s)}),yn(s=>s===!0))}function Nj(n,s,o,u){let _=s.canMatch;if(!_||_.length===0)return fn(!0);let i=_.map(P=>{let V=ff(P,n),$=Dj(V)?V.canMatch(s,o):Ls(n,()=>V(s,o));return Pc($)});return fn(i).pipe(df(),aR(u))}var Jm=class{constructor(s){this.segmentGroup=s||null}},Dv=class extends Error{constructor(s){super(),this.urlTree=s}};function of(n){return Ed(new Jm(n))}function zj(n){return Ed(new cn(4e3,!1))}function Bj(n){return Ed(rR(!1,Vo.GuardRejected))}var gE=class{constructor(s,o){this.urlSerializer=s,this.urlTree=o}lineralizeSegments(s,o){let u=[],_=o.root;for(;;){if(u=u.concat(_.segments),_.numberOfChildren===0)return fn(u);if(_.numberOfChildren>1||!_.children[Bn])return zj(s.redirectTo);_=_.children[Bn]}}applyRedirectCommands(s,o,u){let _=this.applyRedirectCreateUrlTree(o,this.urlSerializer.parse(o),s,u);if(o.startsWith("/"))throw new Dv(_);return _}applyRedirectCreateUrlTree(s,o,u,_){let i=this.createSegmentGroup(s,o.root,u,_);return new Dc(i,this.createQueryParams(o.queryParams,this.urlTree.queryParams),o.fragment)}createQueryParams(s,o){let u={};return Object.entries(s).forEach(([_,i])=>{if(typeof i=="string"&&i.startsWith(":")){let V=i.substring(1);u[_]=o[V]}else u[_]=i}),u}createSegmentGroup(s,o,u,_){let i=this.createSegments(s,o.segments,u,_),P={};return Object.entries(o.children).forEach(([V,$])=>{P[V]=this.createSegmentGroup(s,$,u,_)}),new mi(i,P)}createSegments(s,o,u,_){return o.map(i=>i.path.startsWith(":")?this.findPosParam(s,i,_):this.findOrReturn(i,u))}findPosParam(s,o,u){let _=u[o.path.substring(1)];if(!_)throw new cn(4001,!1);return _}findOrReturn(s,o){let u=0;for(let _ of o){if(_.path===s.path)return o.splice(u),_;u++}return s}},_E={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Vj(n,s,o,u,_){let i=IE(n,s,o);return i.matched?(u=mj(s,u),Nj(u,s,o,_).pipe(yn(P=>P===!0?i:St({},_E)))):fn(i)}function IE(n,s,o){if(s.path==="**")return jj(o);if(s.path==="")return s.pathMatch==="full"&&(n.hasChildren()||o.length>0)?St({},_E):{matched:!0,consumedSegments:[],remainingSegments:o,parameters:{},positionalParamSegments:{}};let _=(s.matcher||N5)(o,n,s);if(!_)return St({},_E);let i={};Object.entries(_.posParams??{}).forEach(([V,$])=>{i[V]=$.path});let P=_.consumed.length>0?St(St({},i),_.consumed[_.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:_.consumed,remainingSegments:o.slice(_.consumed.length),parameters:P,positionalParamSegments:_.posParams??{}}}function jj(n){return{matched:!0,parameters:n.length>0?VP(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function kP(n,s,o,u){return o.length>0&&Gj(n,o,u)?{segmentGroup:new mi(s,$j(u,new mi(o,n.children))),slicedSegments:[]}:o.length===0&&Hj(n,o,u)?{segmentGroup:new mi(n.segments,Uj(n,o,u,n.children)),slicedSegments:o}:{segmentGroup:new mi(n.segments,n.children),slicedSegments:o}}function Uj(n,s,o,u){let _={};for(let i of o)if(Pv(n,s,i)&&!u[va(i)]){let P=new mi([],{});_[va(i)]=P}return St(St({},u),_)}function $j(n,s){let o={};o[Bn]=s;for(let u of n)if(u.path===""&&va(u)!==Bn){let _=new mi([],{});o[va(u)]=_}return o}function Gj(n,s,o){return o.some(u=>Pv(n,s,u)&&va(u)!==Bn)}function Hj(n,s,o){return o.some(u=>Pv(n,s,u))}function Pv(n,s,o){return(n.hasChildren()||s.length>0)&&o.pathMatch==="full"?!1:o.path===""}function qj(n,s,o,u){return va(n)!==u&&(u===Bn||!Pv(s,o,n))?!1:IE(s,n,o).matched}function Wj(n,s,o){return s.length===0&&!n.children[o]}var yE=class{};function Zj(n,s,o,u,_,i,P="emptyOnly"){return new vE(n,s,o,u,_,P,i).recognize()}var Xj=31,vE=class{constructor(s,o,u,_,i,P,V){this.injector=s,this.configLoader=o,this.rootComponentType=u,this.config=_,this.urlTree=i,this.paramsInheritanceStrategy=P,this.urlSerializer=V,this.applyRedirects=new gE(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(s){return new cn(4002,`'${s.segmentGroup}'`)}recognize(){let s=kP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(yn(o=>{let u=new Ym([],Object.freeze({}),Object.freeze(St({},this.urlTree.queryParams)),this.urlTree.fragment,{},Bn,this.rootComponentType,null,{}),_=new Bo(u,o),i=new Iv("",_),P=nj(u,[],this.urlTree.queryParams,this.urlTree.fragment);return P.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(P),this.inheritParamsAndData(i._root,null),{state:i,tree:P}}))}match(s){return this.processSegmentGroup(this.injector,this.config,s,Bn).pipe(dc(u=>{if(u instanceof Dv)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof Jm?this.noMatchError(u):u}))}inheritParamsAndData(s,o){let u=s.value,_=bE(u,o,this.paramsInheritanceStrategy);u.params=Object.freeze(_.params),u.data=Object.freeze(_.data),s.children.forEach(i=>this.inheritParamsAndData(i,u))}processSegmentGroup(s,o,u,_){return u.segments.length===0&&u.hasChildren()?this.processChildren(s,o,u):this.processSegment(s,o,u,u.segments,_,!0).pipe(yn(i=>i instanceof Bo?[i]:[]))}processChildren(s,o,u){let _=[];for(let i of Object.keys(u.children))i==="primary"?_.unshift(i):_.push(i);return Ai(_).pipe(Ss(i=>{let P=u.children[i],V=gj(o,i);return this.processSegmentGroup(s,V,P,i)}),ib((i,P)=>(i.push(...P),i)),fc(null),nb(),sr(i=>{if(i===null)return of(u);let P=lR(i);return Yj(P),fn(P)}))}processSegment(s,o,u,_,i,P){return Ai(o).pipe(Ss(V=>this.processSegmentAgainstRoute(V._injector??s,o,V,u,_,i,P).pipe(dc($=>{if($ instanceof Jm)return fn(null);throw $}))),la(V=>!!V),dc(V=>{if(sR(V))return Wj(u,_,i)?fn(new yE):of(u);throw V}))}processSegmentAgainstRoute(s,o,u,_,i,P,V){return qj(u,_,i,P)?u.redirectTo===void 0?this.matchSegmentAgainstRoute(s,_,u,i,P):this.allowRedirects&&V?this.expandSegmentAgainstRouteUsingRedirect(s,_,o,u,i,P):of(_):of(_)}expandSegmentAgainstRouteUsingRedirect(s,o,u,_,i,P){let{matched:V,consumedSegments:$,positionalParamSegments:re,remainingSegments:xe}=IE(o,_,i);if(!V)return of(o);_.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Xj&&(this.allowRedirects=!1));let Pe=this.applyRedirects.applyRedirectCommands($,_.redirectTo,re);return this.applyRedirects.lineralizeSegments(_,Pe).pipe(sr(Xe=>this.processSegment(s,u,o,Xe.concat(xe),P,!1)))}matchSegmentAgainstRoute(s,o,u,_,i){let P=Vj(o,u,_,s,this.urlSerializer);return u.path==="**"&&(o.children={}),P.pipe(Or(V=>V.matched?(s=u._injector??s,this.getChildConfig(s,u,_).pipe(Or(({routes:$})=>{let re=u._loadedInjector??s,{consumedSegments:xe,remainingSegments:Pe,parameters:Xe}=V,Ze=new Ym(xe,Xe,Object.freeze(St({},this.urlTree.queryParams)),this.urlTree.fragment,Jj(u),va(u),u.component??u._loadedComponent??null,u,Qj(u)),{segmentGroup:yt,slicedSegments:lt}=kP(o,xe,Pe,$);if(lt.length===0&&yt.hasChildren())return this.processChildren(re,$,yt).pipe(yn(un=>un===null?null:new Bo(Ze,un)));if($.length===0&&lt.length===0)return fn(new Bo(Ze,[]));let Ut=va(u)===i;return this.processSegment(re,$,yt,lt,Ut?Bn:i,!0).pipe(yn(un=>new Bo(Ze,un instanceof Bo?[un]:[])))}))):of(o)))}getChildConfig(s,o,u){return o.children?fn({routes:o.children,injector:s}):o.loadChildren?o._loadedRoutes!==void 0?fn({routes:o._loadedRoutes,injector:o._loadedInjector}):kj(s,o,u,this.urlSerializer).pipe(sr(_=>_?this.configLoader.loadChildren(s,o).pipe(er(i=>{o._loadedRoutes=i.routes,o._loadedInjector=i.injector})):Bj(o))):fn({routes:[],injector:s})}};function Yj(n){n.sort((s,o)=>s.value.outlet===Bn?-1:o.value.outlet===Bn?1:s.value.outlet.localeCompare(o.value.outlet))}function Kj(n){let s=n.value.routeConfig;return s&&s.path===""}function lR(n){let s=[],o=new Set;for(let u of n){if(!Kj(u)){s.push(u);continue}let _=s.find(i=>u.value.routeConfig===i.value.routeConfig);_!==void 0?(_.children.push(...u.children),o.add(_)):s.push(u)}for(let u of o){let _=lR(u.children);s.push(new Bo(u.value,_))}return s.filter(u=>!o.has(u))}function Jj(n){return n.data||{}}function Qj(n){return n.resolve||{}}function eU(n,s,o,u,_,i){return sr(P=>Zj(n,s,o,u,P.extractedUrl,_,i).pipe(yn(({state:V,tree:$})=>yi(St({},P),{targetSnapshot:V,urlAfterRedirects:$}))))}function tU(n,s){return sr(o=>{let{targetSnapshot:u,guards:{canActivateChecks:_}}=o;if(!_.length)return fn(o);let i=new Set(_.map($=>$.route)),P=new Set;for(let $ of i)if(!P.has($))for(let re of cR($))P.add(re);let V=0;return Ai(P).pipe(Ss($=>i.has($)?nU($,u,n,s):($.data=bE($,$.parent,n).resolve,fn(void 0))),er(()=>V++),Id(1),sr($=>V===P.size?fn(o):ko))})}function cR(n){let s=n.children.map(o=>cR(o)).flat();return[n,...s]}function nU(n,s,o,u){let _=n.routeConfig,i=n._resolve;return _?.title!==void 0&&!tR(_)&&(i[eg]=_.title),iU(i,n,s,u).pipe(yn(P=>(n._resolvedData=P,n.data=bE(n,n.parent,o).resolve,null)))}function iU(n,s,o,u){let _=YT(n);if(_.length===0)return fn({});let i={};return Ai(_).pipe(sr(P=>rU(n[P],s,o,u).pipe(la(),er(V=>{i[P]=V}))),Id(1),tb(i),dc(P=>sR(P)?ko:Ed(P)))}function rU(n,s,o,u){let _=ig(s)??u,i=ff(n,_),P=i.resolve?i.resolve(s,o):Ls(_,()=>i(s,o));return Pc(P)}function ZT(n){return Or(s=>{let o=n(s);return o?Ai(o).pipe(yn(()=>s)):fn(s)})}var uR=(()=>{class n{buildTitle(o){let u,_=o.root;for(;_!==void 0;)u=this.getResolvedTitleForRoute(_)??u,_=_.children.find(i=>i.outlet===Bn);return u}getResolvedTitleForRoute(o){return o.data[eg]}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(oU),providedIn:"root"})}}return n})(),oU=(()=>{class n extends uR{constructor(o){super(),this.title=o}updateTitle(o){let u=this.buildTitle(o);u!==void 0&&this.title.setTitle(u)}static{this.\u0275fac=function(u){return new(u||n)(Zt(AP))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),og=new en("",{providedIn:"root",factory:()=>({})}),Qm=new en(""),CE=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ct(j0)}loadComponent(o){if(this.componentLoaders.get(o))return this.componentLoaders.get(o);if(o._loadedComponent)return fn(o._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(o);let u=Pc(o.loadComponent()).pipe(yn(hR),er(i=>{this.onLoadEndListener&&this.onLoadEndListener(o),o._loadedComponent=i}),pc(()=>{this.componentLoaders.delete(o)})),_=new Td(u,()=>new or).pipe(wd());return this.componentLoaders.set(o,_),_}loadChildren(o,u){if(this.childrenLoaders.get(u))return this.childrenLoaders.get(u);if(u._loadedRoutes)return fn({routes:u._loadedRoutes,injector:u._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(u);let i=sU(u,this.compiler,o,this.onLoadEndListener).pipe(pc(()=>{this.childrenLoaders.delete(u)})),P=new Td(i,()=>new or).pipe(wd());return this.childrenLoaders.set(u,P),P}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function sU(n,s,o,u){return Pc(n.loadChildren()).pipe(yn(hR),sr(_=>_ instanceof bm||Array.isArray(_)?fn(_):Ai(s.compileModuleAsync(_))),yn(_=>{u&&u(n);let i,P,V=!1;return Array.isArray(_)?(P=_,V=!0):(i=_.create(o).injector,P=i.get(Qm,[],{optional:!0,self:!0}).flat()),{routes:P.map(EE),injector:i}}))}function aU(n){return n&&typeof n=="object"&&"default"in n}function hR(n){return aU(n)?n.default:n}var DE=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(lU),providedIn:"root"})}}return n})(),lU=(()=>{class n{shouldProcessUrl(o){return!0}extract(o){return o}merge(o,u){return o}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),dR=new en(""),fR=new en("");function cU(n,s,o){let u=n.get(fR),_=n.get(Hr);return n.get(ji).runOutsideAngular(()=>{if(!_.startViewTransition||u.skipNextTransition)return u.skipNextTransition=!1,new Promise(re=>setTimeout(re));let i,P=new Promise(re=>{i=re}),V=_.startViewTransition(()=>(i(),uU(n))),{onViewTransitionCreated:$}=u;return $&&Ls(n,()=>$({transition:V,from:s,to:o})),P})}function uU(n){return new Promise(s=>{R0(s,{injector:n})})}var ME=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new or,this.transitionAbortSubject=new or,this.configLoader=Ct(CE),this.environmentInjector=Ct($r),this.urlSerializer=Ct(tg),this.rootContexts=Ct(ng),this.location=Ct(tf),this.inputBindingEnabled=Ct(Av,{optional:!0})!==null,this.titleStrategy=Ct(uR),this.options=Ct(og,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ct(DE),this.createViewTransition=Ct(dR,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>fn(void 0),this.rootComponentType=null;let o=_=>this.events.next(new rE(_)),u=_=>this.events.next(new oE(_));this.configLoader.onLoadEndListener=u,this.configLoader.onLoadStartListener=o}complete(){this.transitions?.complete()}handleNavigationRequest(o){let u=++this.navigationId;this.transitions?.next(yi(St(St({},this.transitions.value),o),{id:u}))}setupNavigations(o,u,_){return this.transitions=new fr({id:0,currentUrlTree:u,currentRawUrl:u,extractedUrl:this.urlHandlingStrategy.extract(u),urlAfterRedirects:this.urlHandlingStrategy.extract(u),rawUrl:u,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:$m,restoredState:null,currentSnapshot:_.snapshot,targetSnapshot:null,currentRouterState:_,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(yo(i=>i.id!==0),yn(i=>yi(St({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),Or(i=>{let P=!1,V=!1;return fn(i).pipe(Or($=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Vo.SupersededByNewNavigation),ko;this.currentTransition=i,this.currentNavigation={id:$.id,initialUrl:$.rawUrl,extractedUrl:$.extractedUrl,trigger:$.source,extras:$.extras,previousNavigation:this.lastSuccessfulNavigation?yi(St({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let re=!o.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),xe=$.extras.onSameUrlNavigation??o.onSameUrlNavigation;if(!re&&xe!=="reload"){let Pe="";return this.events.next(new Sc($.id,this.urlSerializer.serialize($.rawUrl),Pe,xv.IgnoredSameUrlNavigation)),$.resolve(null),ko}if(this.urlHandlingStrategy.shouldProcessUrl($.rawUrl))return fn($).pipe(Or(Pe=>{let Xe=this.transitions?.getValue();return this.events.next(new hf(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),Pe.source,Pe.restoredState)),Xe!==this.transitions?.getValue()?ko:Promise.resolve(Pe)}),eU(this.environmentInjector,this.configLoader,this.rootComponentType,o.config,this.urlSerializer,this.paramsInheritanceStrategy),er(Pe=>{i.targetSnapshot=Pe.targetSnapshot,i.urlAfterRedirects=Pe.urlAfterRedirects,this.currentNavigation=yi(St({},this.currentNavigation),{finalUrl:Pe.urlAfterRedirects});let Xe=new bv(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),this.urlSerializer.serialize(Pe.urlAfterRedirects),Pe.targetSnapshot);this.events.next(Xe)}));if(re&&this.urlHandlingStrategy.shouldProcessUrl($.currentRawUrl)){let{id:Pe,extractedUrl:Xe,source:Ze,restoredState:yt,extras:lt}=$,Ut=new hf(Pe,this.urlSerializer.serialize(Xe),Ze,yt);this.events.next(Ut);let un=QP(this.rootComponentType).snapshot;return this.currentTransition=i=yi(St({},$),{targetSnapshot:un,urlAfterRedirects:Xe,extras:yi(St({},lt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Xe,fn(i)}else{let Pe="";return this.events.next(new Sc($.id,this.urlSerializer.serialize($.extractedUrl),Pe,xv.IgnoredByUrlHandlingStrategy)),$.resolve(null),ko}}),er($=>{let re=new eE($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(re)}),yn($=>(this.currentTransition=i=yi(St({},$),{guards:yj($.targetSnapshot,$.currentSnapshot,this.rootContexts)}),i)),Mj(this.environmentInjector,$=>this.events.next($)),er($=>{if(i.guardsResult=$.guardsResult,uf($.guardsResult))throw iR(this.urlSerializer,$.guardsResult);let re=new tE($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot,!!$.guardsResult);this.events.next(re)}),yo($=>$.guardsResult?!0:(this.cancelNavigationTransition($,"",Vo.GuardRejected),!1)),ZT($=>{if($.guards.canActivateChecks.length)return fn($).pipe(er(re=>{let xe=new nE(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects),re.targetSnapshot);this.events.next(xe)}),Or(re=>{let xe=!1;return fn(re).pipe(tU(this.paramsInheritanceStrategy,this.environmentInjector),er({next:()=>xe=!0,complete:()=>{xe||this.cancelNavigationTransition(re,"",Vo.NoDataFromResolver)}}))}),er(re=>{let xe=new iE(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects),re.targetSnapshot);this.events.next(xe)}))}),ZT($=>{let re=xe=>{let Pe=[];xe.routeConfig?.loadComponent&&!xe.routeConfig._loadedComponent&&Pe.push(this.configLoader.loadComponent(xe.routeConfig).pipe(er(Xe=>{xe.component=Xe}),yn(()=>{})));for(let Xe of xe.children)Pe.push(...re(Xe));return Pe};return lm(re($.targetSnapshot.root)).pipe(fc(null),vo(1))}),ZT(()=>this.afterPreactivation()),Or(()=>{let{currentSnapshot:$,targetSnapshot:re}=i,xe=this.createViewTransition?.(this.environmentInjector,$.root,re.root);return xe?Ai(xe).pipe(yn(()=>i)):fn(i)}),yn($=>{let re=uj(o.routeReuseStrategy,$.targetSnapshot,$.currentRouterState);return this.currentTransition=i=yi(St({},$),{targetRouterState:re}),this.currentNavigation.targetRouterState=re,i}),er(()=>{this.events.next(new Zm)}),_j(this.rootContexts,o.routeReuseStrategy,$=>this.events.next($),this.inputBindingEnabled),vo(1),er({next:$=>{P=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new js($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects))),this.titleStrategy?.updateTitle($.targetRouterState.snapshot),$.resolve(!0)},complete:()=>{P=!0}}),sb(this.transitionAbortSubject.pipe(er($=>{throw $}))),pc(()=>{!P&&!V&&this.cancelNavigationTransition(i,"",Vo.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),dc($=>{if(V=!0,oR($))this.events.next(new Mc(i.id,this.urlSerializer.serialize(i.extractedUrl),$.message,$.cancellationCode)),fj($)?this.events.next(new Xm($.url)):i.resolve(!1);else{this.events.next(new Wm(i.id,this.urlSerializer.serialize(i.extractedUrl),$,i.targetSnapshot??void 0));try{i.resolve(o.errorHandler($))}catch(re){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(re)}}return ko}))}))}cancelNavigationTransition(o,u,_){let i=new Mc(o.id,this.urlSerializer.serialize(o.extractedUrl),u,_);this.events.next(i),o.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function hU(n){return n!==$m}var dU=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(fU),providedIn:"root"})}}return n})(),xE=class{shouldDetach(s){return!1}store(s,o){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,o){return s.routeConfig===o.routeConfig}},fU=(()=>{class n extends xE{static{this.\u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})()}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),pR=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:()=>Ct(pU),providedIn:"root"})}}return n})(),pU=(()=>{class n extends pR{constructor(){super(...arguments),this.location=Ct(tf),this.urlSerializer=Ct(tg),this.options=Ct(og,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ct(DE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Dc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=QP(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(o){return this.location.subscribe(u=>{u.type==="popstate"&&o(u.url,u.state)})}handleRouterEvent(o,u){if(o instanceof hf)this.stateMemento=this.createStateMemento();else if(o instanceof Sc)this.rawUrlTree=u.initialUrl;else if(o instanceof bv){if(this.urlUpdateStrategy==="eager"&&!u.extras.skipLocationChange){let _=this.urlHandlingStrategy.merge(u.finalUrl,u.initialUrl);this.setBrowserUrl(_,u)}}else o instanceof Zm?(this.currentUrlTree=u.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(u.finalUrl,u.initialUrl),this.routerState=u.targetRouterState,this.urlUpdateStrategy==="deferred"&&(u.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,u))):o instanceof Mc&&(o.code===Vo.GuardRejected||o.code===Vo.NoDataFromResolver)?this.restoreHistory(u):o instanceof Wm?this.restoreHistory(u,!0):o instanceof js&&(this.lastSuccessfulId=o.id,this.currentPageId=this.browserPageId)}setBrowserUrl(o,u){let _=this.urlSerializer.serialize(o);if(this.location.isCurrentPathEqualTo(_)||u.extras.replaceUrl){let i=this.browserPageId,P=St(St({},u.extras.state),this.generateNgRouterState(u.id,i));this.location.replaceState(_,"",P)}else{let i=St(St({},u.extras.state),this.generateNgRouterState(u.id,this.browserPageId+1));this.location.go(_,"",i)}}restoreHistory(o,u=!1){if(this.canceledNavigationResolution==="computed"){let _=this.browserPageId,i=this.currentPageId-_;i!==0?this.location.historyGo(i):this.currentUrlTree===o.finalUrl&&i===0&&(this.resetState(o),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(u&&this.resetState(o),this.resetUrlToCurrentUrlTree())}resetState(o){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,o.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(o,u){return this.canceledNavigationResolution==="computed"?{navigationId:o,\u0275routerPageId:u}:{navigationId:o}}static{this.\u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})()}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),jm=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(jm||{});function mR(n,s){n.events.pipe(yo(o=>o instanceof js||o instanceof Mc||o instanceof Wm||o instanceof Sc),yn(o=>o instanceof js||o instanceof Sc?jm.COMPLETE:(o instanceof Mc?o.code===Vo.Redirect||o.code===Vo.SupersededByNewNavigation:!1)?jm.REDIRECTING:jm.FAILED),yo(o=>o!==jm.REDIRECTING),vo(1)).subscribe(()=>{s()})}function mU(n){throw n}var gU={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_U={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},xa=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Ct(B0),this.stateManager=Ct(pR),this.options=Ct(og,{optional:!0})||{},this.pendingTasks=Ct(Ku),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ct(ME),this.urlSerializer=Ct(tg),this.location=Ct(tf),this.urlHandlingStrategy=Ct(DE),this._events=new or,this.errorHandler=this.options.errorHandler||mU,this.navigated=!1,this.routeReuseStrategy=Ct(dU),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ct(Qm,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ct(Av,{optional:!0}),this.eventsSubscription=new dr,this.isNgZoneEnabled=Ct(ji)instanceof ji&&ji.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:o=>{this.console.warn(o)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let o=this.navigationTransitions.events.subscribe(u=>{try{let _=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(_!==null&&i!==null){if(this.stateManager.handleRouterEvent(u,i),u instanceof Mc&&u.code!==Vo.Redirect&&u.code!==Vo.SupersededByNewNavigation)this.navigated=!0;else if(u instanceof js)this.navigated=!0;else if(u instanceof Xm){let P=this.urlHandlingStrategy.merge(u.url,_.currentRawUrl),V={info:_.extras.info,skipLocationChange:_.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||hU(_.source)};this.scheduleNavigation(P,$m,null,V,{resolve:_.resolve,reject:_.reject,promise:_.promise})}}vU(u)&&this._events.next(u)}catch(_){this.navigationTransitions.transitionAbortSubject.next(_)}});this.eventsSubscription.add(o)}resetRootComponentType(o){this.routerState.root.component=o,this.navigationTransitions.rootComponentType=o}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),$m,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((o,u)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(o,"popstate",u)},0)})}navigateToSyncWithBrowser(o,u,_){let i={replaceUrl:!0},P=_?.navigationId?_:null;if(_){let $=St({},_);delete $.navigationId,delete $.\u0275routerPageId,Object.keys($).length!==0&&(i.state=$)}let V=this.parseUrl(o);this.scheduleNavigation(V,u,P,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(o){this.config=o.map(EE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(o,u={}){let{relativeTo:_,queryParams:i,fragment:P,queryParamsHandling:V,preserveFragment:$}=u,re=$?this.currentUrlTree.fragment:P,xe=null;switch(V){case"merge":xe=St(St({},this.currentUrlTree.queryParams),i);break;case"preserve":xe=this.currentUrlTree.queryParams;break;default:xe=i||null}xe!==null&&(xe=this.removeEmptyProps(xe));let Pe;try{let Xe=_?_.snapshot:this.routerState.snapshot.root;Pe=XP(Xe)}catch{(typeof o[0]!="string"||!o[0].startsWith("/"))&&(o=[]),Pe=this.currentUrlTree.root}return YP(Pe,o,xe,re??null)}navigateByUrl(o,u={skipLocationChange:!1}){let _=uf(o)?o:this.parseUrl(o),i=this.urlHandlingStrategy.merge(_,this.rawUrlTree);return this.scheduleNavigation(i,$m,null,u)}navigate(o,u={skipLocationChange:!1}){return yU(o),this.navigateByUrl(this.createUrlTree(o,u),u)}serializeUrl(o){return this.urlSerializer.serialize(o)}parseUrl(o){try{return this.urlSerializer.parse(o)}catch{return this.urlSerializer.parse("/")}}isActive(o,u){let _;if(u===!0?_=St({},gU):u===!1?_=St({},_U):_=u,uf(o))return PP(this.currentUrlTree,o,_);let i=this.parseUrl(o);return PP(this.currentUrlTree,i,_)}removeEmptyProps(o){return Object.entries(o).reduce((u,[_,i])=>(i!=null&&(u[_]=i),u),{})}scheduleNavigation(o,u,_,i,P){if(this.disposed)return Promise.resolve(!1);let V,$,re;P?(V=P.resolve,$=P.reject,re=P.promise):re=new Promise((Pe,Xe)=>{V=Pe,$=Xe});let xe=this.pendingTasks.add();return mR(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(xe))}),this.navigationTransitions.handleNavigationRequest({source:u,restoredState:_,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:o,extras:i,resolve:V,reject:$,promise:re,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),re.catch(Pe=>Promise.reject(Pe))}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function yU(n){for(let s=0;s<n.length;s++)if(n[s]==null)throw new cn(4008,!1)}function vU(n){return!(n instanceof Zm)&&!(n instanceof Xm)}var Mv=(()=>{class n{constructor(o,u,_,i,P,V){this.router=o,this.route=u,this.tabIndexAttribute=_,this.renderer=i,this.el=P,this.locationStrategy=V,this.href=null,this.commands=null,this.onChanges=new or,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let $=P.nativeElement.tagName?.toLowerCase();this.isAnchorElement=$==="a"||$==="area",this.isAnchorElement?this.subscription=o.events.subscribe(re=>{re instanceof js&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(o){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",o)}ngOnChanges(o){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(o){o!=null?(this.commands=Array.isArray(o)?o:[o],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(o,u,_,i,P){let V=this.urlTree;if(V===null||this.isAnchorElement&&(o!==0||u||_||i||P||typeof this.target=="string"&&this.target!="_self"))return!0;let $={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(V,$),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let o=this.urlTree;this.href=o!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(o)):null;let u=this.href===null?null:YA(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",u)}applyAttributeValue(o,u){let _=this.renderer,i=this.el.nativeElement;u!==null?_.setAttribute(i,o,u):_.removeAttribute(i,o)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(u){return new(u||n)(Yt(xa),Yt(Ac),Bw("tabindex"),Yt(zs),Yt(Gr),Yt(al))}}static{this.\u0275dir=Xi({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(u,_){u&1&&br("click",function(P){return _.onClick(P.button,P.ctrlKey,P.shiftKey,P.altKey,P.metaKey)}),u&2&&F0("target",_.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Lr.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Qd],skipLocationChange:[Lr.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Qd],replaceUrl:[Lr.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Qd],routerLink:"routerLink"},standalone:!0,features:[cT,tl]})}}return n})(),gR=(()=>{class n{get isActive(){return this._isActive}constructor(o,u,_,i,P){this.router=o,this.element=u,this.renderer=_,this.cdr=i,this.link=P,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Ii,this.routerEventsSubscription=o.events.subscribe(V=>{V instanceof js&&this.update()})}ngAfterContentInit(){fn(this.links.changes,fn(null)).pipe(hc()).subscribe(o=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let o=[...this.links.toArray(),this.link].filter(u=>!!u).map(u=>u.onChanges);this.linkInputChangesSubscription=Ai(o).pipe(hc()).subscribe(u=>{this._isActive!==this.isLinkActive(this.router)(u)&&this.update()})}set routerLinkActive(o){let u=Array.isArray(o)?o:o.split(" ");this.classes=u.filter(_=>!!_)}ngOnChanges(o){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let o=this.hasActiveLinks();this.classes.forEach(u=>{o?this.renderer.addClass(this.element.nativeElement,u):this.renderer.removeClass(this.element.nativeElement,u)}),o&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==o&&(this._isActive=o,this.cdr.markForCheck(),this.isActiveChange.emit(o))})}isLinkActive(o){let u=xU(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return _=>{let i=_.urlTree;return i?o.isActive(i,u):!1}}hasActiveLinks(){let o=this.isLinkActive(this.router);return this.link&&o(this.link)||this.links.some(o)}static{this.\u0275fac=function(u){return new(u||n)(Yt(xa),Yt(Gr),Yt(zs),Yt(Bs),Yt(Mv,8))}}static{this.\u0275dir=Xi({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(u,_,i){if(u&1&&F2(i,Mv,5),u&2){let P;k0(P=N0())&&(_.links=P)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[tl]})}}return n})();function xU(n){return!!n.paths}var Sv=class{};var bU=(()=>{class n{constructor(o,u,_,i,P){this.router=o,this.injector=_,this.preloadingStrategy=i,this.loader=P}setUpPreloading(){this.subscription=this.router.events.pipe(yo(o=>o instanceof js),Ss(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(o,u){let _=[];for(let i of u){i.providers&&!i._injector&&(i._injector=O0(i.providers,o,`Route: ${i.path}`));let P=i._injector??o,V=i._loadedInjector??P;(i.loadChildren&&!i._loadedRoutes&&i.canLoad===void 0||i.loadComponent&&!i._loadedComponent)&&_.push(this.preloadConfig(P,i)),(i.children||i._loadedRoutes)&&_.push(this.processRoutes(V,i.children??i._loadedRoutes))}return Ai(_).pipe(hc())}preloadConfig(o,u){return this.preloadingStrategy.preload(u,()=>{let _;u.loadChildren&&u.canLoad===void 0?_=this.loader.loadChildren(o,u):_=fn(null);let i=_.pipe(sr(P=>P===null?fn(void 0):(u._loadedRoutes=P.routes,u._loadedInjector=P.injector,this.processRoutes(P.injector??o,P.routes))));if(u.loadComponent&&!u._loadedComponent){let P=this.loader.loadComponent(u);return Ai([i,P]).pipe(hc())}else return i})}static{this.\u0275fac=function(u){return new(u||n)(Zt(xa),Zt(j0),Zt($r),Zt(Sv),Zt(CE))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),_R=new en(""),wU=(()=>{class n{constructor(o,u,_,i,P={}){this.urlSerializer=o,this.transitions=u,this.viewportScroller=_,this.zone=i,this.options=P,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=Ct($r),P.scrollPositionRestoration||="disabled",P.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(o=>{o instanceof hf?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=o.navigationTrigger,this.restoredId=o.restoredState?o.restoredState.navigationId:0):o instanceof js?(this.lastId=o.id,this.scheduleScrollEvent(o,this.urlSerializer.parse(o.urlAfterRedirects).fragment)):o instanceof Sc&&o.code===xv.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(o,this.urlSerializer.parse(o.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(o=>{o instanceof wv&&(o.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(o.position):o.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(o.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(o,u){this.zone.runOutsideAngular(()=>sy(this,null,function*(){yield new Promise(_=>{setTimeout(()=>{_()}),R0(()=>{_()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new wv(o,this.lastSource==="popstate"?this.store[this.restoredId]:null,u))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(u){a2()}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac})}}return n})();function yR(n,...s){return Xu([{provide:Qm,multi:!0,useValue:n},[],{provide:Ac,useFactory:vR,deps:[xa]},{provide:Pm,multi:!0,useFactory:xR},s.map(o=>o.\u0275providers)])}function vR(n){return n.routerState.root}function sg(n,s){return{\u0275kind:n,\u0275providers:s}}function xR(){let n=Ct(nl);return s=>{let o=n.get(Jd);if(s!==o.components[0])return;let u=n.get(xa),_=n.get(bR);n.get(SE)===1&&u.initialNavigation(),n.get(wR,null,Wn.Optional)?.setUpPreloading(),n.get(_R,null,Wn.Optional)?.init(),u.resetRootComponentType(o.componentTypes[0]),_.closed||(_.next(),_.complete(),_.unsubscribe())}}var bR=new en("",{factory:()=>new or}),SE=new en("",{providedIn:"root",factory:()=>1});function TU(){return sg(2,[{provide:SE,useValue:0},{provide:V0,multi:!0,deps:[nl],useFactory:s=>{let o=s.get(nP,Promise.resolve());return()=>o.then(()=>new Promise(u=>{let _=s.get(xa),i=s.get(bR);mR(_,()=>{u(!0)}),s.get(ME).afterPreactivation=()=>(u(!0),i.closed?fn(void 0):i),_.initialNavigation()}))}}])}function EU(){return sg(3,[{provide:V0,multi:!0,useFactory:()=>{let s=Ct(xa);return()=>{s.setUpLocationChangeListener()}}},{provide:SE,useValue:2}])}var wR=new en("");function IU(n){return sg(0,[{provide:wR,useExisting:bU},{provide:Sv,useExisting:n}])}function CU(){return sg(8,[FP,{provide:Av,useExisting:FP}])}function AE(n){let s=[{provide:dR,useValue:cU},{provide:fR,useValue:St({skipNextTransition:!!n?.skipInitialTransition},n)}];return sg(9,s)}var NP=new en("ROUTER_FORROOT_GUARD"),DU=[tf,{provide:tg,useClass:Hm},xa,ng,{provide:Ac,useFactory:vR,deps:[xa]},CE,[]],TR=(()=>{class n{constructor(o){}static forRoot(o,u){return{ngModule:n,providers:[DU,[],{provide:Qm,multi:!0,useValue:o},{provide:NP,useFactory:PU,deps:[[xa,new g0,new bw]]},{provide:og,useValue:u||{}},u?.useHash?SU():AU(),MU(),u?.preloadingStrategy?IU(u.preloadingStrategy).\u0275providers:[],u?.initialNavigation?RU(u):[],u?.bindToComponentInputs?CU().\u0275providers:[],u?.enableViewTransitions?AE().\u0275providers:[],OU()]}}static forChild(o){return{ngModule:n,providers:[{provide:Qm,multi:!0,useValue:o}]}}static{this.\u0275fac=function(u){return new(u||n)(Zt(NP,8))}}static{this.\u0275mod=ns({type:n})}static{this.\u0275inj=ts({})}}return n})();function MU(){return{provide:_R,useFactory:()=>{let n=Ct(uP),s=Ct(ji),o=Ct(og),u=Ct(ME),_=Ct(tg);return o.scrollOffset&&n.setOffset(o.scrollOffset),new wU(_,u,n,s,o)}}}function SU(){return{provide:al,useClass:rP}}function AU(){return{provide:al,useClass:PT}}function PU(n){return"guarded"}function RU(n){return[n.initialNavigation==="disabled"?EU().\u0275providers:[],n.initialNavigation==="enabledBlocking"?TU().\u0275providers:[]]}var zP=new en("");function OU(){return[{provide:zP,useFactory:xR},{provide:Pm,multi:!0,useExisting:zP}]}var Oc=class{},ER=(()=>{class n extends Oc{getTranslation(o){return fn({})}static \u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})();static \u0275prov=Wt({token:n,factory:n.\u0275fac})}return n})(),lg=class{},IR=(()=>{class n{handle(o){return o.key}static \u0275fac=function(u){return new(u||n)};static \u0275prov=Wt({token:n,factory:n.\u0275fac})}return n})();function Ov(n,s){if(n===s)return!0;if(n===null||s===null)return!1;if(n!==n&&s!==s)return!0;let o=typeof n,u=typeof s,_,i,P;if(o==u&&o=="object")if(Array.isArray(n)){if(!Array.isArray(s))return!1;if((_=n.length)==s.length){for(i=0;i<_;i++)if(!Ov(n[i],s[i]))return!1;return!0}}else{if(Array.isArray(s))return!1;P=Object.create(null);for(i in n){if(!Ov(n[i],s[i]))return!1;P[i]=!0}for(i in s)if(!(i in P)&&typeof s[i]<"u")return!1;return!0}return!1}function Rc(n){return typeof n<"u"&&n!==null}function ug(n){return Rv(n)&&!NE(n)}function Rv(n){return typeof n=="object"}function NE(n){return Array.isArray(n)}function zE(n){return typeof n=="string"}function FU(n){return typeof n=="function"}function PE(n,s){let o=Object.assign({},n);return Rv(n)?(Rv(n)&&Rv(s)&&Object.keys(s).forEach(u=>{ug(s[u])?u in n?o[u]=PE(n[u],s[u]):Object.assign(o,{[u]:s[u]}):Object.assign(o,{[u]:s[u]})}),o):PE({},s)}function RE(n,s){let o=s.split(".");s="";do s+=o.shift(),Rc(n)&&Rc(n[s])&&(ug(n[s])||NE(n[s])||!o.length)?(n=n[s],s=""):o.length?s+=".":n=void 0;while(o.length);return n}function kU(n,s,o){let u=s.split("."),_=n;for(let i=0;i<u.length;i++){let P=u[i];i===u.length-1?_[P]=o:((!_[P]||!ug(_[P]))&&(_[P]={}),_=_[P])}}var pf=class{},CR=(()=>{class n extends pf{templateMatcher=/{{\s?([^{}\s]*)\s?}}/g;interpolate(o,u){if(zE(o))return this.interpolateString(o,u);if(FU(o))return this.interpolateFunction(o,u)}interpolateFunction(o,u){return o(u)}interpolateString(o,u){return u?o.replace(this.templateMatcher,(_,i)=>{let P=RE(u,i);return Rc(P)?P:_}):o}static \u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})();static \u0275prov=Wt({token:n,factory:n.\u0275fac})}return n})(),mf=class{},DR=(()=>{class n extends mf{compile(o,u){return o}compileTranslations(o,u){return o}static \u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})();static \u0275prov=Wt({token:n,factory:n.\u0275fac})}return n})(),Lv=class{defaultLang;currentLang=this.defaultLang;translations={};langs=[];onTranslationChange=new Ii;onLangChange=new Ii;onDefaultLangChange=new Ii},OE=new en("ISOALTE_TRANSLATE_SERVICE"),LE=new en("USE_DEFAULT_LANG"),FE=new en("DEFAULT_LANGUAGE"),kE=new en("USE_EXTEND"),ag=n=>Wa(n)?n:fn(n),cg=(()=>{class n{store;currentLoader;compiler;parser;missingTranslationHandler;useDefaultLang;isolate;extend;loadingTranslations;pending=!1;_onTranslationChange=new Ii;_onLangChange=new Ii;_onDefaultLangChange=new Ii;_defaultLang;_currentLang;_langs=[];_translations={};_translationRequests={};lastUseLanguage=null;get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(o){this.isolate?this._defaultLang=o:this.store.defaultLang=o}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(o){this.isolate?this._currentLang=o:this.store.currentLang=o}get langs(){return this.isolate?this._langs:this.store.langs}set langs(o){this.isolate?this._langs=o:this.store.langs=o}get translations(){return this.isolate?this._translations:this.store.translations}set translations(o){this.isolate?this._translations=o:this.store.translations=o}constructor(o,u,_,i,P,V=!0,$=!1,re=!1,xe){this.store=o,this.currentLoader=u,this.compiler=_,this.parser=i,this.missingTranslationHandler=P,this.useDefaultLang=V,this.isolate=$,this.extend=re,xe&&this.setDefaultLang(xe)}setDefaultLang(o){if(o===this.defaultLang)return;let u=this.retrieveTranslations(o);typeof u<"u"?(this.defaultLang==null&&(this.defaultLang=o),u.pipe(vo(1)).subscribe(()=>{this.changeDefaultLang(o)})):this.changeDefaultLang(o)}getDefaultLang(){return this.defaultLang}use(o){if(this.lastUseLanguage=o,o===this.currentLang)return fn(this.translations[o]);this.currentLang||(this.currentLang=o);let u=this.retrieveTranslations(o);return Wa(u)?(u.pipe(vo(1)).subscribe(()=>{this.changeLang(o)}),u):(this.changeLang(o),fn(this.translations[o]))}changeLang(o){o===this.lastUseLanguage&&(this.currentLang=o,this.onLangChange.emit({lang:o,translations:this.translations[o]}),this.defaultLang==null&&this.changeDefaultLang(o))}retrieveTranslations(o){if(typeof this.translations[o]>"u"||this.extend)return this._translationRequests[o]=this._translationRequests[o]||this.loadAndCompileTranslations(o),this._translationRequests[o]}getTranslation(o){return this.loadAndCompileTranslations(o)}loadAndCompileTranslations(o){this.pending=!0;let u=this.currentLoader.getTranslation(o).pipe(Py(1),vo(1));return this.loadingTranslations=u.pipe(yn(_=>this.compiler.compileTranslations(_,o)),Py(1),vo(1)),this.loadingTranslations.subscribe({next:_=>{this.translations[o]=this.extend&&this.translations[o]?St(St({},_),this.translations[o]):_,this.updateLangs(),this.pending=!1},error:_=>{this.pending=!1}}),u}setTranslation(o,u,_=!1){let i=this.compiler.compileTranslations(u,o);(_||this.extend)&&this.translations[o]?this.translations[o]=PE(this.translations[o],i):this.translations[o]=i,this.updateLangs(),this.onTranslationChange.emit({lang:o,translations:this.translations[o]})}getLangs(){return this.langs}addLangs(o){o.forEach(u=>{this.langs.indexOf(u)===-1&&this.langs.push(u)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResultForKey(o,u,_){let i;if(o&&(i=this.runInterpolation(RE(o,u),_)),i===void 0&&this.defaultLang!=null&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(i=this.runInterpolation(RE(this.translations[this.defaultLang],u),_)),i===void 0){let P={key:u,translateService:this};typeof _<"u"&&(P.interpolateParams=_),i=this.missingTranslationHandler.handle(P)}return i!==void 0?i:u}runInterpolation(o,u){if(NE(o))return o.map(_=>this.runInterpolation(_,u));if(ug(o)){let _={};for(let i in o)_[i]=this.runInterpolation(o[i],u);return _}else return this.parser.interpolate(o,u)}getParsedResult(o,u,_){if(u instanceof Array){let i={},P=!1;for(let $ of u)i[$]=this.getParsedResultForKey(o,$,_),P=P||Wa(i[$]);if(!P)return i;let V=u.map($=>ag(i[$]));return cm(V).pipe(yn($=>{let re={};return $.forEach((xe,Pe)=>{re[u[Pe]]=xe}),re}))}return this.getParsedResultForKey(o,u,_)}get(o,u){if(!Rc(o)||!o.length)throw new Error('Parameter "key" is required and cannot be empty');return this.pending?this.loadingTranslations.pipe(Ss(_=>ag(this.getParsedResult(_,o,u)))):ag(this.getParsedResult(this.translations[this.currentLang],o,u))}getStreamOnTranslationChange(o,u){if(!Rc(o)||!o.length)throw new Error('Parameter "key" is required and cannot be empty');return Xa(ku(()=>this.get(o,u)),this.onTranslationChange.pipe(Or(_=>{let i=this.getParsedResult(_.translations,o,u);return ag(i)})))}stream(o,u){if(!Rc(o)||!o.length)throw new Error('Parameter "key" required');return Xa(ku(()=>this.get(o,u)),this.onLangChange.pipe(Or(_=>{let i=this.getParsedResult(_.translations,o,u);return ag(i)})))}instant(o,u){if(!Rc(o)||o.length===0)throw new Error('Parameter "key" is required and cannot be empty');let _=this.getParsedResult(this.translations[this.currentLang],o,u);return Wa(_)?Array.isArray(o)?o.reduce((i,P)=>(i[P]=P,i),{}):o:_}set(o,u,_=this.currentLang){kU(this.translations[_],o,zE(u)?this.compiler.compile(u,_):this.compiler.compileTranslations(u,_)),this.updateLangs(),this.onTranslationChange.emit({lang:_,translations:this.translations[_]})}changeDefaultLang(o){this.defaultLang=o,this.onDefaultLangChange.emit({lang:o,translations:this.translations[o]})}reloadLang(o){return this.resetLang(o),this.loadAndCompileTranslations(o)}resetLang(o){delete this._translationRequests[o],delete this.translations[o]}getBrowserLang(){if(typeof window>"u"||!window.navigator)return;let o=this.getBrowserCultureLang();return o?o.split(/[-_]/)[0]:void 0}getBrowserCultureLang(){if(!(typeof window>"u"||typeof window.navigator>"u"))return window.navigator.languages?window.navigator.languages[0]:window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage}static \u0275fac=function(u){return new(u||n)(Zt(Lv),Zt(Oc),Zt(mf),Zt(pf),Zt(lg),Zt(LE),Zt(OE),Zt(kE),Zt(FE))};static \u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Tr=(()=>{class n{translate;_ref;value="";lastKey=null;lastParams=[];onTranslationChange;onLangChange;onDefaultLangChange;constructor(o,u){this.translate=o,this._ref=u}updateValue(o,u,_){let i=P=>{this.value=P!==void 0?P:o,this.lastKey=o,this._ref.markForCheck()};if(_){let P=this.translate.getParsedResult(_,o,u);Wa(P)?P.subscribe(i):i(P)}this.translate.get(o,u).subscribe(i)}transform(o,...u){if(!o||!o.length)return o;if(Ov(o,this.lastKey)&&Ov(u,this.lastParams))return this.value;let _;if(Rc(u[0])&&u.length)if(zE(u[0])&&u[0].length){let i=u[0].replace(/(')?([a-zA-Z0-9_]+)(')?(\s)?:/g,'"$2":').replace(/:(\s)?(')(.*?)(')/g,':"$3"');try{_=JSON.parse(i)}catch(P){throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${u[0]}`)}}else ug(u[0])&&(_=u[0]);return this.lastKey=o,this.lastParams=u,this.updateValue(o,_),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(i=>{this.lastKey&&i.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(o,_,i.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(i=>{this.lastKey&&(this.lastKey=null,this.updateValue(o,_,i.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(o,_))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}static \u0275fac=function(u){return new(u||n)(Yt(cg,16),Yt(Bs,16))};static \u0275pipe=Im({name:"translate",type:n,pure:!1,standalone:!0});static \u0275prov=Wt({token:n,factory:n.\u0275fac})}return n})();var Yi=(()=>{class n{static forRoot(o={}){return{ngModule:n,providers:[o.loader||{provide:Oc,useClass:ER},o.compiler||{provide:mf,useClass:DR},o.parser||{provide:pf,useClass:CR},o.missingTranslationHandler||{provide:lg,useClass:IR},Lv,{provide:OE,useValue:o.isolate},{provide:LE,useValue:o.useDefaultLang},{provide:kE,useValue:o.extend},{provide:FE,useValue:o.defaultLanguage},cg]}}static forChild(o={}){return{ngModule:n,providers:[o.loader||{provide:Oc,useClass:ER},o.compiler||{provide:mf,useClass:DR},o.parser||{provide:pf,useClass:CR},o.missingTranslationHandler||{provide:lg,useClass:IR},{provide:OE,useValue:o.isolate},{provide:LE,useValue:o.useDefaultLang},{provide:kE,useValue:o.extend},{provide:FE,useValue:o.defaultLanguage},cg]}}static \u0275fac=function(u){return new(u||n)};static \u0275mod=ns({type:n});static \u0275inj=ts({})}return n})();var Fv={production:!1,apiKey:"pk.eyJ1IjoiZWhlcm5hbmRlem5leHVzIiwiYSI6ImNtMXFseTQ2cDAxYnQyanF3ZThjNzVzbHIifQ.2V25gfCVjfaX98ErvQyzww"};var Lc=(()=>{class n{constructor(o){this.http=o,this.estacions=[],this.estaciName=[],this.apiUrl="https://analisi.transparenciacatalunya.cat/resource/gn9e-3qhr.json",this.measurementSubject=new fr([]),this.measurements$=this.measurementSubject.asObservable()}getLocations(){return this.http.get(this.apiUrl).pipe(er(o=>console.log("Datos recibidos:",o)))}getEstaci(){return this.getLocations().pipe(yn(o=>{let u=o.map(_=>_.estaci);return this.estaciName=[...new Set(u)],this.estaciName}))}getCoordinates(o){let u=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(o)}.json?access_token=${Fv.apiKey}`;return this.http.get(u)}getUniqueDates(){return this.getLocations().pipe(yn(o=>{let u=o.map(_=>_.dia.toString());return Array.from(new Set(u))}))}getAvailableEstacionsByDate(o){return this.getLocations().pipe(yn(u=>u.filter(_=>{let i=new Date(_.dia).toISOString().split("T")[0],P=new Date(o).toISOString().split("T")[0];return i===P}).map(_=>_.estaci)))}getMeasurements(o,u,_,i,P){let V=new _a().set("$where",`dia='${new Date(o).toISOString().split("T")[0]}' AND estaci='${u}'`);return _!==void 0&&(V=V.append("$where",`nivell_absolut > ${_}`)),i!==void 0&&(V=V.append("$where",`percentatge_volum_embassat = ${i}`)),P!==void 0&&(V=V.append("$where",`volum_embassat = ${P}`)),this.http.get(this.apiUrl,{params:V})}emitMeasurements(o){this.measurementSubject.next(o)}selectMeasurement(o){this.measurementSubject.next([o])}getSpeciesData(){return this.http.get("assets/species-data.json")}static{this.\u0275fac=function(u){return new(u||n)(Zt(Fm))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var NU=n=>({open:n});function zU(n,s){if(n&1&&(wt(0,"div",4)(1,"span",5),Rt(2),Lt(3,"translate"),Sn(4,"br"),wt(5,"strong"),Rt(6),vt()(),wt(7,"span",6),Rt(8),Lt(9,"date"),vt(),wt(10,"span",7),Rt(11),Lt(12,"slice"),vt()(),wt(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11)(17,"span",12),Rt(18),Lt(19,"translate"),vt(),Sn(20,"br"),wt(21,"span",13),Rt(22),vt()(),Sn(23,"div",14)(24,"div",15)(25,"div",16)(26,"div",17)(27,"div",18),vt()()(),wt(28,"div",8)(29,"div",9)(30,"div",10)(31,"div",11)(32,"span",12),Rt(33),Lt(34,"translate"),vt(),Sn(35,"br"),wt(36,"span",13),Rt(37),vt()(),Sn(38,"div",14)(39,"div",15)(40,"div",16)(41,"div",17)(42,"div",18),vt()()()),n&2){let o=s.$implicit;xt(2),Jn(zt(3,8,"level")),xt(4),zn("",o.nivell_absolut," msnm"),xt(2),Jn(zt(9,10,o.dia)),xt(3),Jn(j2(12,12,o.estaci,15,47)),xt(7),Jn(zt(19,16,"PercentWater")),xt(4),zn("",o.percentatge_volum_embassat,"%"),xt(11),zn("",zt(34,18,"volumeOfWater")," (hm3)"),xt(4),zn("",o.volum_embassat," hm3")}}var MR=(()=>{class n{constructor(o){this.placesService=o,this.measurements=[],this.isSidebarVisible=!1}ngOnDestroy(){this.measureSubs?.unsubscribe()}ngOnInit(){this.measureSubs=this.placesService.measurements$.subscribe(o=>{this.measurements=o,this.measurements.length>0&&(this.isSidebarVisible=!0)})}toggleSidebar(){this.isSidebarVisible=!this.isSidebarVisible}static{this.\u0275fac=function(u){return new(u||n)(Yt(Lc))}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-sidenav"]],standalone:!0,features:[Ri],decls:7,vars:3,consts:[[1,"sidenav","lg:w-full","md:w-full","md:h-40","sm:w-full",3,"ngClass"],[1,"p-1","bg-gradient-to-r","from-cyan-100","to-blue-100","flex","justify-center",3,"click"],[1,"m-1","w-9","h-1","bg-blue-600","rounded-sm"],[1,"flex","flex-wrap","md:flex-wrap","sm:flex-wrap","items-center","justify-evenly","mt-2"],[1,"flex","flex-col","rounded-md","justify-center","items-center","w-48","p-1"],[1,"text-xs","text-center"],[1,"mt-2","p-2","text-center","rounded-xl","text-sm","bg-blue-300"],[1,"p-1","text-sm","font-bold","text-center"],[1,"w-32","h-32","rounded-md","flex","flex-wrap","justify-center","items-start"],[1,"w-22","h-22","rounded-md","flex","justify-center","items-center","m-1"],[1,"w-28","h-28","gota","m-3","rounded-full"],[1,"text-center","mt-5","text-xs"],[1,"p-1","text-xs"],[1,"mt-4","text-base"],[1,"wave"],[1,"wave1"],[1,"wave2"],[1,"w-2","h-2","gota","m-3","rounded-full"],[1,"w-1","h-1","left-1","gota","m-3","rounded-full"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"div",1),br("click",function(){return _.toggleSidebar()}),Sn(2,"div",2),vt(),wt(3,"div",3),hT(4),Zd(5,zU,43,20,null,null,Wd),dT(),vt()()),u&2&&(ri("ngClass",z0(1,NU,_.isSidebarVisible)),xt(5),Xd(_.measurements))},dependencies:[ao,nf,iv,nv,Yi,Tr],styles:[".gota[_ngcontent-%COMP%]{background:#b7d8e9;box-shadow:inset 10px 10px 10px #0000000d,15px 25px 10px #0000000d,15px 20px 20px #0000000d,inset -10px -10px 15px #ffffffe6;position:relative;overflow:hidden}.wave[_ngcontent-%COMP%]{position:absolute;bottom:0;left:10%;width:110%;height:15px;border:1px solid rgb(185,185,247);background:#185ae99b;border-radius:50% 30% 50% 50%;animation:_ngcontent-%COMP%_wave-motion 2s ease-in-out infinite}.wave1[_ngcontent-%COMP%]{position:absolute;bottom:0;left:16%;width:100%;height:20px;border:3px solid rgba(120,120,245,.233);border-radius:60% 40% 50% 60%;background-color:#f0f0f0;background:#91eefe80;animation:_ngcontent-%COMP%_wave-motion 2s ease-in-out infinite}.wave2[_ngcontent-%COMP%]{position:absolute;bottom:0;left:26%;border:1px solid rgb(235,235,249);width:100%;height:20px;background:#8bf4f480;border-radius:80% 27% 50% 10%;animation:_ngcontent-%COMP%_wave-motion 2s ease-in-out infinite}.wave[_ngcontent-%COMP%]:nth-child(1){animation-delay:0s}.wave1[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.wave2[_ngcontent-%COMP%]:nth-child(3){animation-delay:.6s}.sidenav[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;transform:translateY(87%);transition:transform .5s ease-in-out;background-color:#f0f0f0;overflow:hidden}.sidenav.open[_ngcontent-%COMP%]{transform:translateY(0)}.raya[_ngcontent-%COMP%]{width:40px;height:4px;background-color:#0070f3;margin:10px auto;cursor:pointer}.estaci[_ngcontent-%COMP%]{color:#0e0e6e}@keyframes _ngcontent-%COMP%_wave-motion{0%,to{transform:translateY(0)}50%{transform:translateY(-2px)}}"]})}}return n})();var vf=yk(AR());var VR=(()=>{class n{constructor(o,u){this._renderer=o,this._elementRef=u,this.onChange=_=>{},this.onTouched=()=>{}}setProperty(o,u){this._renderer.setProperty(this._elementRef.nativeElement,o,u)}registerOnTouched(o){this.onTouched=o}registerOnChange(o){this.onChange=o}setDisabledState(o){this.setProperty("disabled",o)}static{this.\u0275fac=function(u){return new(u||n)(Yt(zs),Yt(Gr))}}static{this.\u0275dir=Xi({type:n})}}return n})(),GE=(()=>{class n extends VR{static{this.\u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})()}static{this.\u0275dir=Xi({type:n,features:[ga]})}}return n})(),Hv=new en("");var BU={provide:Hv,useExisting:bc(()=>jR),multi:!0};function VU(){let n=sl()?sl().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var jU=new en(""),jR=(()=>{class n extends VR{constructor(o,u,_){super(o,u),this._compositionMode=_,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!VU())}writeValue(o){let u=o??"";this.setProperty("value",u)}_handleInput(o){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(o)}_compositionStart(){this._composing=!0}_compositionEnd(o){this._composing=!1,this._compositionMode&&this.onChange(o)}static{this.\u0275fac=function(u){return new(u||n)(Yt(zs),Yt(Gr),Yt(jU,8))}}static{this.\u0275dir=Xi({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,_){u&1&&br("input",function(P){return _._handleInput(P.target.value)})("blur",function(){return _.onTouched()})("compositionstart",function(){return _._compositionStart()})("compositionend",function(P){return _._compositionEnd(P.target.value)})},features:[Kd([BU]),ga]})}}return n})();function Fc(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function UR(n){return n!=null&&typeof n.length=="number"}var $R=new en(""),GR=new en(""),UU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,fg=class{static min(s){return $U(s)}static max(s){return GU(s)}static required(s){return HU(s)}static requiredTrue(s){return qU(s)}static email(s){return WU(s)}static minLength(s){return ZU(s)}static maxLength(s){return XU(s)}static pattern(s){return YU(s)}static nullValidator(s){return HR(s)}static compose(s){return KR(s)}static composeAsync(s){return QR(s)}};function $U(n){return s=>{if(Fc(s.value)||Fc(n))return null;let o=parseFloat(s.value);return!isNaN(o)&&o<n?{min:{min:n,actual:s.value}}:null}}function GU(n){return s=>{if(Fc(s.value)||Fc(n))return null;let o=parseFloat(s.value);return!isNaN(o)&&o>n?{max:{max:n,actual:s.value}}:null}}function HU(n){return Fc(n.value)?{required:!0}:null}function qU(n){return n.value===!0?null:{required:!0}}function WU(n){return Fc(n.value)||UU.test(n.value)?null:{email:!0}}function ZU(n){return s=>Fc(s.value)||!UR(s.value)?null:s.value.length<n?{minlength:{requiredLength:n,actualLength:s.value.length}}:null}function XU(n){return s=>UR(s.value)&&s.value.length>n?{maxlength:{requiredLength:n,actualLength:s.value.length}}:null}function YU(n){if(!n)return HR;let s,o;return typeof n=="string"?(o="",n.charAt(0)!=="^"&&(o+="^"),o+=n,n.charAt(n.length-1)!=="$"&&(o+="$"),s=new RegExp(o)):(o=n.toString(),s=n),u=>{if(Fc(u.value))return null;let _=u.value;return s.test(_)?null:{pattern:{requiredPattern:o,actualValue:_}}}}function HR(n){return null}function qR(n){return n!=null}function WR(n){return Ju(n)?Ai(n):n}function ZR(n){let s={};return n.forEach(o=>{s=o!=null?St(St({},s),o):s}),Object.keys(s).length===0?null:s}function XR(n,s){return s.map(o=>o(n))}function KU(n){return!n.validate}function YR(n){return n.map(s=>KU(s)?s:o=>s.validate(o))}function KR(n){if(!n)return null;let s=n.filter(qR);return s.length==0?null:function(o){return ZR(XR(o,s))}}function JR(n){return n!=null?KR(YR(n)):null}function QR(n){if(!n)return null;let s=n.filter(qR);return s.length==0?null:function(o){let u=XR(o,s).map(WR);return cm(u).pipe(yn(ZR))}}function eO(n){return n!=null?QR(YR(n)):null}function PR(n,s){return n===null?[s]:Array.isArray(n)?[...n,s]:[n,s]}function tO(n){return n._rawValidators}function nO(n){return n._rawAsyncValidators}function jE(n){return n?Array.isArray(n)?n:[n]:[]}function Bv(n,s){return Array.isArray(n)?n.includes(s):n===s}function RR(n,s){let o=jE(s);return jE(n).forEach(_=>{Bv(o,_)||o.push(_)}),o}function OR(n,s){return jE(s).filter(o=>!Bv(n,o))}var Vv=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=JR(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=eO(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,o){return this.control?this.control.hasError(s,o):!1}getError(s,o){return this.control?this.control.getError(s,o):null}},_f=class extends Vv{get formDirective(){return null}get path(){return null}},pg=class extends Vv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},jv=class{constructor(s){this._cd=s}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},JU={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},jZ=yi(St({},JU),{"[class.ng-submitted]":"isSubmitted"}),iO=(()=>{class n extends jv{constructor(o){super(o)}static{this.\u0275fac=function(u){return new(u||n)(Yt(pg,2))}}static{this.\u0275dir=Xi({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,_){u&2&&qd("ng-untouched",_.isUntouched)("ng-touched",_.isTouched)("ng-pristine",_.isPristine)("ng-dirty",_.isDirty)("ng-valid",_.isValid)("ng-invalid",_.isInvalid)("ng-pending",_.isPending)},features:[ga]})}}return n})(),rO=(()=>{class n extends jv{constructor(o){super(o)}static{this.\u0275fac=function(u){return new(u||n)(Yt(_f,10))}}static{this.\u0275dir=Xi({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(u,_){u&2&&qd("ng-untouched",_.isUntouched)("ng-touched",_.isTouched)("ng-pristine",_.isPristine)("ng-dirty",_.isDirty)("ng-valid",_.isValid)("ng-invalid",_.isInvalid)("ng-pending",_.isPending)("ng-submitted",_.isSubmitted)},features:[ga]})}}return n})();var hg="VALID",Nv="INVALID",gf="PENDING",dg="DISABLED";function HE(n){return(qv(n)?n.validators:n)||null}function QU(n){return Array.isArray(n)?JR(n):n||null}function qE(n,s){return(qv(s)?s.asyncValidators:n)||null}function e6(n){return Array.isArray(n)?eO(n):n||null}function qv(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function oO(n,s,o){let u=n.controls;if(!(s?Object.keys(u):u).length)throw new cn(1e3,"");if(!u[o])throw new cn(1001,"")}function sO(n,s,o){n._forEachChild((u,_)=>{if(o[_]===void 0)throw new cn(1002,"")})}var yf=class{constructor(s,o){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(s),this._assignAsyncValidators(o)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get valid(){return this.status===hg}get invalid(){return this.status===Nv}get pending(){return this.status==gf}get disabled(){return this.status===dg}get enabled(){return this.status!==dg}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(RR(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(RR(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(OR(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(OR(s,this._rawAsyncValidators))}hasValidator(s){return Bv(this._rawValidators,s)}hasAsyncValidator(s){return Bv(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){this.touched=!0,this._parent&&!s.onlySelf&&this._parent.markAsTouched(s)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(s=>s.markAllAsTouched())}markAsUntouched(s={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s)}markAsDirty(s={}){this.pristine=!1,this._parent&&!s.onlySelf&&this._parent.markAsDirty(s)}markAsPristine(s={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(o=>{o.markAsPristine({onlySelf:!0})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s)}markAsPending(s={}){this.status=gf,s.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!s.onlySelf&&this._parent.markAsPending(s)}disable(s={}){let o=this._parentMarkedDirty(s.onlySelf);this.status=dg,this.errors=null,this._forEachChild(u=>{u.disable(yi(St({},s),{onlySelf:!0}))}),this._updateValue(),s.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(yi(St({},s),{skipPristineCheck:o})),this._onDisabledChange.forEach(u=>u(!0))}enable(s={}){let o=this._parentMarkedDirty(s.onlySelf);this.status=hg,this._forEachChild(u=>{u.enable(yi(St({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(yi(St({},s),{skipPristineCheck:o})),this._onDisabledChange.forEach(u=>u(!1))}_updateAncestors(s){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===hg||this.status===gf)&&this._runAsyncValidator(s.emitEvent)),s.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(s)}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(o=>o._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?dg:hg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s){if(this.asyncValidator){this.status=gf,this._hasOwnPendingAsyncValidator=!0;let o=WR(this.asyncValidator(this));this._asyncValidationSubscription=o.subscribe(u=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(u,{emitEvent:s})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(s,o={}){this.errors=s,this._updateControlsErrors(o.emitEvent!==!1)}get(s){let o=s;return o==null||(Array.isArray(o)||(o=o.split(".")),o.length===0)?null:o.reduce((u,_)=>u&&u._find(_),this)}getError(s,o){let u=o?this.get(o):this;return u&&u.errors?u.errors[s]:null}hasError(s,o){return!!this.getError(s,o)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(s)}_initObservables(){this.valueChanges=new Ii,this.statusChanges=new Ii}_calculateStatus(){return this._allControlsDisabled()?dg:this.errors?Nv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(gf)?gf:this._anyControlsHaveStatus(Nv)?Nv:hg}_anyControlsHaveStatus(s){return this._anyControls(o=>o.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s={}){this.pristine=!this._anyControlsDirty(),this._parent&&!s.onlySelf&&this._parent._updatePristine(s)}_updateTouched(s={}){this.touched=this._anyControlsTouched(),this._parent&&!s.onlySelf&&this._parent._updateTouched(s)}_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){qv(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let o=this._parent&&this._parent.dirty;return!s&&!!o&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=QU(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=e6(this._rawAsyncValidators)}},Uv=class extends yf{constructor(s,o,u){super(HE(o),qE(u,o)),this.controls=s,this._initObservables(),this._setUpdateStrategy(o),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(s,o){return this.controls[s]?this.controls[s]:(this.controls[s]=o,o.setParent(this),o._registerOnCollectionChange(this._onCollectionChange),o)}addControl(s,o,u={}){this.registerControl(s,o),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}removeControl(s,o={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}setControl(s,o,u={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],o&&this.registerControl(s,o),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}contains(s){return this.controls.hasOwnProperty(s)&&this.controls[s].enabled}setValue(s,o={}){sO(this,!0,s),Object.keys(s).forEach(u=>{oO(this,!0,u),this.controls[u].setValue(s[u],{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o)}patchValue(s,o={}){s!=null&&(Object.keys(s).forEach(u=>{let _=this.controls[u];_&&_.patchValue(s[u],{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o))}reset(s={},o={}){this._forEachChild((u,_)=>{u.reset(s?s[_]:null,{onlySelf:!0,emitEvent:o.emitEvent})}),this._updatePristine(o),this._updateTouched(o),this.updateValueAndValidity(o)}getRawValue(){return this._reduceChildren({},(s,o,u)=>(s[u]=o.getRawValue(),s))}_syncPendingControls(){let s=this._reduceChildren(!1,(o,u)=>u._syncPendingControls()?!0:o);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){Object.keys(this.controls).forEach(o=>{let u=this.controls[o];u&&s(u,o)})}_setUpControls(){this._forEachChild(s=>{s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(s){for(let[o,u]of Object.entries(this.controls))if(this.contains(o)&&s(u))return!0;return!1}_reduceValue(){let s={};return this._reduceChildren(s,(o,u,_)=>((u.enabled||this.disabled)&&(o[_]=u.value),o))}_reduceChildren(s,o){let u=s;return this._forEachChild((_,i)=>{u=o(u,_,i)}),u}_allControlsDisabled(){for(let s of Object.keys(this.controls))if(this.controls[s].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(s){return this.controls.hasOwnProperty(s)?this.controls[s]:null}};var UE=class extends Uv{};var aO=new en("CallSetDisabledState",{providedIn:"root",factory:()=>WE}),WE="always";function t6(n,s){return[...s.path,n]}function LR(n,s,o=WE){ZE(n,s),s.valueAccessor.writeValue(n.value),(n.disabled||o==="always")&&s.valueAccessor.setDisabledState?.(n.disabled),i6(n,s),o6(n,s),r6(n,s),n6(n,s)}function FR(n,s,o=!0){let u=()=>{};s.valueAccessor&&(s.valueAccessor.registerOnChange(u),s.valueAccessor.registerOnTouched(u)),Gv(n,s),n&&(s._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function $v(n,s){n.forEach(o=>{o.registerOnValidatorChange&&o.registerOnValidatorChange(s)})}function n6(n,s){if(s.valueAccessor.setDisabledState){let o=u=>{s.valueAccessor.setDisabledState(u)};n.registerOnDisabledChange(o),s._registerOnDestroy(()=>{n._unregisterOnDisabledChange(o)})}}function ZE(n,s){let o=tO(n);s.validator!==null?n.setValidators(PR(o,s.validator)):typeof o=="function"&&n.setValidators([o]);let u=nO(n);s.asyncValidator!==null?n.setAsyncValidators(PR(u,s.asyncValidator)):typeof u=="function"&&n.setAsyncValidators([u]);let _=()=>n.updateValueAndValidity();$v(s._rawValidators,_),$v(s._rawAsyncValidators,_)}function Gv(n,s){let o=!1;if(n!==null){if(s.validator!==null){let _=tO(n);if(Array.isArray(_)&&_.length>0){let i=_.filter(P=>P!==s.validator);i.length!==_.length&&(o=!0,n.setValidators(i))}}if(s.asyncValidator!==null){let _=nO(n);if(Array.isArray(_)&&_.length>0){let i=_.filter(P=>P!==s.asyncValidator);i.length!==_.length&&(o=!0,n.setAsyncValidators(i))}}}let u=()=>{};return $v(s._rawValidators,u),$v(s._rawAsyncValidators,u),o}function i6(n,s){s.valueAccessor.registerOnChange(o=>{n._pendingValue=o,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&lO(n,s)})}function r6(n,s){s.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&lO(n,s),n.updateOn!=="submit"&&n.markAsTouched()})}function lO(n,s){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function o6(n,s){let o=(u,_)=>{s.valueAccessor.writeValue(u),_&&s.viewToModelUpdate(u)};n.registerOnChange(o),s._registerOnDestroy(()=>{n._unregisterOnChange(o)})}function s6(n,s){n==null,ZE(n,s)}function a6(n,s){return Gv(n,s)}function l6(n,s){if(!n.hasOwnProperty("model"))return!1;let o=n.model;return o.isFirstChange()?!0:!Object.is(s,o.currentValue)}function c6(n){return Object.getPrototypeOf(n.constructor)===GE}function u6(n,s){n._syncPendingControls(),s.forEach(o=>{let u=o.control;u.updateOn==="submit"&&u._pendingChange&&(o.viewToModelUpdate(u._pendingValue),u._pendingChange=!1)})}function h6(n,s){if(!s)return null;Array.isArray(s);let o,u,_;return s.forEach(i=>{i.constructor===jR?o=i:c6(i)?u=i:_=i}),_||u||o||null}function d6(n,s){let o=n.indexOf(s);o>-1&&n.splice(o,1)}function kR(n,s){let o=n.indexOf(s);o>-1&&n.splice(o,1)}function NR(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var zv=class extends yf{constructor(s=null,o,u){super(HE(o),qE(u,o)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(s),this._setUpdateStrategy(o),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),qv(o)&&(o.nonNullable||o.initialValueIsDefault)&&(NR(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,o={}){this.value=this._pendingValue=s,this._onChange.length&&o.emitModelToViewChange!==!1&&this._onChange.forEach(u=>u(this.value,o.emitViewToModelChange!==!1)),this.updateValueAndValidity(o)}patchValue(s,o={}){this.setValue(s,o)}reset(s=this.defaultValue,o={}){this._applyFormState(s),this.markAsPristine(o),this.markAsUntouched(o),this.setValue(this.value,o),this._pendingChange=!1}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){kR(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){kR(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){NR(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var f6=n=>n instanceof zv;var cO=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275dir=Xi({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var uO=new en("");var p6={provide:_f,useExisting:bc(()=>XE)},XE=(()=>{class n extends _f{constructor(o,u,_){super(),this.callSetDisabledState=_,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ii,this._setValidators(o),this._setAsyncValidators(u)}ngOnChanges(o){this._checkFormPresent(),o.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Gv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(o){let u=this.form.get(o.path);return LR(u,o,this.callSetDisabledState),u.updateValueAndValidity({emitEvent:!1}),this.directives.push(o),u}getControl(o){return this.form.get(o.path)}removeControl(o){FR(o.control||null,o,!1),d6(this.directives,o)}addFormGroup(o){this._setUpFormContainer(o)}removeFormGroup(o){this._cleanUpFormContainer(o)}getFormGroup(o){return this.form.get(o.path)}addFormArray(o){this._setUpFormContainer(o)}removeFormArray(o){this._cleanUpFormContainer(o)}getFormArray(o){return this.form.get(o.path)}updateModel(o,u){this.form.get(o.path).setValue(u)}onSubmit(o){return this.submitted=!0,u6(this.form,this.directives),this.ngSubmit.emit(o),o?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(o=void 0){this.form.reset(o),this.submitted=!1}_updateDomValue(){this.directives.forEach(o=>{let u=o.control,_=this.form.get(o.path);u!==_&&(FR(u||null,o),f6(_)&&(LR(_,o,this.callSetDisabledState),o.control=_))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(o){let u=this.form.get(o.path);s6(u,o),u.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(o){if(this.form){let u=this.form.get(o.path);u&&a6(u,o)&&u.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ZE(this.form,this),this._oldForm&&Gv(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(u){return new(u||n)(Yt($R,10),Yt(GR,10),Yt(aO,8))}}static{this.\u0275dir=Xi({type:n,selectors:[["","formGroup",""]],hostBindings:function(u,_){u&1&&br("submit",function(P){return _.onSubmit(P)})("reset",function(){return _.onReset()})},inputs:{form:[Lr.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Kd([p6]),ga,tl]})}}return n})();var m6={provide:pg,useExisting:bc(()=>YE)},YE=(()=>{class n extends pg{set isDisabled(o){}static{this._ngModelWarningSentOnce=!1}constructor(o,u,_,i,P){super(),this._ngModelWarningConfig=P,this._added=!1,this.name=null,this.update=new Ii,this._ngModelWarningSent=!1,this._parent=o,this._setValidators(u),this._setAsyncValidators(_),this.valueAccessor=h6(this,i)}ngOnChanges(o){this._added||this._setUpControl(),l6(o,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(o){this.viewModel=o,this.update.emit(o)}get path(){return t6(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(u){return new(u||n)(Yt(_f,13),Yt($R,10),Yt(GR,10),Yt(Hv,10),Yt(uO,8))}}static{this.\u0275dir=Xi({type:n,selectors:[["","formControlName",""]],inputs:{name:[Lr.None,"formControlName","name"],isDisabled:[Lr.None,"disabled","isDisabled"],model:[Lr.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[Kd([m6]),ga,tl]})}}return n})(),g6={provide:Hv,useExisting:bc(()=>Wv),multi:!0};function hO(n,s){return n==null?`${s}`:(s&&typeof s=="object"&&(s="Object"),`${n}: ${s}`.slice(0,50))}function _6(n){return n.split(":")[0]}var Wv=(()=>{class n extends GE{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(o){this._compareWith=o}writeValue(o){this.value=o;let u=this._getOptionId(o),_=hO(u,o);this.setProperty("value",_)}registerOnChange(o){this.onChange=u=>{this.value=this._getOptionValue(u),o(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(o){for(let u of this._optionMap.keys())if(this._compareWith(this._optionMap.get(u),o))return u;return null}_getOptionValue(o){let u=_6(o);return this._optionMap.has(u)?this._optionMap.get(u):o}static{this.\u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})()}static{this.\u0275dir=Xi({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(u,_){u&1&&br("change",function(P){return _.onChange(P.target.value)})("blur",function(){return _.onTouched()})},inputs:{compareWith:"compareWith"},features:[Kd([g6]),ga]})}}return n})(),dO=(()=>{class n{constructor(o,u,_){this._element=o,this._renderer=u,this._select=_,this._select&&(this.id=this._select._registerOption())}set ngValue(o){this._select!=null&&(this._select._optionMap.set(this.id,o),this._setElementValue(hO(this.id,o)),this._select.writeValue(this._select.value))}set value(o){this._setElementValue(o),this._select&&this._select.writeValue(this._select.value)}_setElementValue(o){this._renderer.setProperty(this._element.nativeElement,"value",o)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(u){return new(u||n)(Yt(Gr),Yt(zs),Yt(Wv,9))}}static{this.\u0275dir=Xi({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})(),y6={provide:Hv,useExisting:bc(()=>fO),multi:!0};function zR(n,s){return n==null?`${s}`:(typeof s=="string"&&(s=`'${s}'`),s&&typeof s=="object"&&(s="Object"),`${n}: ${s}`.slice(0,50))}function v6(n){return n.split(":")[0]}var fO=(()=>{class n extends GE{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(o){this._compareWith=o}writeValue(o){this.value=o;let u;if(Array.isArray(o)){let _=o.map(i=>this._getOptionId(i));u=(i,P)=>{i._setSelected(_.indexOf(P.toString())>-1)}}else u=(_,i)=>{_._setSelected(!1)};this._optionMap.forEach(u)}registerOnChange(o){this.onChange=u=>{let _=[],i=u.selectedOptions;if(i!==void 0){let P=i;for(let V=0;V<P.length;V++){let $=P[V],re=this._getOptionValue($.value);_.push(re)}}else{let P=u.options;for(let V=0;V<P.length;V++){let $=P[V];if($.selected){let re=this._getOptionValue($.value);_.push(re)}}}this.value=_,o(_)}}_registerOption(o){let u=(this._idCounter++).toString();return this._optionMap.set(u,o),u}_getOptionId(o){for(let u of this._optionMap.keys())if(this._compareWith(this._optionMap.get(u)._value,o))return u;return null}_getOptionValue(o){let u=v6(o);return this._optionMap.has(u)?this._optionMap.get(u)._value:o}static{this.\u0275fac=(()=>{let o;return function(_){return(o||(o=ks(n)))(_||n)}})()}static{this.\u0275dir=Xi({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(u,_){u&1&&br("change",function(P){return _.onChange(P.target)})("blur",function(){return _.onTouched()})},inputs:{compareWith:"compareWith"},features:[Kd([y6]),ga]})}}return n})(),pO=(()=>{class n{constructor(o,u,_){this._element=o,this._renderer=u,this._select=_,this._select&&(this.id=this._select._registerOption(this))}set ngValue(o){this._select!=null&&(this._value=o,this._setElementValue(zR(this.id,o)),this._select.writeValue(this._select.value))}set value(o){this._select?(this._value=o,this._setElementValue(zR(this.id,o)),this._select.writeValue(this._select.value)):this._setElementValue(o)}_setElementValue(o){this._renderer.setProperty(this._element.nativeElement,"value",o)}_setSelected(o){this._renderer.setProperty(this._element.nativeElement,"selected",o)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(u){return new(u||n)(Yt(Gr),Yt(zs),Yt(fO,9))}}static{this.\u0275dir=Xi({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})();var x6=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275mod=ns({type:n})}static{this.\u0275inj=ts({})}}return n})(),$E=class extends yf{constructor(s,o,u){super(HE(o),qE(u,o)),this.controls=s,this._initObservables(),this._setUpdateStrategy(o),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(s){return this.controls[this._adjustIndex(s)]}push(s,o={}){this.controls.push(s),this._registerControl(s),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}insert(s,o,u={}){this.controls.splice(s,0,o),this._registerControl(o),this.updateValueAndValidity({emitEvent:u.emitEvent})}removeAt(s,o={}){let u=this._adjustIndex(s);u<0&&(u=0),this.controls[u]&&this.controls[u]._registerOnCollectionChange(()=>{}),this.controls.splice(u,1),this.updateValueAndValidity({emitEvent:o.emitEvent})}setControl(s,o,u={}){let _=this._adjustIndex(s);_<0&&(_=0),this.controls[_]&&this.controls[_]._registerOnCollectionChange(()=>{}),this.controls.splice(_,1),o&&(this.controls.splice(_,0,o),this._registerControl(o)),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(s,o={}){sO(this,!1,s),s.forEach((u,_)=>{oO(this,!1,_),this.at(_).setValue(u,{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o)}patchValue(s,o={}){s!=null&&(s.forEach((u,_)=>{this.at(_)&&this.at(_).patchValue(u,{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o))}reset(s=[],o={}){this._forEachChild((u,_)=>{u.reset(s[_],{onlySelf:!0,emitEvent:o.emitEvent})}),this._updatePristine(o),this._updateTouched(o),this.updateValueAndValidity(o)}getRawValue(){return this.controls.map(s=>s.getRawValue())}clear(s={}){this.controls.length<1||(this._forEachChild(o=>o._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:s.emitEvent}))}_adjustIndex(s){return s<0?s+this.length:s}_syncPendingControls(){let s=this.controls.reduce((o,u)=>u._syncPendingControls()?!0:o,!1);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){this.controls.forEach((o,u)=>{s(o,u)})}_updateValue(){this.value=this.controls.filter(s=>s.enabled||this.disabled).map(s=>s.value)}_anyControls(s){return this.controls.some(o=>o.enabled&&s(o))}_setUpControls(){this._forEachChild(s=>this._registerControl(s))}_allControlsDisabled(){for(let s of this.controls)if(s.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(s){s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)}_find(s){return this.at(s)??null}};function BR(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var mO=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let o=new n;return o.useNonNullable=!0,o}group(o,u=null){let _=this._reduceControls(o),i={};return BR(u)?i=u:u!==null&&(i.validators=u.validator,i.asyncValidators=u.asyncValidator),new Uv(_,i)}record(o,u=null){let _=this._reduceControls(o);return new UE(_,u)}control(o,u,_){let i={};return this.useNonNullable?(BR(u)?i=u:(i.validators=u,i.asyncValidators=_),new zv(o,yi(St({},i),{nonNullable:!0}))):new zv(o,u,_)}array(o,u,_){let i=o.map(P=>this._createControl(P));return new $E(i,u,_)}_reduceControls(o){let u={};return Object.keys(o).forEach(_=>{u[_]=this._createControl(o[_])}),u}_createControl(o){if(o instanceof zv)return o;if(o instanceof yf)return o;if(Array.isArray(o)){let u=o[0],_=o.length>1?o[1]:null,i=o.length>2?o[2]:null;return this.control(u,_,i)}else return this.control(o)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var gO=(()=>{class n{static withConfig(o){return{ngModule:n,providers:[{provide:uO,useValue:o.warnOnNgModelWithFormControl??"always"},{provide:aO,useValue:o.callSetDisabledState??WE}]}}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275mod=ns({type:n})}static{this.\u0275inj=ts({imports:[x6]})}}return n})();function w6(n,s){if(n&1&&(wt(0,"option",7),Rt(1),Lt(2,"date"),vt()),n&2){let o=s.$implicit;ri("value",o),xt(),Jn(_T(2,2,o,"dd/MM/yyyy"))}}function T6(n,s){if(n&1&&(wt(0,"option",8),Rt(1),Lt(2,"translate"),Lt(3,"slice"),vt()),n&2){let o=s.$implicit;ri("value",o),xt(),pT(" ",zt(2,3,"Damm")," ",_T(3,5,o,15),"")}}var _O=(()=>{class n{constructor(o,u){this.placesService=o,this.fb=u,this.fechas=[],this.estacionsDisponibles=[],this.estacions=[],this.measurementSelected=new Ii,this.myForm=this.fb.group({date:["",fg.required],waterDam:["",fg.required]})}ngOnDestroy(){this.loadUniqueSubs?.unsubscribe(),this.setupDateSubs?.unsubscribe(),this.loadAvailableSubs?.unsubscribe(),this.onDateChangeSubs?.unsubscribe()}ngOnInit(){this.loadUniqueDates(),this.setupDateChangeListener(),this.onDateChange()}loadUniqueDates(){this.loadUniqueSubs=this.placesService.getUniqueDates().subscribe(o=>{this.fechas=o})}setupDateChangeListener(){let o=this.myForm.get("date");o&&(this.setupDateSubs=o.valueChanges.subscribe(u=>{this.loadAvailableEstacions(u)}))}loadAvailableEstacions(o){this.loadAvailableSubs=this.placesService.getAvailableEstacionsByDate(o).subscribe(u=>{this.estacionsDisponibles=u})}onDateChange(){let o=this.myForm.get("date");o&&(this.onDateChangeSubs=o.valueChanges.subscribe(u=>{u?this.placesService.getAvailableEstacionsByDate(u).subscribe(_=>{console.log("Estaciones disponibles:",_),this.estacions=_}):this.estacions=[]}))}onWaterDamChange(o){let _=o.target.value,i=this.myForm.get("date")?.value;this.onSelectMeasurement(i,_)}onSelectMeasurement(o,u){let _=o.split("T")[0];this.placesService.getMeasurements(_,u).subscribe(i=>{this.placesService.emitMeasurements(i)})}static{this.\u0275fac=function(u){return new(u||n)(Yt(Lc),Yt(mO))}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-selectors"]],outputs:{measurementSelected:"measurementSelected"},standalone:!0,features:[Ri],decls:12,vars:9,consts:[[3,"formGroup"],[1,"flex","flex-col","ms:flex-row","md:flex-row","gap-3","justify-evenly","rounded-sm"],["name","select","formControlName","date","id","date",1,"ml-1","p-2","w-full","rounded-sm","drop-shadow-xl"],["value",""],["selected","",3,"value",4,"ngFor","ngForOf"],["name","select","formControlName","waterDam","id","waterDam",1,"ml-1","w-full","p-2","drop-shadow-xl","rounded","shadow-blue-300",3,"change"],[3,"value",4,"ngFor","ngForOf"],["selected","",3,"value"],[3,"value"]],template:function(u,_){u&1&&(wt(0,"form",0)(1,"div",1)(2,"select",2)(3,"option",3),Rt(4),Lt(5,"translate"),vt(),pa(6,w6,3,5,"option",4),vt(),wt(7,"select",5),br("change",function(P){return _.onWaterDamChange(P)}),wt(8,"option",3),Rt(9),Lt(10,"translate"),vt(),pa(11,T6,4,8,"option",6),vt()()()),u&2&&(ri("formGroup",_.myForm),xt(4),zn("-- ",zt(5,5,"SelectorsDate")," --"),xt(2),ri("ngForOf",_.fechas),xt(3),zn("-- ",zt(10,7,"SelectorsDamm")," --"),xt(2),ri("ngForOf",_.estacions))},dependencies:[ao,tv,iv,nv,gO,cO,dO,pO,Wv,iO,rO,XE,YE,Yi,Tr]})}}return n})();var E6=(n,s)=>({"border-blue-500":n,"border-transparent":s});function I6(n,s){if(n&1){let o=Yd();wt(0,"img",4),br("click",function(){let _=Ud(o).$implicit,i=Ic();return $d(i.setCurrentIndex(_))}),vt()}if(n&2){let o=s.$implicit,u=Ic();qd("selected",o===u.currentIndex),ri("src",u.images[o],Mm)("ngClass",z2(4,E6,o===u.currentIndex,o!==u.currentIndex))}}var yO=(()=>{class n{constructor(){this.images=["assets/images/autumm.webp","assets/images/drought-2791710_1280.webp","assets/images/fascinante-paisaje-pinos-hermoso-lago_181624-25197.webp","assets/images/mountain-2651233_1280.webp","assets/images/nina.webp"],this.indices=[],this.currentIndex=0}ngOnInit(){this.indices=Array.from({length:this.images.length},(o,u)=>u),this.intervalId=setInterval(()=>this.nextImage(),1500)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}setCurrentIndex(o){this.currentIndex=o}nextImage(){"startViewTransition"in document?document.startViewTransition(()=>{this.currentIndex=(this.currentIndex+1)%this.images.length}):this.currentIndex=(this.currentIndex+1)%this.images.length}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-slider-transition"]],standalone:!0,features:[Ri],decls:5,vars:1,consts:[[1,"slider"],["loading","lazy","alt","imagenes de rios, pantanos y pantanos secos",1,"img","w-full","lg:w-screen","h-[calc(100vh-48px)]","object-cover",3,"srcset"],[1,"flex","flex-row","relative","mt-4","space-x-1"],["loading","lazy","alt","imagenes de rios, pantanos y pantanos secos",1,"ml-1","w-16","h-16","object-cover","cursor-pointer","rounded-md","border-2",3,"src","selected","ngClass"],["loading","lazy","alt","imagenes de rios, pantanos y pantanos secos",1,"ml-1","w-16","h-16","object-cover","cursor-pointer","rounded-md","border-2",3,"click","src","ngClass"]],template:function(u,_){u&1&&(wt(0,"section",0),Sn(1,"img",1),vt(),wt(2,"div",2),Zd(3,I6,1,7,"img",3,Wd),vt()),u&2&&(xt(),ri("srcset",_.images[_.currentIndex]),xt(2),Xd(_.indices))},dependencies:[ao,nf],styles:[".slider[_ngcontent-%COMP%]{position:absolute;z-index:0}.carrussel[_ngcontent-%COMP%]{position:absolute}"]})}}return n})();var C6=["mapDiv"];function D6(n,s){n&1&&(wt(0,"div")(1,"div",3),Sn(2,"app-selectors",4)(3,"div",5),vt(),Sn(4,"div",6,0),vt())}function M6(n,s){n&1&&(wt(0,"div"),Sn(1,"app-sidenav"),vt())}function S6(n,s){if(n&1){let o=Yd();wt(0,"div",7),Sn(1,"app-slider-transition"),wt(2,"div",8)(3,"h6",9),Rt(4),Lt(5,"translate"),vt(),wt(6,"h1",10),Rt(7,"Claustrum"),vt(),wt(8,"h3",11),Rt(9,"Aqvae"),vt(),wt(10,"button",12),br("click",function(){Ud(o);let _=Ic();return $d(_.isVisible())}),wt(11,"span",13),Rt(12),Lt(13,"translate"),Sn(14,"span",14)(15,"span",15),vt()()()()}n&2&&(xt(4),Jn(zt(5,2,"MapSubtitle")),xt(8),zn(" ",zt(13,4,"MapSpan")," "))}var vO=(()=>{class n{constructor(o,u){this.cdr=o,this.placesService=u,this.estacions=[],this.estaciName=[],this.markers=[],this.measurements=[],this.isCoverPageVisible=!0,this.location_estations={}}ngOnDestroy(){this.map?.remove(),this.getEstaciSubs?.unsubscribe(),this.getCoordSubs?.unsubscribe(),this.getCenterSubs?.unsubscribe()}ngAfterViewInit(){this.isCoverPageVisible||this.initMap()}ngOnInit(){this.center()}isVisible(){this.isCoverPageVisible=!1,this.cdr.detectChanges(),setTimeout(()=>{this.initMap(),this.fetchEstaci()},0)}initMap(){if(this.map){console.warn("El mapa ya est\xE1 inicializado.");return}this.mapDivElement?(this.map=new vf.Map({container:this.mapDivElement.nativeElement,pitch:42,bearing:5,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[2.833944,41.977247],zoom:10,projection:"globe",accessToken:Fv.apiKey}),this.map.setCenter([2.833944,41.977247])):console.error("mapDivElement no esta disponivle")}fetchEstaci(){this.getEstaciSubs=this.placesService.getEstaci().subscribe({next:o=>{this.estaciName=o,console.log(this.estaciName),this.estaciName.forEach(u=>{this.getCoordinates(u),console.log(u)})},error:o=>console.error("Error al obtener datos:",o)})}getCoordinates(o){if(this.location_estations[o]){let u=this.location_estations[o];this.flyTo(u,o),this.addMarker(u,o);return}this.getCoordSubs=this.placesService.getCoordinates(o).subscribe({next:u=>{console.log(u.features[0].center),console.log(u.features[0].geometry.coordinates);let _;_=u.features[0].geometry.coordinates,_.length>0&&(this.location_estations[o]=_),this.flyTo(_,o),this.addMarker(_,o)},error:u=>console.error("Error al obtener datos:",u)})}addMarker(o,u){new vf.Marker().setLngLat(o).setPopup(new vf.Popup().setHTML(`<h3>${u}</h3>`)).addTo(this.map).getElement().addEventListener("click",()=>{this.flyTo(o,u)})}flyTo(o,u){this.map.flyTo({zoom:12,center:o,speed:.6,curve:1.9,essential:!0})}center(){this.getCenterSubs=this.placesService.measurements$.subscribe(o=>{if(this.measurements=o,this.measurements.length>0){console.log("Mediciones en map:",this.measurements);let _=this.measurements[0].estaci;_&&this.getCoordinates(_)}})}static{this.\u0275fac=function(u){return new(u||n)(Yt(Bs),Yt(Lc))}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-map"]],viewQuery:function(u,_){if(u&1&&k2(C6,5),u&2){let i;k0(i=N0())&&(_.mapDivElement=i.first)}},standalone:!0,features:[Ri],decls:3,vars:3,consts:[["mapDiv",""],[4,"ngIf"],["class","map1 flex h-[calc(100vh-48px)] w-full",4,"ngIf"],[1,"container","bg-gradient-to-r","from-cyan-100","to-blue-100","prueba","md:w-8/12","h-28","md:flex-row","flex","sm:flex-row","sm:h-14","md:h-14","p-2","mt-2","rounded-sm"],[1,"w-full"],[1,"prueba"],[1,"map-container"],[1,"map1","flex","h-[calc(100vh-48px)]","w-full"],[1,"overlay","flex","flex-col","justify-center","items-center","w-full"],[1,"text-1xl","p-1","text-amber-200","line-clamp-3","bg-blue-600"],[1,"p-1","text-5xl","font-extrabold","text-amber-300","drop-shadow-lg","title1"],[1,"text-4xl","text-white","font-extrabold","title2","0"],[1,"w-24","mt-3","h-9","p-1","bg-blue-600","rounded-md",3,"click"],[1,"relative","text-white","font-bold","h-3","w-3"],[1,"animate-ping","absolute","inline-flex","h-4","w-4","mt-2","rounded-full","bg-red-600","opacity-75"],[1,"relative","inline-flex","rounded-full","h-2","w-2","mt-1","ml-1","bg-red-500"]],template:function(u,_){u&1&&pa(0,D6,6,0,"div",1)(1,M6,2,0,"div",1)(2,S6,16,6,"div",2),u&2&&(ri("ngIf",!_.isCoverPageVisible),xt(),ri("ngIf",!_.isCoverPageVisible),xt(),ri("ngIf",_.isCoverPageVisible))},dependencies:[ao,lP,MR,_O,yO,Yi,Tr],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:100vh;z-index:0}.map1[_ngcontent-%COMP%]{position:absolute;z-index:0}.prueba[_ngcontent-%COMP%]{position:absolute;z-index:100}.overlay[_ngcontent-%COMP%]{position:relative}.title1[_ngcontent-%COMP%], .title2[_ngcontent-%COMP%]{text-shadow:2px 3px darkblue}"]})}}return n})();function A6(n,s){if(n&1&&(wt(0,"div",5)(1,"p",6),Rt(2),Lt(3,"translate"),vt(),Sn(4,"img",7),Lt(5,"translate"),wt(6,"p",8),Rt(7),Lt(8,"translate"),vt(),wt(9,"p",9),Rt(10),Lt(11,"translate"),vt()()),n&2){let o=s.$implicit;xt(2),zn(" ",zt(3,5,"species."+o.key+".title")," "),xt(2),fT("alt",o.key),ri("src",zt(5,7,"species."+o.key+".image"),Mm),xt(3),Jn(zt(8,9,"species."+o.key+".scientificName")),xt(3),Jn(zt(11,11,"species."+o.key+".habitat"))}}var xO=(()=>{class n{constructor(o){this.placeService=o,this.speciesData=[],this.speciesData1=[{key:"Barbdemuntanya",title:"species.Barbdemuntanya.title",scientificName:"species.Barbdemuntanya.scientificName",habitat:"species.Barbdemuntanya.habitat",img:"species.Barbdemuntanya.image"},{key:"Tritodelmontseny",title:"species.Tritodelmontseny.title",scientificName:"species.Tritodelmontseny.scientificName",habitat:"species.Tritodelmontseny.habitat",img:"species.Tritodelmontseny.image"},{key:"Salamandracomuna",title:"species.Salamandracomuna.title",scientificName:"species.Salamandracomuna.scientificName",habitat:"species.Salamandracomuna.habitat"},{key:"Tortugadestany",title:"species.Tortugadestany.title",scientificName:"species.Tortugadestany.scientificName",habitat:"species.Tortugadestany.habitat"},{key:"Naiade",title:"species.Naiade.title",scientificName:"species.Naiade.scientificName",habitat:"species.Naiade.habitat"},{key:"Anguila",title:"species.Anguila.title",scientificName:"species.Anguila.scientificName",habitat:"species.Anguila.habitat"}]}ngOnInit(){this.getSpecies()}ngOnDestroy(){}getSpecies(){this.placeService.getSpeciesData().subscribe(o=>{this.speciesData=o})}static{this.\u0275fac=function(u){return new(u||n)(Yt(Lc))}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-species-story"]],standalone:!0,features:[Ri],decls:28,vars:21,consts:[[1,"flex","flex-col","sm:flex-row","md:flex-row","md:ml-20","md:mr-20","justify-center","items-center","mt-8","pb-3","ml-5","mr-5","p-1","rounded-lg","shadow-lg","mb-8"],[1,"p-2"],[1,"text-3xl","font-bold","bg-gradient-to-r","from-cyan-200","to-blue-100","mb-2"],[1,"md:ml-20","md:mr-20","ml-3","mr-3","text-3xl","font-bold","bg-gradient-to-r","from-cyan-200","to-blue-100","p-2","mb-8"],[1,"grid","grid-cols-1","md:grid-cols-3","md:ml-20","md:mr-20","gap-3","rounded-lg","mb-8"],[1,"w-auto","especie1","bg-slate-100","p-3","rounded-sm","shadow-lg"],[1,"text-gray-50","bg-gradient-to-r","from-sky-300","to-indigo-400","p-2","font-bold"],[1,"w-full","object-cover","h-36",3,"src","alt"],[1,"text-xs","w-full","text-center","p-1","font-bold"],[1,"mt-2","text-center"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"div",1)(2,"h1",2),Rt(3),Lt(4,"translate"),vt(),wt(5,"span"),Rt(6),Lt(7,"translate"),vt(),Sn(8,"br")(9,"br"),wt(10,"span"),Rt(11),Lt(12,"translate"),wt(13,"strong"),Rt(14),Lt(15,"translate"),vt(),Rt(16),Lt(17,"translate"),vt(),Sn(18,"br"),wt(19,"span"),Rt(20),Lt(21,"translate"),vt()()(),wt(22,"h1",3),Rt(23),Lt(24,"translate"),vt(),wt(25,"div",4),Zd(26,A6,12,13,"div",5,Wd),vt()),u&2&&(xt(3),Jn(zt(4,7,"SpeciesTitle")),xt(3),Jn(zt(7,9,"SpeciesSub")),xt(5),zn("",zt(12,11,"SpeciesStrong1")," "),xt(3),zn("",zt(15,13,"SpeciesStrong2")," "),xt(2),zn(" ",zt(17,15,"SpeciesStrong3"),""),xt(4),zn("",zt(21,17,"SpeciesSpan")," "),xt(3),zn(" ",zt(24,19,"SpeciesEx"),`
`),xt(3),Xd(_.speciesData1))},dependencies:[ao,Yi,Tr]})}}return n})();var bO=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-info-conciencia"]],standalone:!0,features:[Ri],decls:20,vars:18,consts:[[1,"flex","flex-col","sm:flex-row","md:flex-row","md:ml-20","md:mr-20","justify-center","items-center","mt-7","pb-3","ml-5","mr-5","p-1","rounded-lg","shadow-lg","mb-8"],[1,"p-2"],[1,"text-3xl","font-bold","bg-gradient-to-r","from-cyan-200","to-blue-100","mb-2"],[1,"mt-2"],["src","https://img.freepik.com/foto-gratis/adolescente-duchandose-reducir-efecto-resaca_23-2150894827.jpg?t=st=1730987829~exp=1730991429~hmac=d008b1df8e7082626a391fb8195d31ad73e5ffe131e9aa6b630e32422a83e1c5&w=826",1,"rounded","w-full","p-2","md:w-60",3,"alt"],["src","https://img.freepik.com/foto-gratis/vaso-agua-macro-disparo_53876-14908.jpg?t=st=1730990015~exp=1730993615~hmac=4da6bf8161fcabc6acf357c02b11a6a6c7e93d422a486a72d0f60fdef785d3b5&w=740",1,"rounded","w-full","p-2","md:w-60",3,"alt"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"div",1)(2,"h1",2),Rt(3),Lt(4,"translate"),vt(),wt(5,"span",3),Rt(6),Lt(7,"translate"),vt()(),Sn(8,"img",4),Lt(9,"translate"),vt(),wt(10,"div",0),Sn(11,"img",5),Lt(12,"translate"),wt(13,"div",1)(14,"h1",2),Rt(15),Lt(16,"translate"),vt(),wt(17,"span",3),Rt(18),Lt(19,"translate"),vt()()()),u&2&&(xt(3),Jn(zt(4,6,"ConsciousnessTitle")),xt(3),zn("",zt(7,8,"ConsciousnessSubst")," "),xt(2),ri("alt",zt(9,10,"ConsciousAlt")),xt(3),ri("alt",zt(12,12,"ConsciousAlt")),xt(4),Jn(zt(16,14,"ConciousEmergency")),xt(3),zn("",zt(19,16,"ConciousEmerParagraf")," "))},dependencies:[Yi,Tr]})}}return n})();var wO=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-info-tips"]],standalone:!0,features:[Ri],decls:72,vars:65,consts:[[1,"md:ml-20","md:mr-20","ml-3","mr-3","text-3xl","font-bold","bg-gradient-to-r","from-cyan-200","to-blue-100","p-2","mb-8"],[1,"md:ml-20","md:mr-20","ml-3","mr-3","text-1xl","font-bold","bg-gradient-to-r","from-cyan-50","to-blue-100","p-1"],[1,"grid","grid-cols-1","h-auto","md:grid-cols-2","md:ml-20","md:mr-20","gap-3","rounded-lg","mb-8","mt-2"],[1,"w-auto","especie1","bg-slate-100","p-3","rounded-sm","shadow-lg"],[1,"text-red-500","bg-gradient-to-r","from-sky-50","to-indigo-100","p-2","font-bold","text-sm"],["src","https://img.freepik.com/foto-gratis/vista-superior-persona-que-lava-manos-fregadero_23-2148602935.jpg?t=st=1730996523~exp=1731000123~hmac=a89eaa4168b5ad43880f59046cec18ebe496fd32b7371aa4b0268946550baf30&w=826",1,"w-full","object-cover","h-36",3,"alt"],[1,"mt-2","text-center"],[1,"text-red-500","bg-gradient-to-r","from-sky-50","to-indigo-100","p-2","font-bold"],["src","https://img.freepik.com/foto-gratis/aseo-nadie-blanca-wc_1203-3837.jpg?t=st=1730997791~exp=1731001391~hmac=3cfc29b08ef416f0b28b6702ce282fdbb4674df6b7536de2d886d7ac9a144618&w=360",1,"w-full","object-cover","h-36",3,"alt"],[1,"text-xs","w-full","text-center","p-1","font-bold"],["src","https://img.freepik.com/foto-gratis/hombre-tiro-medio-cantando-ducha_23-2150323096.jpg?t=st=1730998375~exp=1731001975~hmac=c1afcd8a2364c6b4e47405ba13e37554bac3532a0e7988f092f3f913eca6715f&w=900",1,"w-full","object-cover","h-36",3,"alt"],["src","https://img.freepik.com/foto-gratis/plato-limpio-plato-rack_1339-7043.jpg?t=st=1731000067~exp=1731003667~hmac=bd01b7793ba26e6d9f1a30d3179b67721baa17b88d9f5d527d0341ba5b87983f&w=360",1,"w-full","object-cover","h-36",3,"alt"],["src","https://images.hola.com/imagenes/decoracion/20210415187823/cultivar-lavanda-plantas-exterior-mc/0-940-990/cultivar-lavanda-3-a.jpg","alt","jardi amb plantes autoct\xF3nes",1,"w-full","object-cover","h-36"],["src","https://img.freepik.com/foto-gratis/hombres-descansando-piscina-patio_23-2148107904.jpg?t=st=1731000958~exp=1731004558~hmac=54c5efd6e29023d4b070cfb70481f2aa20a18f878e3e17e78dfea787afc42bfc&w=826","alt","piscina molt cuidada",1,"w-full","object-cover","h-36"]],template:function(u,_){u&1&&(wt(0,"h1",0),Rt(1),Lt(2,"translate"),vt(),wt(3,"h3",1),Rt(4),Lt(5,"translate"),vt(),wt(6,"div",2)(7,"div",3)(8,"p",4),Rt(9),Lt(10,"translate"),vt(),Sn(11,"img",5),Lt(12,"translate"),wt(13,"p",6),Rt(14),Lt(15,"translate"),vt()(),wt(16,"div",3)(17,"p",7),Rt(18),Lt(19,"translate"),vt(),Sn(20,"img",8),wt(21,"p",9),Rt(22),Lt(23,"translate"),vt(),wt(24,"p",6),Rt(25),Lt(26,"translate"),vt()(),wt(27,"div",3)(28,"p",7),Rt(29),Lt(30,"translate"),vt(),Sn(31,"img",10),wt(32,"p",9),Rt(33),Lt(34,"translate"),vt(),wt(35,"p",6),Rt(36),Lt(37,"translate"),vt()(),wt(38,"div",3)(39,"p",7),Rt(40),Lt(41,"translate"),vt(),Sn(42,"img",11),Lt(43,"translate"),wt(44,"p",9),Rt(45),Lt(46,"translate"),vt(),wt(47,"p",6),Rt(48),Lt(49,"translate"),vt()(),wt(50,"div",3)(51,"p",7),Rt(52),Lt(53,"translate"),vt(),Sn(54,"img",12),wt(55,"p",9),Rt(56),Lt(57,"translate"),vt(),wt(58,"p",6),Rt(59),Lt(60,"translate"),vt()(),wt(61,"div",3)(62,"p",7),Rt(63),Lt(64,"translate"),vt(),Sn(65,"img",13),wt(66,"p",9),Rt(67),Lt(68,"translate"),vt(),wt(69,"p",6),Rt(70),Lt(71,"translate"),vt()()()),u&2&&(xt(),zn(" ",zt(2,23,"InfoTipstitle"),`
`),xt(3),zn(" ",zt(5,25,"InfoTipsSubs"),""),xt(5),zn("",zt(10,27,"InfoTipsAlt")," "),xt(2),ri("alt",zt(12,29,"InfoTipsAlt")),xt(3),Jn(zt(15,31,"InfoTipsParag1")),xt(4),zn("",zt(19,33,"InfoTipstitle1")," "),xt(2),ri("alt","InfoTipsAlt1 | translate"),xt(2),Jn(zt(23,35,"InfoTipssubs2")),xt(3),Jn(zt(26,37,"InfoTipssubs2")),xt(4),zn("",zt(30,39,"InfoTipstitle2")," "),xt(2),ri("alt","InfoTipsAlt2 |translate"),xt(2),zn("",zt(34,41,"InfoTipssubs3")," "),xt(3),Jn(zt(37,43,"InfoTipsParag3")),xt(4),zn(" ",zt(41,45,"InfoTipstitle3")," "),xt(2),ri("alt",zt(43,47,"InfoTipsAlt3")),xt(3),zn("",zt(46,49,"InfoTipssubs4")," "),xt(3),zn("",zt(49,51,"InfoTipsParag4")," "),xt(4),zn("",zt(53,53,"InfoTipstitle4")," "),xt(4),Jn(zt(57,55,"InfoTipssubs5")),xt(3),Jn(zt(60,57,"InfoTipsParag5")),xt(4),zn(" ",zt(64,59,"InfoTipstitle6")," "),xt(4),Jn(zt(68,61,"InfoTipssubs6")),xt(3),zn("",zt(71,63,"InfoTipsParag6")," "))},dependencies:[Yi,Tr]})}}return n})();var TO=(()=>{class n{constructor(){}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-story"]],standalone:!0,features:[Ri],decls:34,vars:27,consts:[[1,"flex","flex-col","sm:flex-row","md:flex-row","md:ml-20","md:mr-20","justify-center","items-center","mt-7","pb-3","ml-5","mr-5","p-1","rounded-lg","shadow-lg","mb-4"],[1,"p-2"],[1,"text-3xl","font-bold","bg-gradient-to-r","from-cyan-200","to-blue-100","mb-2"],[1,"mt-2"],["src","https://m1.quebecormedia.com/emp/emp/636635b0-baaf-11ee-89f7-fb32b8a46919_ORIGINAL.jpg?impolicy=crop-resize&x=0&y=0&w=1200&h=800&width=1000",1,"rounded","w-full","p-2","md:w-60",3,"alt"],[1,"flex","flex-col","sm:flex-row","md:flex-row","mt-12","ml-5","mr-10","p-3","mb-4","rounded-lg","shadow-lg","md:ml-20","md:mr-20"],["src","assets/images/anomaliadelatemperatura.png",1,"rounded","w-full","p-2","md:w-60",3,"alt"],[1,"text-3xl","font-bold","mb-7","bg-gradient-to-r","from-cyan-200","to-blue-100"],[1,"mb-7","text-justify"],[1,"mb-7","text-1xl","font-bold","text-justify"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"div",1)(2,"h1",2),Rt(3),Lt(4,"translate"),vt(),wt(5,"span",3),Rt(6),Lt(7,"translate"),wt(8,"strong"),Rt(9),Lt(10,"translate"),vt(),Rt(11),Lt(12,"translate"),vt()(),Sn(13,"img",4),Lt(14,"translate"),vt(),wt(15,"div",5),Sn(16,"img",6),Lt(17,"translate"),wt(18,"div",1)(19,"h1",7),Rt(20),Lt(21,"translate"),vt(),wt(22,"span",8),Rt(23),Lt(24,"translate"),vt(),Sn(25,"br")(26,"br"),wt(27,"span",9)(28,"cite"),Rt(29),Lt(30,"translate"),vt()()()(),Sn(31,"app-species-story")(32,"app-info-conciencia")(33,"app-info-tips")),u&2&&(xt(3),Jn(zt(4,9,"StoryTitle1")),xt(3),zn("",zt(7,11,"StorySpanStrong1")," "),xt(3),Jn(zt(10,13,"StorySpanStrong2")),xt(2),Jn(zt(12,15,"StorySpanStrong3")),xt(2),ri("alt",zt(14,17,"StoryImgAlt")),xt(3),ri("alt",zt(17,19,"StoryImgAlt1")),xt(4),Jn(zt(21,21,"StoryTitle2")),xt(3),zn("",zt(24,23,"StorySpan")," "),xt(6),zn("",zt(30,25,"StorySpan1")," "))},dependencies:[xO,bO,wO,Yi,Tr]})}}return n})();var EO=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-notfoundpage"]],standalone:!0,features:[Ri],decls:11,vars:6,consts:[[1,"w-screen"],[1,"fondo","h-[calc(100vh-56px)]","flex","flex-col","justify-center","items-center","text-center"],[1,"text-white","font-extrabold","text-9xl","Letrasconfondo","mt-8"],[1,"text-2xl","font-extrabold"],[1,"text-1xl"],["src",XA`https://lottie.host/embed/065c97e9-fc1d-4270-bef6-25a3e95ae995/AQqb5YktOl.json`,1,"w-full","h-full","md:w-full","md:h-full","lg:w-full","lg:h-full"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"div",1)(2,"h1",2),Rt(3,"404"),vt(),wt(4,"h1",3),Rt(5),Lt(6,"translate"),vt(),wt(7,"h2",4),Rt(8),Lt(9,"translate"),vt(),Sn(10,"iframe",5),vt()()),u&2&&(xt(5),Jn(zt(6,2,"ErrorPage")),xt(3),Jn(zt(9,4,"PageNotFound")))},dependencies:[Yi,Tr],styles:[".Letrasconfondo[_ngcontent-%COMP%]{background:url(https://img.freepik.com/vector-gratis/fondo-realista-agua-limpia_52683-60648.jpg?t=st=1731098394~exp=1731101994~hmac=1026811cae80923f26a4dd3b6e027705f60754f8cc4d8e9834d87053a5e2212a&w=826);-webkit-text-fill-color:transparent;background-clip:text;background-size:contain;text-shadow:-12px 2px 3px rgba(70,230,244,.317)}"]})}}return n})();var IO=[{path:"",component:vO},{path:"story",component:TO},{path:"**",component:EO}];var CO={providers:[yR(IO,AE({skipInitialTransition:!0}))]};var DO=(()=>{class n{constructor(o){this.translate=o,this.translate.setDefaultLang("ca"),this.setLanguage("ca")}setLanguage(o){this.translate.use(o)}getLanguage(){return this.translate.currentLang||"ca"}static{this.\u0275fac=function(u){return new(u||n)(Zt(cg))}}static{this.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var R6=n=>({active:n});function O6(n,s){if(n&1){let o=Yd();wt(0,"button",2),br("click",function(){let _=Ud(o).$implicit,i=Ic();return $d(i.switchLanguage(_.code))}),Rt(1),vt()}if(n&2){let o=s.$implicit,u=Ic();ri("ngClass",z0(2,R6,u.currentLanguage===o.code)),xt(),zn(" ",o.name," ")}}var MO=(()=>{class n{constructor(o){this.languageService=o,this.languages=[{code:"en",name:"English"},{code:"es",name:"Espa\xF1ol"},{code:"ca",name:"Catal\xE1"}],this.currentLanguage=this.languageService.getLanguage()}switchLanguage(o){this.languageService.setLanguage(o),this.currentLanguage=o}static{this.\u0275fac=function(u){return new(u||n)(Yt(DO))}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-language-selector"]],standalone:!0,features:[Ri],decls:2,vars:1,consts:[[1,"language-selector","text-right","md:text-center","lg:text-center","flex-col","md:flex-row","lg:flex-row","gap-1","p-1"],["class","w-42 bg-fuchsia-300 ml-2 p-1 rounded-md text-xs",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"w-42","bg-fuchsia-300","ml-2","p-1","rounded-md","text-xs",3,"click","ngClass"]],template:function(u,_){u&1&&(wt(0,"div",0),pa(1,O6,2,4,"button",1),vt()),u&2&&(xt(),ri("ngForOf",_.languages))},dependencies:[ao,nf,tv,Yi]})}}return n})();var L6=()=>["/"],F6=()=>["/story"],SO=(()=>{class n{static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-header"]],standalone:!0,features:[Ri],decls:16,vars:10,consts:[[1,"w-full","bg-gradient-to-r","from-cyan-200","to-blue-500","text-gray-700"],[1,"flex","max-w-screen-xl","justify-around","px-5","mx-auto","md:items-center","md:justify-between","md:flex-row","lg:px-8"],[1,"flex","items-center"],["href","#",1,"text-sm","font-semibold","tracking-widest","text-lime-950","uppercase","rounded-lg","dark-mode:text-white","focus:outline-none","focus:shadow-outline"],["src","https://i.ibb.co/0M7ZsMm/gota-de-agua-1.png","alt","gota de agua",1,"w-4","h-6","md:w-8","md:h-12","ml-1","mb-1"],[1,"flex","flex-col","ml-9","justify-center","p-1","gap-1","md:flex-row","lg:flex-row","mt-2"],[1,"w-18","rounded-lg","p-1","text-white","text-xs","font-bold","border-spacing-1","border-2","text-center"],[3,"routerLink"],[1,"text-center","w-18","font-bold","text-white","text-xs","p-1","rounded-lg","border-spacing-1","border-2","border-white"],["routerLinkActive","active",3,"routerLink"]],template:function(u,_){u&1&&(wt(0,"div",0)(1,"nav",1)(2,"div",2)(3,"a",3),Rt(4,"Claustrum Aquae"),vt(),Sn(5,"img",4),vt(),wt(6,"div",5)(7,"button",6)(8,"a",7),Rt(9),Lt(10,"translate"),vt()(),wt(11,"button",8)(12,"a",9),Rt(13),Lt(14,"translate"),vt()()(),Sn(15,"app-language-selector"),vt()()),u&2&&(xt(8),ri("routerLink",mT(8,L6)),xt(),Jn(zt(10,4,"home")),xt(3),ri("routerLink",mT(9,F6)),xt(),Jn(zt(14,6,"history")))},dependencies:[TR,Mv,gR,MO,Yi,Tr]})}}return n})();var AO=(()=>{class n{constructor(){this.title="Aqvae"}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275cmp=Pi({type:n,selectors:[["app-root"]],standalone:!0,features:[Ri],decls:2,vars:0,template:function(u,_){u&1&&Sn(0,"app-header")(1,"router-outlet")},dependencies:[ao,TE,SO]})}}return n})();var Zv=class{http;prefix;suffix;constructor(s,o="/assets/i18n/",u=".json"){this.http=s,this.prefix=o,this.suffix=u}getTranslation(s){return this.http.get(`${this.prefix}${s}${this.suffix}`)}};function k6(n){return new Zv(n,"./assets/i18n/",".json")}var N6=[Ew(bP,Yi.forRoot({loader:{provide:Oc,useFactory:k6,deps:[Fm]}})),...CO.providers||[]];SP(AO,{providers:N6}).catch(n=>console.error(n));export{k6 as HttpLoaderFactory};
